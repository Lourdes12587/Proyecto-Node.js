<%- include('partials/head') %>

<%- include('partials/header') %>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" defer></script>
<link rel="stylesheet" href="/resources/css/inscripcion.css">

<div class="container">
  <div class="inscripcion-container">

    <!-- Banner motivacional con imagen de fondo -->
    <div class="motivational-banner">
      <div class="banner-overlay">
        <h2>¡Prepárate para la gran carrera!</h2>
        <p>Visualiza la meta, siente la emoción y anima a inscribirte hoy.</p>
      </div>
    </div>

    <h2>FORMULARIO DE INSCRIPCIÓN</h2>

    <form action="/inscripcion" method="POST" enctype="multipart/form-data">
      <div class="form-left">
        <div class="form-group">
          <label for="foto">Foto para dorsal/perfil:</label>
          <input type="file" name="foto" accept="image/*" required>
        </div>

        <div class="form-group">
          <label for="nombre">Nombre:</label>
          <input type="text" name="nombre" placeholder="Ingrese su nombre"
            value="<%= (typeof valores !== 'undefined' && valores.nombre) ? valores.nombre : '' %>">
        </div>

        <div class="form-group">
          <label for="apellido">Apellido:</label>
          <input type="text" name="apellido" placeholder="Ingrese su apellido"
            value="<%= (typeof valores !== 'undefined' && valores.apellido) ? valores.apellido : '' %>">
        </div>

        <div class="form-group">
          <label for="dni">DNI:</label>
          <input type="text" name="dni" placeholder="Ingrese su DNI"
            value="<%= (typeof valores !== 'undefined' && valores.dni) ? valores.dni : '' %>">
        </div>

        <div class="form-group">
          <label for="telefono">Teléfono:</label>
          <input type="text" name="telefono" placeholder="Ingrese su teléfono"
            value="<%= (typeof valores !== 'undefined' && valores.telefono) ? valores.telefono : '' %>">
        </div>

        <div class="form-group">
          <label for="calle">Calle:</label>
          <input type="text" name="calle" placeholder="Ingrese su calle"
            value="<%= (typeof valores !== 'undefined' && valores.calle) ? valores.calle : '' %>">
        </div>

        <div class="form-group">
          <label for="numero">N°:</label>
          <input type="text" name="numero" placeholder="N°"
            value="<%= (typeof valores !== 'undefined' && valores.numero) ? valores.numero : '' %>">
        </div>

        <div class="form-group">
          <label for="poblacion">Población:</label>
          <input type="text" name="poblacion" placeholder="Ingrese su población"
            value="<%= (typeof valores !== 'undefined' && valores.poblacion) ? valores.poblacion : '' %>">
        </div>

        <div class="form-group">
          <label for="codigo_postal">Código Postal N°:</label>
          <input type="text" name="codigo_postal" placeholder="Ingrese su código postal"
            value="<%= (typeof valores !== 'undefined' && valores.codigo_postal) ? valores.codigo_postal : '' %>">
        </div>

        <div class="form-group full">
          <label for="password">Contraseña:</label>
          <input type="password" name="password" placeholder="Ingrese su contraseña"
            value="<%= (typeof valores !== 'undefined' && valores.password) ? valores.password : '' %>">
        </div>

        <div class="form-group full">
          <button type="submit" class="btn-registrarse">INSCRIBIRSE</button>
        </div>

        <% if (typeof validaciones !== 'undefined' && Array.isArray(validaciones) && validaciones.length) { %>
          <div class="form-group full">
            <% validaciones.forEach(function(validacion) { %>
              <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <strong><%= validacion.msg %></strong>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            <% }); %>
          </div>
        <% } %>

      </div> <!-- .form-left -->

      <!-- RIGHT COLUMN: Weather widget -->
      <div class="weather-widget" style="margin-left:18px;">
        <% if (typeof clima !== 'undefined' && clima) { %>
          <h3><%= clima.city %></h3>

          <% if (clima.icon) { %>
            <div style="text-align:center;">
              <img src="https://openweathermap.org/img/wn/<%= clima.icon %>@2x.png" alt="icon" style="width:100px;height:100px;">
            </div>
          <% } %>

          <p><strong>Temperatura:</strong> <%= clima.temp %>°C</p>
          <p><strong>Sensación:</strong> <%= clima.feels_like %>°C</p>
          <p><strong>Humedad:</strong> <%= clima.humidity %>%</p>
          <p><strong>Descripción:</strong> <%= clima.description %></p>
          <p><strong>Viento:</strong> <%= clima.wind_speed %> m/s</p>
          <p><strong>Nubes:</strong> <%= clima.clouds %>%</p>

          <% if (typeof cached !== 'undefined' && cached) { %>
            <small class="text-muted">(Datos en cache)</small>
          <% } %>

        <% } else { %>
          <p class="text-muted">No hay datos de clima. El servidor no inyectó la variable <code>clima</code>.</p>
        <% } %>
      </div>

    </form>

    <!-- SweetAlert2 block (solo si viene la variable alert) -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <% if (typeof alert !== 'undefined' && alert) { %>
      <script>
        Swal.fire({
          html: '<b style="color:#ffffff; font-size:20px;"><%= alertMessage %></b>',
          icon: '<%= alertIcon %>',
          background: 'linear-gradient(135deg, #2f6690ff, #3a7ca5ff)',
          color: '#ffffff',
          iconColor: '#81c3d7ff',
          confirmButtonText: 'Aceptar',
          confirmButtonColor: '#16425bff',
          showConfirmButton: <%= !!showConfirmButton %>,
          timer: <%= timer || 2000 %>,
          backdrop: 'rgba(0,0,0,0.25)',
          customClass: {
            popup: 'swal2-border-rounded',
            title: 'swal2-title-custom',
            content: 'swal2-content-custom'
          }
        }).then(function() {
          if (typeof ruta !== 'undefined' && ruta) {
            window.location = '/<%= ruta %>';
          }
        });
      </script>
    <% } %>

  </div> <!-- .inscripcion-container -->
</div> <!-- .container -->

<%- include('partials/footer') %>
