<%- include('partials/head') %>
<!-- Asegúrate de tener Montserrat + Boxicons en tu head partial.
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
-->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="/resources/css/admin.css">

<%- include('partials/header') %>

<main class="auth-wrapper admin-wrapper">
  <div class="login-container admin-card">
    <h2>Panel de Organizador</h2>

    <p class="helper small mb-2">Listado de participantes inscritos</p>

    <div class="mb-2 d-flex gap-2">
      <input id="searchInput" class="form-control form-control-sm" placeholder="Buscar por nombre, DNI..." />
      <span class="badge participantes-count align-self-center">Total: <%= participantes.length %></span>
    </div>

    <div class="table-responsive small-table mb-2">
      <table class="table table-sm table-hover text-center align-middle mb-0">
        <thead class="table-head-custom">
          <tr>
            <th>N° Dorsal</th>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>DNI</th>
            <th>Tel.</th>
            <th>Calle</th>
            <th>N°</th>
            <th>Población</th>
            <th>CP°</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="participantesTable">
          <% participantes.forEach(participante => { %>
            <tr>
              <td><%= participante.id %></td>
              <td><%= participante.nombre %></td>
              <td><%= participante.apellido %></td>
              <td><%= participante.dni %></td>
              <td><%= participante.telefono %></td>
              <td><%= participante.calle %></td>
              <td><%= participante.numero %></td>
              <td><%= participante.poblacion %></td>
              <td><%= participante.codigo_postal %></td>
              <td class="actions-col">
                <a href="/editadmin/<%= participante.id %>" class="btn btn-sm btn-edit" title="Editar">
                  <i class="bx bxs-edit"></i>
                </a>
                <a href="/delete/<%= participante.id %>" class="btn btn-sm btn-delete" title="Borrar" onclick="return confirm('¿Eliminar participante?');">
                  <i class="bx bxs-trash"></i>
                </a>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
</main>

<%- include('partials/footer') %>

<script>
  // búsqueda cliente (simple)
  const searchInput = document.getElementById('searchInput');
  const participantesTable = document.getElementById('participantesTable');
  searchInput?.addEventListener('input', (e) => {
    const q = e.target.value.toLowerCase().trim();
    Array.from(participantesTable.rows).forEach(row => {
      const txt = row.innerText.toLowerCase();
      row.style.display = txt.includes(q) ? '' : 'none';
    });
  });
</script>
