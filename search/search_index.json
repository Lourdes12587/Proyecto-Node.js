{"config":{"lang":["es"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Lourdes12587-Proyecto-Node.js-DeepWiki","text":""},{"location":"#content-index","title":"Content Index","text":"<ul> <li>Overview</li> <li>Architecture</li> <li>Application-Server</li> <li>Middleware-Layer</li> <li>Database-Layer</li> <li>Authentication-&amp;-Authorization</li> <li>Login-System</li> <li>Role-Based-Access-Control</li> <li>Session-Management</li> <li>User-Interfaces</li> <li>Participant-Interfaces</li> <li>Landing-Page</li> <li>Registration-Flow</li> <li>Profile-Management</li> <li>Admin-Interfaces</li> <li>Admin-Panel</li> <li>Winner-Management</li> <li>Organizer-Registration</li> <li>Shared-Components</li> <li>Styling-System</li> <li>Design-System</li> <li>Component-Styles</li> <li>Data-Management</li> <li>Participant-Data</li> <li>File-Upload-System</li> </ul>"},{"location":"Admin-Interfaces/","title":"Admin Interfaces","text":"<p>Relevant source files * views/admin.ejs * views/info.ejs * views/register.ejs</p>"},{"location":"Admin-Interfaces/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document describes the three administrator-only interfaces in the HAPPY RUNNER 42K application: the Admin Panel for participant management, Winner Management for selecting race winners, and Organizer Registration for creating new admin accounts. These interfaces are protected by role-based access control and accessible only to users with <code>rol === \"admin\"</code> in their session.</p> <p>For information about participant-facing interfaces, see Participant Interfaces. For details on the authentication mechanisms that protect these interfaces, see Role-Based Access Control.</p>"},{"location":"Admin-Interfaces/#overview-of-admin-interfaces","title":"Overview of Admin Interfaces","text":"<p>The system provides three distinct administrative interfaces, each serving a specific management function:</p> Interface Route View File Primary Function Admin Panel <code>/admin</code> <code>views/admin.ejs</code> View, search, edit, and delete participant records Winner Management <code>/info</code> (admin section) <code>views/info.ejs</code> Select 1st/2nd/3rd place winners from participant list Organizer Registration <code>/register</code> <code>views/register.ejs</code> Create new admin accounts for organizers <p>All three interfaces require authentication through the <code>verifyAdmin</code> middleware, which validates both the presence of a valid JWT token and confirms that <code>req.session.rol === \"admin\"</code>.</p> <p>Sources: views/admin.ejs L1-L79</p> <p>views/info.ejs L30-L84</p> <p>views/register.ejs L1-L71</p>"},{"location":"Admin-Interfaces/#access-control-architecture","title":"Access Control Architecture","text":"<pre><code>flowchart TD\n\nAdminLogin[\"/loginadmin&lt;br&gt;POST\"]\nAuthController[\"authcontroller.js&lt;br&gt;validateCredentials()\"]\nOrganizadoresDB[\"organizadores table&lt;br&gt;user, nombre, password\"]\nSessionSet[\"Set session:&lt;br&gt;rol='admin'&lt;br&gt;user=username\"]\nAdminRoute[\"/admin&lt;br&gt;GET\"]\nInfoRoute[\"/info&lt;br&gt;GET\"]\nRegisterRoute[\"/register&lt;br&gt;GET, POST\"]\nGanadoresRoute[\"/ganadores&lt;br&gt;POST\"]\nEditAdminRoute[\"/editadmin/:id&lt;br&gt;GET, POST\"]\nDeleteRoute[\"/delete/:id&lt;br&gt;GET\"]\nVerifyAdmin[\"verifyAdmin middleware&lt;br&gt;Check JWT token&lt;br&gt;Verify rol === 'admin'\"]\nAdminView[\"admin.ejs&lt;br&gt;Participant table\"]\nInfoViewAdmin[\"info.ejs&lt;br&gt;Winner form section\"]\nRegisterView[\"register.ejs&lt;br&gt;Organizer form\"]\n\nSessionSet --&gt; VerifyAdmin\nVerifyAdmin --&gt; AdminRoute\nVerifyAdmin --&gt; InfoRoute\nVerifyAdmin --&gt; RegisterRoute\nVerifyAdmin --&gt; GanadoresRoute\nVerifyAdmin --&gt; EditAdminRoute\nVerifyAdmin --&gt; DeleteRoute\nAdminRoute --&gt; AdminView\nInfoRoute --&gt; InfoViewAdmin\nRegisterRoute --&gt; RegisterView\n\nsubgraph subGraph3 [\"Admin Views\"]\n    AdminView\n    InfoViewAdmin\n    RegisterView\nend\n\nsubgraph subGraph2 [\"Middleware Guards\"]\n    VerifyAdmin\nend\n\nsubgraph subGraph1 [\"Protected Admin Routes\"]\n    AdminRoute\n    InfoRoute\n    RegisterRoute\n    GanadoresRoute\n    EditAdminRoute\n    DeleteRoute\nend\n\nsubgraph subGraph0 [\"Admin Authentication Flow\"]\n    AdminLogin\n    AuthController\n    OrganizadoresDB\n    SessionSet\n    AdminLogin --&gt; AuthController\n    AuthController --&gt; OrganizadoresDB\n    AuthController --&gt; SessionSet\nend</code></pre> <p>Admin Access Requirements:</p> <ol> <li>Session Authentication: Valid JWT token stored in cookie (verified using <code>process.env.JWT_SECRET</code>)</li> <li>Role Verification: Session must contain <code>rol === \"admin\"</code></li> <li>Redirect Behavior: Failed authentication redirects to <code>/authadmin</code> or <code>/loginadmin</code></li> </ol> <p>The <code>verifyAdmin</code> middleware enforces these requirements for all administrative routes. Without proper authorization, users are redirected and cannot access admin functionality.</p> <p>Sources: High-level architecture diagrams (Diagram 2), views/admin.ejs L1-L79</p> <p>views/info.ejs L30-L84</p> <p>views/register.ejs L1-L71</p>"},{"location":"Admin-Interfaces/#admin-panel-421","title":"Admin Panel (4.2.1)","text":"<p>The Admin Panel provides a comprehensive view of all registered participants with search, edit, and delete capabilities. The interface is rendered by <code>views/admin.ejs</code> and accessible via the <code>/admin</code> route.</p>"},{"location":"Admin-Interfaces/#interface-components","title":"Interface Components","text":"<p>Participant Table Structure:</p> Column Data Field Description N\u00b0 Dorsal <code>participante.id</code> Unique participant identifier / race number Nombre <code>participante.nombre</code> First name Apellido <code>participante.apellido</code> Last name DNI <code>participante.dni</code> National identification number Tel. <code>participante.telefono</code> Contact phone Calle <code>participante.calle</code> Street address N\u00b0 <code>participante.numero</code> Street number Poblaci\u00f3n <code>participante.poblacion</code> City/town CP\u00b0 <code>participante.codigo_postal</code> Postal code Acciones \u2014 Edit/Delete action buttons <p>The table iterates over the <code>participantes</code> array passed from the server, rendering each participant as a table row views/admin.ejs L39-L59</p>"},{"location":"Admin-Interfaces/#client-side-search-implementation","title":"Client-Side Search Implementation","text":"<p>The admin panel includes a real-time search filter implemented entirely in client-side JavaScript:</p> <p>This implementation:</p> <ul> <li>Listens for input events on the search field views/admin.ejs L18</li> <li>Converts the query to lowercase for case-insensitive matching</li> <li>Iterates through all table rows (<code>&lt;tbody id=\"participantesTable\"&gt;</code> views/admin.ejs L38 )</li> <li>Shows/hides rows based on whether their text content includes the query string</li> <li>Searches across all visible fields (name, DNI, address, etc.)</li> </ul>"},{"location":"Admin-Interfaces/#action-buttons","title":"Action Buttons","text":"<p>Each participant row includes two action buttons in the \"Acciones\" column views/admin.ejs L50-L57</p> <p>:</p> <p>Edit Button:</p> <ul> <li>Links to <code>/editadmin/:id</code> route</li> <li>Opens a form to modify participant data</li> <li>Uses Boxicons <code>bxs-edit</code> icon</li> </ul> <p>Delete Button:</p> <pre><code>\n</code></pre> <ul> <li>Links to <code>/delete/:id</code> route</li> <li>Includes JavaScript confirmation dialog</li> <li>Uses Boxicons <code>bxs-trash</code> icon</li> </ul>"},{"location":"Admin-Interfaces/#participant-count-badge","title":"Participant Count Badge","text":"<p>The interface displays the total participant count using a badge component:</p> <p>This badge is rendered at views/admin.ejs L19</p> <p>and updates only on page reload (not dynamically filtered by the search).</p> <p>Sources: views/admin.ejs L1-L79</p>"},{"location":"Admin-Interfaces/#winner-management-422","title":"Winner Management (4.2.2)","text":"<p>Winner management functionality is embedded within the <code>info.ejs</code> view as a conditional admin-only section. When an administrator is logged in, the page renders a form to select and register the top three finishers.</p>"},{"location":"Admin-Interfaces/#conditional-rendering","title":"Conditional Rendering","text":"<p>The winner management form only appears when the <code>isAdmin</code> variable is truthy:</p> <pre><code>\n</code></pre> <p>This conditional block spans views/info.ejs L30-L84</p> <p>The <code>isAdmin</code> variable is populated by server-side logic based on the user's session role.</p>"},{"location":"Admin-Interfaces/#winner-selection-form","title":"Winner Selection Form","text":"<pre><code>flowchart TD\n\nSelect3[\"\"]\nForm[\"method='POST'enctype='multipart/form-data'&gt;\"]\nSelect1[\"\"]\nSelect2[\"\"]\nSubmit[\"\"]\nParticipantList1[\"Populate from&lt;br&gt;participantes array\"]\nParticipantList2[\"Populate from&lt;br&gt;participantes array\"]\nParticipantList3[\"Populate from&lt;br&gt;participantes array\"]\nFile3[\"name='foto3'&gt;\"]\nFile2[\"name='foto2'&gt;\"]\nFile1[\"name='foto1'&gt;\"]\n\nsubgraph subGraph3 [\"Winner Form Structure\"]\n    Form\n    Submit\n    Form --&gt; Select1\n    Form --&gt; Select2\n    Form --&gt; Select3\n    Form --&gt; Submit\n\nsubgraph subGraph2 [\"Third Place\"]\n    Select3\n    ParticipantList3\n    File3\n    Select3 --&gt; ParticipantList3\nend\n\nsubgraph subGraph1 [\"Second Place\"]\n    Select2\n    ParticipantList2\n    File2\n    Select2 --&gt; ParticipantList2\nend\n\nsubgraph subGraph0 [\"First Place\"]\n    Select1\n    ParticipantList1\n    File1\n    Select1 --&gt; ParticipantList1\nend\nend</code></pre> <p>Form Structure:</p> <p>The form posts to <code>/ganadores</code> with <code>multipart/form-data</code> encoding views/info.ejs L34</p> <p>to support file uploads. Each place (1st, 2nd, 3rd) has:</p> <ol> <li>Dropdown selector - populated from the <code>participantes</code> array</li> <li>Optional file upload - for winner-specific photos</li> </ol>"},{"location":"Admin-Interfaces/#participant-dropdown-population","title":"Participant Dropdown Population","text":"<p>Each dropdown is populated identically using this EJS loop:</p> <p>This pattern repeats for <code>primero</code> views/info.ejs L38-L43</p> <p><code>segundo</code> views/info.ejs L51-L56</p> <p>and <code>tercero</code> views/info.ejs L64-L69</p> <p>Each option displays the participant's dorsal number (ID), first name, and last name.</p>"},{"location":"Admin-Interfaces/#file-upload-fields","title":"File Upload Fields","text":"<p>Winner photos are optional and handled through standard file inputs:</p> <p>These correspond to first, second, and third place respectively views/info.ejs L44-L70</p> <p>The <code>accept=\"image/*\"</code> attribute restricts uploads to image files.</p>"},{"location":"Admin-Interfaces/#form-actions","title":"Form Actions","text":"<p>The form includes two buttons views/info.ejs L74-L77</p> <p>:</p> <ul> <li>Submit button: <code>&lt;button type=\"submit\" class=\"btn cta-btn\"&gt;Guardar ganadores&lt;/button&gt;</code></li> <li>Cancel link: <code>&lt;a href=\"/admin\" class=\"btn btn-neutral\"&gt;Cancelar&lt;/a&gt;</code> - returns to admin panel</li> </ul>"},{"location":"Admin-Interfaces/#feedback-messages","title":"Feedback Messages","text":"<p>After form submission, the page displays server-generated feedback:</p> <p>This conditional rendering views/info.ejs L79-L81</p> <p>shows success or error messages based on <code>mensaje</code> and <code>mensajeTipo</code> variables passed from the route handler.</p> <p>Sources: views/info.ejs L30-L84</p>"},{"location":"Admin-Interfaces/#organizer-registration-423","title":"Organizer Registration (4.2.3)","text":"<p>The organizer registration interface allows existing administrators to create new admin accounts. This is the only mechanism for adding administrators to the system.</p>"},{"location":"Admin-Interfaces/#form-structure","title":"Form Structure","text":"<p>The registration form is rendered by <code>views/register.ejs</code> and accessible via the <code>/register</code> route. The form uses POST method to submit credentials:</p> <pre><code>\n</code></pre> <p>Form Fields:</p> Field Input Name Type Description Usuario <code>user</code> <code>text</code> Unique username for authentication Nombre <code>nombre</code> <code>text</code> Organizer's display name Contrase\u00f1a <code>password</code> <code>password</code> Account password (hashed with bcrypt) <p>All fields are required views/register.ejs L15-L27</p>"},{"location":"Admin-Interfaces/#value-persistence","title":"Value Persistence","text":"<p>The form implements value persistence for failed submissions, repopulating fields with previously entered data:</p> <p>This pattern repeats for <code>user</code>, <code>nombre</code>, and <code>password</code> fields views/register.ejs L18-L26</p> <p>The <code>valores</code> object is passed from the server when validation fails.</p>"},{"location":"Admin-Interfaces/#server-side-validation","title":"Server-Side Validation","text":"<p>The form displays validation errors from <code>express-validator</code>:</p> <pre><code>\n</code></pre> <p>This block views/register.ejs L31-L37</p> <p>iterates over the <code>validaciones</code> array, displaying each error message in a styled alert box. The <code>aria-live=\"polite\"</code> attribute ensures screen reader accessibility.</p>"},{"location":"Admin-Interfaces/#sweetalert-integration","title":"SweetAlert Integration","text":"<p>Successful registration triggers a SweetAlert2 modal:</p> <p>This script block views/register.ejs L44-L67</p> <p>:</p> <ul> <li>Displays a styled modal with title, message, and icon</li> <li>Applies custom colors matching the application theme</li> <li>Auto-closes after the specified <code>timer</code> duration</li> <li>Redirects to the route specified in <code>ruta</code> variable</li> </ul> <p>Sources: views/register.ejs L1-L71</p>"},{"location":"Admin-Interfaces/#admin-operation-data-flow","title":"Admin Operation Data Flow","text":"<pre><code>sequenceDiagram\n  participant Admin Browser\n  participant app.js\n  participant verifyAdmin\n  participant middleware\n  participant Route Handler\n  participant MySQL Database\n  participant (participantes,\n  participant organizadores,\n  participant ganadores)\n  participant File System\n  participant (uploads/participantes/)\n\n  note over Admin Browser,Route Handler: Admin Panel Flow (/admin)\n  Admin Browser-&gt;&gt;app.js: GET /admin\n  app.js-&gt;&gt;verifyAdmin: Check authorization\n  verifyAdmin-&gt;&gt;verifyAdmin: Verify JWT + rol==='admin'\n  verifyAdmin-&gt;&gt;Route Handler: Authorized\n  Route Handler-&gt;&gt;MySQL Database: SELECT * FROM participantes\n  MySQL Database--&gt;&gt;Route Handler: participantes[]\n  Route Handler--&gt;&gt;Admin Browser: Render admin.ejs with participantes\n  Admin Browser-&gt;&gt;Admin Browser: Client-side search\n  Admin Browser-&gt;&gt;app.js: (filter table rows)\n  app.js-&gt;&gt;verifyAdmin: GET /delete/:id\n  verifyAdmin-&gt;&gt;Route Handler: Check authorization\n  Route Handler-&gt;&gt;MySQL Database: Authorized\n  MySQL Database--&gt;&gt;Route Handler: DELETE FROM participantes WHERE id=?\n  Route Handler--&gt;&gt;Admin Browser: Success\n  note over Admin Browser,(uploads/participantes/): Winner Management Flow (/ganadores)\n  Admin Browser-&gt;&gt;app.js: Redirect to /admin\n  app.js-&gt;&gt;verifyAdmin: GET /info\n  verifyAdmin-&gt;&gt;Route Handler: Check authorization\n  Route Handler-&gt;&gt;MySQL Database: Authorized\n  Route Handler-&gt;&gt;MySQL Database: SELECT * FROM participantes\n  MySQL Database--&gt;&gt;Route Handler: SELECT * FROM ganadores\n  Route Handler--&gt;&gt;Admin Browser: participantes[], ganadores[]\n  Admin Browser-&gt;&gt;app.js: Render info.ejs\n  app.js-&gt;&gt;verifyAdmin: (isAdmin=true, show form)\n  verifyAdmin-&gt;&gt;Route Handler: POST /ganadores\n  Route Handler-&gt;&gt;File System: (primero, segundo, tercero, foto1-3)\n  File System--&gt;&gt;Route Handler: Check authorization\n  Route Handler-&gt;&gt;MySQL Database: Authorized\n  MySQL Database--&gt;&gt;Route Handler: Save foto1, foto2, foto3\n  Route Handler--&gt;&gt;Admin Browser: (if provided)\n  note over Admin Browser,ganadores): Organizer Registration Flow (/register)\n  Admin Browser-&gt;&gt;app.js: File paths\n  app.js-&gt;&gt;verifyAdmin: INSERT/UPDATE ganadores table\n  verifyAdmin-&gt;&gt;Route Handler: (positions 1,2,3)\n  Route Handler--&gt;&gt;Admin Browser: Success\n  Admin Browser-&gt;&gt;app.js: Redirect to /info with mensaje\n  app.js-&gt;&gt;verifyAdmin: GET /register\n  verifyAdmin-&gt;&gt;Route Handler: Check authorization\n  Route Handler-&gt;&gt;Route Handler: Authorized\n  loop [Validation Failed]\n    Route Handler--&gt;&gt;Admin Browser: Render register.ejs\n    Route Handler-&gt;&gt;Route Handler: POST /register\n    Route Handler-&gt;&gt;MySQL Database: (user, nombre, password)\n    MySQL Database--&gt;&gt;Route Handler: Check authorization\n    Route Handler--&gt;&gt;Admin Browser: Authorized\n  end</code></pre> <p>Key Data Flow Characteristics:</p> <ol> <li>Consistent Authorization: Every admin request passes through <code>verifyAdmin</code> middleware before reaching route handlers</li> <li>Admin Panel: Fetches all participants in a single query, performs search client-side without additional server requests</li> <li>Winner Management: Handles both database operations (inserting/updating <code>ganadores</code> table) and file operations (saving winner photos)</li> <li>Organizer Registration: Implements server-side validation, password hashing, and provides feedback through both inline errors and SweetAlert modals</li> </ol> <p>Sources: views/admin.ejs L67-L78</p> <p>views/info.ejs L34-L84</p> <p>views/register.ejs L15-L67</p> <p>High-level architecture diagrams (Diagram 5)</p>"},{"location":"Admin-Interfaces/#route-and-view-mapping","title":"Route and View Mapping","text":"<p>The following table summarizes the routing architecture for all admin interfaces:</p> HTTP Method Route Path Protected By Renders View Data Operations GET <code>/admin</code> <code>verifyAdmin</code> <code>admin.ejs</code> SELECT all participantes GET <code>/editadmin/:id</code> <code>verifyAdmin</code> Edit form (not in provided files) SELECT participante by id POST <code>/editadmin/:id</code> <code>verifyAdmin</code> Redirect UPDATE participante GET <code>/delete/:id</code> <code>verifyAdmin</code> Redirect to <code>/admin</code> DELETE participante GET <code>/info</code> <code>verifyAdmin</code> <code>info.ejs</code> (with admin section) SELECT participantes, ganadores POST <code>/ganadores</code> <code>verifyAdmin</code> Redirect to <code>/info</code> INSERT/UPDATE ganadores, file upload GET <code>/register</code> <code>verifyAdmin</code> <code>register.ejs</code> None POST <code>/register</code> <code>verifyAdmin</code> Redirect or re-render INSERT organizador (with bcrypt hash) <p>Navigation Links:</p> <ul> <li>Admin panel links to edit: <code>/editadmin/&lt;%= participante.id %&gt;</code> views/admin.ejs L51</li> <li>Admin panel links to delete: <code>/delete/&lt;%= participante.id %&gt;</code> views/admin.ejs L54</li> <li>Winner form cancels to: <code>/admin</code> views/info.ejs L76</li> <li>Registration success redirects to: <code>/&lt;%= ruta %&gt;</code> views/register.ejs L64</li> </ul> <p>Sources: views/admin.ejs L51-L56</p> <p>views/info.ejs L34-L76</p> <p>views/register.ejs L15-L64</p>"},{"location":"Admin-Panel/","title":"Admin Panel","text":"<p>Relevant source files * public/css/admin.css * views/admin.ejs</p>"},{"location":"Admin-Panel/#purpose-and-scope","title":"Purpose and Scope","text":"<p>The Admin Panel is the primary interface for organizers to view and manage all registered marathon participants. This page provides a comprehensive participant list in a tabular format with client-side search capabilities and quick-access edit/delete actions. The panel is accessible only to users with administrator privileges who have successfully authenticated through the admin login flow.</p> <p>This document covers the admin panel's view template, styling, search functionality, and action buttons. For the authentication mechanism that protects this page, see Role-Based Access Control. For the actual edit and delete operations that occur when action buttons are clicked, see Participant Data. For winner selection functionality within the info page, see Winner Management.</p>"},{"location":"Admin-Panel/#access-control-and-route-protection","title":"Access Control and Route Protection","text":"<p>The admin panel is served through a protected route that requires admin-level authorization. The request must pass through two middleware layers before reaching the view.</p> <pre><code>flowchart TD\n\nRequest[\"HTTP GET /admin\"]\nCookieSession[\"cookie-session middleware\"]\nVerifyAdmin[\"verifyAdmin middleware\"]\nRouteHandler[\"admin router handler\"]\nDatabaseQuery[\"SELECT * FROM participantes\"]\nRenderView[\"admin.ejs rendering\"]\nRedirect[\"/authadmin redirect\"]\n\nRequest --&gt; CookieSession\nCookieSession --&gt; VerifyAdmin\nVerifyAdmin --&gt; RouteHandler\nVerifyAdmin --&gt; Redirect\nRouteHandler --&gt; DatabaseQuery\nDatabaseQuery --&gt; RenderView</code></pre> <p>Sources: High-level architecture diagrams (Diagram 2, Diagram 5)</p> <p>The <code>verifyAdmin</code> middleware validates that <code>req.session.rol</code> equals <code>\"admin\"</code> and that a valid JWT token exists in the request cookies. Failed authorization redirects to <code>/authadmin</code>. Upon successful authentication, the route handler queries all participant records from the <code>participantes</code> table and passes them to the view template.</p>"},{"location":"Admin-Panel/#view-architecture","title":"View Architecture","text":"<p>The admin panel follows the standard EJS partial composition pattern used throughout the application, with dedicated styling and embedded client-side JavaScript.</p> <pre><code>flowchart TD\n\nAdminEJS[\"admin.ejs\"]\nHeadPartial[\"partials/head.ejs\"]\nHeaderPartial[\"partials/header.ejs\"]\nFooterPartial[\"partials/footer.ejs\"]\nAdminCSS[\"public/css/admin.css\"]\nBootstrapCSS[\"Bootstrap 5.3.3 CDN\"]\nBoxiconsCSS[\"Boxicons 2.1.4 CDN\"]\nExternalLibs[\"Leaflet, Font Awesome,&lt;br&gt;Montserrat font\"]\nNavigation[\"Role-based nav menu&lt;br&gt;(admin items visible)\"]\nSearchScript[\"Inline search filter&lt;br&gt;JavaScript\"]\nParticipantTable[\"Scrollable table with&lt;br&gt;participant rows\"]\n\nAdminEJS --&gt; HeadPartial\nAdminEJS --&gt; HeaderPartial\nAdminEJS --&gt; FooterPartial\nAdminEJS --&gt; AdminCSS\nAdminEJS --&gt; BootstrapCSS\nAdminEJS --&gt; BoxiconsCSS\nHeadPartial --&gt; ExternalLibs\nHeaderPartial --&gt; Navigation\nAdminEJS --&gt; SearchScript\nAdminEJS --&gt; ParticipantTable</code></pre> <p>Sources: views/admin.ejs L1-L9</p> <p>The view structure includes:</p> <ul> <li>Head partial inclusion views/admin.ejs L1  - Loads core dependencies (Montserrat font, Boxicons)</li> <li>Bootstrap CSS views/admin.ejs L6  - Provides table and form control styling</li> <li>Admin-specific stylesheet views/admin.ejs L7  - Custom styling via <code>/resources/css/admin.css</code></li> <li>Header partial views/admin.ejs L9  - Renders admin-context navigation</li> <li>Footer partial views/admin.ejs L65  - Page footer</li> </ul>"},{"location":"Admin-Panel/#page-components","title":"Page Components","text":""},{"location":"Admin-Panel/#main-container-structure","title":"Main Container Structure","text":"<p>The admin panel uses a centered wrapper design consistent with other authentication-protected pages:</p> <pre><code>flowchart TD\n\nMainTag[\"main.auth-wrapper.admin-wrapper\"]\nContainerDiv[\"div.login-container.admin-card\"]\nTitleH2[\"h2: 'Panel de Organizador'\"]\nHelperText[\"p.helper: 'Listado de participantes'\"]\nSearchRow[\"div.mb-2: Search + Count Badge\"]\nTableWrapper[\"div.small-table: Scrollable table\"]\nTableElement[\"table.table: Participant data\"]\n\nMainTag --&gt; ContainerDiv\nContainerDiv --&gt; TitleH2\nContainerDiv --&gt; HelperText\nContainerDiv --&gt; SearchRow\nContainerDiv --&gt; TableWrapper\nTableWrapper --&gt; TableElement</code></pre> <p>Sources: views/admin.ejs L11-L22</p> Component Classes Purpose <code>&lt;main&gt;</code> <code>.auth-wrapper</code>, <code>.admin-wrapper</code> Flex container for vertical/horizontal centering Container <code>&lt;div&gt;</code> <code>.login-container</code>, <code>.admin-card</code> White card with gradient background and shadow Title <code>&lt;h2&gt;</code> - \"Panel de Organizador\" heading Helper <code>&lt;p&gt;</code> <code>.helper</code>, <code>.small</code>, <code>.mb-2</code> \"Listado de participantes inscritos\" description Search row <code>.mb-2</code>, <code>.d-flex</code>, <code>.gap-2</code> Contains search input and count badge Table wrapper <code>.small-table</code>, <code>.mb-2</code> Scrollable container with 420px max height"},{"location":"Admin-Panel/#search-and-count-display","title":"Search and Count Display","text":"<p>The interface provides real-time client-side filtering with a participant count badge:</p> <p>views/admin.ejs L17-L20</p> <ul> <li>Search input - <code>#searchInput</code> with <code>.form-control-sm</code> styling, placeholder \"Buscar por nombre, DNI...\"</li> <li>Count badge - <code>.participantes-count</code> displays total participant count using EJS interpolation: <code>&lt;%= participantes.length %&gt;</code></li> </ul> <p>The badge uses custom CSS styling with gradient background:</p> <p>Sources: views/admin.ejs L17-L20</p> <p>public/css/admin.css L65-L72</p>"},{"location":"Admin-Panel/#participant-data-table","title":"Participant Data Table","text":"<p>The table displays comprehensive participant information with fixed column headers and scrollable body:</p> <pre><code>flowchart TD\n\nTableWrapper[\"div.table-responsive.small-table\"]\nTable[\"table.table.table-sm.table-hover\"]\nThead[\"thead.table-head-custom\"]\nTbody[\"tbody#participantesTable\"]\nHeaderRow[\"tr with 10 column headers\"]\nDataRows[\"Generated rows via&lt;br&gt;EJS forEach loop\"]\nDorsalCol[\"N\u00b0 Dorsal (id)\"]\nNameCol[\"Nombre\"]\nSurnameCol[\"Apellido\"]\nDNICol[\"DNI\"]\nPhoneCol[\"Tel\u00e9fono\"]\nStreetCol[\"Calle\"]\nNumCol[\"N\u00b0 (numero)\"]\nCityCol[\"Poblaci\u00f3n\"]\nPostalCol[\"CP\u00b0 (codigo_postal)\"]\nActionsCol[\"Acciones (edit/delete)\"]\n\nTableWrapper --&gt; Table\nTable --&gt; Thead\nTable --&gt; Tbody\nThead --&gt; HeaderRow\nTbody --&gt; DataRows\nDataRows --&gt; DorsalCol\nDataRows --&gt; NameCol\nDataRows --&gt; SurnameCol\nDataRows --&gt; DNICol\nDataRows --&gt; PhoneCol\nDataRows --&gt; StreetCol\nDataRows --&gt; NumCol\nDataRows --&gt; CityCol\nDataRows --&gt; PostalCol\nDataRows --&gt; ActionsCol</code></pre> <p>Sources: views/admin.ejs L22-L62</p>"},{"location":"Admin-Panel/#table-columns","title":"Table Columns","text":"Column Header Data Field Display Value N\u00b0 Dorsal <code>participante.id</code> Unique participant ID Nombre <code>participante.nombre</code> First name Apellido <code>participante.apellido</code> Last name DNI <code>participante.dni</code> National ID number Tel. <code>participante.telefono</code> Phone number Calle <code>participante.calle</code> Street name N\u00b0 <code>participante.numero</code> Street number Poblaci\u00f3n <code>participante.poblacion</code> City/town CP\u00b0 <code>participante.codigo_postal</code> Postal code Acciones - Edit/delete buttons <p>The table body is generated server-side using an EJS <code>forEach</code> loop views/admin.ejs L39-L59</p> <p>that iterates over the <code>participantes</code> array passed from the route handler.</p>"},{"location":"Admin-Panel/#client-side-search-implementation","title":"Client-Side Search Implementation","text":"<p>The search functionality filters table rows in real-time without server round-trips, providing instant feedback as the admin types.</p>"},{"location":"Admin-Panel/#search-algorithm","title":"Search Algorithm","text":"<pre><code>sequenceDiagram\n  participant User\n  participant input event listener\n  participant filter function\n\n  User-&gt;&gt;User: Types search query\n  input event listener-&gt;&gt;input event listener: Fires 'input' event\n  input event listener-&gt;&gt;filter function: e.target.value\n  filter function-&gt;&gt;filter function: toLowerCase().trim()\n  loop [Match found]\n    filter function-&gt;&gt;filter function: row.innerText.toLowerCase()\n    filter function--&gt;&gt;filter function: row text content\n    filter function-&gt;&gt;filter function: txt.includes(query)\n    filter function-&gt;&gt;filter function: row.style.display = ''\n    filter function-&gt;&gt;filter function: row.style.display = 'none'\n  end</code></pre> <p>Sources: views/admin.ejs L67-L78</p>"},{"location":"Admin-Panel/#implementation-details","title":"Implementation Details","text":"<p>The search is implemented in an inline <code>&lt;script&gt;</code> tag at the bottom of the view:</p> <p>views/admin.ejs L67-L78</p> <p>Key aspects:</p> <ol> <li>Event binding - Attaches <code>input</code> event listener to <code>#searchInput</code></li> <li>Query normalization - Converts query to lowercase and trims whitespace</li> <li>Text matching - Uses <code>row.innerText.toLowerCase()</code> to get all cell content</li> <li>Filter logic - Simple substring match with <code>txt.includes(q)</code></li> <li>Display toggle - Sets <code>row.style.display</code> to empty string (visible) or <code>'none'</code> (hidden)</li> </ol> <p>The search operates across all table columns simultaneously, matching against the combined text content of each row. This allows admins to search by any field (name, DNI, phone, address, etc.) without selecting a specific column.</p>"},{"location":"Admin-Panel/#action-buttons","title":"Action Buttons","text":"<p>Each participant row includes two action buttons in the final column: Edit and Delete.</p>"},{"location":"Admin-Panel/#button-structure-and-routing","title":"Button Structure and Routing","text":"<pre><code>flowchart TD\n\nActionsCol[\"td.actions-col\"]\nEditLink[\"a.btn.btn-sm.btn-edit&lt;br&gt;href=/editadmin/:id\"]\nDeleteLink[\"a.btn.btn-sm.btn-delete&lt;br&gt;href=/delete/:id&lt;br&gt;onclick=confirm()\"]\nEditIcon[\"i.bx.bxs-edit\"]\nDeleteIcon[\"i.bx.bxs-trash\"]\nEditRoute[\"/editadmin/:id\"]\nDeleteRoute[\"/delete/:id\"]\n\nActionsCol --&gt; EditLink\nActionsCol --&gt; DeleteLink\nEditLink --&gt; EditIcon\nDeleteLink --&gt; DeleteIcon\nEditLink --&gt; EditRoute\nDeleteLink --&gt; DeleteRoute</code></pre> <p>Sources: views/admin.ejs L50-L57</p>"},{"location":"Admin-Panel/#edit-button","title":"Edit Button","text":"<ul> <li>Route: <code>/editadmin/&lt;%= participante.id %&gt;</code></li> <li>Classes: <code>.btn</code>, <code>.btn-sm</code>, <code>.btn-edit</code></li> <li>Icon: Boxicons <code>bxs-edit</code> (solid edit icon)</li> <li>Tooltip: <code>title=\"Editar\"</code></li> </ul> <p>The edit button redirects to an admin edit form where organizers can modify participant data views/admin.ejs L51-L53</p>"},{"location":"Admin-Panel/#delete-button","title":"Delete Button","text":"<ul> <li>Route: <code>/delete/&lt;%= participante.id %&gt;</code></li> <li>Classes: <code>.btn</code>, <code>.btn-sm</code>, <code>.btn-delete</code></li> <li>Icon: Boxicons <code>bxs-trash</code> (solid trash icon)</li> <li>Tooltip: <code>title=\"Borrar\"</code></li> <li>Confirmation: <code>onclick=\"return confirm('\u00bfEliminar participante?');\"</code> prevents accidental deletion</li> </ul> <p>The delete button includes JavaScript confirmation dialog that blocks navigation if user cancels views/admin.ejs L54-L56</p>"},{"location":"Admin-Panel/#styling-system","title":"Styling System","text":"<p>The admin panel uses a dedicated stylesheet that maintains visual consistency with the login/authentication pages while adapting for tabular data display.</p>"},{"location":"Admin-Panel/#css-custom-properties","title":"CSS Custom Properties","text":"<p>The stylesheet defines a color palette using CSS custom properties for consistency:</p> <p>public/css/admin.css L1-L11</p> Variable Value Usage <code>--lapis-lazuli</code> <code>#2f6690ff</code> Primary brand color <code>--cerulean</code> <code>#3a7ca5ff</code> Secondary brand color <code>--platinum</code> <code>#d9dcd6ff</code> Light background <code>--indigo-dye</code> <code>#16425bff</code> Dark text/accent <code>--sky-blue</code> <code>#81c3d7ff</code> Tertiary accent <code>--white</code> <code>#ffffff</code> Pure white <code>--muted-shadow</code> <code>rgba(22,66,91,0.08)</code> Soft shadow <code>--card-max-width</code> <code>980px</code> Maximum card width"},{"location":"Admin-Panel/#key-style-rules","title":"Key Style Rules","text":""},{"location":"Admin-Panel/#container-styling","title":"Container Styling","text":"<pre><code>.login-container.admin-card [public/css/admin.css:36-44]\n</code></pre> <ul> <li>Max width: 900px (wider than standard login to accommodate table)</li> <li>Background: Linear gradient from white to platinum</li> <li>Border radius: 14px</li> <li>Padding: 18px</li> <li>Box shadow: <code>0 10px 30px var(--muted-shadow)</code></li> </ul>"},{"location":"Admin-Panel/#table-styling","title":"Table Styling","text":"<pre><code>.small-table [public/css/admin.css:75-82]\n</code></pre> <ul> <li>Max height: 420px (enables vertical scrolling)</li> <li>Overflow: auto</li> <li>Border radius: 8px</li> <li>White background</li> <li>Padding: 6px</li> </ul>"},{"location":"Admin-Panel/#table-header","title":"Table Header","text":"<pre><code>.table-head-custom th [public/css/admin.css:85-91]\n</code></pre> <ul> <li>Background: Linear gradient from <code>--lapis-lazuli</code> to <code>--cerulean</code></li> <li>Color: White</li> <li>Font weight: 700 (bold)</li> <li>Font size: 0.85rem</li> <li>No border</li> </ul>"},{"location":"Admin-Panel/#table-cells","title":"Table Cells","text":"<pre><code>.table th, .table td [public/css/admin.css:94-99]\n</code></pre> <ul> <li>Compact padding: 0.45rem horizontal, 0.5rem vertical</li> <li>Vertical alignment: middle</li> <li>Font size: 0.86rem</li> <li>Border color: <code>rgba(22,66,91,0.06)</code> (subtle)</li> </ul>"},{"location":"Admin-Panel/#action-button-styling","title":"Action Button Styling","text":"<p>Both edit and delete buttons share base styling public/css/admin.css L107-L117</p> <p>:</p> <ul> <li>Fixed size: 34px \u00d7 34px</li> <li>Display: inline-flex (for icon centering)</li> <li>Border radius: 10px</li> <li>No border (uses box shadow instead)</li> </ul> <p>Edit button public/css/admin.css L120-L124</p> <p>:</p> <ul> <li>Background: Yellow/cream gradient <code>rgba(255,239,186,0.95)</code> to <code>rgba(255,249,230,0.95)</code></li> <li>Text color: <code>#7a5a00</code> (dark yellow)</li> <li>Subtle border: <code>rgba(122,90,0,0.08)</code></li> </ul> <p>Delete button public/css/admin.css L127-L131</p> <p>:</p> <ul> <li>Background: Red/pink gradient <code>rgba(255,232,232,0.95)</code> to <code>rgba(255,245,245,0.95)</code></li> <li>Text color: <code>#8b1e1e</code> (dark red)</li> <li>Subtle border: <code>rgba(139,30,30,0.06)</code></li> </ul>"},{"location":"Admin-Panel/#participant-count-badge","title":"Participant Count Badge","text":"<p>The badge displaying total participant count uses a gradient background matching the table header:</p> <p>public/css/admin.css L65-L72</p> <ul> <li>Background: Linear gradient from <code>--lapis-lazuli</code> to <code>--cerulean</code></li> <li>White text</li> <li>Padding: 0.28rem \u00d7 0.6rem</li> <li>Border radius: 999px (pill shape)</li> <li>Font weight: 700</li> <li>Font size: 0.82rem</li> </ul>"},{"location":"Admin-Panel/#responsive-design","title":"Responsive Design","text":"<p>The admin panel adapts to different screen sizes through media query breakpoints:</p>"},{"location":"Admin-Panel/#tablet-breakpoint-max-width-992px","title":"Tablet Breakpoint (max-width: 992px)","text":"<p>public/css/admin.css L146-L149</p> <ul> <li>Card max-width reduced to 720px</li> <li>Card padding reduced to 14px</li> <li>Table max-height reduced to 360px</li> </ul>"},{"location":"Admin-Panel/#mobile-breakpoint-max-width-576px","title":"Mobile Breakpoint (max-width: 576px)","text":"<p>public/css/admin.css L150-L156</p> <ul> <li>Wrapper padding reduced to 20px horizontal, 10px vertical</li> <li>Card max-width reduced to 360px</li> <li>Card padding reduced to 12px</li> <li>Table cell font size reduced to 0.78rem</li> <li>Cell padding reduced to 0.32rem \u00d7 0.36rem</li> <li>Table max-height reduced to 300px</li> <li>CTA button padding and font size reduced</li> </ul> <p>These responsive adjustments ensure the admin panel remains usable on smaller devices while prioritizing desktop/tablet usage where tabular data is easier to manage.</p> <p>Sources: public/css/admin.css L146-L156</p>"},{"location":"Admin-Panel/#data-flow-summary","title":"Data Flow Summary","text":"<pre><code>flowchart TD\n\nAdminRoute[\"GET /admin route\"]\nVerifyAdmin[\"verifyAdmin middleware\"]\nRouteHandler[\"Route handler function\"]\nDBQuery[\"SQL: SELECT * FROM participantes\"]\nParticipantesArray[\"participantes array\"]\nRenderAdmin[\"res.render('admin', {participantes})\"]\nEJSEngine[\"EJS template engine\"]\nForEachLoop[\"forEach loop in admin.ejs\"]\nTableRows[\"HTML table rows generated\"]\nClientScript[\"Client-side search script\"]\nFilteredDisplay[\"Filtered table display\"]\nActionButtons[\"Edit/Delete buttons\"]\nEditRoute[\"/editadmin/:id\"]\nDeleteRoute[\"/delete/:id\"]\n\nAdminRoute --&gt; VerifyAdmin\nVerifyAdmin --&gt; RouteHandler\nRouteHandler --&gt; DBQuery\nDBQuery --&gt; ParticipantesArray\nParticipantesArray --&gt; RenderAdmin\nRenderAdmin --&gt; EJSEngine\nEJSEngine --&gt; ForEachLoop\nForEachLoop --&gt; TableRows\nTableRows --&gt; ClientScript\nClientScript --&gt; FilteredDisplay\nTableRows --&gt; ActionButtons\nActionButtons --&gt; EditRoute\nActionButtons --&gt; DeleteRoute</code></pre> <p>Sources: High-level architecture diagrams (Diagram 3), views/admin.ejs L39-L78</p> <p>The admin panel receives pre-loaded participant data from the server, renders it as static HTML table rows, then adds client-side interactivity through the search filter. Action buttons provide direct navigation to participant editing and deletion routes, completing the participant management workflow.</p>"},{"location":"Application-Server/","title":"Application Server","text":"<p>Relevant source files * app.js</p>"},{"location":"Application-Server/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document details the Express.js application server configuration in <code>app.js</code>, which serves as the central entry point and orchestrator for the HAPPY RUNNER 42K application. This page covers:</p> <ul> <li>Express application initialization and HTTP server creation</li> <li>Session management configuration using <code>cookie-session</code></li> <li>Middleware pipeline setup and execution order</li> <li>Static file serving for uploads and public assets</li> <li>View engine configuration for EJS templates</li> <li>Route delegation to specialized router modules</li> </ul> <p>For authentication middleware (<code>verifyToken</code>, <code>verifyAdmin</code>) that protect routes, see Middleware Layer. For database connection configuration, see Database Layer. For session data structure and lifecycle details, see Session Management.</p> <p>Sources: app.js L1-L47</p>"},{"location":"Application-Server/#server-initialization-and-configuration","title":"Server Initialization and Configuration","text":"<p>The application server is initialized in <code>app.js</code> through a series of configuration steps that establish the Express application, HTTP server, and environment settings.</p>"},{"location":"Application-Server/#express-application-creation","title":"Express Application Creation","text":"<p>The server begins by creating an Express application instance and loading environment variables:</p> <pre><code>Express app instance \u2192 Environment variable loading \u2192 HTTP server creation\n</code></pre> <p>The application loads environment configuration from <code>./env/.env</code> using the <code>dotenv</code> package, with special handling for production environments app.js L3-L6</p> <p>This configuration loads sensitive values such as <code>JWT_SECRET</code> used by authentication middleware.</p> <p>An HTTP server is explicitly created wrapping the Express app app.js L7-L8</p> <p>allowing the server to handle standard HTTP requests. The server listens on port 3000 app.js L18-L20</p>"},{"location":"Application-Server/#server-initialization-flow","title":"Server Initialization Flow","text":"<pre><code>flowchart TD\n\nStart[\"Application Start\"]\nExpressInit[\"express.require()&lt;br&gt;app = express()\"]\nDotenvLoad[\".env file loading&lt;br&gt;dotenv.config()\"]\nHTTPServer[\"http.createServer(app)\"]\nListen[\"server.listen(3000)\"]\nReady[\"Server Ready&lt;br&gt;localhost:3000\"]\n\nStart --&gt; ExpressInit\nExpressInit --&gt; DotenvLoad\nDotenvLoad --&gt; HTTPServer\nHTTPServer --&gt; Listen\nListen --&gt; Ready</code></pre> <p>Sources: app.js L1-L20</p>"},{"location":"Application-Server/#session-management","title":"Session Management","text":"<p>The application implements session management using the <code>cookie-session</code> middleware, which stores session data directly in cookies rather than server-side storage.</p>"},{"location":"Application-Server/#session-configuration","title":"Session Configuration","text":"<p>The <code>cookie-session</code> middleware is configured with the following parameters:</p> Parameter Value Purpose <code>name</code> <code>'session'</code> Cookie name in browser <code>keys</code> <code>['clave_secreta']</code> Signing key for cookie integrity <code>maxAge</code> <code>24 * 60 * 60 * 1000</code> Session lifetime (24 hours in milliseconds) <p>This configuration appears in app.js L12-L16</p> <p>and is applied before any route handlers, ensuring session data is available throughout the request lifecycle.</p>"},{"location":"Application-Server/#response-locals-population","title":"Response Locals Population","text":"<p>A custom middleware populates <code>res.locals</code> with session data on every request app.js L22-L26</p> <p>:</p> <pre><code>req.session.user \u2192 res.locals.user\nreq.session.rol \u2192 res.locals.rol\n</code></pre> <p>This middleware makes session data (<code>user</code> and <code>rol</code>) automatically available to all EJS templates without explicit passing. If no session exists, these values default to <code>null</code>, allowing templates to conditionally render based on authentication state.</p> <p>Sources: app.js L9-L26</p>"},{"location":"Application-Server/#middleware-pipeline","title":"Middleware Pipeline","text":"<p>The application employs a sequential middleware pipeline that processes every incoming request. The execution order is critical as each middleware layer depends on previous layers.</p>"},{"location":"Application-Server/#middleware-execution-order","title":"Middleware Execution Order","text":"<pre><code>flowchart TD\n\nRequest[\"Incoming HTTP Request\"]\nCookieSession[\"cookie-session&lt;br&gt;Parse session cookie&lt;br&gt;Populate req.session\"]\nResLocals[\"Custom Middleware&lt;br&gt;res.locals.user = req.session.user&lt;br&gt;res.locals.rol = req.session.rol\"]\nURLEncoded[\"express.urlencoded&lt;br&gt;Parse form data&lt;br&gt;extended: true\"]\nJSON[\"express.json()&lt;br&gt;Parse JSON request bodies\"]\nCookieParser[\"cookie-parser&lt;br&gt;Parse Cookie headers&lt;br&gt;into req.cookies\"]\nStaticUploads[\"Static: /uploads&lt;br&gt;Serve public/uploads\"]\nStaticResources[\"Static: /resources&lt;br&gt;Serve public directory\"]\nRoutes[\"Route Handlers&lt;br&gt;index, auth, participante,&lt;br&gt;admin, ganadores\"]\n\nRequest --&gt; CookieSession\nCookieSession --&gt; ResLocals\nResLocals --&gt; URLEncoded\nURLEncoded --&gt; JSON\nJSON --&gt; CookieParser\nCookieParser --&gt; StaticUploads\nStaticUploads --&gt; StaticResources\nStaticResources --&gt; Routes</code></pre>"},{"location":"Application-Server/#request-parsing-middleware","title":"Request Parsing Middleware","text":"<p>The application configures three request parsing middleware layers:</p> <ol> <li>express.urlencoded app.js L29 : Parses URL-encoded form data (e.g., from HTML form submissions) with <code>extended: true</code> to support nested objects</li> <li>express.json app.js L30 : Parses JSON request bodies for API endpoints</li> <li>cookie-parser app.js L31 : Parses Cookie headers into <code>req.cookies</code> object</li> </ol> <p>These middleware execute in sequence before any route handlers, ensuring request data is properly parsed regardless of content type.</p> <p>Sources: app.js L22-L32</p>"},{"location":"Application-Server/#static-file-serving","title":"Static File Serving","text":"<p>The application serves static assets through two distinct mount points, separating uploaded user content from application resources.</p>"},{"location":"Application-Server/#static-route-configuration","title":"Static Route Configuration","text":"Route Path File System Path Purpose <code>/uploads</code> <code>public/uploads</code> User-uploaded participant and winner photos <code>/resources</code> <code>public/</code> CSS stylesheets, JavaScript files, static images <p>The <code>/uploads</code> route app.js L32</p> <p>provides direct access to the <code>public/uploads</code> directory where multer stores participant photos with timestamped filenames (e.g., <code>participante-1234567890.jpg</code>).</p> <p>The <code>/resources</code> route app.js L34</p> <p>serves the entire <code>public</code> directory, using <code>__dirname</code> to ensure the path is resolved relative to the application root. This route provides access to:</p> <ul> <li>CSS files (<code>style.css</code>, <code>admin.css</code>, <code>inscripcion.css</code>, etc.)</li> <li>JavaScript files</li> <li>Static event images used in the gallery</li> </ul>"},{"location":"Application-Server/#static-file-access-pattern","title":"Static File Access Pattern","text":"<pre><code>flowchart TD\n\nBrowser[\"Browser Request\"]\nUploadsRoute[\"/uploads/*&lt;br&gt;express.static('public/uploads')\"]\nResourcesRoute[\"/resources/*&lt;br&gt;express.static('public')\"]\nUploadsDir[\"public/uploads/&lt;br&gt;participante-TIMESTAMP.ext&lt;br&gt;ganador-TIMESTAMP.ext\"]\nPublicDir[\"public/&lt;br&gt;css/, js/, images/\"]\n\nBrowser --&gt; UploadsRoute\nBrowser --&gt; ResourcesRoute\nUploadsRoute --&gt; UploadsDir\nResourcesRoute --&gt; PublicDir\n\nsubgraph subGraph1 [\"File System\"]\n    UploadsDir\n    PublicDir\nend\n\nsubgraph subGraph0 [\"Express Static Middleware\"]\n    UploadsRoute\n    ResourcesRoute\nend</code></pre> <p>Sources: app.js L32-L34</p>"},{"location":"Application-Server/#view-engine-configuration","title":"View Engine Configuration","text":"<p>The application uses EJS (Embedded JavaScript) as its templating engine for server-side HTML rendering. The view engine is configured with a single directive app.js L36</p> <p>:</p> <pre><code>app.set('view engine', 'ejs')\n</code></pre> <p>This configuration allows route handlers to render EJS templates using the <code>res.render()</code> method without specifying the file extension. For example, <code>res.render('perfil')</code> automatically resolves to <code>views/perfil.ejs</code>.</p> <p>The application uses the default views directory (<code>views/</code>) without explicitly setting it via <code>app.set('views', path)</code>, as indicated by the commented-out line app.js L37</p> <p>All EJS templates reside in the <code>views/</code> directory at the application root.</p> <p>Sources: app.js L36-L37</p>"},{"location":"Application-Server/#route-delegation-architecture","title":"Route Delegation Architecture","text":"<p>The application follows a modular routing architecture, delegating request handling to five specialized router modules. Each router handles a distinct functional domain of the application.</p>"},{"location":"Application-Server/#router-module-registration","title":"Router Module Registration","text":"<pre><code>flowchart TD\n\nAppJS[\"app.js&lt;br&gt;Express Application\"]\nIndexRouter[\"./src/routers/index&lt;br&gt;Landing page, event info\"]\nAuthRouter[\"./src/routers/auth&lt;br&gt;Login, logout, authentication\"]\nParticipanteRouter[\"./src/routers/participante&lt;br&gt;Registration, profile management\"]\nAdminRouter[\"./src/routers/admin&lt;br&gt;Admin panel, participant CRUD\"]\nGanadoresRouter[\"./src/routers/ganadores&lt;br&gt;Winner management\"]\n\nAppJS --&gt; IndexRouter\nAppJS --&gt; AuthRouter\nAppJS --&gt; ParticipanteRouter\nAppJS --&gt; AdminRouter\nAppJS --&gt; GanadoresRouter\n\nsubgraph subGraph0 [\"Router Modules\"]\n    IndexRouter\n    AuthRouter\n    ParticipanteRouter\n    AdminRouter\n    GanadoresRouter\nend</code></pre> <p>All router modules are mounted at the root path <code>/</code> app.js L40-L44</p> <p>with each router defining its own sub-paths. This approach allows routers to specify complete route paths (e.g., <code>/login</code>, <code>/perfil</code>, <code>/admin</code>) rather than relative paths.</p>"},{"location":"Application-Server/#router-module-responsibilities","title":"Router Module Responsibilities","text":"Router Module File Path Functional Domain <code>index</code> <code>./src/routers/index</code> Public pages (landing, event information) <code>auth</code> <code>./src/routers/auth</code> Authentication flows (login, logout) <code>participante</code> <code>./src/routers/participante</code> Participant operations (registration, profile) <code>admin</code> <code>./src/routers/admin</code> Administrative operations (participant management) <code>ganadores</code> <code>./src/routers/ganadores</code> Winner selection and management <p>The order of router registration matters when routes overlap. Routers are evaluated in the order they are registered, with the first matching route handling the request. However, in this application, each router defines distinct paths, minimizing routing conflicts.</p>"},{"location":"Application-Server/#request-flow-through-routers","title":"Request Flow Through Routers","text":"<pre><code>sequenceDiagram\n  participant HTTP Client\n  participant app.js\n  participant cookie-session\n  participant res.locals middleware\n  participant Router Module\n  participant Route Handler\n\n  HTTP Client-&gt;&gt;app.js: \"HTTP Request: /perfil\"\n  app.js-&gt;&gt;cookie-session: \"Parse session cookie\"\n  cookie-session-&gt;&gt;res.locals middleware: \"Populate res.locals\"\n  res.locals middleware-&gt;&gt;Router Module: \"Check index router\"\n  Router Module-&gt;&gt;Router Module: \"No match\"\n  res.locals middleware-&gt;&gt;Router Module: \"Check auth router\"\n  Router Module-&gt;&gt;Router Module: \"No match\"\n  res.locals middleware-&gt;&gt;Router Module: \"Check participante router\"\n  Router Module-&gt;&gt;Route Handler: \"Match found: /perfil\"\n  Route Handler-&gt;&gt;HTTP Client: \"Response\"</code></pre> <p>Sources: app.js L40-L44</p>"},{"location":"Application-Server/#complete-application-bootstrap-sequence","title":"Complete Application Bootstrap Sequence","text":"<p>The following diagram illustrates the complete initialization sequence from application start to request handling readiness:</p> <pre><code>flowchart TD\n\nStart[\"Node.js Process Start\"]\nRequireExpress[\"Require express module\"]\nCreateApp[\"Create Express app instance\"]\nLoadEnv[\"Load environment variables&lt;br&gt;from ./env/.env\"]\nRequireHTTP[\"Require http module\"]\nCreateServer[\"Create HTTP server&lt;br&gt;http.createServer(app)\"]\nCookieSession[\"Configure cookie-session&lt;br&gt;name: 'session'&lt;br&gt;keys: ['clave_secreta']&lt;br&gt;maxAge: 24 hours\"]\nCustomLocals[\"Register res.locals middleware&lt;br&gt;user, rol from session\"]\nURLEncoded[\"Register express.urlencoded&lt;br&gt;extended: true\"]\nJSON[\"Register express.json()\"]\nCookieParser[\"Register cookie-parser\"]\nStaticUploads[\"Mount /uploads static&lt;br&gt;public/uploads\"]\nStaticResources[\"Mount /resources static&lt;br&gt;public/\"]\nViewEngine[\"Set view engine: ejs\"]\nRouterIndex[\"Register index router\"]\nRouterAuth[\"Register auth router\"]\nRouterParticipante[\"Register participante router\"]\nRouterAdmin[\"Register admin router\"]\nRouterGanadores[\"Register ganadores router\"]\nListen[\"server.listen(3000)\"]\nReady[\"Server Ready&lt;br&gt;Accepting Connections\"]\n\nStart --&gt; RequireExpress\nCreateServer --&gt; CookieSession\nCustomLocals --&gt; URLEncoded\nStaticResources --&gt; ViewEngine\nViewEngine --&gt; RouterIndex\nRouterGanadores --&gt; Listen\n\nsubgraph subGraph5 [\"Server Start\"]\n    Listen\n    Ready\n    Listen --&gt; Ready\nend\n\nsubgraph subGraph4 [\"Router Registration\"]\n    RouterIndex\n    RouterAuth\n    RouterParticipante\n    RouterAdmin\n    RouterGanadores\n    RouterIndex --&gt; RouterAuth\n    RouterAuth --&gt; RouterParticipante\n    RouterParticipante --&gt; RouterAdmin\n    RouterAdmin --&gt; RouterGanadores\nend\n\nsubgraph subGraph3 [\"Application Configuration\"]\n    ViewEngine\nend\n\nsubgraph subGraph2 [\"Middleware Registration\"]\n    URLEncoded\n    JSON\n    CookieParser\n    StaticUploads\n    StaticResources\n    URLEncoded --&gt; JSON\n    JSON --&gt; CookieParser\n    CookieParser --&gt; StaticUploads\n    StaticUploads --&gt; StaticResources\nend\n\nsubgraph subGraph1 [\"Session Configuration\"]\n    CookieSession\n    CustomLocals\n    CookieSession --&gt; CustomLocals\nend\n\nsubgraph subGraph0 [\"Initialization Phase\"]\n    RequireExpress\n    CreateApp\n    LoadEnv\n    RequireHTTP\n    CreateServer\n    RequireExpress --&gt; CreateApp\n    CreateApp --&gt; LoadEnv\n    LoadEnv --&gt; RequireHTTP\n    RequireHTTP --&gt; CreateServer\nend</code></pre> <p>This bootstrap sequence ensures that:</p> <ol> <li>Session management is configured before route handlers</li> <li>Response locals are populated before any route processing</li> <li>Request parsing middleware is available to all routers</li> <li>Static file serving is configured before route delegation</li> <li>All routers have access to the complete middleware pipeline</li> </ol> <p>Sources: app.js L1-L47</p>"},{"location":"Application-Server/#port-configuration","title":"Port Configuration","text":"<p>The HTTP server listens on port 3000 app.js L18-L20</p> <p>making the application accessible at <code>http://localhost:3000</code>. This port is hardcoded in the application rather than loaded from environment variables.</p> <p>When the server successfully starts, it logs:</p> <pre><code>Servidor corriendo en http://localhost:3000\n</code></pre> <p>For production deployments, this port configuration may need modification or extraction to environment variables to support different deployment environments and reverse proxy configurations.</p> <p>Sources: app.js L18-L20</p>"},{"location":"Architecture/","title":"Architecture","text":"<p>Relevant source files * app.js * middlewares/multer.js * middlewares/verifyAdmin.js * middlewares/verifyToken.js * public/css/edit.css</p>"},{"location":"Architecture/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document describes the overall architecture of the HAPPY RUNNER 42K marathon management application, including the Express.js server structure, middleware pipeline, and request lifecycle. It provides a high-level view of how system components interact and how HTTP requests flow through the application layers.</p> <p>For detailed information about specific architectural components, see:</p> <ul> <li>Application server configuration and route delegation: Application Server</li> <li>Middleware implementation details: Middleware Layer</li> <li>Database connection and configuration: Database Layer</li> <li>Authentication mechanisms: Authentication &amp; Authorization</li> </ul>"},{"location":"Architecture/#architectural-overview","title":"Architectural Overview","text":"<p>The application follows a layered architecture pattern built on Express.js. The system separates concerns across distinct layers: presentation (EJS views), application logic (routes and controllers), authentication/authorization (middleware guards), and data persistence (MySQL database and file storage).</p>"},{"location":"Architecture/#system-layers-diagram","title":"System Layers Diagram","text":"<pre><code>flowchart TD\n\nBrowser[\"Web Browser&lt;br&gt;(HTTP/HTTPS)\"]\nEJSViews[\"EJS Templates&lt;br&gt;views/*.ejs\"]\nCSSFiles[\"Stylesheets&lt;br&gt;public/css/*.css\"]\nStaticFiles[\"Static Assets&lt;br&gt;public/uploads/*\"]\nAppJS[\"app.js&lt;br&gt;(Express Server)\"]\nRoutes[\"Route Modules\"]\nIndexRouter[\"src/routers/index.js\"]\nAuthRouter[\"src/routers/auth.js\"]\nParticipanteRouter[\"src/routers/participante.js\"]\nAdminRouter[\"src/routers/admin.js\"]\nGanadoresRouter[\"src/routers/ganadores.js\"]\nCookieSession[\"cookie-session\"]\nBodyParser[\"express.urlencoded&lt;br&gt;express.json\"]\nCookieParser[\"cookie-parser\"]\nVerifyToken[\"verifyToken\"]\nVerifyAdmin[\"verifyAdmin\"]\nMulterUpload[\"multer\"]\nControllers[\"Controllers&lt;br&gt;authcontroller.js&lt;br&gt;updateParticipante.js\"]\nMySQL[\"MySQL Database&lt;br&gt;participantes&lt;br&gt;organizadores&lt;br&gt;ganadores\"]\nFileSystem[\"File Storage&lt;br&gt;public/uploads/participantes/\"]\n\nBrowser --&gt; AppJS\nAppJS --&gt; CookieSession\nCookieParser --&gt; Routes\nIndexRouter --&gt; EJSViews\nAuthRouter --&gt; VerifyToken\nAuthRouter --&gt; VerifyAdmin\nParticipanteRouter --&gt; VerifyToken\nAdminRouter --&gt; VerifyAdmin\nGanadoresRouter --&gt; VerifyAdmin\nVerifyToken --&gt; Controllers\nVerifyAdmin --&gt; Controllers\nMulterUpload --&gt; FileSystem\nControllers --&gt; MySQL\n\nsubgraph Data [\"Data Layer\"]\n    MySQL\n    FileSystem\nend\n\nsubgraph Business [\"Business Logic Layer\"]\n    Controllers\nend\n\nsubgraph Middleware [\"Middleware Layer\"]\n    CookieSession\n    BodyParser\n    CookieParser\n    VerifyToken\n    VerifyAdmin\n    MulterUpload\n    CookieSession --&gt; BodyParser\n    BodyParser --&gt; CookieParser\nend\n\nsubgraph Application [\"Application Layer\"]\n    AppJS\n    Routes\n    IndexRouter\n    AuthRouter\n    ParticipanteRouter\n    AdminRouter\n    GanadoresRouter\n    Routes --&gt; IndexRouter\n    Routes --&gt; AuthRouter\n    Routes --&gt; ParticipanteRouter\n    Routes --&gt; AdminRouter\n    Routes --&gt; GanadoresRouter\nend\n\nsubgraph Presentation [\"Presentation Layer\"]\n    EJSViews\n    CSSFiles\n    StaticFiles\n    EJSViews --&gt; CSSFiles\n    EJSViews --&gt; StaticFiles\nend\n\nsubgraph Client [\"Client Layer\"]\n    Browser\nend</code></pre> <p>Sources: app.js L1-L47</p> <p>The application implements clear separation between public routes (accessible without authentication), participant routes (requiring authentication), and admin routes (requiring admin role verification).</p>"},{"location":"Architecture/#application-entry-point","title":"Application Entry Point","text":"<p>The Express application initializes in <code>app.js</code> with the following responsibilities:</p> Component Purpose Configuration Location Express Server HTTP server creation app.js L1-L2 app.js L7-L8 Environment Variables Configuration management app.js L3-L6 Session Management Cookie-based sessions app.js L12-L16 View Engine EJS template rendering app.js L36 Static Files Public asset serving app.js L32-L34 Route Delegation Modular routing app.js L40-L44"},{"location":"Architecture/#server-initialization-flow","title":"Server Initialization Flow","text":"<pre><code>sequenceDiagram\n  participant Process\n  participant app.js\n  participant Express\n  participant http.Server\n  participant Route Modules\n\n  Process-&gt;&gt;app.js: \"require('app.js')\"\n  app.js-&gt;&gt;Express: \"express()\"\n  Express--&gt;&gt;app.js: \"app instance\"\n  app.js-&gt;&gt;app.js: \"Load .env config\"\n  app.js-&gt;&gt;app.js: \"Configure middleware\n  app.js-&gt;&gt;http.Server: (cookie-session, body parsers)\"\n  http.Server--&gt;&gt;app.js: \"http.createServer(app)\"\n  app.js-&gt;&gt;Route Modules: \"server instance\"\n  Route Modules--&gt;&gt;app.js: \"app.use(require('./src/routers/*'))\"\n  app.js-&gt;&gt;http.Server: \"routes registered\"\n  http.Server--&gt;&gt;Process: \"server.listen(3000)\"</code></pre> <p>Sources: app.js L1-L20</p> <p>app.js L36-L44</p> <p>The server listens on port 3000 and creates an HTTP server instance wrapping the Express application. Environment variables are loaded from <code>./env/.env</code> using dotenv, with production-specific handling.</p>"},{"location":"Architecture/#middleware-pipeline","title":"Middleware Pipeline","text":"<p>The middleware pipeline processes every incoming request in a specific order. Middleware execution follows the registration sequence in <code>app.js</code>:</p>"},{"location":"Architecture/#middleware-execution-order","title":"Middleware Execution Order","text":"<pre><code>flowchart TD\n\nRequest[\"Incoming HTTP Request\"]\nCookieSession[\"Unsupported markdown: list\"]\nLocalsMiddleware[\"Unsupported markdown: list\"]\nURLEncoded[\"Unsupported markdown: list\"]\nJSON[\"Unsupported markdown: list\"]\nCookieParser[\"Unsupported markdown: list\"]\nStaticUploads[\"Unsupported markdown: list\"]\nStaticResources[\"Unsupported markdown: list\"]\nRoutes[\"Unsupported markdown: list\"]\nAuthGuards[\"Unsupported markdown: list\"]\nRouteLogic[\"Unsupported markdown: list\"]\nResponse[\"HTTP Response\"]\n\nRequest --&gt; CookieSession\nCookieSession --&gt; LocalsMiddleware\nLocalsMiddleware --&gt; URLEncoded\nURLEncoded --&gt; JSON\nJSON --&gt; CookieParser\nCookieParser --&gt; StaticUploads\nStaticUploads --&gt; StaticResources\nStaticResources --&gt; Routes\nRoutes --&gt; AuthGuards\nAuthGuards --&gt; RouteLogic\nRouteLogic --&gt; Response</code></pre> <p>Sources: app.js L12-L34</p> <p>middlewares/verifyToken.js L1-L19</p> <p>middlewares/verifyAdmin.js L1-L17</p>"},{"location":"Architecture/#core-middleware-components","title":"Core Middleware Components","text":"Middleware Purpose Implementation <code>cookie-session</code> Session state management with 24-hour lifetime app.js L12-L16 <code>res.locals</code> population Makes <code>req.session.user</code> and <code>req.session.rol</code> available to all views app.js L22-L26 <code>express.urlencoded</code> Parses form data (application/x-www-form-urlencoded) app.js L29 <code>express.json</code> Parses JSON request bodies app.js L30 <code>cookie-parser</code> Parses cookies for JWT token extraction app.js L31 Static file serving Serves uploaded files and public assets app.js L32-L34 <p>The custom middleware at app.js L22-L26</p> <p>populates <code>res.locals</code> with session data, making user identity and role accessible to all EJS templates without explicit passing.</p>"},{"location":"Architecture/#request-lifecycle","title":"Request Lifecycle","text":"<p>A complete request flows through multiple stages from HTTP reception to response rendering. The lifecycle varies based on route protection level.</p>"},{"location":"Architecture/#public-route-request-flow","title":"Public Route Request Flow","text":"<pre><code>sequenceDiagram\n  participant Client\n  participant app.js\n  participant cookie-session\n  participant res.locals MW\n  participant Route Handler\n  participant EJS Template\n\n  Client-&gt;&gt;app.js: \"GET /\"\n  app.js-&gt;&gt;cookie-session: \"Process session cookie\"\n  cookie-session-&gt;&gt;cookie-session: \"Parse session\n  cookie-session-&gt;&gt;res.locals MW: (req.session populated)\"\n  res.locals MW-&gt;&gt;res.locals MW: \"next()\"\n  res.locals MW-&gt;&gt;Route Handler: \"res.locals.user = req.session.user\n  Route Handler-&gt;&gt;Route Handler: res.locals.rol = req.session.rol\"\n  Route Handler-&gt;&gt;EJS Template: \"next()\"\n  EJS Template-&gt;&gt;EJS Template: \"Execute route logic\"\n  EJS Template--&gt;&gt;Client: \"res.render('index', data)\"</code></pre> <p>Sources: app.js L12-L26</p> <p>app.js L40-L44</p>"},{"location":"Architecture/#protected-route-request-flow-participant","title":"Protected Route Request Flow (Participant)","text":"<pre><code>sequenceDiagram\n  participant Client\n  participant app.js\n  participant cookie-session\n  participant res.locals MW\n  participant Route Handler\n  participant verifyToken MW\n  participant Business Logic\n  participant MySQL\n  participant EJS Template\n\n  Client-&gt;&gt;app.js: \"GET /perfil\"\n  app.js-&gt;&gt;cookie-session: \"Process session\"\n  cookie-session-&gt;&gt;res.locals MW: \"next()\"\n  res.locals MW-&gt;&gt;Route Handler: \"next()\"\n  Route Handler-&gt;&gt;verifyToken MW: \"Middleware guard\"\n  verifyToken MW-&gt;&gt;verifyToken MW: \"Extract token from req.cookies.token\"\n  loop [Token invalid]\n    verifyToken MW--&gt;&gt;Client: \"Redirect to /loginadmin\"\n    verifyToken MW-&gt;&gt;verifyToken MW: \"jwt.verify(token, JWT_SECRET)\"\n    verifyToken MW--&gt;&gt;Client: \"Redirect to /loginadmin\"\n    verifyToken MW-&gt;&gt;verifyToken MW: \"req.user = decoded\"\n    verifyToken MW-&gt;&gt;Business Logic: \"next()\"\n    Business Logic-&gt;&gt;MySQL: \"Query participant data\"\n    MySQL--&gt;&gt;Business Logic: \"Result set\"\n    Business Logic-&gt;&gt;EJS Template: \"res.render('perfil', data)\"\n    EJS Template--&gt;&gt;Client: \"HTML Response\"\n  end</code></pre> <p>Sources: middlewares/verifyToken.js L1-L19</p>"},{"location":"Architecture/#protected-route-request-flow-admin","title":"Protected Route Request Flow (Admin)","text":"<pre><code>sequenceDiagram\n  participant Client\n  participant Route Handler\n  participant verifyAdmin MW\n  participant Business Logic\n\n  Client-&gt;&gt;Route Handler: \"GET /admin\"\n  Route Handler-&gt;&gt;verifyAdmin MW: \"Middleware guard\"\n  verifyAdmin MW-&gt;&gt;verifyAdmin MW: \"Extract token from req.cookies.token\"\n  loop [Token invalid]\n    verifyAdmin MW--&gt;&gt;Client: \"Redirect to /authadmin\"\n    verifyAdmin MW-&gt;&gt;verifyAdmin MW: \"jwt.verify(token, JWT_SECRET)\"\n    verifyAdmin MW--&gt;&gt;Client: \"Redirect to /authadmin\"\n    verifyAdmin MW-&gt;&gt;verifyAdmin MW: \"Check decoded.rol === 'admin'\"\n    verifyAdmin MW--&gt;&gt;Client: \"Redirect to /authadmin\"\n    verifyAdmin MW-&gt;&gt;verifyAdmin MW: \"req.user = decoded\"\n    verifyAdmin MW-&gt;&gt;Business Logic: \"next()\"\n    Business Logic--&gt;&gt;Client: \"Execute admin logic\"\n  end</code></pre> <p>Sources: middlewares/verifyAdmin.js L1-L17</p> <p>The key difference between <code>verifyToken</code> and <code>verifyAdmin</code> middleware is that <code>verifyAdmin</code> performs an additional role check at middlewares/verifyAdmin.js L9</p> <p>ensuring <code>decoded.rol === \"admin\"</code> before allowing access.</p>"},{"location":"Architecture/#routing-architecture","title":"Routing Architecture","text":"<p>Routes are organized into five modular files, each handling a specific functional domain:</p>"},{"location":"Architecture/#route-module-organization","title":"Route Module Organization","text":"<pre><code>flowchart TD\n\nAppJS[\"app.js\"]\nIndexRouter[\"src/routers/index.js&lt;br&gt;(Public Routes)\"]\nAuthRouter[\"src/routers/auth.js&lt;br&gt;(Authentication)\"]\nParticipanteRouter[\"src/routers/participante.js&lt;br&gt;(Participant Operations)\"]\nAdminRouter[\"src/routers/admin.js&lt;br&gt;(Admin Operations)\"]\nGanadoresRouter[\"src/routers/ganadores.js&lt;br&gt;(Winner Management)\"]\nPublic[\"GET /&lt;br&gt;GET /info&lt;br&gt;GET /inscripcion\"]\nAuth[\"POST /auth&lt;br&gt;POST /authadmin&lt;br&gt;GET /login&lt;br&gt;GET /loginadmin&lt;br&gt;GET /logout\"]\nPart[\"GET /perfil&lt;br&gt;GET /edit&lt;br&gt;POST /update\"]\nAdmin[\"GET /admin&lt;br&gt;GET /editadmin/:id&lt;br&gt;POST /updateadmin/:id&lt;br&gt;POST /delete/:id&lt;br&gt;GET /register&lt;br&gt;POST /storeOrganizador\"]\nWinners[\"POST /storeganador&lt;br&gt;GET /ganadores&lt;br&gt;POST /eliminarganador/:id\"]\n\nAppJS --&gt; IndexRouter\nAppJS --&gt; AuthRouter\nAppJS --&gt; ParticipanteRouter\nAppJS --&gt; AdminRouter\nAppJS --&gt; GanadoresRouter\nIndexRouter --&gt; Public\nAuthRouter --&gt; Auth\nParticipanteRouter --&gt; Part\nAdminRouter --&gt; Admin\nGanadoresRouter --&gt; Winners</code></pre> <p>Sources: app.js L40-L44</p>"},{"location":"Architecture/#route-protection-matrix","title":"Route Protection Matrix","text":"Route Module Protection Level Middleware Accessed By <code>index.js</code> None - All users <code>auth.js</code> Mixed - Authentication endpoints <code>participante.js</code> Participant <code>verifyToken</code> Authenticated participants <code>admin.js</code> Admin <code>verifyAdmin</code> Admin users only <code>ganadores.js</code> Admin <code>verifyAdmin</code> Admin users only <p>Each router module is registered with <code>app.use(\"/\", require(\"./src/routers/...\"))</code>, mounting all routes at the root path. Individual route handlers within each module then apply appropriate middleware guards.</p>"},{"location":"Architecture/#session-and-state-management","title":"Session and State Management","text":"<p>Session state is managed through <code>cookie-session</code> middleware with encrypted cookies containing session data.</p>"},{"location":"Architecture/#session-configuration","title":"Session Configuration","text":"<pre><code>flowchart TD\n\nSessionConfig[\"cookie-session Configuration\"]\nName[\"name: 'session'\"]\nKeys[\"keys: ['clave_secreta']\"]\nMaxAge[\"maxAge: 24 * 60 * 60 * 1000&lt;br&gt;(24 hours)\"]\nSessionData[\"Session Data Structure\"]\nUser[\"req.session.user&lt;br&gt;(DNI or username)\"]\nRol[\"req.session.rol&lt;br&gt;('participante' or 'admin')\"]\nToken[\"JWT token stored in cookies\"]\nViewAccess[\"res.locals (View Access)\"]\nLocalsUser[\"res.locals.user\"]\nLocalsRol[\"res.locals.rol\"]\n\nSessionConfig --&gt; Name\nSessionConfig --&gt; Keys\nSessionConfig --&gt; MaxAge\nSessionData --&gt; User\nSessionData --&gt; Rol\nSessionData --&gt; Token\nViewAccess --&gt; LocalsUser\nViewAccess --&gt; LocalsRol</code></pre> <p>Sources: app.js L12-L16</p> <p>app.js L22-L26</p>"},{"location":"Architecture/#session-lifecycle","title":"Session Lifecycle","text":"Event Action Location User login Session created with <code>user</code> and <code>rol</code> properties Authentication controllers Session duration 24 hours from last activity app.js L15 Each request Session data populated into <code>res.locals</code> for view access app.js L22-L26 JWT validation Token extracted from <code>req.cookies.token</code> middlewares/verifyToken.js L4 middlewares/verifyAdmin.js L4 User logout Session destroyed, cookies cleared Auth router <p>The session middleware uses a secret key <code>'clave_secreta'</code> to sign session cookies, preventing tampering. JWT tokens provide additional authentication security, stored separately in cookies and verified using <code>process.env.JWT_SECRET</code>.</p>"},{"location":"Architecture/#file-upload-architecture","title":"File Upload Architecture","text":"<p>File uploads are handled by multer middleware with disk storage configuration.</p>"},{"location":"Architecture/#multer-storage-configuration","title":"Multer Storage Configuration","text":"<pre><code>flowchart TD\n\nMulterConfig[\"multer.diskStorage\"]\nDestination[\"destination:&lt;br&gt;public/uploads/participantes/\"]\nFilename[\"filename:&lt;br&gt;participante-{timestamp}.{ext}\"]\nUploadFlow[\"Upload Flow\"]\nRequest[\"Multipart form data\"]\nMulter[\"multer middleware\"]\nDiskWrite[\"Write to disk\"]\nFileRecord[\"File path stored in DB\"]\nStaticServe[\"Static File Serving\"]\nExpress[\"app.use('/uploads', ...)\"]\nPublicAccess[\"Public access via&lt;br&gt;/uploads/participantes/filename\"]\n\nMulterConfig --&gt; Destination\nMulterConfig --&gt; Filename\nUploadFlow --&gt; Request\nRequest --&gt; Multer\nMulter --&gt; DiskWrite\nDiskWrite --&gt; FileRecord\nStaticServe --&gt; Express\nExpress --&gt; PublicAccess</code></pre> <p>Sources: middlewares/multer.js L1-L15</p> <p>app.js L32</p> <p>Uploaded files are stored in <code>public/uploads/participantes/</code> with timestamped filenames generated at middlewares/multer.js L11</p> <p>The naming convention <code>participante-{Date.now()}.{ext}</code> ensures uniqueness and prevents filename collisions. These files are publicly accessible through the static file middleware at app.js L32</p> <p>which maps the <code>/uploads</code> URL path to the <code>public/uploads</code> directory.</p>"},{"location":"Architecture/#summary","title":"Summary","text":"<p>The HAPPY RUNNER 42K application architecture implements a layered design with clear separation of concerns:</p> <ul> <li>Application Layer: Express.js server in <code>app.js</code> coordinates all components</li> <li>Middleware Pipeline: Sequential processing of requests through session management, body parsing, and authentication guards</li> <li>Routing Layer: Five modular routers handling distinct functional domains</li> <li>Authentication: Dual-level protection using JWT tokens with role-based access control</li> <li>Data Persistence: MySQL database for structured data, file system for uploaded photos</li> <li>Session Management: Cookie-based sessions with 24-hour lifetime and <code>res.locals</code> population for view access</li> </ul> <p>The architecture enables role-based feature segregation, with public routes for event information, participant-protected routes for profile management, and admin-protected routes for system administration.</p>"},{"location":"Authentication-%26-Authorization/","title":"Authentication &amp; Authorization","text":"<p>Relevant source files * controllers/authcontroller.js * middlewares/multer.js * middlewares/verifyAdmin.js * middlewares/verifyToken.js * public/css/edit.css * views/partials/header.ejs</p> <p>This document provides a comprehensive overview of the authentication and authorization mechanisms in the HAPPY RUNNER 42K application. The system implements a dual authentication model with session-based state management and role-based access control to distinguish between participant and administrator capabilities.</p> <p>Scope: This document covers login mechanisms, credential validation, middleware-based authorization guards, session management, and role-based navigation. For information about the broader middleware pipeline, see Middleware Layer. For details about user interface access patterns, see User Interfaces.</p>"},{"location":"Authentication-%26-Authorization/#system-overview","title":"System Overview","text":"<p>The application implements two independent authentication pathways that converge on a unified session-based authorization model:</p> <pre><code>flowchart TD\n\nParticipantLogin[\"Participant Login&lt;br&gt;/login&lt;br&gt;DNI + password\"]\nAdminLogin[\"Admin Login&lt;br&gt;/loginadmin&lt;br&gt;username + password\"]\nLoginParticipanteFunc[\"authcontroller.js&lt;br&gt;loginParticipante()\"]\nLoginAdminFunc[\"authcontroller.js&lt;br&gt;loginAdmin()\"]\nBcryptCompare[\"bcrypt.compare()\"]\nParticipantesTable[\"participantes table&lt;br&gt;dni, password\"]\nOrganizadoresTable[\"organizadores table&lt;br&gt;user, password\"]\nSessionData[\"req.session&lt;br&gt;loggedin: true&lt;br&gt;dni/user: value&lt;br&gt;rol: 'participante'/'admin'\"]\nVerifyTokenMW[\"verifyToken middleware&lt;br&gt;JWT validation\"]\nVerifyAdminMW[\"verifyAdmin middleware&lt;br&gt;JWT + rol check\"]\nParticipantRoutes[\"/perfil, /edit\"]\nAdminRoutes[\"/admin, /register,&lt;br&gt;/ganadores\"]\n\nParticipantLogin --&gt; LoginParticipanteFunc\nAdminLogin --&gt; LoginAdminFunc\nLoginParticipanteFunc --&gt; ParticipantesTable\nLoginAdminFunc --&gt; OrganizadoresTable\nBcryptCompare --&gt; SessionData\nSessionData --&gt; VerifyTokenMW\nSessionData --&gt; VerifyAdminMW\nVerifyTokenMW --&gt; ParticipantRoutes\nVerifyAdminMW --&gt; AdminRoutes\n\nsubgraph subGraph5 [\"Protected Resources\"]\n    ParticipantRoutes\n    AdminRoutes\nend\n\nsubgraph subGraph4 [\"Authorization Guards\"]\n    VerifyTokenMW\n    VerifyAdminMW\nend\n\nsubgraph subGraph3 [\"Session Establishment\"]\n    SessionData\nend\n\nsubgraph subGraph2 [\"Database Tables\"]\n    ParticipantesTable\n    OrganizadoresTable\nend\n\nsubgraph subGraph1 [\"Credential Validation\"]\n    LoginParticipanteFunc\n    LoginAdminFunc\n    BcryptCompare\n    LoginParticipanteFunc --&gt; BcryptCompare\n    LoginAdminFunc --&gt; BcryptCompare\nend\n\nsubgraph subGraph0 [\"Authentication Entry Points\"]\n    ParticipantLogin\n    AdminLogin\nend</code></pre> <p>Sources: controllers/authcontroller.js L1-L91</p> <p>middlewares/verifyToken.js L1-L18</p> <p>middlewares/verifyAdmin.js L1-L15</p>"},{"location":"Authentication-%26-Authorization/#31-login-system","title":"3.1 Login System","text":"<p>The login system provides two distinct authentication mechanisms that query separate database tables and establish role-specific sessions.</p>"},{"location":"Authentication-%26-Authorization/#participant-login-dni-based","title":"Participant Login (DNI-Based)","text":"<p>Participants authenticate using their National Identity Document (DNI) number as the username. The <code>loginParticipante</code> function implements the following validation logic:</p> <p>Authentication Flow:</p> Step Action Implementation 1 Validate input presence Check <code>dni</code> and <code>password</code> fields exist 2 Query database <code>SELECT * FROM participantes WHERE dni = ?</code> 3 Verify credentials <code>bcrypt.compare(password, results[0].password)</code> 4 Establish session Set <code>req.session.loggedin</code>, <code>req.session.dni</code>, <code>req.session.rol = \"participante\"</code> 5 Redirect Navigate to <code>/perfil</code> on success <pre><code>sequenceDiagram\n  participant Client\n  participant /login POST\n  participant loginParticipante()\n  participant participantes table\n  participant bcrypt\n  participant req.session\n\n  Client-&gt;&gt;/login POST: \"POST {dni, password}\"\n  /login POST-&gt;&gt;loginParticipante(): \"Execute handler\"\n  loop [Missing Credentials]\n    loginParticipante()--&gt;&gt;Client: \"Render login with error\"\n    loginParticipante()-&gt;&gt;participantes table: \"SELECT * FROM participantes\n    participantes table--&gt;&gt;loginParticipante(): WHERE dni = ?\"\n    loginParticipante()--&gt;&gt;Client: \"User record or empty\"\n    loginParticipante()-&gt;&gt;bcrypt: \"Render 'Credenciales inv\u00e1lidas'\"\n    bcrypt--&gt;&gt;loginParticipante(): \"compare(password, hash)\"\n    loginParticipante()--&gt;&gt;Client: \"boolean result\"\n  end\n  loginParticipante()-&gt;&gt;req.session: \"Render 'Credenciales inv\u00e1lidas'\"\n  loginParticipante()--&gt;&gt;Client: \"loggedin = true</code></pre> <p>Implementation Details:</p> <p>The function performs asynchronous password comparison using bcrypt to validate hashed credentials stored in the database controllers/authcontroller.js L1-L45</p> <p>Input validation occurs before database queries controllers/authcontroller.js L4-L12</p> <p>Failed authentication attempts render the login view with error feedback rather than throwing exceptions controllers/authcontroller.js L17-L27</p> <p>Sources: controllers/authcontroller.js L1-L45</p>"},{"location":"Authentication-%26-Authorization/#admin-login-username-based","title":"Admin Login (Username-Based)","text":"<p>Administrator authentication uses a traditional username/password combination, querying the <code>organizadores</code> table:</p> <p>Key Differences from Participant Login:</p> Aspect Participant Admin Credential field <code>dni</code> <code>user</code> Database table <code>participantes</code> <code>organizadores</code> Session identifier <code>req.session.dni</code> <code>req.session.user</code> Role value <code>\"participante\"</code> <code>\"admin\"</code> Success redirect <code>/perfil</code> <code>/admin</code> <pre><code>flowchart TD\n\nLoginAdminForm[\"POST /loginadmin&lt;br&gt;{user, password}\"]\nLoginAdminFunc[\"loginAdmin()&lt;br&gt;authcontroller.js:47-91\"]\nOrganizadoresQuery[\"SELECT * FROM organizadores&lt;br&gt;WHERE user = ?\"]\nBcryptValidation[\"await bcrypt.compare()&lt;br&gt;line 65\"]\nSessionSetup[\"req.session.loggedin = true&lt;br&gt;req.session.user = results[0].user&lt;br&gt;req.session.rol = 'admin'&lt;br&gt;lines 77-79\"]\nAdminPanel[\"Redirect to /admin\"]\n\nLoginAdminForm --&gt; LoginAdminFunc\nLoginAdminFunc --&gt; OrganizadoresQuery\nOrganizadoresQuery --&gt; BcryptValidation\nBcryptValidation --&gt; SessionSetup\nSessionSetup --&gt; AdminPanel</code></pre> <p>The admin login function follows identical validation patterns to participant login but operates on different data structures controllers/authcontroller.js L47-L91</p> <p>Error handling mirrors the participant flow, rendering <code>loginadmin.ejs</code> with appropriate alert configurations.</p> <p>Sources: controllers/authcontroller.js L47-L91</p>"},{"location":"Authentication-%26-Authorization/#password-security","title":"Password Security","text":"<p>Both login functions employ bcrypt for secure password comparison:</p> <ul> <li>Asynchronous comparison: Uses <code>await bcrypt.compare()</code> to prevent timing attacks</li> <li>No plaintext exposure: Passwords are never logged or displayed</li> <li>Database storage: Only bcrypt hashes are stored in <code>participantes.password</code> and <code>organizadores.password</code> fields</li> </ul> <p>The comparison occurs after successful database query retrieval controllers/authcontroller.js L19</p> <p>and controllers/authcontroller.js L65</p> <p>ensuring short-circuit evaluation when users don't exist.</p> <p>Sources: controllers/authcontroller.js L19</p> <p>controllers/authcontroller.js L65</p>"},{"location":"Authentication-%26-Authorization/#32-role-based-access-control","title":"3.2 Role-Based Access Control","text":"<p>The application enforces authorization through two middleware guards that intercept requests to protected routes. These guards validate JWT tokens and role attributes to control access.</p>"},{"location":"Authentication-%26-Authorization/#middleware-architecture","title":"Middleware Architecture","text":"<pre><code>flowchart TD\n\nIncomingRequest[\"HTTP Request\"]\nCookieCheck[\"Check req.cookies.token\"]\nVTCheck[\"Token exists?\"]\nVTDecode[\"jwt.verify(token, JWT_SECRET)\"]\nVTAttach[\"req.user = decoded\"]\nVACheck[\"Token exists?\"]\nVADecode[\"jwt.verify(token, JWT_SECRET)\"]\nVARoleCheck[\"decoded.rol === 'admin'?\"]\nVAAttach[\"req.user = decoded\"]\nRedirectLogin[\"Redirect /loginadmin\"]\nRedirectAuth[\"Redirect /authadmin\"]\nRouteHandler[\"Execute route handler\"]\n\nIncomingRequest --&gt; CookieCheck\nCookieCheck --&gt; VTCheck\nVTCheck --&gt; RedirectLogin\nVTDecode --&gt; RedirectLogin\nVTAttach --&gt; RouteHandler\nCookieCheck --&gt; VACheck\nVACheck --&gt; RedirectAuth\nVADecode --&gt; RedirectAuth\nVARoleCheck --&gt; RedirectAuth\nVAAttach --&gt; RouteHandler\n\nsubgraph subGraph1 [\"verifyAdmin Middleware\"]\n    VACheck\n    VADecode\n    VARoleCheck\n    VAAttach\n    VACheck --&gt; VADecode\n    VADecode --&gt; VARoleCheck\n    VARoleCheck --&gt; VAAttach\nend\n\nsubgraph subGraph0 [\"verifyToken Middleware\"]\n    VTCheck\n    VTDecode\n    VTAttach\n    VTCheck --&gt; VTDecode\n    VTDecode --&gt; VTAttach\nend</code></pre> <p>Sources: middlewares/verifyToken.js L1-L18</p> <p>middlewares/verifyAdmin.js L1-L15</p>"},{"location":"Authentication-%26-Authorization/#verifytoken-middleware","title":"verifyToken Middleware","text":"<p>The <code>verifyToken</code> middleware provides general authentication validation for routes requiring any authenticated user. It reads JWT tokens from cookies and validates them against the <code>JWT_SECRET</code> environment variable.</p> <p>Implementation middlewares/verifyToken.js L1-L18</p> <p>:</p> <pre><code>Token retrieval: req.cookies.token (line 4)\nValidation: jwt.verify(token, process.env.JWT_SECRET) (line 10)\nUser attachment: req.user = decoded (line 11)\nFailure redirect: /loginadmin (lines 6, 14)\n</code></pre> <p>Usage Pattern: This middleware protects participant-facing routes where general authentication suffices without role differentiation. The decoded token payload is attached to <code>req.user</code> for downstream route handlers.</p> <p>Sources: middlewares/verifyToken.js L1-L18</p>"},{"location":"Authentication-%26-Authorization/#verifyadmin-middleware","title":"verifyAdmin Middleware","text":"<p>The <code>verifyAdmin</code> middleware extends authentication with role verification, ensuring only users with <code>rol: \"admin\"</code> in their token payload can access administrative routes.</p> <p>Implementation middlewares/verifyAdmin.js L1-L15</p> <p>:</p> <pre><code>Token retrieval: req.cookies.token (line 4)\nValidation: jwt.verify(token, process.env.JWT_SECRET) (line 8)\nRole check: decoded.rol !== \"admin\" (line 9)\nSuccess attachment: req.user = decoded (line 10)\nFailure redirect: /authadmin (lines 5, 9, 13)\n</code></pre> <p>Key Difference: The additional role comparison middlewares/verifyAdmin.js L9</p> <p>creates a two-stage authorization: first validating the token's authenticity, then verifying the role attribute. Failed role checks redirect to <code>/authadmin</code> rather than <code>/loginadmin</code>, distinguishing authentication failures from authorization failures.</p> <p>Sources: middlewares/verifyAdmin.js L1-L15</p>"},{"location":"Authentication-%26-Authorization/#protected-route-mapping","title":"Protected Route Mapping","text":"<p>The following table maps routes to their authorization requirements:</p> Route Middleware Role Required Purpose <code>/perfil</code> <code>verifyToken</code> Any authenticated View participant profile <code>/edit</code> <code>verifyToken</code> Any authenticated Edit participant profile <code>/admin</code> <code>verifyAdmin</code> <code>\"admin\"</code> View all participants <code>/register</code> <code>verifyAdmin</code> <code>\"admin\"</code> Register new organizers <code>/ganadores</code> <code>verifyAdmin</code> <code>\"admin\"</code> Manage race winners <code>/editadmin/:id</code> <code>verifyAdmin</code> <code>\"admin\"</code> Edit participant as admin <code>/delete/:id</code> <code>verifyAdmin</code> <code>\"admin\"</code> Delete participant <p>Sources: middlewares/verifyToken.js L1-L18</p> <p>middlewares/verifyAdmin.js L1-L15</p>"},{"location":"Authentication-%26-Authorization/#role-based-navigation","title":"Role-Based Navigation","text":"<p>The navigation header dynamically renders links based on authentication state and role, implemented in the <code>header.ejs</code> partial:</p> <pre><code>flowchart TD\n\nHeaderRender[\"header.ejs rendering\"]\nCheckUser[\"user variable&lt;br&gt;exists?\"]\nCheckRole[\"rol value\"]\nUnauthNav[\"Unauthenticated Navigation&lt;br&gt;- INICIO&lt;br&gt;- INFO&lt;br&gt;- INSCRIPCI\u00d3N button&lt;br&gt;- Login icon /login&lt;br&gt;- Admin shield /loginadmin\"]\nParticipantNav[\"Participant Navigation&lt;br&gt;- INICIO&lt;br&gt;- INFO&lt;br&gt;- MI PERFIL&lt;br&gt;- Logout icon\"]\nAdminNav[\"Admin Navigation&lt;br&gt;- INICIO&lt;br&gt;- INFO&lt;br&gt;- REG\u00cdSTRATE&lt;br&gt;- PANEL&lt;br&gt;- GANADORES&lt;br&gt;- Logout icon\"]\n\nHeaderRender --&gt; CheckUser\nCheckUser --&gt; UnauthNav\nCheckUser --&gt; CheckRole\nCheckRole --&gt; ParticipantNav\nCheckRole --&gt; AdminNav</code></pre> <p>Implementation Details views/partials/header.ejs L18-L30</p> <p>:</p> <ul> <li>Line 18: Checks <code>if (!user)</code> for unauthenticated state</li> <li>Line 22: Checks <code>else if (rol === 'participante')</code> for participant role</li> <li>Line 25: Checks <code>else if (rol === 'admin')</code> for admin role</li> </ul> <p>The <code>user</code> and <code>rol</code> variables are populated from session data by middleware before template rendering, providing seamless role-based UI customization without client-side logic.</p> <p>Sources: views/partials/header.ejs L18-L30</p>"},{"location":"Authentication-%26-Authorization/#33-session-management","title":"3.3 Session Management","text":"<p>The application uses the <code>cookie-session</code> middleware to maintain server-side session state encoded in signed cookies. Session data persists across requests and stores authentication status and role information.</p>"},{"location":"Authentication-%26-Authorization/#session-data-structure","title":"Session Data Structure","text":"<p>The session object contains the following properties after successful authentication:</p> Property Type Purpose Set By <code>loggedin</code> Boolean Indicates active authentication Both login functions <code>dni</code> String Participant identifier (DNI number) <code>loginParticipante</code> <code>user</code> String Admin username <code>loginAdmin</code> <code>rol</code> String User role (<code>\"participante\"</code> or <code>\"admin\"</code>) Both login functions <p>Participant Session Example controllers/authcontroller.js L31-L33</p> <p>:</p> <pre><code>req.session.loggedin = true\nreq.session.dni = results[0].dni\nreq.session.rol = \"participante\"\n</code></pre> <p>Admin Session Example controllers/authcontroller.js L77-L79</p> <p>:</p> <pre><code>req.session.loggedin = true\nreq.session.user = results[0].user\nreq.session.rol = \"admin\"\n</code></pre> <p>Sources: controllers/authcontroller.js L31-L33</p> <p>controllers/authcontroller.js L77-L79</p>"},{"location":"Authentication-%26-Authorization/#session-lifecycle","title":"Session Lifecycle","text":"<pre><code>sequenceDiagram\n  participant Browser\n  participant cookie-session\n  participant middleware\n  participant loginParticipante() or\n  participant loginAdmin()\n  participant app.js middleware\n  participant res.locals setup\n  participant EJS Template\n\n  Browser-&gt;&gt;cookie-session: \"Request with session cookie\"\n  cookie-session-&gt;&gt;cookie-session: \"Decrypt and verify\n  cookie-session-&gt;&gt;app.js middleware: using clave_secreta\"\n  note over app.js middleware,res.locals setup: \"Populate res.locals\n  app.js middleware-&gt;&gt;EJS Template: \"req.session populated\"\n  EJS Template--&gt;&gt;Browser: \"user = req.session.user/dni\n  note over Browser: \"User initiates login\"\n  Browser-&gt;&gt;loginParticipante() or: rol = req.session.rol\"\n  loginParticipante() or-&gt;&gt;loginParticipante() or: \"Rendered HTML with\n  loginParticipante() or-&gt;&gt;cookie-session: role-based content\"\n  cookie-session-&gt;&gt;cookie-session: \"POST /login or /loginadmin\"\n  cookie-session--&gt;&gt;Browser: \"Validate credentials\"\n  note over Browser,middleware: \"Session active for 24 hours\"\n  Browser-&gt;&gt;cookie-session: \"req.session.loggedin = true\n  cookie-session-&gt;&gt;app.js middleware: req.session.rol = role</code></pre> <p>Sources: controllers/authcontroller.js L31-L33</p> <p>controllers/authcontroller.js L77-L79</p>"},{"location":"Authentication-%26-Authorization/#cookie-session-configuration","title":"Cookie-Session Configuration","text":"<p>The <code>cookie-session</code> middleware configuration establishes session parameters:</p> <p>Configuration Properties (from application setup):</p> Property Value Purpose <code>name</code> Session cookie name Cookie identifier in browser <code>keys</code> <code>['clave_secreta']</code> Signing key for session encryption <code>maxAge</code> 24 hours (milliseconds) Session expiration time <p>The session cookie is signed using the <code>clave_secreta</code> key, ensuring integrity and preventing client-side tampering. Sessions expire after 24 hours, requiring re-authentication.</p>"},{"location":"Authentication-%26-Authorization/#session-availability-in-views","title":"Session Availability in Views","text":"<p>The application middleware populates <code>res.locals</code> from session data before rendering EJS templates:</p> <pre><code>flowchart TD\n\nSessionData[\"req.session&lt;br&gt;{loggedin, dni/user, rol}\"]\nMiddleware[\"app.js middleware&lt;br&gt;res.locals setup\"]\nResLocals[\"res.locals&lt;br&gt;{user, rol}\"]\nEJSTemplates[\"All EJS views&lt;br&gt;access user and rol\"]\n\nSessionData --&gt; Middleware\nMiddleware --&gt; ResLocals\nResLocals --&gt; EJSTemplates</code></pre> <p>This pattern makes session state available to all rendered views without explicit passing in route handlers. The <code>header.ejs</code> partial leverages this to implement role-based navigation views/partials/header.ejs L18-L30</p> <p>Sources: views/partials/header.ejs L18-L30</p>"},{"location":"Authentication-%26-Authorization/#logout-mechanism","title":"Logout Mechanism","text":"<p>Logout functionality destroys the session and redirects users to the home page. The session is cleared by setting <code>req.session = null</code> or by destroying the session cookie, forcing re-authentication on subsequent protected route access.</p>"},{"location":"Authentication-%26-Authorization/#security-considerations","title":"Security Considerations","text":"<p>The authentication and authorization implementation includes several security measures:</p> Security Feature Implementation Location Password hashing bcrypt with automatic salting Login functions JWT token validation Signature verification with secret Middleware guards Session encryption Signed cookies with secret key cookie-session config Role verification Explicit role checking in middleware verifyAdmin SQL injection prevention Parameterized queries Database queries Timing attack mitigation Async bcrypt comparison Login functions <p>Credential Validation Pattern: Both login functions follow identical error handling, avoiding information leakage about user existence controllers/authcontroller.js L17-L27</p> <p>and controllers/authcontroller.js L63-L73</p> <p>Token Storage: JWT tokens are stored in HTTP-only cookies rather than localStorage, preventing XSS-based token theft. The <code>verifyToken</code> and <code>verifyAdmin</code> middleware read tokens from <code>req.cookies.token</code> middlewares/verifyToken.js L4</p> <p>and middlewares/verifyAdmin.js L4</p> <p>Sources: controllers/authcontroller.js L17-L27</p> <p>controllers/authcontroller.js L63-L73</p> <p>middlewares/verifyToken.js L4</p> <p>middlewares/verifyAdmin.js L4</p>"},{"location":"Component-Styles/","title":"Component Styles","text":"<p>Relevant source files * middlewares/multer.js * middlewares/verifyAdmin.js * middlewares/verifyToken.js * public/css/admin.css * public/css/edit.css * public/css/info.css * public/css/inscripcion.css * public/css/perfil.css</p>"},{"location":"Component-Styles/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document details the page-specific stylesheets in the HAPPY RUNNER 42K application, covering the component patterns, layout strategies, and responsive behaviors implemented in <code>admin.css</code>, <code>inscripcion.css</code>, <code>perfil.css</code>, <code>info.css</code>, and <code>edit.css</code>. These stylesheets build upon the foundational design system to create specialized visual experiences for different user interfaces.</p> <p>For information about the foundational CSS custom properties, color palette, and base styles, see Design System. For information about the EJS templates that use these styles, see User Interfaces.</p>"},{"location":"Component-Styles/#architecture-overview","title":"Architecture Overview","text":"<p>The component styling system follows a one-stylesheet-per-page pattern where each major user interface has a dedicated CSS file that imports and extends the design system tokens defined in public/css/admin.css L1-L11</p> <p>public/css/info.css L1-L10</p> <p>public/css/inscripcion.css L4-L26</p> <p>public/css/perfil.css L1-L8</p> <p>and public/css/edit.css L2-L9</p> <pre><code>flowchart TD\n\nDesignTokens[\"CSS Custom Properties&lt;br&gt;--lapis-lazuli: #2f6690&lt;br&gt;--cerulean: #3a7ca5&lt;br&gt;--platinum: #d9dcd6&lt;br&gt;--indigo-dye: #16425b&lt;br&gt;--sky-blue: #81c3d7\"]\nAdminCSS[\"admin.css&lt;br&gt;Admin panel components\"]\nInscripcionCSS[\"inscripcion.css&lt;br&gt;Registration components\"]\nPerfilCSS[\"perfil.css&lt;br&gt;Profile components\"]\nInfoCSS[\"info.css&lt;br&gt;Event info components\"]\nEditCSS[\"edit.css&lt;br&gt;Edit form components\"]\nAdminEJS[\"admin.ejs\"]\nInscripcionEJS[\"inscripcion.ejs\"]\nPerfilEJS[\"perfil.ejs\"]\nInfoEJS[\"info.ejs\"]\nEditEJS[\"edit.ejs\"]\n\nDesignTokens --&gt; AdminCSS\nDesignTokens --&gt; InscripcionCSS\nDesignTokens --&gt; PerfilCSS\nDesignTokens --&gt; InfoCSS\nDesignTokens --&gt; EditCSS\nAdminCSS --&gt; AdminEJS\nInscripcionCSS --&gt; InscripcionEJS\nPerfilCSS --&gt; PerfilEJS\nInfoCSS --&gt; InfoEJS\nEditCSS --&gt; EditEJS\n\nsubgraph subGraph2 [\"EJS Templates\"]\n    AdminEJS\n    InscripcionEJS\n    PerfilEJS\n    InfoEJS\n    EditEJS\nend\n\nsubgraph subGraph1 [\"Component Stylesheets\"]\n    AdminCSS\n    InscripcionCSS\n    PerfilCSS\n    InfoCSS\n    EditCSS\nend\n\nsubgraph subGraph0 [\"Design System Foundation\"]\n    DesignTokens\nend</code></pre> <p>Sources: public/css/admin.css L1-L157</p> <p>public/css/inscripcion.css L1-L313</p> <p>public/css/perfil.css L1-L93</p> <p>public/css/info.css L1-L195</p> <p>public/css/edit.css L1-L150</p>"},{"location":"Component-Styles/#admin-panel-styles-admincss","title":"Admin Panel Styles (admin.css)","text":"<p>The admin panel stylesheet implements a compact, table-centric design for participant management with client-side search functionality.</p>"},{"location":"Component-Styles/#component-hierarchy","title":"Component Hierarchy","text":"<pre><code>flowchart TD\n\nAuthWrapper[\".auth-wrapper&lt;br&gt;.admin-wrapper&lt;br&gt;Flex container\"]\nLoginContainer[\".login-container.admin-card&lt;br&gt;Card container&lt;br&gt;max-width: 900px\"]\nTitle[\"h2&lt;br&gt;Panel title\"]\nHelper[\".helper&lt;br&gt;Helper text\"]\nBadge[\".participantes-count&lt;br&gt;Count badge\"]\nTableWrapper[\".small-table&lt;br&gt;Scrollable container&lt;br&gt;max-height: 420px\"]\nTable[\".table&lt;br&gt;Bootstrap table\"]\nTableHead[\".table-head-custom&lt;br&gt;Gradient header\"]\nTableBody[\"tbody&lt;br&gt;Alternating rows\"]\nActions[\".btn-edit&lt;br&gt;.btn-delete&lt;br&gt;Icon buttons\"]\nFooter[\".cta-btn&lt;br&gt;Action button\"]\n\nAuthWrapper --&gt; LoginContainer\nLoginContainer --&gt; Title\nLoginContainer --&gt; Helper\nLoginContainer --&gt; Badge\nLoginContainer --&gt; TableWrapper\nTableWrapper --&gt; Table\nTable --&gt; TableHead\nTable --&gt; TableBody\nTableBody --&gt; Actions\nLoginContainer --&gt; Footer</code></pre> <p>Sources: public/css/admin.css L26-L44</p> <p>public/css/admin.css L74-L82</p> <p>public/css/admin.css L84-L99</p>"},{"location":"Component-Styles/#key-component-patterns","title":"Key Component Patterns","text":"Component Class Styling Pattern Code Reference Container <code>.admin-wrapper</code> Flex centering, min-height viewport-based public/css/admin.css L27-L33 Card <code>.login-container.admin-card</code> Gradient background, rounded corners, shadow public/css/admin.css L36-L44 Count Badge <code>.participantes-count</code> Gradient pill, bold text public/css/admin.css L65-L72 Table Container <code>.small-table</code> Fixed height with scroll, rounded public/css/admin.css L75-L82 Table Header <code>.table-head-custom</code> Gradient background (lapis-lazuli \u2192 cerulean) public/css/admin.css L85-L91 Edit Button <code>.btn-edit</code> Yellow gradient, 34\u00d734px icon button public/css/admin.css L120-L124 Delete Button <code>.btn-delete</code> Pink gradient, 34\u00d734px icon button public/css/admin.css L127-L131"},{"location":"Component-Styles/#responsive-breakpoints","title":"Responsive Breakpoints","text":"<p>The admin panel implements three responsive tiers defined in public/css/admin.css L146-L156</p> <p>:</p> <ul> <li>Desktop (&gt; 992px): Full 900px width, 420px table height</li> <li>Tablet (577-992px): 720px width, 360px table height</li> <li>Mobile (\u2264 576px): 360px width, 300px table height, reduced padding</li> </ul> <p>Sources: public/css/admin.css L1-L157</p>"},{"location":"Component-Styles/#registration-form-styles-inscripcioncss","title":"Registration Form Styles (inscripcion.css)","text":"<p>The registration stylesheet implements a sophisticated two-column layout with an embedded weather widget and motivational banner.</p>"},{"location":"Component-Styles/#layout-architecture","title":"Layout Architecture","text":"<pre><code>flowchart TD\n\nContainer[\".inscripcion-container&lt;br&gt;Grid container&lt;br&gt;max-width: 980px\"]\nBanner[\".motivational-banner&lt;br&gt;Hero image with overlay&lt;br&gt;height: 220px\"]\nForm[\"form&lt;br&gt;Grid: 1fr 360px\"]\nFormLeft[\".form-left&lt;br&gt;2-column grid&lt;br&gt;Form fields\"]\nWeatherWidget[\".weather-widget&lt;br&gt;360px sidebar&lt;br&gt;Weather display\"]\nFormGroups[\".form-group&lt;br&gt;Input containers\"]\nInputs[\"input, textarea&lt;br&gt;Styled form controls\"]\nSubmitBtn[\".btn-registrarse&lt;br&gt;Gradient submit button\"]\nWeatherStats[\".stats&lt;br&gt;2-column stat grid\"]\nWeatherIcon[\".weather-icon&lt;br&gt;Animated icon\"]\n\nContainer --&gt; Banner\nContainer --&gt; Form\nForm --&gt; FormLeft\nForm --&gt; WeatherWidget\nFormLeft --&gt; FormGroups\nFormGroups --&gt; Inputs\nFormLeft --&gt; SubmitBtn\nWeatherWidget --&gt; WeatherStats\nWeatherWidget --&gt; WeatherIcon</code></pre> <p>Sources: public/css/inscripcion.css L52-L64</p> <p>public/css/inscripcion.css L79-L92</p> <p>public/css/inscripcion.css L161-L244</p>"},{"location":"Component-Styles/#weather-widget-component","title":"Weather Widget Component","text":"<p>The weather widget is a distinctive feature with animated floating effects and dynamic gradient backgrounds:</p> <p>Class Structure:</p> <ul> <li><code>.weather-widget</code> public/css/inscripcion.css L161-L185  - Container with gradient background (sky-blue \u2192 lapis-lazuli)</li> <li><code>.weather-icon img</code> public/css/inscripcion.css L196-L200  - 100\u00d7100px icon with float animation</li> <li><code>.stats</code> public/css/inscripcion.css L207-L212  - 2-column grid for temperature and conditions</li> <li><code>.stat</code> public/css/inscripcion.css L214-L231  - Individual stat cards with semi-transparent white backgrounds</li> </ul> <p>Animation:</p> <pre><code>@keyframes float {\n  0%, 100% { transform: translateY(0); }\n  50% { transform: translateY(-6px); }\n}\n</code></pre> <p>Defined in public/css/inscripcion.css L202-L205</p>"},{"location":"Component-Styles/#form-input-styling","title":"Form Input Styling","text":"<p>All form inputs share consistent styling patterns defined in public/css/inscripcion.css L106-L128</p> <p>:</p> <ul> <li>Border: 1px solid with 12% opacity indigo-dye</li> <li>Background: Linear gradient from white to light blue (<code>#ffffff</code> \u2192 <code>#f7fbff</code>)</li> <li>Padding: 12px vertical, 14px horizontal</li> <li>Border Radius: 12px</li> <li>Focus State: Transforms upward (-3px), increases shadow, changes border to cerulean</li> </ul>"},{"location":"Component-Styles/#motivational-banner","title":"Motivational Banner","text":"<p>The banner component public/css/inscripcion.css L251-L292</p> <p>overlays text on a background image:</p> <ul> <li>Height: 220px (160px on mobile)</li> <li>Background: URL-based image with rgba overlay (22,66,91,0.48)</li> <li>Typography: 2rem bold title with text-shadow for contrast</li> </ul> <p>Sources: public/css/inscripcion.css L1-L313</p>"},{"location":"Component-Styles/#profile-display-styles-perfilcss","title":"Profile Display Styles (perfil.css)","text":"<p>The profile stylesheet creates a compact card-based interface for displaying participant information.</p>"},{"location":"Component-Styles/#component-structure","title":"Component Structure","text":"<pre><code>flowchart TD\n\nWrapper[\".perfil-wrapper&lt;br&gt;Flex centering&lt;br&gt;padding: 48px 16px\"]\nCard[\".perfil-card&lt;br&gt;max-width: 380px&lt;br&gt;Gradient card\"]\nTitle[\"h1&lt;br&gt;Participant name&lt;br&gt;font-size: 1.5rem\"]\nSubtitle[\"h3&lt;br&gt;Role label&lt;br&gt;font-size: 1.05rem\"]\nPhotoWrap[\".perfil-foto-wrap&lt;br&gt;Photo container\"]\nPhoto[\".perfil-foto&lt;br&gt;100\u00d7100px circle&lt;br&gt;3px border\"]\nPlaceholder[\".perfil-foto-placeholder&lt;br&gt;Fallback icon\"]\nRows[\".perfil-row&lt;br&gt;Data rows&lt;br&gt;gradient background\"]\nEditBtn[\".btn-edit-profile&lt;br&gt;Full-width CTA&lt;br&gt;gradient button\"]\n\nWrapper --&gt; Card\nCard --&gt; Title\nCard --&gt; Subtitle\nCard --&gt; PhotoWrap\nPhotoWrap --&gt; Photo\nPhotoWrap --&gt; Placeholder\nCard --&gt; Rows\nCard --&gt; EditBtn</code></pre> <p>Sources: public/css/perfil.css L21-L44</p> <p>public/css/perfil.css L49-L59</p> <p>public/css/perfil.css L61-L73</p>"},{"location":"Component-Styles/#profile-card-features","title":"Profile Card Features","text":"Element Class Specification Code Reference Card Container <code>.perfil-card</code> 380px max-width, gradient background, 16px border-radius public/css/perfil.css L29-L39 Hover Effect <code>.perfil-card:hover</code> translateY(-6px), enhanced shadow public/css/perfil.css L41-L44 Photo <code>.perfil-foto</code> 100\u00d7100px circular, 3px lapis-lazuli border public/css/perfil.css L50-L58 Data Row <code>.perfil-row</code> Gradient background, flex justify-between public/css/perfil.css L61-L71 Edit Button <code>.btn-edit-profile</code> Full-width, pill-shaped, gradient public/css/perfil.css L75-L89 <p>The profile photo uses a dual-class system where <code>.perfil-foto</code> displays uploaded images and <code>.perfil-foto-placeholder</code> shows a fallback icon (40px font-size, gray background) when no photo exists public/css/perfil.css L59</p> <p>Sources: public/css/perfil.css L1-L93</p>"},{"location":"Component-Styles/#event-info-styles-infocss","title":"Event Info Styles (info.css)","text":"<p>The info stylesheet implements a multi-section layout with hero banner, statistics panel, winner display grid, and interactive map.</p>"},{"location":"Component-Styles/#page-layout-structure","title":"Page Layout Structure","text":"<pre><code>flowchart TD\n\nInfoHero[\".info-hero&lt;br&gt;Hero banner section&lt;br&gt;gradient background\"]\nPageBody[\".container.page-body&lt;br&gt;max-width: 1080px&lt;br&gt;flex column\"]\nGrid[\".grid&lt;br&gt;2fr 1fr layout\"]\nDetailsCard[\".card&lt;br&gt;Event details&lt;br&gt;2fr width\"]\nStatsCard[\".card.stats&lt;br&gt;Stats panel&lt;br&gt;1fr width\"]\nWinnersSection[\"Winners section\"]\nWinnersGrid[\".winners-grid&lt;br&gt;repeat(auto-fit, minmax(140px, 1fr))\"]\nWinnerCard[\".winner-card&lt;br&gt;Individual winner\"]\nMapSection[\".race-map&lt;br&gt;Leaflet container\"]\nMapDiv[\"#map&lt;br&gt;height: 300px\"]\nShareSection[\".share-results&lt;br&gt;Social sharing\"]\nShareButtons[\".share-buttons&lt;br&gt;Flex button row\"]\n\nInfoHero --&gt; PageBody\nPageBody --&gt; Grid\nGrid --&gt; DetailsCard\nGrid --&gt; StatsCard\nPageBody --&gt; WinnersSection\nWinnersSection --&gt; WinnersGrid\nWinnersGrid --&gt; WinnerCard\nPageBody --&gt; MapSection\nMapSection --&gt; MapDiv\nPageBody --&gt; ShareSection\nShareSection --&gt; ShareButtons</code></pre> <p>Sources: public/css/info.css L23-L44</p> <p>public/css/info.css L47-L76</p> <p>public/css/info.css L106-L149</p> <p>public/css/info.css L152-L158</p>"},{"location":"Component-Styles/#winner-card-component","title":"Winner Card Component","text":"<p>The winner display uses a grid of cards with circular photo containers and position badges:</p> <p>Component Classes:</p> <ul> <li><code>.winners-grid</code> public/css/info.css L106-L110  - Auto-fit grid with 140px minimum column width</li> <li><code>.winner-card</code> public/css/info.css L111-L124  - Flex column container with hover lift effect</li> <li><code>.winner-photo-wrap</code> public/css/info.css L125-L136  - 100\u00d7100px circular frame with gradient border</li> <li><code>.winner-place</code> public/css/info.css L139  - Bold position label (font-weight: 900)</li> <li><code>.dorsal-badge</code> public/css/info.css L141-L149  - Gradient pill badge with race number</li> </ul>"},{"location":"Component-Styles/#statistics-panel","title":"Statistics Panel","text":"<p>The stats card public/css/info.css L87-L103</p> <p>centers numerical data with dramatic typography:</p> <ul> <li>Stat Number: 2.2rem, font-weight 900, cerulean color</li> <li>Layout: Flex column with center alignment and 12px gap</li> <li>Stat Label: Font-weight 700, muted indigo-dye color</li> </ul>"},{"location":"Component-Styles/#map-integration","title":"Map Integration","text":"<p>The race map component public/css/info.css L152-L158</p> <p>provides a container for Leaflet integration:</p> <ul> <li>Container: <code>.race-map</code> with 16px padding and glass background</li> <li>Map Element: <code>#map</code> with 300px fixed height and 16px border-radius</li> </ul>"},{"location":"Component-Styles/#social-share-buttons","title":"Social Share Buttons","text":"<p>Share buttons public/css/info.css L161-L190</p> <p>implement platform-specific colors:</p> Platform Class Background Color Reference Twitter <code>.btn-share.twitter</code> <code>#1da1f2</code> public/css/info.css L187 Facebook <code>.btn-share.facebook</code> <code>#1877f2</code> public/css/info.css L188 WhatsApp <code>.btn-share.whatsapp</code> <code>#25d366</code> public/css/info.css L189 <p>All share buttons include hover lift effect (translateY(-2px)) and shadow enhancement defined in public/css/info.css L190</p> <p>Sources: public/css/info.css L1-L195</p>"},{"location":"Component-Styles/#profile-edit-styles-editcss","title":"Profile Edit Styles (edit.css)","text":"<p>The edit stylesheet creates a compact form interface for participant profile modifications.</p>"},{"location":"Component-Styles/#form-card-architecture","title":"Form Card Architecture","text":"<pre><code>flowchart TD\n\nContainer[\".container.mt-4.w-50&lt;br&gt;max-width: 460px&lt;br&gt;centered\"]\nCard[\".card&lt;br&gt;Rounded card&lt;br&gt;gradient background\"]\nCardHeader[\".card-header&lt;br&gt;Gradient header bar&lt;br&gt;lapis-lazuli \u2192 cerulean\"]\nCardBody[\".card-body&lt;br&gt;padding: 18px\"]\nFormGroups[\"form-group elements\"]\nLabels[\".form-label&lt;br&gt;font-weight: 600\"]\nControls[\".form-control&lt;br&gt;Gradient inputs\"]\nPrimaryBtn[\".btn.btn-primary&lt;br&gt;Full-width save button&lt;br&gt;pill-shaped\"]\nDangerBtn[\".btn.btn-danger&lt;br&gt;Full-width cancel button&lt;br&gt;outline style\"]\n\nContainer --&gt; Card\nCard --&gt; CardHeader\nCard --&gt; CardBody\nCardBody --&gt; FormGroups\nFormGroups --&gt; Labels\nFormGroups --&gt; Controls\nCardBody --&gt; PrimaryBtn\nCardBody --&gt; DangerBtn</code></pre> <p>Sources: public/css/edit.css L26-L57</p> <p>public/css/edit.css L84-L128</p>"},{"location":"Component-Styles/#form-control-styling","title":"Form Control Styling","text":"<p>Edit form inputs follow a refined gradient pattern defined in public/css/edit.css L66-L81</p> <p>:</p> <p>Base State:</p> <ul> <li>Border-radius: 10px</li> <li>Border: 1px solid rgba(22,66,91,0.12)</li> <li>Background: Linear gradient from white to platinum</li> <li>Padding: 10px 12px</li> </ul> <p>Focus State:</p> <ul> <li>Border-color: cerulean</li> <li>Box-shadow: <code>0 10px 30px rgba(58,124,165,0.08)</code></li> <li>Transform: translateY(-1px)</li> </ul>"},{"location":"Component-Styles/#button-differentiation","title":"Button Differentiation","text":"<p>The edit form uses two distinct button styles:</p> <p>Primary Button (<code>.btn.btn-primary</code>) public/css/edit.css L84-L107</p> <p>:</p> <ul> <li>Full-width pill shape (border-radius: 999px)</li> <li>Gradient background: lapis-lazuli \u2192 cerulean</li> <li>Font-weight: 800, letter-spacing: 0.5px</li> <li>Hover: Lifts 3px with scale(1.01)</li> </ul> <p>Cancel Button (<code>.btn.btn-danger</code>) public/css/edit.css L110-L128</p> <p>:</p> <ul> <li>Transparent background with border outline</li> <li>2px border: rgba(47,102,144,0.12)</li> <li>Color: lapis-lazuli</li> <li>Hover: Subtle fill rgba(47,102,144,0.06)</li> </ul>"},{"location":"Component-Styles/#responsive-optimization","title":"Responsive Optimization","text":"<p>Mobile breakpoint (\u2264 576px) defined in public/css/edit.css L136-L144</p> <p>reduces:</p> <ul> <li>Container max-width: 360px (from 460px)</li> <li>Card header font-size: 0.95rem</li> <li>Card body padding: 14px (from 18px)</li> <li>Button padding: 9px 12px (from 10px 14px)</li> </ul> <p>Sources: public/css/edit.css L1-L150</p>"},{"location":"Component-Styles/#cross-stylesheet-patterns","title":"Cross-Stylesheet Patterns","text":"<p>All component stylesheets share common architectural patterns:</p>"},{"location":"Component-Styles/#design-token-inheritance","title":"Design Token Inheritance","text":"<p>Every stylesheet imports the core color palette as CSS custom properties:</p> <pre><code>flowchart TD\n\nRoot[\":root&lt;br&gt;CSS Custom Properties\"]\nLapisLazuli[\"--lapis-lazuli: #2f6690\"]\nCerulean[\"--cerulean: #3a7ca5\"]\nPlatinum[\"--platinum: #d9dcd6\"]\nIndigoDye[\"--indigo-dye: #16425bff\"]\nSkyBlue[\"--sky-blue: #81c3d7\"]\nWhite[\"--white: #ffffff\"]\n\nRoot --&gt; LapisLazuli\nRoot --&gt; Cerulean\nRoot --&gt; Platinum\nRoot --&gt; IndigoDye\nRoot --&gt; SkyBlue\nRoot --&gt; White</code></pre> <p>Sources: public/css/admin.css L1-L11</p> <p>public/css/info.css L1-L10</p> <p>public/css/inscripcion.css L4-L26</p> <p>public/css/perfil.css L1-L8</p> <p>public/css/edit.css L2-L9</p>"},{"location":"Component-Styles/#gradient-patterns","title":"Gradient Patterns","text":"<p>The application employs three primary gradient types:</p> Gradient Type Direction Colors Common Usage Background 180deg platinum \u2192 white Page backgrounds CTA Buttons 90deg lapis-lazuli \u2192 cerulean Primary actions Card Headers 90deg lapis-lazuli \u2192 cerulean Section titles"},{"location":"Component-Styles/#hover-interaction-pattern","title":"Hover Interaction Pattern","text":"<p>All interactive cards and buttons follow a consistent hover pattern:</p> <ol> <li>Transform: <code>translateY(-3px)</code> to <code>-6px</code> for lift effect</li> <li>Shadow: Enhanced from base shadow to deeper shadow</li> <li>Transition: 0.12s to 0.18s ease timing</li> </ol> <p>This pattern appears in:</p> <ul> <li>public/css/admin.css L107-L117  - Edit/delete buttons</li> <li>public/css/info.css L72-L76  - Info cards</li> <li>public/css/perfil.css L41-L44  - Profile card</li> <li>public/css/edit.css L103-L107  - Edit form buttons</li> </ul>"},{"location":"Component-Styles/#responsive-strategy","title":"Responsive Strategy","text":"<p>All stylesheets implement mobile-first responsive design with consistent breakpoints:</p> <p>Standard Breakpoints:</p> <ul> <li><code>@media (max-width: 992px)</code> - Tablet adjustments</li> <li><code>@media (max-width: 576px)</code> - Mobile optimizations</li> </ul> <p>Common responsive transformations:</p> <ul> <li>Grid layouts collapse to single column</li> <li>Font sizes reduce by 0.1-0.2rem</li> <li>Padding compresses by 20-30%</li> <li>Max-widths scale proportionally</li> </ul> <p>Sources: public/css/admin.css L146-L156</p> <p>public/css/info.css L193-L194</p> <p>public/css/inscripcion.css L302-L312</p> <p>public/css/edit.css L136-L149</p>"},{"location":"Component-Styles/#accessibility-considerations","title":"Accessibility Considerations","text":"<p>The component stylesheets implement reduced-motion support defined in public/css/edit.css L147-L149</p> <p>:</p> <pre><code>@media (prefers-reduced-motion: reduce) {\n  * { transition: none !important; animation: none !important; }\n}\n</code></pre> <p>This removes all animations and transitions for users who have enabled reduced motion preferences, appearing only in <code>edit.css</code> but recommended for all stylesheets as a best practice pattern.</p> <p>Sources: public/css/edit.css L147-L149</p>"},{"location":"Data-Management/","title":"Data Management","text":"<p>Relevant source files * config/db.js * controllers/updateParticipante.js * middlewares/multer.js * middlewares/verifyAdmin.js * middlewares/verifyToken.js * public/css/edit.css</p>"},{"location":"Data-Management/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document covers the data management subsystems of the HAPPY RUNNER 42K application, including database connection configuration, CRUD operations for participant records, and the file upload system for participant and winner photographs. Data management encompasses structured data persistence in MySQL and unstructured file storage on the filesystem.</p> <p>For authentication and session management aspects, see Authentication &amp; Authorization. For the middleware layer that guards data access, see Middleware Layer. For specific user interface interactions with data, see User Interfaces.</p>"},{"location":"Data-Management/#data-management-architecture","title":"Data Management Architecture","text":"<p>The application employs a dual-layer data management strategy: structured relational data in MySQL and unstructured binary data (photos) in the filesystem. All database operations flow through a centralized connection module, while file uploads are handled by dedicated multer middleware.</p> <pre><code>flowchart TD\n\nRoutes[\"Route Handlers&lt;br&gt;(routers/*)\"]\nControllers[\"Controllers&lt;br&gt;(controllers/updateParticipante.js)\"]\nDBModule[\"Database Connection&lt;br&gt;(config/db.js)&lt;br&gt;conexion\"]\nMulterMiddleware[\"File Upload Middleware&lt;br&gt;(middlewares/multer.js)&lt;br&gt;storage, upload\"]\nMySQL[\"MySQL Database&lt;br&gt;Tables: participantes,&lt;br&gt;organizadores, ganadores\"]\nFileSystem[\"File System&lt;br&gt;public/uploads/participantes/\"]\nQueryInterface[\"db.query(sql, params, callback)\"]\nUploadInterface[\"upload.single('foto')\"]\n\nRoutes --&gt; MulterMiddleware\nControllers --&gt; DBModule\nMulterMiddleware --&gt; FileSystem\nDBModule --&gt; MySQL\nDBModule --&gt; QueryInterface\nMulterMiddleware --&gt; UploadInterface\n\nsubgraph subGraph2 [\"Storage Layer\"]\n    MySQL\n    FileSystem\nend\n\nsubgraph subGraph1 [\"Data Access Layer\"]\n    DBModule\n    MulterMiddleware\nend\n\nsubgraph subGraph0 [\"Application Layer\"]\n    Routes\n    Controllers\n    Routes --&gt; Controllers\nend</code></pre> <p>Sources: config/db.js L1-L18</p> <p>controllers/updateParticipante.js L1-L19</p> <p>middlewares/multer.js L1-L15</p>"},{"location":"Data-Management/#database-connection-configuration","title":"Database Connection Configuration","text":"<p>The application establishes a single MySQL connection using the <code>mysql2</code> library, configured through environment variables for security and deployment flexibility.</p>"},{"location":"Data-Management/#connection-module-structure","title":"Connection Module Structure","text":"<p>The config/db.js L1-L18</p> <p>module exports a <code>conexion</code> object that represents the MySQL connection pool:</p> Configuration Parameter Environment Variable Purpose <code>host</code> <code>DB_HOST</code> Database server hostname <code>user</code> <code>DB_USER</code> Database authentication username <code>password</code> <code>DB_PASS</code> Database authentication password <code>database</code> <code>DB_NAME</code> Target database name <p>The connection is initialized immediately upon module load config/db.js L10-L16</p> <p>logging success or error to the console. This eager initialization ensures database connectivity is verified at application startup rather than on first query.</p> <pre><code>sequenceDiagram\n  participant Application Startup\n  participant config/db.js\n  participant MySQL Server\n\n  Application Startup-&gt;&gt;config/db.js: \"require('config/db.js')\"\n  config/db.js-&gt;&gt;config/db.js: \"mysql.createConnection({\n  config/db.js-&gt;&gt;MySQL Server: host, user, password, database})\"\n  loop [Connection Successful]\n    MySQL Server--&gt;&gt;config/db.js: \"conexion.connect()\"\n    config/db.js-&gt;&gt;config/db.js: \"Connection established\"\n    MySQL Server--&gt;&gt;config/db.js: \"console.log('Conectado a la base de datos')\"\n    config/db.js-&gt;&gt;config/db.js: \"Error\"\n  end\n  config/db.js--&gt;&gt;Application Startup: \"console.log(error)\"</code></pre> <p>Sources: config/db.js L1-L18</p>"},{"location":"Data-Management/#database-schema-and-tables","title":"Database Schema and Tables","text":"<p>The application uses three primary tables to manage event data:</p>"},{"location":"Data-Management/#participantes-table","title":"participantes Table","text":"<p>Stores registration data for marathon participants. Fields include:</p> <ul> <li><code>id</code> (primary key)</li> <li><code>nombre</code> (first name)</li> <li><code>apellido</code> (last name)</li> <li><code>dni</code> (national identification number, used for authentication)</li> <li><code>telefono</code> (phone number)</li> <li><code>calle</code>, <code>numero</code>, <code>poblacion</code>, <code>codigo_postal</code> (address components)</li> <li><code>foto</code> (filename of uploaded participant photo)</li> </ul>"},{"location":"Data-Management/#organizadores-table","title":"organizadores Table","text":"<p>Stores administrator/organizer accounts with hashed passwords. Used for admin authentication via username-based login.</p>"},{"location":"Data-Management/#ganadores-table","title":"ganadores Table","text":"<p>Links winner positions (1st, 2nd, 3rd place) to participant records:</p> <ul> <li><code>position</code> (winner placement)</li> <li><code>participant_id</code> (foreign key to participantes table)</li> <li><code>foto</code> (optional winner-specific photo)</li> </ul> <p>Sources: High-level diagrams (Diagram 3: Data Management and User Journeys)</p>"},{"location":"Data-Management/#crud-operations-participant-data","title":"CRUD Operations: Participant Data","text":"<p>The application performs Create, Read, Update, and Delete operations on participant records through various route handlers and controllers.</p>"},{"location":"Data-Management/#update-operation-flow","title":"Update Operation Flow","text":"<p>The <code>updateParticipante</code> controller handles participant profile modifications:</p> <pre><code>flowchart TD\n\nEditForm[\"edit.ejs&lt;br&gt;Profile Edit Form\"]\nPostRoute[\"/update POST route&lt;br&gt;(routers/participante.js)\"]\nUpdateCtrl[\"updateParticipante.update()&lt;br&gt;(controllers/updateParticipante.js)\"]\nUpdateQuery[\"UPDATE participantes SET&lt;br&gt;nombre=?, apellido=?, dni=?,&lt;br&gt;telefono=?, calle=?, numero=?,&lt;br&gt;poblacion=?, codigo_postal=?&lt;br&gt;WHERE id=?\"]\nParticipantesTable[\"participantes table\"]\n\nEditForm --&gt; PostRoute\nPostRoute --&gt; UpdateCtrl\nUpdateCtrl --&gt; UpdateQuery\nParticipantesTable --&gt; UpdateCtrl\nUpdateCtrl --&gt; EditForm\n\nsubgraph Database [\"Database\"]\n    UpdateQuery\n    ParticipantesTable\n    UpdateQuery --&gt; ParticipantesTable\nend\n\nsubgraph Controller [\"Controller\"]\n    UpdateCtrl\nend\n\nsubgraph subGraph1 [\"Route Handler\"]\n    PostRoute\nend\n\nsubgraph subGraph0 [\"User Interface\"]\n    EditForm\nend</code></pre> <p>The update controller extracts parameters from the request body and constructs a parameterized SQL query controllers/updateParticipante.js L7-L9</p> <p>Parameterized queries prevent SQL injection by separating SQL structure from user-supplied data.</p> <p>Sources: controllers/updateParticipante.js L1-L19</p>"},{"location":"Data-Management/#query-pattern-and-error-handling","title":"Query Pattern and Error Handling","text":"<p>All database operations follow a consistent callback-based pattern using the <code>conexion.query()</code> method:</p> <pre><code>sequenceDiagram\n  participant Controller Function\n  participant db.query()\n  participant MySQL Database\n  participant Express Response\n\n  Controller Function-&gt;&gt;db.query(): \"query(sql, params, callback)\"\n  db.query()-&gt;&gt;MySQL Database: \"Execute SQL with parameters\"\n  loop [Query Successful]\n    MySQL Database--&gt;&gt;db.query(): \"result object\"\n    db.query()-&gt;&gt;Controller Function: \"callback(null, result)\"\n    Controller Function-&gt;&gt;Controller Function: \"console.log('success message')\"\n    Controller Function-&gt;&gt;Express Response: \"res.redirect() or res.render()\"\n    MySQL Database--&gt;&gt;db.query(): \"error object\"\n    db.query()-&gt;&gt;Controller Function: \"callback(err, null)\"\n    Controller Function-&gt;&gt;Controller Function: \"console.error('Error message', err)\"\n    Controller Function-&gt;&gt;Express Response: \"res.redirect(error page)\"\n  end</code></pre> <p>The update controller demonstrates this pattern controllers/updateParticipante.js L10-L17</p> <p>:</p> <ul> <li>On error: logs to console and redirects to <code>/perfil</code></li> <li>On success: logs confirmation and redirects to <code>/perfil</code></li> </ul> <p>This approach provides basic error recovery but does not expose detailed error messages to users, maintaining security while ensuring the application remains operational.</p> <p>Sources: controllers/updateParticipante.js L10-L17</p>"},{"location":"Data-Management/#file-upload-system","title":"File Upload System","text":"<p>The application uses <code>multer</code> middleware to handle multipart form data containing file uploads. This system is critical for participant registration and winner photo management.</p>"},{"location":"Data-Management/#multer-configuration","title":"Multer Configuration","text":"<p>The middlewares/multer.js L1-L15</p> <p>module configures <code>multer.diskStorage</code> with two key functions:</p> Function Purpose Implementation <code>destination</code> Specifies storage directory Returns <code>'public/uploads/participantes'</code> <code>filename</code> Generates unique filenames Returns <code>'participante-' + Date.now() + ext</code> <pre><code>flowchart TD\n\nFormData[\"Multipart Form Data&lt;br&gt;Content-Type: multipart/form-data&lt;br&gt;Field: 'foto'\"]\nMulterStorage[\"multer.diskStorage&lt;br&gt;(middlewares/multer.js)\"]\nDestinationFn[\"destination(req, file, cb)&lt;br&gt;\u2192 'public/uploads/participantes'\"]\nFilenameFn[\"filename(req, file, cb)&lt;br&gt;\u2192 'participante-' + Date.now() + ext\"]\nUploadDir[\"public/uploads/participantes/\"]\nSavedFile[\"participante-1701234567890.jpg\"]\nReqFile[\"req.file&lt;br&gt;{filename, path, mimetype, size}\"]\n\nFormData --&gt; MulterStorage\nDestinationFn --&gt; UploadDir\nFilenameFn --&gt; SavedFile\nSavedFile --&gt; ReqFile\n\nsubgraph subGraph3 [\"Request Object\"]\n    ReqFile\nend\n\nsubgraph subGraph2 [\"File System\"]\n    UploadDir\n    SavedFile\nend\n\nsubgraph subGraph1 [\"Multer Middleware\"]\n    MulterStorage\n    DestinationFn\n    FilenameFn\n    MulterStorage --&gt; DestinationFn\n    MulterStorage --&gt; FilenameFn\nend\n\nsubgraph subGraph0 [\"Client Request\"]\n    FormData\nend</code></pre> <p>Sources: middlewares/multer.js L1-L15</p>"},{"location":"Data-Management/#file-naming-strategy","title":"File Naming Strategy","text":"<p>The filename generation function middlewares/multer.js L9-L12</p> <p>employs timestamp-based naming to ensure uniqueness:</p> <ol> <li>Extract original file extension using <code>path.extname(file.originalname)</code></li> <li>Construct filename: <code>participante-{timestamp}{extension}</code></li> <li>Example: <code>participante-1701234567890.jpg</code></li> </ol> <p>This strategy prevents filename collisions even if multiple users upload files simultaneously, as <code>Date.now()</code> returns milliseconds since epoch. The prefix <code>participante-</code> provides namespace separation if the directory later stores other file types.</p> <p>Sources: middlewares/multer.js L9-L12</p>"},{"location":"Data-Management/#file-upload-integration","title":"File Upload Integration","text":"<p>The <code>upload</code> object exported from the multer configuration is used as route middleware to process file uploads before request handlers execute:</p> <pre><code>sequenceDiagram\n  participant Browser\n  participant Route Handler\n  participant upload.single('foto')\n  participant File System\n  participant Route Controller\n  participant Database\n\n  Browser-&gt;&gt;Route Handler: \"POST /inscripcion\n  Route Handler-&gt;&gt;upload.single('foto'): multipart/form-data\"\n  upload.single('foto')-&gt;&gt;upload.single('foto'): \"Process middleware\"\n  upload.single('foto')-&gt;&gt;File System: \"Parse multipart data\"\n  File System--&gt;&gt;upload.single('foto'): \"Save to public/uploads/participantes/\n  upload.single('foto')-&gt;&gt;upload.single('foto'): participante-{timestamp}.ext\"\n  upload.single('foto')-&gt;&gt;Route Controller: \"File saved successfully\"\n  Route Controller-&gt;&gt;Route Controller: \"Populate req.file\"\n  Route Controller-&gt;&gt;Database: \"next()\"\n  Database--&gt;&gt;Route Controller: \"Access req.file.filename\"\n  Route Controller-&gt;&gt;Browser: \"INSERT INTO participantes</code></pre> <p>The middleware populates <code>req.file</code> with metadata including:</p> <ul> <li><code>filename</code>: Generated filename (e.g., <code>participante-1701234567890.jpg</code>)</li> <li><code>path</code>: Full filesystem path</li> <li><code>mimetype</code>: MIME type of uploaded file</li> <li><code>size</code>: File size in bytes</li> </ul> <p>Controllers then reference <code>req.file.filename</code> when inserting database records, creating a link between the participant record and their stored photo.</p> <p>Sources: middlewares/multer.js L1-L15</p>"},{"location":"Data-Management/#data-validation-and-security","title":"Data Validation and Security","text":""},{"location":"Data-Management/#input-validation","title":"Input Validation","text":"<p>The application relies on HTML5 form validation attributes in EJS templates (e.g., <code>required</code>, <code>pattern</code>, <code>type=\"email\"</code>) for client-side validation. Server-side validation is implicit through SQL schema constraints and parameterized queries.</p>"},{"location":"Data-Management/#sql-injection-prevention","title":"SQL Injection Prevention","text":"<p>All database queries use parameterized statements with the <code>?</code> placeholder syntax controllers/updateParticipante.js L8-L9</p> <p>The <code>mysql2</code> library automatically escapes parameters before query execution, preventing SQL injection attacks even if user input contains malicious SQL syntax.</p> <p>Example from updateParticipante controller:</p> <pre><code>UPDATE participantes SET nombre=?, apellido=?, dni=?, ... WHERE id=?\n</code></pre> <p>Parameters array: <code>[nombre, apellido, dni, telefono, calle, numero, poblacion, codigo_postal, id]</code></p>"},{"location":"Data-Management/#file-upload-security","title":"File Upload Security","text":"<p>The multer configuration middlewares/multer.js L5-L13</p> <p>does not explicitly filter file types or limit file sizes. This presents potential security considerations:</p> Concern Current State Mitigation Strategy File type validation Not implemented Could add <code>fileFilter</code> function to multer config File size limits Not implemented Could add <code>limits: { fileSize: n }</code> to multer config Malicious file names Handled Filename is completely replaced with timestamp pattern <p>The timestamp-based naming strategy eliminates filename-related attacks (e.g., directory traversal via <code>../../etc/passwd</code>) by discarding the original filename entirely.</p> <p>Sources: controllers/updateParticipante.js L7-L9</p> <p>middlewares/multer.js L5-L13</p>"},{"location":"Data-Management/#data-flow-complete-registration-cycle","title":"Data Flow: Complete Registration Cycle","text":"<p>The following diagram illustrates how participant data and photos flow through the system during registration:</p> <pre><code>flowchart TD\n\nRegistrationForm[\"inscripcion.ejs&lt;br&gt;Registration Form&lt;br&gt;nombre, apellido, dni, telefono,&lt;br&gt;direccion fields, foto upload\"]\nInscripcionRoute[\"POST /inscripcion route\"]\nMulterMW[\"upload.single('foto')&lt;br&gt;middlewares/multer.js\"]\nInsertCtrl[\"Route controller\"]\nFileSystemWrite[\"Write File&lt;br&gt;public/uploads/participantes/&lt;br&gt;participante-{timestamp}.ext\"]\nDBInsert[\"INSERT INTO participantes&lt;br&gt;(nombre, apellido, dni,&lt;br&gt;telefono, calle, numero,&lt;br&gt;poblacion, codigo_postal, foto)\"]\nPhotoFile[\"Stored Photo&lt;br&gt;public/uploads/participantes/\"]\nDBRecord[\"participantes Table Record&lt;br&gt;foto column references filename\"]\n\nRegistrationForm --&gt; InscripcionRoute\nMulterMW --&gt; FileSystemWrite\nFileSystemWrite --&gt; PhotoFile\nInsertCtrl --&gt; DBInsert\nDBInsert --&gt; DBRecord\n\nsubgraph Persistence [\"Persistence\"]\n    PhotoFile\n    DBRecord\n    DBRecord --&gt; PhotoFile\nend\n\nsubgraph Storage [\"Storage\"]\n    FileSystemWrite\n    DBInsert\nend\n\nsubgraph subGraph1 [\"Server Processing\"]\n    InscripcionRoute\n    MulterMW\n    InsertCtrl\n    InscripcionRoute --&gt; MulterMW\n    MulterMW --&gt; InsertCtrl\nend\n\nsubgraph Client [\"Client\"]\n    RegistrationForm\nend</code></pre> <p>The participant record's <code>foto</code> column stores only the filename (e.g., <code>participante-1701234567890.jpg</code>), not the full path. When rendering profile pages, templates construct the full URL as <code>/uploads/participantes/{filename}</code>, which Express serves via static file middleware.</p> <p>Sources: middlewares/multer.js L1-L15</p> <p>High-level diagrams (Diagram 3)</p>"},{"location":"Data-Management/#data-integrity-and-referential-relationships","title":"Data Integrity and Referential Relationships","text":""},{"location":"Data-Management/#winner-participant-relationship","title":"Winner-Participant Relationship","text":"<p>The <code>ganadores</code> table maintains referential integrity with the <code>participantes</code> table through the <code>participant_id</code> foreign key:</p> <pre><code>#mermaid-q356j1dc0tf{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-q356j1dc0tf .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-q356j1dc0tf .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-q356j1dc0tf .error-icon{fill:#dddddd;}#mermaid-q356j1dc0tf .error-text{fill:#222222;stroke:#222222;}#mermaid-q356j1dc0tf .edge-thickness-normal{stroke-width:1px;}#mermaid-q356j1dc0tf .edge-thickness-thick{stroke-width:3.5px;}#mermaid-q356j1dc0tf .edge-pattern-solid{stroke-dasharray:0;}#mermaid-q356j1dc0tf .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-q356j1dc0tf .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-q356j1dc0tf .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-q356j1dc0tf .marker{fill:#999;stroke:#999;}#mermaid-q356j1dc0tf .marker.cross{stroke:#999;}#mermaid-q356j1dc0tf svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-q356j1dc0tf p{margin:0;}#mermaid-q356j1dc0tf .entityBox{fill:#ffffff;stroke:#dddddd;}#mermaid-q356j1dc0tf .relationshipLabelBox{fill:#dddddd;opacity:0.7;background-color:#dddddd;}#mermaid-q356j1dc0tf .relationshipLabelBox rect{opacity:0.5;}#mermaid-q356j1dc0tf .labelBkg{background-color:rgba(221, 221, 221, 0.5);}#mermaid-q356j1dc0tf .edgeLabel .label{fill:#dddddd;font-size:14px;}#mermaid-q356j1dc0tf .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#333;}#mermaid-q356j1dc0tf .edge-pattern-dashed{stroke-dasharray:8,8;}#mermaid-q356j1dc0tf .node rect,#mermaid-q356j1dc0tf .node circle,#mermaid-q356j1dc0tf .node ellipse,#mermaid-q356j1dc0tf .node polygon{fill:#ffffff;stroke:#dddddd;stroke-width:1px;}#mermaid-q356j1dc0tf .relationshipLine{stroke:#999;stroke-width:1;fill:none;}#mermaid-q356j1dc0tf .marker{fill:none!important;stroke:#999!important;stroke-width:1;}#mermaid-q356j1dc0tf :root{--mermaid-font-family:\"trebuchet ms\",verdana,arial,sans-serif;}winner_ofparticipantesintidPKvarcharnombrevarcharapellidovarchardniUKvarchartelefonovarcharcallevarcharnumerovarcharpoblacionvarcharcodigo_postalvarcharfotoganadoresintidPKintpositionintparticipant_idFKvarcharfotoorganizadoresintidPKvarcharusernameUKvarcharpassword\n</code></pre> <p>This design ensures:</p> <ul> <li>Winners must be existing participants (foreign key constraint)</li> <li>Participant data (name, DNI) is maintained in one location</li> <li>Winner-specific photos can differ from registration photos</li> <li>A participant can win multiple positions (though business logic may prevent this)</li> </ul> <p>Sources: High-level diagrams (Diagram 3: Data Management and User Journeys)</p>"},{"location":"Data-Management/#database-connection-lifecycle","title":"Database Connection Lifecycle","text":"<p>The MySQL connection established by config/db.js L1-L18</p> <p>remains open for the application's entire lifecycle. The <code>mysql2</code> library maintains this connection and automatically handles reconnection if network interruptions occur.</p> <pre><code>stateDiagram-v2\n    [*] --&gt; ModuleLoad : \"require('config/db.js')\"\n    ModuleLoad --&gt; Connecting : \"mysql.createConnection()\"\n    Connecting --&gt; Connected : \"conexion.connect() success\"\n    Connecting --&gt; Failed : \"conexion.connect() error\"\n    Failed --&gt; [*] : \"console.log(error)\"\n    Connected --&gt; AwaitingQueries : \"Exported as 'conexion'\"\n    AwaitingQueries --&gt; ExecutingQuery : \"db.query(sql, params, callback)\"\n    ExecutingQuery --&gt; AwaitingQueries : \"db.query(sql, params, callback)\"\n    AwaitingQueries --&gt; [*] : \"Application shutdown\"</code></pre> <p>No explicit connection pooling is configured. For production deployments handling concurrent users, migrating to <code>mysql2.createPool()</code> would provide better resource management and automatic connection recycling.</p> <p>Sources: config/db.js L1-L18</p>"},{"location":"Data-Management/#error-handling-patterns","title":"Error Handling Patterns","text":"<p>Database operations throughout the application follow a consistent error handling pattern:</p> Error Scenario Detection Method Recovery Action User Feedback Query execution failure <code>err</code> parameter in callback Log error to console Redirect to safe page (e.g., <code>/perfil</code>) Connection failure <code>error</code> in connect callback Log at startup Application may not start correctly File upload failure Multer error handling (Not explicitly handled) Default Express error handler <p>The updateParticipante controller demonstrates typical error handling controllers/updateParticipante.js L11-L13</p> <p>:</p> <pre><code>if (err) {\n  console.error(\"Error al actualizar:\", err);\n  return res.redirect(\"/perfil\");\n}\n</code></pre> <p>This approach prioritizes application stability over detailed user error messages, preventing information leakage while ensuring users are not left on broken pages.</p> <p>Sources: controllers/updateParticipante.js L10-L17</p> <p>config/db.js L10-L16</p>"},{"location":"Database-Layer/","title":"Database Layer","text":"<p>Relevant source files * config/db.js</p>"},{"location":"Database-Layer/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document describes the database layer configuration for the HAPPY RUNNER 42K application, including the MySQL connection setup, environment-based configuration, and connection lifecycle. The database layer provides the foundation for data persistence across the application.</p> <p>For information about how data is queried and manipulated by business logic, see Data Management. For details on authentication queries against the <code>participantes</code> and <code>organizadores</code> tables, see Authentication &amp; Authorization.</p>"},{"location":"Database-Layer/#connection-module","title":"Connection Module","text":"<p>The database layer is implemented as a single module that creates and exports a MySQL connection object. The module is located at config/db.js L1-L18</p> <p>and serves as the sole entry point for database operations throughout the application.</p>"},{"location":"Database-Layer/#module-structure","title":"Module Structure","text":"<p>The connection module uses the <code>mysql2</code> library and creates a connection using the <code>createConnection()</code> method rather than a connection pool.</p> Component Implementation Location Database Library <code>mysql2</code> config/db.js L1 Connection Object <code>conexion</code> config/db.js L3-L8 Connection Method <code>mysql.createConnection()</code> config/db.js L3 Module Export <code>conexion</code> config/db.js L18 <p>Sources: config/db.js L1-L18</p>"},{"location":"Database-Layer/#connection-configuration","title":"Connection Configuration","text":"<p>The database connection is configured using environment variables, allowing for different configurations across development, testing, and production environments without code changes.</p>"},{"location":"Database-Layer/#configuration-parameters","title":"Configuration Parameters","text":"<pre><code>flowchart TD\n\nDB_HOST[\"DB_HOST&lt;br&gt;(database server address)\"]\nDB_USER[\"DB_USER&lt;br&gt;(authentication username)\"]\nDB_PASS[\"DB_PASS&lt;br&gt;(authentication password)\"]\nDB_NAME[\"DB_NAME&lt;br&gt;(database schema name)\"]\nCreateConnection[\"mysql.createConnection()\"]\nConnectionConfig[\"conexion&lt;br&gt;(MySQL connection)\"]\n\nDB_HOST --&gt; CreateConnection\nDB_USER --&gt; CreateConnection\nDB_PASS --&gt; CreateConnection\nDB_NAME --&gt; CreateConnection\n\nsubgraph subGraph1 [\"Connection Object\"]\n    CreateConnection\n    ConnectionConfig\n    CreateConnection --&gt; ConnectionConfig\nend\n\nsubgraph subGraph0 [\"Environment Variables\"]\n    DB_HOST\n    DB_USER\n    DB_PASS\n    DB_NAME\nend</code></pre> <p>The configuration object passed to <code>mysql.createConnection()</code> at config/db.js L3-L8</p> <p>contains four required parameters:</p> Parameter Environment Variable Purpose <code>host</code> <code>process.env.DB_HOST</code> Database server hostname or IP address <code>user</code> <code>process.env.DB_USER</code> MySQL username for authentication <code>password</code> <code>process.env.DB_PASS</code> MySQL password for authentication <code>database</code> <code>process.env.DB_NAME</code> Target database schema name <p>Sources: config/db.js L3-L8</p>"},{"location":"Database-Layer/#connection-lifecycle","title":"Connection Lifecycle","text":"<p>The database connection is established synchronously when the module is first imported. The connection lifecycle follows a simple initialization pattern with error handling.</p>"},{"location":"Database-Layer/#initialization-flow","title":"Initialization Flow","text":"<pre><code>sequenceDiagram\n  participant Application Code\n  participant (requires db.js)\n  participant config/db.js\n  participant mysql2 Library\n  participant MySQL Server\n\n  Application Code-&gt;&gt;config/db.js: require('config/db.js')\n  config/db.js-&gt;&gt;mysql2 Library: mysql.createConnection(config)\n  mysql2 Library--&gt;&gt;config/db.js: return conexion object\n  config/db.js-&gt;&gt;config/db.js: conexion.connect()\n  config/db.js-&gt;&gt;MySQL Server: Establish TCP connection\n  loop [Connection Successful]\n    MySQL Server--&gt;&gt;config/db.js: Connection established\n    config/db.js-&gt;&gt;config/db.js: console.log(\"Conectado...\")\n    MySQL Server--&gt;&gt;config/db.js: Connection error\n    config/db.js-&gt;&gt;config/db.js: console.log(error)\n  end\n  config/db.js--&gt;&gt;Application Code: export conexion</code></pre> <p>The <code>conexion.connect()</code> method is invoked at config/db.js L10-L16</p> <p>with an error-first callback. If the connection succeeds, the console displays \"Conectado a la base de datos\". If the connection fails, the error object is logged but does not terminate the application.</p> <p>Sources: config/db.js L10-L16</p>"},{"location":"Database-Layer/#database-schema","title":"Database Schema","text":"<p>The MySQL database contains three primary tables that support the application's functionality:</p> <pre><code>#mermaid-oqxgxmfd5t{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-oqxgxmfd5t .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-oqxgxmfd5t .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-oqxgxmfd5t .error-icon{fill:#dddddd;}#mermaid-oqxgxmfd5t .error-text{fill:#222222;stroke:#222222;}#mermaid-oqxgxmfd5t .edge-thickness-normal{stroke-width:1px;}#mermaid-oqxgxmfd5t .edge-thickness-thick{stroke-width:3.5px;}#mermaid-oqxgxmfd5t .edge-pattern-solid{stroke-dasharray:0;}#mermaid-oqxgxmfd5t .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-oqxgxmfd5t .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-oqxgxmfd5t .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-oqxgxmfd5t .marker{fill:#999;stroke:#999;}#mermaid-oqxgxmfd5t .marker.cross{stroke:#999;}#mermaid-oqxgxmfd5t svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-oqxgxmfd5t p{margin:0;}#mermaid-oqxgxmfd5t .entityBox{fill:#ffffff;stroke:#dddddd;}#mermaid-oqxgxmfd5t .relationshipLabelBox{fill:#dddddd;opacity:0.7;background-color:#dddddd;}#mermaid-oqxgxmfd5t .relationshipLabelBox rect{opacity:0.5;}#mermaid-oqxgxmfd5t .labelBkg{background-color:rgba(221, 221, 221, 0.5);}#mermaid-oqxgxmfd5t .edgeLabel .label{fill:#dddddd;font-size:14px;}#mermaid-oqxgxmfd5t .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#333;}#mermaid-oqxgxmfd5t .edge-pattern-dashed{stroke-dasharray:8,8;}#mermaid-oqxgxmfd5t .node rect,#mermaid-oqxgxmfd5t .node circle,#mermaid-oqxgxmfd5t .node ellipse,#mermaid-oqxgxmfd5t .node polygon{fill:#ffffff;stroke:#dddddd;stroke-width:1px;}#mermaid-oqxgxmfd5t .relationshipLine{stroke:#999;stroke-width:1;fill:none;}#mermaid-oqxgxmfd5t .marker{fill:none!important;stroke:#999!important;stroke-width:1;}#mermaid-oqxgxmfd5t :root{--mermaid-font-family:\"trebuchet ms\",verdana,arial,sans-serif;}selected as winnerparticipantesintidPKstringnombrestringapellidostringdnistringtelefonostringdireccionstringfotoganadoresintidPKstringpositionintparticipant_idFKstringfotoorganizadoresintidPKstringusernamestringpasswordstringrol\n</code></pre> Table Purpose Key Relationships <code>participantes</code> Stores marathon participant registration data including personal information and photo paths Referenced by <code>ganadores.participant_id</code> <code>organizadores</code> Stores administrator credentials with bcrypt-hashed passwords Standalone authentication table <code>ganadores</code> Stores race winner information with positions (1st, 2nd, 3rd) and optional winner-specific photos Foreign key to <code>participantes.id</code> <p>Sources: Inferred from high-level system diagrams and authentication flow</p>"},{"location":"Database-Layer/#connection-usage-pattern","title":"Connection Usage Pattern","text":"<p>The <code>conexion</code> object exported from config/db.js L18</p> <p>is imported by controllers and route handlers that need to execute SQL queries. The connection provides a <code>query()</code> method for executing SQL statements.</p>"},{"location":"Database-Layer/#consumer-modules","title":"Consumer Modules","text":"<pre><code>flowchart TD\n\nConfigDB[\"config/db.js&lt;br&gt;exports: conexion\"]\nAuthController[\"authcontroller.js&lt;br&gt;(credential verification)\"]\nUpdateController[\"updateParticipante.js&lt;br&gt;(profile updates)\"]\nParticipanteRoutes[\"routes/participante.js&lt;br&gt;(registration, profile)\"]\nAdminRoutes[\"routes/admin.js&lt;br&gt;(participant management)\"]\nGanadoresRoutes[\"routes/ganadores.js&lt;br&gt;(winner selection)\"]\nParticipantesTable[\"participantes table\"]\nOrganizadoresTable[\"organizadores table\"]\nGanadoresTable[\"ganadores table\"]\n\nConfigDB --&gt; AuthController\nConfigDB --&gt; UpdateController\nConfigDB --&gt; ParticipanteRoutes\nConfigDB --&gt; AdminRoutes\nConfigDB --&gt; GanadoresRoutes\nAuthController --&gt; ParticipantesTable\nAuthController --&gt; OrganizadoresTable\nUpdateController --&gt; ParticipantesTable\nParticipanteRoutes --&gt; ParticipantesTable\nAdminRoutes --&gt; ParticipantesTable\nGanadoresRoutes --&gt; GanadoresTable\nGanadoresRoutes --&gt; ParticipantesTable</code></pre> <p>Controllers and routes import the connection using <code>require()</code>:</p> <pre><code>const conexion = require('../config/db');\n</code></pre> <p>The <code>conexion.query()</code> method accepts a SQL string and optional parameters, returning results through a callback function following the error-first pattern.</p> <p>Sources: config/db.js L18</p> <p>inferred from high-level architecture diagrams</p>"},{"location":"Database-Layer/#connection-characteristics","title":"Connection Characteristics","text":""},{"location":"Database-Layer/#single-connection-model","title":"Single Connection Model","text":"<p>The database layer uses a single persistent connection rather than a connection pool. This design has specific characteristics:</p> Characteristic Implication Connection Type Single <code>mysql.createConnection()</code> call Concurrency Sequential query execution on single connection Lifecycle Connection maintained for application lifetime Reconnection No automatic reconnection on connection loss Resource Usage Minimal connection overhead for low-traffic scenarios <p>This approach is suitable for applications with moderate query volumes where connection pooling overhead is unnecessary.</p> <p>Sources: config/db.js L3</p>"},{"location":"Database-Layer/#error-handling","title":"Error Handling","text":"<p>The connection error handling is implemented at the connection establishment phase only. The <code>conexion.connect()</code> callback at config/db.js L10-L16</p> <p>logs errors to the console but does not implement retry logic or graceful degradation.</p>"},{"location":"Database-Layer/#error-scenarios","title":"Error Scenarios","text":"Scenario Behavior Impact Invalid credentials Error logged, connection remains unusable Application queries will fail Network unavailable Error logged, connection remains unusable Application queries will fail Database does not exist Error logged, connection remains unusable Application queries will fail Connection succeeds Success message logged Normal operation <p>Subsequent query-level errors must be handled by the consuming code that invokes <code>conexion.query()</code>.</p> <p>Sources: config/db.js L10-L16</p>"},{"location":"Database-Layer/#environment-variable-requirements","title":"Environment Variable Requirements","text":"<p>The database module requires four environment variables to be set before the application starts. These variables should be defined in a <code>.env</code> file or the deployment environment.</p>"},{"location":"Database-Layer/#required-variables","title":"Required Variables","text":"Variable Format Example <code>DB_HOST</code> Hostname or IP address <code>localhost</code> or <code>192.168.1.100</code> <code>DB_USER</code> MySQL username <code>marathon_app</code> <code>DB_PASS</code> MySQL password <code>secure_password_123</code> <code>DB_NAME</code> Database schema name <code>happy_runner_42k</code> <p>Without these variables, the <code>createConnection()</code> call at config/db.js L3-L8</p> <p>will use <code>undefined</code> values, causing connection failures.</p> <p>Sources: config/db.js L4-L7</p>"},{"location":"Design-System/","title":"Design System","text":"<p>Relevant source files * public/css/login.css * public/css/style.css</p>"},{"location":"Design-System/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document describes the HAPPY RUNNER 42K application's design system, which provides a unified visual language through CSS custom properties, global styles, and reusable design patterns. The design system is implemented primarily in public/css/style.css</p> <p>and establishes design tokens for colors, typography, spacing, and shadows that are consistently applied across all interfaces.</p> <p>For page-specific component styling, see Component Styles. For complete user interface implementations, see User Interfaces.</p>"},{"location":"Design-System/#design-token-architecture","title":"Design Token Architecture","text":"<p>The design system is built on CSS custom properties (CSS variables) defined in the <code>:root</code> selector, making them globally accessible throughout the application. This approach ensures consistency and simplifies theme maintenance.</p>"},{"location":"Design-System/#color-palette","title":"Color Palette","text":"<p>The application uses a cohesive blue-based color scheme with an accent color for call-to-action elements. All colors are defined as CSS custom properties in public/css/style.css L3-L11</p> <p>and public/css/login.css L1-L10</p> <p>:</p> Token Variable Hex Value Usage <code>--lapis-lazuli</code> <code>#2f6690ff</code> Primary brand color, navigation backgrounds <code>--cerulean</code> <code>#3a7ca5ff</code> Secondary brand color, gradients <code>--platinum</code> <code>#d9dcd6ff</code> Neutral background, text on dark backgrounds <code>--indigo-dye</code> <code>#16425bff</code> Dark text, footer backgrounds <code>--sky-blue</code> <code>#81c3d7ff</code> Accents, highlights, interactive elements <code>--white</code> <code>#ffffff</code> Pure white backgrounds, text on dark <code>--accent</code> <code>#d2643c</code> Call-to-action buttons, emphasized elements <code>--glass</code> <code>rgba(255,255,255,0.96)</code> Semi-transparent overlays <p>Sources: public/css/style.css L3-L11</p> <p>public/css/login.css L1-L10</p>"},{"location":"Design-System/#spacing-and-layout-tokens","title":"Spacing and Layout Tokens","text":"<p>Layout consistency is achieved through standardized spacing values defined in public/css/style.css L13-L16</p> <p>:</p> Token Variable Value Purpose <code>--radius</code> <code>14px</code> Standard border radius for cards and components <code>--gap</code> <code>1rem</code> Standard spacing between elements <code>--max-width</code> <code>1200px</code> Maximum content width for readability <p>Sources: public/css/style.css L13-L16</p>"},{"location":"Design-System/#typography-system","title":"Typography System","text":"<p>The typography system uses Montserrat as the primary font family with scalable font sizes defined in public/css/style.css L22-L27</p> <p>:</p> Token Variable Value Application <code>--fz-base</code> <code>18px</code> Base body text size (increased for readability) <code>--fz-lg</code> <code>1.25rem</code> Large text, lead paragraphs <code>--fz-sm</code> <code>0.95rem</code> Small text, captions, metadata <code>--leading</code> <code>1.55</code> Line height for optimal readability <p>The font stack is defined as: <code>\"Montserrat\", system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial</code> in public/css/style.css L34</p> <p>providing graceful fallbacks to system fonts.</p> <p>Sources: public/css/style.css L22-L27</p> <p>public/css/style.css L34</p>"},{"location":"Design-System/#shadow-tokens","title":"Shadow Tokens","text":"<p>Two shadow levels provide depth hierarchy in public/css/style.css L18-L20</p> <p>:</p> Token Variable Value Usage <code>--shadow-soft</code> <code>0 12px 32px rgba(10,30,45,0.08)</code> Default cards, subtle elevation <code>--shadow-strong</code> <code>0 20px 60px rgba(10,30,45,0.14)</code> Hover states, emphasized components <p>Sources: public/css/style.css L18-L20</p>"},{"location":"Design-System/#design-token-dependency-graph","title":"Design Token Dependency Graph","text":"<pre><code>flowchart TD\n\nRoot[\":root selector&lt;br&gt;(style.css:3-27)\"]\nColorTokens[\"Color Tokens&lt;br&gt;--lapis-lazuli, --cerulean,&lt;br&gt;--platinum, --indigo-dye,&lt;br&gt;--sky-blue, --white,&lt;br&gt;--accent, --glass\"]\nSpacingTokens[\"Spacing Tokens&lt;br&gt;--radius, --gap,&lt;br&gt;--max-width\"]\nTypographyTokens[\"Typography Tokens&lt;br&gt;--fz-base, --fz-lg,&lt;br&gt;--fz-sm, --leading\"]\nShadowTokens[\"Shadow Tokens&lt;br&gt;--shadow-soft,&lt;br&gt;--shadow-strong\"]\nNavBar[\"nav&lt;br&gt;(style.css:46-58)\"]\nBanner[\".banner&lt;br&gt;(style.css:209-220)\"]\nFooter[\".site-footer&lt;br&gt;(style.css:526-532)\"]\nCards[\".card, .card--dark&lt;br&gt;(style.css:318-348)\"]\nButtons[\".btn-banner, .btn-primary&lt;br&gt;(style.css:258-268)\"]\nContainer[\".container&lt;br&gt;(style.css:43)\"]\nGallery[\".gallery-container&lt;br&gt;(style.css:368-373)\"]\nBody[\"body&lt;br&gt;(style.css:32-40)\"]\nHeadings[\"h2&lt;br&gt;(style.css:303-308)\"]\nHeroTitle[\".hero-title&lt;br&gt;(style.css:243-249)\"]\nMapWrapper[\".map-wrapper&lt;br&gt;(style.css:409-418)\"]\n\nRoot --&gt; ColorTokens\nRoot --&gt; SpacingTokens\nRoot --&gt; TypographyTokens\nRoot --&gt; ShadowTokens\nColorTokens --&gt; NavBar\nColorTokens --&gt; Banner\nColorTokens --&gt; Footer\nColorTokens --&gt; Cards\nColorTokens --&gt; Buttons\nSpacingTokens --&gt; Container\nSpacingTokens --&gt; Cards\nSpacingTokens --&gt; Gallery\nTypographyTokens --&gt; Body\nTypographyTokens --&gt; Headings\nTypographyTokens --&gt; HeroTitle\nShadowTokens --&gt; Cards\nShadowTokens --&gt; NavBar\nShadowTokens --&gt; MapWrapper</code></pre> <p>Sources: public/css/style.css L3-L27</p> <p>public/css/style.css L46-L58</p> <p>public/css/style.css L209-L220</p> <p>public/css/style.css L318-L348</p>"},{"location":"Design-System/#global-base-styles","title":"Global Base Styles","text":""},{"location":"Design-System/#css-reset-and-base-configuration","title":"CSS Reset and Base Configuration","text":"<p>The design system implements a minimal CSS reset in public/css/style.css L29-L40</p> <p>and public/css/login.css L13-L23</p> <p>:</p> <ul> <li>Box Sizing: <code>box-sizing: border-box</code> applied universally via <code>*</code> selector public/css/style.css L30</li> <li>Full Height Layout: <code>html, body { height: 100%; }</code> enables full viewport layouts public/css/style.css L31</li> <li>Body Defaults: Zero margin, Montserrat font family, 18px base font size, 1.55 line height public/css/style.css L32-L40</li> <li>Background: Linear gradient from <code>var(--platinum)</code> to <code>#f4fbff</code> public/css/style.css L38</li> <li>Font Smoothing: <code>-webkit-font-smoothing: antialiased</code> for improved rendering public/css/style.css L39</li> </ul> <p>Sources: public/css/style.css L29-L40</p> <p>public/css/login.css L13-L23</p>"},{"location":"Design-System/#container-system","title":"Container System","text":"<p>The <code>.container</code> utility class provides consistent content width constraints in public/css/style.css L43</p> <p>:</p> <pre><code>.container {\n  width: calc(100% - 2rem);\n  max-width: var(--max-width);\n  margin: 0 auto;\n  padding: 0 1rem;\n}\n</code></pre> <p>This pattern ensures content remains readable on large screens while maintaining appropriate padding on mobile devices.</p> <p>Sources: public/css/style.css L43</p>"},{"location":"Design-System/#component-design-patterns","title":"Component Design Patterns","text":""},{"location":"Design-System/#navigation-bar-pattern","title":"Navigation Bar Pattern","text":"<p>The navigation bar uses a sticky positioning pattern with gradient background defined in public/css/style.css L46-L58</p> <p>and public/css/login.css L28-L35</p> <p>:</p> <ul> <li>Positioning: <code>position: sticky; top: 0; z-index: 120</code> keeps navigation accessible while scrolling</li> <li>Background: <code>linear-gradient(90deg, var(--lapis-lazuli), var(--cerulean))</code> creates brand gradient</li> <li>Shadow: <code>box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1)</code> provides depth separation</li> <li>Layout: Flexbox with <code>justify-content: space-between</code> for logo and navigation links</li> </ul> <p>Sources: public/css/style.css L46-L58</p> <p>public/css/login.css L28-L35</p>"},{"location":"Design-System/#card-system","title":"Card System","text":"<p>The design system implements two card variants in public/css/style.css L318-L348</p> <p>:</p>"},{"location":"Design-System/#standard-card-card","title":"Standard Card (.card)","text":"<ul> <li>Background: <code>linear-gradient(180deg, rgba(255,255,255,0.98), #fbfdff)</code> - subtle light gradient</li> <li>Border: <code>1px solid rgba(22,66,91,0.06)</code> - minimal border for definition</li> <li>Shadow: <code>var(--shadow-soft)</code> for subtle elevation</li> <li>Border Radius: <code>var(--radius)</code> (14px)</li> <li>Padding: <code>1.25rem</code></li> <li>Transition: <code>transform .18s ease, box-shadow .18s ease</code> for interaction feedback</li> </ul>"},{"location":"Design-System/#dark-card-card-dark","title":"Dark Card (.card--dark)","text":"<ul> <li>Background: <code>linear-gradient(180deg, rgba(6,24,36,0.92), rgba(14,34,48,0.94))</code> - dark gradient</li> <li>Border: <code>1px solid rgba(255,255,255,0.04)</code> - subtle light border</li> <li>Shadow: <code>var(--shadow-strong)</code> for emphasized elevation</li> <li>Text Color: <code>var(--white)</code> for contrast on dark background</li> </ul> <p>Sources: public/css/style.css L318-L348</p>"},{"location":"Design-System/#button-system","title":"Button System","text":"<p>The design system provides multiple button patterns:</p>"},{"location":"Design-System/#primary-button-btn-primary","title":"Primary Button (.btn-primary)","text":"<p>Defined in public/css/style.css L600-L615</p> <p>:</p> <ul> <li>Background: <code>var(--sky-blue)</code></li> <li>Border Radius: <code>999px</code> (fully rounded)</li> <li>Padding: <code>0.6rem 1rem</code></li> <li>Font Weight: <code>800</code> (extra bold)</li> <li>Hover Effect: <code>translateY(-3px) scale(1.02)</code> with shadow enhancement</li> </ul>"},{"location":"Design-System/#banner-cta-btn-banner","title":"Banner CTA (.btn-banner)","text":"<p>Defined in public/css/style.css L258-L267</p> <p>:</p> <ul> <li>Background: <code>linear-gradient(180deg, var(--accent), #ff8a64)</code> - warm gradient</li> <li>Shadow: <code>0 18px 48px rgba(255,107,53,0.12)</code> - prominent depth</li> <li>Hover Effect: <code>translateY(-6px) scale(1.02)</code> with enhanced shadow</li> </ul>"},{"location":"Design-System/#outline-button-btn-outline","title":"Outline Button (.btn-outline)","text":"<p>Defined in public/css/style.css L268-L274</p> <p>:</p> <ul> <li>Border: <code>2px solid rgba(255,255,255,0.12)</code> - transparent border</li> <li>Background: Transparent</li> <li>Color: <code>var(--white)</code></li> </ul> <p>Sources: public/css/style.css L258-L274</p> <p>public/css/style.css L600-L615</p>"},{"location":"Design-System/#css-component-relationship-map","title":"CSS Component Relationship Map","text":"<pre><code>flowchart TD\n\nReset[\"CSS Reset&lt;br&gt;*, html, body&lt;br&gt;(style.css:29-31)\"]\nBody[\"body&lt;br&gt;font-family: Montserrat&lt;br&gt;font-size: 18px&lt;br&gt;(style.css:32-40)\"]\nContainer[\".container&lt;br&gt;max-width: 1200px&lt;br&gt;(style.css:43)\"]\nNav[\"nav&lt;br&gt;sticky positioning&lt;br&gt;gradient background&lt;br&gt;(style.css:46-58)\"]\nLogo[\".logo&lt;br&gt;flex layout&lt;br&gt;(style.css:61-78)\"]\nNavLinks[\".nav-links&lt;br&gt;desktop: flex row&lt;br&gt;mobile: dropdown&lt;br&gt;(style.css:81-167)\"]\nMenuBtn[\".menu-btn&lt;br&gt;hamburger icon&lt;br&gt;(style.css:128-147)\"]\nBanner[\".banner&lt;br&gt;parallax perspective&lt;br&gt;(style.css:209-220)\"]\nBannerOverlay[\".banner-overlay&lt;br&gt;dark gradient overlay&lt;br&gt;(style.css:223-229)\"]\nBannerText[\".banner-text&lt;br&gt;hero content&lt;br&gt;(style.css:232-240)\"]\nHeroTitle[\".hero-title&lt;br&gt;clamp font sizing&lt;br&gt;(style.css:243-249)\"]\nHeroCTA[\".hero-cta&lt;br&gt;button group&lt;br&gt;(style.css:257)\"]\nBtnBanner[\".btn-banner&lt;br&gt;accent gradient&lt;br&gt;(style.css:258-267)\"]\nCard[\".card&lt;br&gt;light variant&lt;br&gt;(style.css:318-325)\"]\nCardDark[\".card--dark&lt;br&gt;dark variant&lt;br&gt;(style.css:328-333)\"]\nGallery[\".gallery-container&lt;br&gt;grid layout&lt;br&gt;(style.css:368-384)\"]\nMapWrapper[\".map-wrapper&lt;br&gt;map container&lt;br&gt;(style.css:409-418)\"]\nWinnersGrid[\".winners-grid&lt;br&gt;winner cards&lt;br&gt;(style.css:466-478)\"]\nSiteFooter[\".site-footer&lt;br&gt;brand color background&lt;br&gt;(style.css:526-532)\"]\nFooterGrid[\".footer-grid&lt;br&gt;3-column grid&lt;br&gt;(style.css:535-542)\"]\nSocialIcon[\".social-icon&lt;br&gt;circular buttons&lt;br&gt;(style.css:624-655)\"]\nNewsletter[\".newsletter&lt;br&gt;email subscription&lt;br&gt;(style.css:584-599)\"]\n\nBody --&gt; Nav\nBody --&gt; Banner\nContainer --&gt; Card\nContainer --&gt; CardDark\nContainer --&gt; Gallery\nContainer --&gt; MapWrapper\nContainer --&gt; WinnersGrid\nBody --&gt; SiteFooter\n\nsubgraph subGraph4 [\"Footer Components\"]\n    SiteFooter\n    FooterGrid\n    SocialIcon\n    Newsletter\n    SiteFooter --&gt; FooterGrid\n    FooterGrid --&gt; SocialIcon\n    FooterGrid --&gt; Newsletter\nend\n\nsubgraph subGraph3 [\"Content Components\"]\n    Card\n    CardDark\n    Gallery\n    MapWrapper\n    WinnersGrid\nend\n\nsubgraph subGraph2 [\"Hero/Banner Components\"]\n    Banner\n    BannerOverlay\n    BannerText\n    HeroTitle\n    HeroCTA\n    BtnBanner\n    Banner --&gt; BannerOverlay\n    Banner --&gt; BannerText\n    BannerText --&gt; HeroTitle\n    BannerText --&gt; HeroCTA\n    HeroCTA --&gt; BtnBanner\nend\n\nsubgraph subGraph1 [\"Navigation Components\"]\n    Nav\n    Logo\n    NavLinks\n    MenuBtn\n    Nav --&gt; Logo\n    Nav --&gt; NavLinks\n    Nav --&gt; MenuBtn\nend\n\nsubgraph subGraph0 [\"Base Layer\"]\n    Reset\n    Body\n    Container\n    Reset --&gt; Body\n    Body --&gt; Container\nend</code></pre> <p>Sources: public/css/style.css L29-L721</p>"},{"location":"Design-System/#responsive-design-strategy","title":"Responsive Design Strategy","text":""},{"location":"Design-System/#breakpoint-system","title":"Breakpoint System","text":"<p>The design system uses three primary breakpoints for responsive behavior:</p> Breakpoint Screen Width Primary Adjustments Large tablets <code>max-width: 980px</code> Two-column layouts, smaller hero text Tablets/Large phones <code>max-width: 780px</code> Mobile navigation menu, stacked grids Small phones <code>max-width: 680px</code> Single column, reduced image heights <p>Implementation in style.css:</p> <ul> <li>980px breakpoint public/css/style.css L498-L502 : Converts grid layouts to single column, adjusts hero title sizing, reduces map height</li> <li>780px breakpoint public/css/style.css L150-L167 : Activates hamburger menu, converts navigation to dropdown overlay</li> <li>680px breakpoint public/css/style.css L503-L508 : Further reduces gallery image heights, banner padding, and map dimensions</li> </ul> <p>Implementation in login.css:</p> <ul> <li>480px breakpoint public/css/login.css L153-L159 : Reduces login container padding and font sizes</li> </ul> <p>Sources: public/css/style.css L498-L508</p> <p>public/css/style.css L150-L167</p> <p>public/css/login.css L153-L159</p>"},{"location":"Design-System/#mobile-navigation-pattern","title":"Mobile Navigation Pattern","text":"<p>The mobile navigation system is implemented in public/css/style.css L150-L167</p> <p>:</p> <pre><code>flowchart TD\n\nDesktop[\"Desktop View&lt;br&gt;.nav-links display: flex&lt;br&gt;horizontal layout\"]\nMobileTrigger[\"&lt; 780px breakpoint\"]\nMobileHidden[\".nav-links display: none&lt;br&gt;.menu-btn display: flex\"]\nMobileActive[\".nav-links.active display: flex&lt;br&gt;dropdown overlay\"]\n\nDesktop --&gt; MobileTrigger\nMobileTrigger --&gt; MobileHidden\nMobileHidden --&gt; MobileActive\nMobileActive --&gt; MobileHidden</code></pre> <p>The hamburger icon (<code>.menu-btn</code>) uses three <code>div</code> elements styled in public/css/style.css L141-L147</p> <p>that can animate into an X pattern through JavaScript interaction.</p> <p>Sources: public/css/style.css L128-L167</p>"},{"location":"Design-System/#flexible-typography","title":"Flexible Typography","text":"<p>The design system uses <code>clamp()</code> functions for fluid typography that scales smoothly between breakpoints:</p> <ul> <li>Hero Title public/css/style.css L244 : <code>font-size: clamp(2rem, 5.2vw, 3.6rem)</code> scales from 2rem to 3.6rem based on viewport width</li> <li>Section Headings public/css/style.css L304 : <code>font-size: clamp(1.25rem, 2.2vw, 1.6rem)</code> for consistent heading hierarchy</li> </ul> <p>This approach eliminates the need for explicit breakpoint-based font size adjustments while ensuring text remains readable at all screen sizes.</p> <p>Sources: public/css/style.css L244</p> <p>public/css/style.css L304</p>"},{"location":"Design-System/#accessibility-features","title":"Accessibility Features","text":""},{"location":"Design-System/#focus-indicators","title":"Focus Indicators","text":"<p>The design system provides consistent focus indicators for keyboard navigation in public/css/style.css L495</p> <p>and public/css/style.css L170-L177</p> <p>:</p> <pre><code>a:focus, button:focus, input:focus {\n  outline: 3px solid rgba(129,195,215,0.16);\n  outline-offset: 3px;\n  border-radius: 8px;\n}\n</code></pre> <p>Specific components implement additional focus states:</p> <ul> <li>Navigation links public/css/style.css L105-L110 : Background highlight on focus</li> <li>Social icons public/css/style.css L652-L655 : Enhanced outline with 4px offset</li> <li>Menu button public/css/style.css L171-L177 : Visible outline for keyboard users</li> </ul> <p>Sources: public/css/style.css L495</p> <p>public/css/style.css L170-L177</p> <p>public/css/style.css L105-L110</p> <p>public/css/style.css L652-L655</p>"},{"location":"Design-System/#reduced-motion-support","title":"Reduced Motion Support","text":"<p>The design system respects user preferences for reduced motion via <code>prefers-reduced-motion</code> media query in public/css/style.css L511-L513</p> <p>:</p> <pre><code>@media (prefers-reduced-motion: reduce){\n  * { \n    transition: none !important; \n    animation: none !important; \n    transform: none !important; \n  }\n}\n</code></pre> <p>This disables all transitions, animations, and transform effects for users who have enabled reduced motion in their operating system settings, improving accessibility for users with vestibular disorders or motion sensitivity.</p> <p>Sources: public/css/style.css L511-L513</p>"},{"location":"Design-System/#screen-reader-support","title":"Screen Reader Support","text":"<p>The design system includes utility classes for screen reader content in public/css/style.css L702-L706</p> <p>:</p> <pre><code>.sr-only {\n  position: absolute !important;\n  width: 1px; height: 1px; padding: 0; margin: -1px;\n  overflow: hidden; clip: rect(0 0 0 0); \n  white-space: nowrap; border: 0;\n}\n</code></pre> <p>This <code>.sr-only</code> class visually hides content while keeping it accessible to screen readers, commonly used for icon button labels and supplementary navigation information.</p> <p>Sources: public/css/style.css L702-L706</p>"},{"location":"Design-System/#animation-and-transition-system","title":"Animation and Transition System","text":""},{"location":"Design-System/#standard-transition-patterns","title":"Standard Transition Patterns","text":"<p>The design system applies consistent transition timing across interactive elements:</p> Element Type Transition Properties Duration Easing Function Cards <code>transform, box-shadow</code> <code>0.18s</code> <code>ease</code> Buttons <code>transform, box-shadow, opacity</code> <code>0.12s</code> - <code>0.25s</code> <code>ease</code> or <code>cubic-bezier(0.2, 0.9, 0.3, 1)</code> Navigation links <code>all</code> <code>0.25s</code> <code>ease</code> Input focus <code>box-shadow, border-color, transform</code> <code>0.09s</code> - <code>0.15s</code> <code>ease</code> Gallery images <code>transform, filter</code> <code>0.5s</code> - <code>0.36s</code> <code>ease</code> <p>Sources: public/css/style.css L324</p> <p>public/css/style.css L108</p> <p>public/css/login.css L86</p> <p>public/css/style.css L379-L383</p>"},{"location":"Design-System/#hover-effects","title":"Hover Effects","text":"<p>Interactive elements implement multi-property hover states:</p> <ul> <li>Cards public/css/style.css L364 : <code>translateY(-10px)</code> with <code>var(--shadow-strong)</code></li> <li>Buttons public/css/style.css L111-L114 public/css/style.css L267 : Vertical translation with scale enhancement</li> <li>Gallery figures public/css/style.css L382-L383 : Container translates, image scales and brightens</li> <li>Social icons public/css/style.css L645-L651 : <code>translateY(-6px) scale(1.05)</code> with shadow and background changes</li> </ul> <p>Sources: public/css/style.css L364</p> <p>public/css/style.css L267</p> <p>public/css/style.css L382-L383</p> <p>public/css/style.css L645-L651</p>"},{"location":"Design-System/#login-page-design-system-extension","title":"Login Page Design System Extension","text":"<p>The login page stylesheet public/css/login.css</p> <p>extends the base design system with authentication-specific patterns while maintaining token consistency.</p>"},{"location":"Design-System/#centered-authentication-layout","title":"Centered Authentication Layout","text":"<p>The login page uses a flexbox-based centering approach in public/css/login.css L37-L56</p> <p>:</p> <ul> <li>Auth Wrapper (<code>.auth-wrapper</code>): <code>display: flex; align-items: center; justify-content: center</code> with <code>min-height: calc(100vh - 150px)</code> to account for header and footer</li> <li>Login Container (<code>.login-container</code>): <code>max-width: 420px</code> with gradient background, border radius, and shadow for visual separation</li> </ul> <p>Sources: public/css/login.css L37-L56</p>"},{"location":"Design-System/#form-component-styling","title":"Form Component Styling","text":"<p>The login form implements consistent input and button styling in public/css/login.css L68-L114</p> <p>:</p> <ul> <li>Input Fields public/css/login.css L77-L93 : * <code>border-radius: 10px</code> for soft edges * Focus state with <code>border-color: var(--cerulean)</code> and shadow * <code>transform: translateY(-1px)</code> on focus for subtle feedback</li> <li>Submit Button public/css/login.css L96-L114 : * Full width with <code>border-radius: 999px</code> (pill shape) * Gradient background matching brand colors * Hover state with <code>translateY(-3px) scale(1.01)</code> and enhanced shadow</li> </ul> <p>Sources: public/css/login.css L68-L114</p>"},{"location":"Design-System/#sweetalert2-customization","title":"SweetAlert2 Customization","text":"<p>Custom classes for SweetAlert2 modal styling are defined in public/css/login.css L135-L149</p> <p>:</p> Class Purpose Key Styles <code>.swal2-border-rounded</code> Modal container <code>border-radius: 16px</code>, Montserrat font <code>.swal2-title-custom</code> Alert title <code>font-weight: 700</code>, <code>font-size: 1.6rem</code>, text shadow <code>.swal2-content-custom</code> Alert content <code>font-size: 1rem</code>, platinum color <p>Sources: public/css/login.css L135-L149</p>"},{"location":"Design-System/#design-system-file-structure","title":"Design System File Structure","text":"<pre><code>flowchart TD\n\nBaseTokens[\":root tokens&lt;br&gt;style.css:3-27\"]\nGlobalStyles[\"Global Styles&lt;br&gt;style.css:29-58\"]\nNavigationStyles[\"Navigation&lt;br&gt;style.css:46-206\"]\nHeroStyles[\"Hero/Banner&lt;br&gt;style.css:208-298\"]\nContentStyles[\"Content Components&lt;br&gt;style.css:300-384\"]\nMapStyles[\"Map Section&lt;br&gt;style.css:387-463\"]\nWinnerStyles[\"Winners Section&lt;br&gt;style.css:465-486\"]\nFooterStyles[\"Footer&lt;br&gt;style.css:525-720\"]\nLoginExtension[\"Login Extension&lt;br&gt;login.css:1-182\"]\nBody[\"body styles\"]\nContainerUtil[\".container utility\"]\nNavBar[\"nav element\"]\nNavLogo[\".logo component\"]\nNavLinksDesktop[\".nav-links desktop\"]\nNavLinksMobile[\".nav-links mobile\"]\nHamburgerMenu[\".menu-btn\"]\nBannerSection[\".banner\"]\nBannerOverlayStyle[\".banner-overlay\"]\nHeroText[\".hero-title\"]\nCTAButtons[\".btn-banner, .btn-outline\"]\nCountdownBadges[\".countdown, .badge\"]\nCardComponents[\".card, .card--dark\"]\nDetailBlocks[\".detail\"]\nCategoryGrid[\".categories-grid\"]\nGalleryGrid[\".gallery-container\"]\nMapContainer[\"#map element\"]\nMapWrapperStyle[\".map-wrapper\"]\nLeafletCustom[\"Leaflet popup styles\"]\nWinnerGrid[\".winners-grid\"]\nWinnerCardComponent[\".winner-card\"]\nDorsalBadge[\".dorsal-badge\"]\nFooterBase[\".site-footer\"]\nFooterGridLayout[\".footer-grid\"]\nFooterBrand[\".footer-brand\"]\nFooterSocial[\".social-icon\"]\nFooterNewsletter[\".newsletter\"]\nLoginTokens[\":root duplicate tokens\"]\nLoginLayout[\".auth-wrapper\"]\nLoginForm[\".login-container\"]\nLoginInputs[\"input styles\"]\nLoginButton[\"submit button\"]\nSweetAlertCustom[\"SweetAlert2 classes\"]\nResponsiveLayer[\"Responsive Rules&lt;br&gt;@media queries\"]\nAccessibilityLayer[\"Accessibility Rules&lt;br&gt;focus, prefers-reduced-motion\"]\n\nBaseTokens --&gt; GlobalStyles\nBaseTokens --&gt; NavigationStyles\nBaseTokens --&gt; HeroStyles\nBaseTokens --&gt; ContentStyles\nBaseTokens --&gt; MapStyles\nBaseTokens --&gt; WinnerStyles\nBaseTokens --&gt; FooterStyles\nBaseTokens --&gt; LoginExtension\nGlobalStyles --&gt; Body\nGlobalStyles --&gt; ContainerUtil\nNavigationStyles --&gt; NavBar\nNavigationStyles --&gt; NavLogo\nNavigationStyles --&gt; NavLinksDesktop\nNavigationStyles --&gt; NavLinksMobile\nNavigationStyles --&gt; HamburgerMenu\nHeroStyles --&gt; BannerSection\nHeroStyles --&gt; BannerOverlayStyle\nHeroStyles --&gt; HeroText\nHeroStyles --&gt; CTAButtons\nHeroStyles --&gt; CountdownBadges\nContentStyles --&gt; CardComponents\nContentStyles --&gt; DetailBlocks\nContentStyles --&gt; CategoryGrid\nContentStyles --&gt; GalleryGrid\nMapStyles --&gt; MapContainer\nMapStyles --&gt; MapWrapperStyle\nMapStyles --&gt; LeafletCustom\nWinnerStyles --&gt; WinnerGrid\nWinnerStyles --&gt; WinnerCardComponent\nWinnerStyles --&gt; DorsalBadge\nFooterStyles --&gt; FooterBase\nFooterStyles --&gt; FooterGridLayout\nFooterStyles --&gt; FooterBrand\nFooterStyles --&gt; FooterSocial\nFooterStyles --&gt; FooterNewsletter\nLoginExtension --&gt; LoginTokens\nLoginExtension --&gt; LoginLayout\nLoginExtension --&gt; LoginForm\nLoginExtension --&gt; LoginInputs\nLoginExtension --&gt; LoginButton\nLoginExtension --&gt; SweetAlertCustom\nResponsiveLayer --&gt; NavigationStyles\nResponsiveLayer --&gt; HeroStyles\nResponsiveLayer --&gt; ContentStyles\nResponsiveLayer --&gt; MapStyles\nResponsiveLayer --&gt; FooterStyles\nResponsiveLayer --&gt; LoginExtension\nAccessibilityLayer --&gt; GlobalStyles\nAccessibilityLayer --&gt; NavigationStyles\nAccessibilityLayer --&gt; FooterStyles</code></pre> <p>Sources: public/css/style.css L1-L721</p> <p>public/css/login.css L1-L182</p>"},{"location":"File-Upload-System/","title":"File Upload System","text":"<p>Relevant source files * middlewares/multer.js * middlewares/verifyAdmin.js * middlewares/verifyToken.js * public/css/edit.css * views/inscripcion.ejs</p>"},{"location":"File-Upload-System/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document describes the file upload system used for handling participant profile photos during registration. The system uses the <code>multer</code> middleware library to process multipart/form-data uploads, generating unique timestamped filenames and storing images in a dedicated directory structure. For information about how participant data is stored and managed beyond file uploads, see Participant Data. For details on the registration form interface itself, see Registration Flow.</p>"},{"location":"File-Upload-System/#multer-middleware-configuration","title":"Multer Middleware Configuration","text":"<p>The file upload system is implemented through a dedicated multer middleware configuration located at middlewares/multer.js L1-L15</p> <p>This middleware intercepts file uploads and handles storage operations before the request reaches route handlers.</p>"},{"location":"File-Upload-System/#storage-engine","title":"Storage Engine","text":"<p>The system uses <code>multer.diskStorage()</code> to configure a disk-based storage engine rather than keeping files in memory. This approach is suitable for the application's needs, where uploaded photos are permanently stored on the server filesystem.</p> <p>Configuration Structure:</p> Configuration Aspect Implementation Storage Type <code>multer.diskStorage()</code> Destination Function Returns <code>'public/uploads/participantes'</code> Filename Function Generates <code>'participante-' + Date.now() + ext</code> Module Export <code>multer({ storage })</code> instance <p>The storage configuration object provides two callback functions that control where and how files are saved: middlewares/multer.js L5-L13</p> <p>Sources: middlewares/multer.js L1-L15</p>"},{"location":"File-Upload-System/#file-naming-strategy","title":"File Naming Strategy","text":"<p>The filename generation function implements a timestamp-based naming convention to ensure uniqueness and prevent filename collisions:</p> <pre><code>participante-{timestamp}.{extension}\n</code></pre> <p>The function extracts the original file extension using <code>path.extname(file.originalname)</code> and combines it with the prefix <code>'participante-'</code> and the current timestamp from <code>Date.now()</code>: middlewares/multer.js L9-L12</p> <p>This approach guarantees unique filenames even when multiple participants upload files simultaneously, as <code>Date.now()</code> returns milliseconds since the Unix epoch.</p> <p>Example Generated Filenames:</p> <ul> <li><code>participante-1703856234567.jpg</code></li> <li><code>participante-1703856234890.png</code></li> <li><code>participante-1703856235123.jpeg</code></li> </ul> <p>Sources: middlewares/multer.js L9-L12</p>"},{"location":"File-Upload-System/#destination-directory","title":"Destination Directory","text":"<p>All participant photos are stored in <code>public/uploads/participantes/</code>: middlewares/multer.js L7</p> <p>This directory structure serves multiple purposes:</p> <ol> <li>Public Accessibility: The <code>public/</code> prefix indicates files are served statically by Express, making them accessible via HTTP URLs</li> <li>Logical Organization: The <code>uploads/</code> subdirectory separates user-generated content from application assets</li> <li>Entity Separation: The <code>participantes/</code> subdirectory isolates participant photos from other upload types (e.g., winner photos)</li> </ol> <p>The destination is returned via the callback function <code>cb(null, 'public/uploads/participantes')</code>, where the <code>null</code> first argument indicates no error: middlewares/multer.js L6-L8</p> <p>Sources: middlewares/multer.js L6-L8</p>"},{"location":"File-Upload-System/#multer-configuration-architecture","title":"Multer Configuration Architecture","text":"<pre><code>flowchart TD\n\nMulterImport[\"require('multer')\"]\nStorageConfig[\"multer.diskStorage({...})\"]\nPathImport[\"require('path')\"]\nFilenameFn[\"filename: function(req, file, cb)\"]\nDestinationFn[\"destination: function(req, file, cb)\"]\nDestPath[\"cb(null, 'public/uploads/participantes')\"]\nExtExtraction[\"path.extname(file.originalname)\"]\nFilenamePattern[\"'participante-' + Date.now() + ext\"]\nUploadInstance[\"multer({ storage })\"]\nModuleExport[\"module.exports = upload\"]\n\nsubgraph subGraph0 [\"multer.js Configuration\"]\n    MulterImport\n    StorageConfig\n    PathImport\n    FilenameFn\n    DestinationFn\n    DestPath\n    ExtExtraction\n    FilenamePattern\n    UploadInstance\n    ModuleExport\n    MulterImport --&gt; StorageConfig\n    PathImport --&gt; FilenameFn\n    StorageConfig --&gt; DestinationFn\n    StorageConfig --&gt; FilenameFn\n    DestinationFn --&gt; DestPath\n    FilenameFn --&gt; ExtExtraction\n    ExtExtraction --&gt; FilenamePattern\n    StorageConfig --&gt; UploadInstance\n    UploadInstance --&gt; ModuleExport\nend</code></pre> <p>Sources: middlewares/multer.js L1-L15</p>"},{"location":"File-Upload-System/#integration-with-registration-form","title":"Integration with Registration Form","text":"<p>The registration form at <code>views/inscripcion.ejs</code> integrates with the multer middleware through proper form encoding and input configuration.</p>"},{"location":"File-Upload-System/#form-configuration","title":"Form Configuration","text":"<p>The form element specifies <code>enctype=\"multipart/form-data\"</code> to enable file upload capability: views/inscripcion.ejs L22</p> <p>This encoding type instructs the browser to send form data as a multipart MIME message, which multer can parse.</p> <pre><code>&lt;form action=\"/inscripcion\" method=\"POST\" enctype=\"multipart/form-data\"&gt;\n</code></pre> <p>Key Form Attributes:</p> Attribute Value Purpose <code>action</code> <code>/inscripcion</code> POST endpoint for form submission <code>method</code> <code>POST</code> HTTP method for data transmission <code>enctype</code> <code>multipart/form-data</code> Enables file upload parsing <p>Sources: views/inscripcion.ejs L22</p>"},{"location":"File-Upload-System/#file-input-field","title":"File Input Field","text":"<p>The file input field is positioned prominently at the top of the form with the label \"Foto para dorsal/perfil\": views/inscripcion.ejs L24-L27</p> <p>The field configuration enforces image file selection:</p> <pre><code>&lt;input type=\"file\" name=\"foto\" accept=\"image/*\" required&gt;\n</code></pre> <p>Input Specifications:</p> Attribute Value Effect <code>type</code> <code>file</code> Renders file picker UI <code>name</code> <code>foto</code> Field name in multipart data <code>accept</code> <code>image/*</code> Browser-level filter for image files <code>required</code> (boolean) Prevents form submission without file <p>The <code>name=\"foto\"</code> attribute is crucial as it determines how the route handler accesses the uploaded file through multer's <code>req.file</code> object.</p> <p>Sources: views/inscripcion.ejs L24-L27</p>"},{"location":"File-Upload-System/#file-upload-request-flow","title":"File Upload Request Flow","text":"<p>The following diagram illustrates how file uploads are processed through the application stack, from form submission to file storage:</p> <pre><code>sequenceDiagram\n  participant Browser\n  participant app.js\n  participant /inscripcion Route\n  participant multer.single('foto')\n  participant multer.diskStorage\n  participant public/uploads/participantes/\n  participant Route Handler\n  participant MySQL DB\n\n  Browser-&gt;&gt;app.js: \"POST /inscripcion\n  app.js-&gt;&gt;/inscripcion Route: Content-Type: multipart/form-data\"\n  /inscripcion Route-&gt;&gt;multer.single('foto'): \"Route to /inscripcion\"\n  multer.single('foto')-&gt;&gt;multer.single('foto'): \"Apply middleware\"\n  multer.single('foto')-&gt;&gt;multer.diskStorage: \"Parse multipart data\"\n  multer.diskStorage--&gt;&gt;multer.single('foto'): \"Call destination(req, file, cb)\"\n  multer.single('foto')-&gt;&gt;multer.diskStorage: \"'public/uploads/participantes'\"\n  multer.diskStorage-&gt;&gt;multer.diskStorage: \"Call filename(req, file, cb)\"\n  multer.diskStorage--&gt;&gt;multer.single('foto'): \"Generate 'participante-' + Date.now() + ext\"\n  multer.single('foto')-&gt;&gt;public/uploads/participantes/: \"'participante-1703856234567.jpg'\"\n  public/uploads/participantes/--&gt;&gt;multer.single('foto'): \"Write file to disk\"\n  multer.single('foto')-&gt;&gt;multer.single('foto'): \"File saved successfully\"\n  multer.single('foto')-&gt;&gt;Route Handler: \"Populate req.file object\"\n  Route Handler-&gt;&gt;Route Handler: \"next()\"\n  Route Handler-&gt;&gt;MySQL DB: \"Access req.file.filename\"\n  MySQL DB--&gt;&gt;Route Handler: \"INSERT participant with foto path\"\n  Route Handler-&gt;&gt;Browser: \"Success\"</code></pre> <p>Sources: middlewares/multer.js L1-L15</p> <p>views/inscripcion.ejs L22-L27</p>"},{"location":"File-Upload-System/#file-storage-structure","title":"File Storage Structure","text":"<p>The file storage system maintains a simple, flat directory structure:</p> <pre><code>flowchart TD\n\nUploadsDir[\"uploads/\"]\nPublicDir[\"public/\"]\nCSSDir[\"css/\"]\nJSDir[\"js/\"]\nImagesDir[\"images/\"]\nParticipantesDir[\"participantes/\"]\nFile1[\"participante-1703856234567.jpg\"]\nFile2[\"participante-1703856234890.png\"]\nFile3[\"participante-1703856235123.jpeg\"]\nFileN[\"...\"]\n\nsubgraph subGraph2 [\"Application Root\"]\n    PublicDir\n    PublicDir --&gt; CSSDir\n    PublicDir --&gt; JSDir\n    PublicDir --&gt; ImagesDir\n    PublicDir --&gt; UploadsDir\n\nsubgraph subGraph1 [\"User Uploads\"]\n    UploadsDir\n    ParticipantesDir\n    File1\n    File2\n    File3\n    FileN\n    UploadsDir --&gt; ParticipantesDir\n    ParticipantesDir --&gt; File1\n    ParticipantesDir --&gt; File2\n    ParticipantesDir --&gt; File3\n    ParticipantesDir --&gt; FileN\nend\n\nsubgraph subGraph0 [\"Static Assets\"]\n    CSSDir\n    JSDir\n    ImagesDir\nend\nend</code></pre> <p>This structure allows participant photos to be served via URLs like <code>/uploads/participantes/participante-1703856234567.jpg</code> due to Express's static file serving configured for the <code>public/</code> directory.</p> <p>Sources: middlewares/multer.js L7</p>"},{"location":"File-Upload-System/#multer-middleware-usage-pattern","title":"Multer Middleware Usage Pattern","text":"<p>The multer middleware instance exported from middlewares/multer.js L15</p> <p>is applied to routes that handle file uploads. The typical usage pattern is:</p> <pre><code>const upload = require('./middlewares/multer');\n\nrouter.post('/inscripcion', upload.single('foto'), (req, res) =&gt; {\n  // req.file contains uploaded file information\n  // req.body contains other form fields\n});\n</code></pre> <p>The <code>upload.single('foto')</code> method call configures multer to:</p> <ol> <li>Expect exactly one file with the field name <code>'foto'</code></li> <li>Make the file information available via <code>req.file</code></li> <li>Continue processing if upload succeeds, or return error if it fails</li> </ol>"},{"location":"File-Upload-System/#reqfile-object-structure","title":"req.file Object Structure","text":"<p>After successful upload, <code>req.file</code> contains:</p> Property Example Value Description <code>fieldname</code> <code>'foto'</code> Field name specified in form <code>originalname</code> <code>'profile.jpg'</code> Original filename from user's computer <code>encoding</code> <code>'7bit'</code> File encoding <code>mimetype</code> <code>'image/jpeg'</code> MIME type detected by multer <code>destination</code> <code>'public/uploads/participantes'</code> Storage directory <code>filename</code> <code>'participante-1703856234567.jpg'</code> Generated filename <code>path</code> <code>'public/uploads/participantes/participante-1703856234567.jpg'</code> Full file path <code>size</code> <code>245678</code> File size in bytes <p>Sources: middlewares/multer.js L1-L15</p>"},{"location":"File-Upload-System/#security-considerations","title":"Security Considerations","text":"<p>The current implementation includes basic security measures but has areas that could be enhanced:</p>"},{"location":"File-Upload-System/#implemented-protections","title":"Implemented Protections","text":"<ol> <li>File Extension Preservation: The system preserves the original file extension: middlewares/multer.js L10  This allows proper file type identification but relies on client-provided data.</li> <li>Timestamp-Based Naming: Using <code>Date.now()</code> for filenames prevents path traversal attacks since the filename is entirely server-generated: middlewares/multer.js L11</li> <li>Isolated Storage Directory: Participant uploads are segregated in a dedicated directory: middlewares/multer.js L7  preventing accidental mixing with application code or system files.</li> </ol>"},{"location":"File-Upload-System/#client-side-validation","title":"Client-Side Validation","text":"<p>The registration form includes browser-level file type filtering with <code>accept=\"image/*\"</code>: views/inscripcion.ejs L26</p> <p>This provides immediate user feedback but is not a security control, as it can be bypassed by modifying the HTML or sending requests directly.</p>"},{"location":"File-Upload-System/#missing-server-side-validations","title":"Missing Server-Side Validations","text":"<p>The current implementation lacks several server-side security controls:</p> <ul> <li>MIME Type Validation: No verification that uploaded files are actually images</li> <li>File Size Limits: No configured limit on upload size (default multer limit applies)</li> <li>File Content Inspection: No validation of image file headers or content</li> <li>Malicious File Prevention: No scanning for embedded scripts or malware</li> </ul> <p>Sources: middlewares/multer.js L1-L15</p> <p>views/inscripcion.ejs L24-L27</p>"},{"location":"File-Upload-System/#file-access-and-serving","title":"File Access and Serving","text":"<p>Uploaded participant photos are served statically through Express's static middleware. Since files are stored in <code>public/uploads/participantes/</code>, they become accessible at URLs with the path prefix <code>/uploads/participantes/</code>.</p>"},{"location":"File-Upload-System/#url-construction-pattern","title":"URL Construction Pattern","text":"<p>To display a participant's photo:</p> <pre><code>/uploads/participantes/{filename}\n</code></pre> <p>Where <code>{filename}</code> is the value stored in the database's <code>foto</code> column (e.g., <code>participante-1703856234567.jpg</code>).</p>"},{"location":"File-Upload-System/#example-usage-in-views","title":"Example Usage in Views","text":"<p>In profile and display pages, participant photos are referenced using this URL pattern:</p> <pre><code>&lt;img src=\"/uploads/participantes/&lt;%= participante.foto %&gt;\" alt=\"Participant Photo\"&gt;\n</code></pre> <p>The Express static file middleware automatically resolves these URLs to the physical files in the <code>public/</code> directory.</p> <p>Sources: middlewares/multer.js L7</p>"},{"location":"File-Upload-System/#integration-with-authentication-middleware","title":"Integration with Authentication Middleware","text":"<p>While the multer middleware itself handles file processing, routes that use it are typically protected by authentication middleware. The upload functionality intersects with authentication in two scenarios:</p> <ol> <li>Participant Registration: The <code>/inscripcion</code> route using multer is public (no authentication required) since new participants need to register: views/inscripcion.ejs L22</li> <li>Profile Updates: If profile editing allows photo changes, those routes would be protected by <code>verifyToken</code> middleware (see Role-Based Access Control) to ensure only authenticated participants can modify their data</li> </ol> <p>This separation means the multer middleware focuses solely on file processing, while authentication concerns are handled by separate middleware layers.</p> <p>Sources: middlewares/multer.js L1-L15</p> <p>views/inscripcion.ejs L22</p>"},{"location":"File-Upload-System/#middleware-composition-diagram","title":"Middleware Composition Diagram","text":"<pre><code>flowchart TD\n\nInscripcionRoute[\"/inscripcion POST\"]\nBodyParser[\"express.urlencoded()\"]\nMulterUpload[\"upload.single('foto')&lt;br&gt;from multer.js\"]\nRouteHandler[\"inscripcion handler\"]\nParseMultipart[\"Parse multipart/form-data\"]\nSaveFile[\"Save to public/uploads/participantes/\"]\nPopulateReqFile[\"Populate req.file\"]\nPopulateReqBody[\"Populate req.body\"]\nDBInsert[\"Insert to participantes table\"]\n\nInscripcionRoute --&gt; MulterUpload\nMulterUpload --&gt; ParseMultipart\nPopulateReqFile --&gt; RouteHandler\nPopulateReqBody --&gt; RouteHandler\nRouteHandler --&gt; DBInsert\n\nsubgraph subGraph2 [\"Processing Steps\"]\n    ParseMultipart\n    SaveFile\n    PopulateReqFile\n    PopulateReqBody\n    DBInsert\n    ParseMultipart --&gt; SaveFile\n    SaveFile --&gt; PopulateReqFile\n    ParseMultipart --&gt; PopulateReqBody\nend\n\nsubgraph subGraph1 [\"Middleware Chain\"]\n    BodyParser\n    MulterUpload\n    RouteHandler\nend\n\nsubgraph subGraph0 [\"Public Routes\"]\n    InscripcionRoute\nend</code></pre> <p>Sources: middlewares/multer.js L1-L15</p> <p>views/inscripcion.ejs L22</p>"},{"location":"Landing-Page/","title":"Landing Page","text":"<p>Relevant source files * public/css/style.css * views/index.ejs</p>"},{"location":"Landing-Page/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document details the landing page implementation for the HAPPY RUNNER 42K marathon management application. The landing page serves as the primary entry point for visitors, displaying event information, registration calls-to-action, photo gallery, race categories, and an interactive map of the race route. It is implemented in <code>views/index.ejs</code> and styled with <code>public/css/style.css</code>.</p> <p>For participant registration functionality, see 4.1.2. For authentication-related navigation behavior, see 3.2. For shared layout components (header, footer), see 4.3.</p>"},{"location":"Landing-Page/#page-structure-overview","title":"Page Structure Overview","text":"<p>The landing page follows a vertical scrolling single-page layout composed of multiple sections. Each section is semantically structured using HTML5 elements and includes EJS partial inclusions for shared components.</p> <pre><code>flowchart TD\n\nIndexEJS[\"index.ejs&lt;br&gt;Main Template\"]\nHeadPartial[\"partials/head.ejs&lt;br&gt;Dependencies &amp; Meta\"]\nHeaderPartial[\"partials/header.ejs&lt;br&gt;Navigation Bar\"]\nFooterPartial[\"partials/footer.ejs&lt;br&gt;Site Footer\"]\nHeroSection[\"banner&lt;br&gt;Hero Section\"]\nInfoSection[\"#info&lt;br&gt;Event Details\"]\nCategoriesSection[\"#categorias&lt;br&gt;Race Categories\"]\nGallerySection[\"gallery&lt;br&gt;Photo Gallery\"]\nMapSection[\"#recorrido&lt;br&gt;Interactive Map\"]\nStyleCSS[\"public/css/style.css&lt;br&gt;Base Styles\"]\nLeafletCSS[\"Leaflet CSS&lt;br&gt;External Library\"]\nLeafletJS[\"Leaflet JS&lt;br&gt;Map Engine\"]\n\nIndexEJS --&gt; HeadPartial\nIndexEJS --&gt; HeaderPartial\nIndexEJS --&gt; HeroSection\nIndexEJS --&gt; InfoSection\nIndexEJS --&gt; CategoriesSection\nIndexEJS --&gt; GallerySection\nIndexEJS --&gt; MapSection\nIndexEJS --&gt; FooterPartial\nHeadPartial --&gt; StyleCSS\nHeadPartial --&gt; LeafletCSS\nMapSection --&gt; LeafletJS</code></pre> <p>Sources: views/index.ejs L1-L119</p> <p>public/css/style.css L1-L721</p>"},{"location":"Landing-Page/#template-composition","title":"Template Composition","text":"<p>The landing page uses EJS partial inclusion to compose the final HTML document:</p> Partial Include Line Reference Purpose <code>partials/head</code> views/index.ejs L1 Loads external dependencies (Bootstrap, Leaflet, Font Awesome, Boxicons) and establishes base meta tags <code>partials/header</code> views/index.ejs L3 Renders role-based navigation bar with logo, menu items, and authentication links <code>partials/footer</code> views/index.ejs L118 Displays footer with brand info, social links, newsletter signup, and legal information <p>Sources: views/index.ejs L1-L3</p> <p>views/index.ejs L118</p>"},{"location":"Landing-Page/#hero-banner-section","title":"Hero Banner Section","text":"<p>The hero banner occupies the top of the page and provides immediate visual impact with event branding, key details, and primary call-to-action buttons.</p>"},{"location":"Landing-Page/#visual-structure","title":"Visual Structure","text":"<p>The banner is implemented using a <code>.banner</code> class container with parallax-style background image and overlay:</p> <pre><code>flowchart TD\n\nBannerDiv[\".banner&lt;br&gt;role='img'&lt;br&gt;id='heroBanner'\"]\nOverlay[\".banner-overlay&lt;br&gt;gradient overlay\"]\nTextContainer[\".banner-text.container&lt;br&gt;content wrapper\"]\nHeroTitle[\".hero-title&lt;br&gt;H1: 'HAPPY RUNNER 42K'\"]\nLead[\".lead&lt;br&gt;Date &amp; Location\"]\nDescription[\".banner-desc&lt;br&gt;Event summary\"]\nCTAGroup[\".hero-cta&lt;br&gt;role='group'\"]\nBadges[\".hero-badges&lt;br&gt;Category badges\"]\nBtnInscripcion[\"a.btn-banner&lt;br&gt;href='/inscripcion'\"]\nBtnRecorrido[\"a.btn-outline&lt;br&gt;href='#recorrido'\"]\n\nBannerDiv --&gt; Overlay\nBannerDiv --&gt; TextContainer\nTextContainer --&gt; HeroTitle\nTextContainer --&gt; Lead\nTextContainer --&gt; Description\nTextContainer --&gt; CTAGroup\nTextContainer --&gt; Badges\nCTAGroup --&gt; BtnInscripcion\nCTAGroup --&gt; BtnRecorrido</code></pre> <p>Banner Implementation Details:</p> <ul> <li>Background image: <code>/resources/img/bunner.jpg</code> (public/css/style.css L215 )</li> <li>Min-height: <code>72vh</code> with cover positioning (public/css/style.css L211-L217 )</li> <li>Overlay gradient: <code>rgba(6,24,36,0.72)</code> to <code>rgba(17,46,66,0.45)</code> with 2px blur (public/css/style.css L226-L228 )</li> <li>Content z-index: <code>2</code> positioned above overlay (public/css/style.css L234 )</li> </ul> <p>Sources: views/index.ejs L5-L26</p> <p>public/css/style.css L208-L287</p>"},{"location":"Landing-Page/#typography-and-content-hierarchy","title":"Typography and Content Hierarchy","text":"<p>The hero section uses a hierarchical typographic scale defined in CSS custom properties:</p> Element Class Font Size Weight Line Reference Main Title <code>.hero-title</code> <code>clamp(2rem, 5.2vw, 3.6rem)</code> 800 public/css/style.css L244-L249 Accent Span <code>.accent</code> Inherits Inherits public/css/style.css L250 Lead Text <code>.lead</code> <code>var(--fz-lg)</code> (1.25rem) 700 public/css/style.css L253 Description <code>.banner-desc</code> 1rem Normal public/css/style.css L254 <p>The accent color (<code>--accent: #d2643c</code>) is applied to the \"42K\" text element (views/index.ejs L9</p> <p>public/css/style.css L10</p> <p>).</p> <p>Sources: views/index.ejs L9-L12</p> <p>public/css/style.css L22-L27</p> <p>public/css/style.css L243-L254</p>"},{"location":"Landing-Page/#call-to-action-buttons","title":"Call-to-Action Buttons","text":"<p>Two primary CTA buttons are rendered within the <code>.hero-cta</code> group:</p> <ol> <li>Primary CTA (<code>.btn-banner</code>): Links to <code>/inscripcion</code> with gradient background (views/index.ejs L15 ) * Gradient: <code>linear-gradient(180deg, var(--accent), #ff8a64)</code> (public/css/style.css L259 ) * Shadow: <code>0 18px 48px rgba(255,107,53,0.12)</code> (public/css/style.css L264 ) * Hover effect: <code>translateY(-6px) scale(1.02)</code> (public/css/style.css L267 )</li> <li>Secondary CTA (<code>.btn-outline</code>): Anchor link to <code>#recorrido</code> section (views/index.ejs L16 ) * Border: <code>2px solid rgba(255,255,255,0.12)</code> (public/css/style.css L269 ) * Weight: 700 (public/css/style.css L273 )</li> </ol> <p>Sources: views/index.ejs L14-L17</p> <p>public/css/style.css L257-L274</p>"},{"location":"Landing-Page/#category-badges","title":"Category Badges","text":"<p>Two badge elements display race categories using the <code>.badge</code> class with glassmorphism styling:</p> <ul> <li>Background: <code>linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03))</code> (public/css/style.css L293 )</li> <li>Border: <code>1px solid rgba(255,255,255,0.04)</code> (public/css/style.css L296 )</li> <li>Content: \"Masculina \u2022 42K\" and \"Femenina \u2022 42K\" (views/index.ejs L21-L22 )</li> </ul> <p>Sources: views/index.ejs L20-L23</p> <p>public/css/style.css L289-L297</p>"},{"location":"Landing-Page/#event-information-section","title":"Event Information Section","text":"<p>The <code>#info</code> section provides structured event details using an article-based card layout.</p> <pre><code>flowchart TD\n\nInfoSection[\"section#info.event-info\"]\nContainer[\"div.container\"]\nHeading[\"h2: 'Informaci\u00f3n del Evento'\"]\nIntro[\"p.intro.small\"]\nDetailsGrid[\"div.event-details\"]\nDateCard[\"article.detail&lt;br&gt;Fecha: 9 sept 2025\"]\nTimeCard[\"article.detail&lt;br&gt;Hora: 10:00 AM\"]\nLocationCard[\"article.detail&lt;br&gt;Ubicaci\u00f3n: Park G\u00fcell\"]\nHydrationCard[\"article.detail&lt;br&gt;Hidrataci\u00f3n: cada 5km\"]\n\nInfoSection --&gt; Container\nContainer --&gt; Heading\nContainer --&gt; Intro\nContainer --&gt; DetailsGrid\nDetailsGrid --&gt; DateCard\nDetailsGrid --&gt; TimeCard\nDetailsGrid --&gt; LocationCard\nDetailsGrid --&gt; HydrationCard</code></pre>"},{"location":"Landing-Page/#grid-layout","title":"Grid Layout","text":"<p>The <code>.event-details</code> container uses flexbox with wrapping:</p> <ul> <li>Display: <code>flex</code> with <code>gap: 1rem</code> and <code>flex-wrap: wrap</code> (public/css/style.css L314 )</li> <li>Each <code>.detail</code> card: <code>flex: 1 1 220px</code> with responsive growth (public/css/style.css L351 )</li> <li>Card styling: <code>border-radius: 12px</code> with soft shadow (public/css/style.css L319-L325 )</li> </ul> <p>Card Content Structure:</p> <ul> <li>H3 for label (e.g., \"Fecha\", \"Hora\")</li> <li>P for value (e.g., \"9 de septiembre 2025\", \"10:00 AM\")</li> </ul> <p>Sources: views/index.ejs L29-L53</p> <p>public/css/style.css L314</p> <p>public/css/style.css L319-L351</p>"},{"location":"Landing-Page/#categories-section","title":"Categories Section","text":"<p>The <code>#categorias</code> section displays race categories using enhanced card components with hover effects.</p>"},{"location":"Landing-Page/#implementation","title":"Implementation","text":"<pre><code>flowchart TD\n\nCatSection[\"section#categorias.categories\"]\nCatContainer[\"div.container\"]\nCatHeading[\"h2: 'Categor\u00edas'\"]\nCatGrid[\"div.categories-grid\"]\nMasculinaCard[\"article.cat&lt;br&gt;H3: 'Masculina \u2014 42K'\"]\nFemeninaCard[\"article.cat&lt;br&gt;H3: 'Femenina \u2014 42K'\"]\n\nCatSection --&gt; CatContainer\nCatContainer --&gt; CatHeading\nCatContainer --&gt; CatGrid\nCatGrid --&gt; MasculinaCard\nCatGrid --&gt; FemeninaCard</code></pre>"},{"location":"Landing-Page/#styling-characteristics","title":"Styling Characteristics","text":"<p>The <code>.cat</code> class provides enhanced card styling compared to basic <code>.detail</code> cards:</p> Property Value Line Reference Flex basis <code>1 1 300px</code> public/css/style.css L356 Padding <code>1.25rem</code> public/css/style.css L358 Background <code>linear-gradient(180deg, var(--white), #fbfdff)</code> public/css/style.css L361 Transition <code>transform .28s cubic-bezier(.2,.9,.3,1)</code> public/css/style.css L362 Hover transform <code>translateY(-10px)</code> public/css/style.css L364 <p>Sources: views/index.ejs L55-L69</p> <p>public/css/style.css L354-L366</p>"},{"location":"Landing-Page/#photo-gallery-section","title":"Photo Gallery Section","text":"<p>The gallery section implements a responsive grid layout for event photography.</p>"},{"location":"Landing-Page/#grid-configuration","title":"Grid Configuration","text":"<pre><code>flowchart TD\n\nGallerySection[\"section.gallery\"]\nGalleryContainer[\"div.gallery-container\"]\nFig1[\"figure&lt;br&gt;img: corredores-alegres...\"]\nFig2[\"figure&lt;br&gt;img: diferentes-personas...\"]\nFig3[\"figure&lt;br&gt;img: mujeres-atleticas...\"]\nCaption1[\"figcaption: 'Corredores disfrutando...'\"]\nCaption2[\"figcaption: 'Salida oficial.'\"]\nCaption3[\"figcaption: 'Emoci\u00f3n en meta.'\"]\n\nGallerySection --&gt; GalleryContainer\nGalleryContainer --&gt; Fig1\nGalleryContainer --&gt; Fig2\nGalleryContainer --&gt; Fig3\nFig1 --&gt; Caption1\nFig2 --&gt; Caption2\nFig3 --&gt; Caption3</code></pre>"},{"location":"Landing-Page/#css-grid-implementation","title":"CSS Grid Implementation","text":"<ul> <li>Grid template: <code>repeat(auto-fit, minmax(240px, 1fr))</code> (public/css/style.css L370 )</li> <li>Gap: <code>1rem</code> (public/css/style.css L371 )</li> <li>Image height: <code>260px</code> with <code>object-fit: cover</code> (public/css/style.css L381 )</li> <li>Hover effects: * Figure: <code>translateY(-10px)</code> with shadow elevation (public/css/style.css L382 ) * Image: <code>scale(1.05)</code> with brightness increase (public/css/style.css L383 )</li> </ul> <p>Image Attributes:</p> <ul> <li><code>loading=\"lazy\"</code> for performance optimization (views/index.ejs L75-L77 )</li> <li>Alt text for accessibility</li> <li>Semantic <code>&lt;figcaption&gt;</code> for descriptions</li> </ul> <p>Sources: views/index.ejs L71-L81</p> <p>public/css/style.css L367-L385</p>"},{"location":"Landing-Page/#interactive-race-map","title":"Interactive Race Map","text":"<p>The race route section integrates Leaflet.js to display an interactive map showing the marathon path from start to finish.</p>"},{"location":"Landing-Page/#leaflet-integration-flow","title":"Leaflet Integration Flow","text":"<pre><code>sequenceDiagram\n  participant Browser\n  participant index.ejs\n  participant leaflet.css (CDN)\n  participant leaflet.js (CDN)\n  participant div\n  participant Inline Script\n\n  Browser-&gt;&gt;index.ejs: Load page\n  index.ejs-&gt;&gt;leaflet.css (CDN): Link stylesheet (line 93)\n  index.ejs-&gt;&gt;leaflet.js (CDN): Load library (line 94)\n  Browser-&gt;&gt;div: Render container\n  Browser-&gt;&gt;Inline Script: Execute initialization\n  Inline Script-&gt;&gt;leaflet.js (CDN): \"L.map('map').setView([41.4145, 2.1527], 14)\"\n  Inline Script-&gt;&gt;leaflet.js (CDN): \"L.tileLayer(...).addTo(map)\"\n  Inline Script-&gt;&gt;leaflet.js (CDN): \"L.polyline(racePath, {...})\"\n  Inline Script-&gt;&gt;leaflet.js (CDN): \"L.marker(...).bindPopup('Inicio')\"\n  Inline Script-&gt;&gt;leaflet.js (CDN): \"L.marker(...).bindPopup('Meta')\"\n  leaflet.js (CDN)-&gt;&gt;div: Render interactive map</code></pre>"},{"location":"Landing-Page/#map-initialization-parameters","title":"Map Initialization Parameters","text":"<p>Map Container:</p> <ul> <li>Element ID: <code>map</code> (views/index.ejs L87 )</li> <li>Initial view: <code>[41.4145, 2.1527]</code> (Park G\u00fcell coordinates) with zoom level 14 (views/index.ejs L97 )</li> <li>Tile layer: OpenStreetMap with attribution (views/index.ejs L99-L101 )</li> </ul> <p>Race Path Coordinates:</p> <pre><code>var racePath = [\n    [41.4145, 2.1527], // Inicio\n    [41.4150, 2.1535],\n    [41.4155, 2.1545],\n    [41.4160, 2.1555]  // Meta\n];\n</code></pre> <p>(views/index.ejs L103-L108</p> <p>)</p> <p>Polyline Styling:</p> <ul> <li>Color: <code>red</code></li> <li>Weight: <code>5</code></li> <li>Opacity: <code>0.8</code> (views/index.ejs L110 )</li> </ul> <p>Markers:</p> <ul> <li>Start marker: <code>racePath[0]</code> with popup \"Inicio\" (auto-opened) (views/index.ejs L114 )</li> <li>Finish marker: <code>racePath[racePath.length - 1]</code> with popup \"Meta\" (views/index.ejs L115 )</li> </ul> <p>Sources: views/index.ejs L83-L116</p>"},{"location":"Landing-Page/#map-styling","title":"Map Styling","text":"<p>The map container receives specific styling for visual consistency:</p> Property Value Line Reference Width <code>100%</code> views/index.ejs L87 Height <code>400px</code> (base), <code>450px</code> (wrapper) views/index.ejs L87 public/css/style.css L423 Border radius <code>14px</code> public/css/style.css L424 Border <code>2px solid rgba(22,66,91,0.08)</code> public/css/style.css L426 Box shadow <code>0 12px 40px rgba(10,40,60,0.12)</code> public/css/style.css L427 <p>Wrapper Container (<code>.map-wrapper</code>):</p> <ul> <li>Max-width: <code>1000px</code> with centered margin (public/css/style.css L410-L412 )</li> <li>Background: <code>#fff</code> with elevated shadow (public/css/style.css L414-L415 )</li> <li>Animation: <code>fadeIn .6s ease-out</code> (public/css/style.css L417 )</li> </ul> <p>Sources: views/index.ejs L87</p> <p>public/css/style.css L388-L463</p>"},{"location":"Landing-Page/#custom-popup-styling","title":"Custom Popup Styling","text":"<p>Leaflet popup elements are customized via CSS overrides:</p> <ul> <li><code>.leaflet-popup-content-wrapper</code>: White background with border radius <code>10px</code> and shadow (public/css/style.css L431-L437 )</li> <li><code>.leaflet-popup-tip</code>: Matching white background (public/css/style.css L440-L442 )</li> <li>Content: Font weight <code>600</code> with indigo-dye color (public/css/style.css L435 )</li> </ul> <p>Sources: public/css/style.css L430-L442</p>"},{"location":"Landing-Page/#css-architecture","title":"CSS Architecture","text":"<p>The landing page styling is built on a comprehensive design system defined in CSS custom properties.</p>"},{"location":"Landing-Page/#design-tokens","title":"Design Tokens","text":"<pre><code>flowchart TD\n\nRootVars[\":root CSS Variables\"]\nColorPalette[\"Color Palette\"]\nSpacing[\"Spacing System\"]\nTypography[\"Typography Scale\"]\nEffects[\"Shadow &amp; Effects\"]\nLapisLazuli[\"--lapis-lazuli: #2f6690ff\"]\nCerulean[\"--cerulean: #3a7ca5ff\"]\nIndigoDye[\"--indigo-dye: #16425bff\"]\nSkyBlue[\"--sky-blue: #81c3d7ff\"]\nAccent[\"--accent: #d2643c\"]\nRadius[\"--radius: 14px\"]\nGap[\"--gap: 1rem\"]\nMaxWidth[\"--max-width: 1200px\"]\nFzBase[\"--fz-base: 18px\"]\nFzLg[\"--fz-lg: 1.25rem\"]\nLeading[\"--leading: 1.55\"]\nShadowSoft[\"--shadow-soft\"]\nShadowStrong[\"--shadow-strong\"]\n\nRootVars --&gt; ColorPalette\nRootVars --&gt; Spacing\nRootVars --&gt; Typography\nRootVars --&gt; Effects\nColorPalette --&gt; LapisLazuli\nColorPalette --&gt; Cerulean\nColorPalette --&gt; IndigoDye\nColorPalette --&gt; SkyBlue\nColorPalette --&gt; Accent\nSpacing --&gt; Radius\nSpacing --&gt; Gap\nSpacing --&gt; MaxWidth\nTypography --&gt; FzBase\nTypography --&gt; FzLg\nTypography --&gt; Leading\nEffects --&gt; ShadowSoft\nEffects --&gt; ShadowStrong</code></pre> <p>Color Palette Definition: All primary colors are defined at public/css/style.css L3-L11</p> <p>The accent color <code>#d2643c</code> provides contrast for CTAs and highlights.</p> <p>Typography System:</p> <ul> <li>Base font size increased to <code>18px</code> for improved readability (public/css/style.css L23 )</li> <li>Line height: <code>1.55</code> for comfortable reading (public/css/style.css L26 )</li> <li>Font family: \"Montserrat\" with system fallbacks (public/css/style.css L34 )</li> </ul> <p>Shadows:</p> <ul> <li>Soft shadow: <code>0 12px 32px rgba(10,30,45,0.08)</code> (public/css/style.css L19 )</li> <li>Strong shadow: <code>0 20px 60px rgba(10,30,45,0.14)</code> (public/css/style.css L20 )</li> </ul> <p>Sources: public/css/style.css L3-L27</p>"},{"location":"Landing-Page/#responsive-breakpoints","title":"Responsive Breakpoints","text":"<p>The stylesheet implements mobile-first responsive design with three primary breakpoints:</p> Breakpoint Scope Key Changes <code>max-width: 980px</code> Tablet Column stacking for event details and categories, reduced hero font size, map height to 420px <code>max-width: 780px</code> Mobile Hamburger menu activation, nav-links dropdown, adjusted padding <code>max-width: 680px</code> Small mobile Gallery image height reduction (260px \u2192 200px), banner min-height to 55vh, map height to 320px <p>Navigation Responsive Behavior:</p> <ul> <li>Menu button (<code>.menu-btn</code>) displays below 780px (public/css/style.css L151 )</li> <li>Nav links convert to dropdown positioned absolutely (public/css/style.css L152-L162 )</li> <li>Active state toggled via <code>.active</code> class (public/css/style.css L164 )</li> </ul> <p>Sources: public/css/style.css L150-L167</p> <p>public/css/style.css L498-L508</p>"},{"location":"Landing-Page/#accessibility-features","title":"Accessibility Features","text":"<p>The landing page implements WCAG 2.1 accessibility guidelines through semantic markup and ARIA attributes.</p>"},{"location":"Landing-Page/#semantic-structure","title":"Semantic Structure","text":"<ul> <li>Hero banner: <code>role=\"img\"</code> with <code>aria-label=\"Corredores en Barcelona\"</code> (views/index.ejs L6 )</li> <li>Overlay: <code>aria-hidden=\"true\"</code> to hide decorative element from screen readers (views/index.ejs L7 )</li> <li>CTA group: <code>role=\"group\"</code> with <code>aria-label=\"Llamados a la acci\u00f3n\"</code> (views/index.ejs L14 )</li> <li>Badges: <code>aria-hidden=\"true\"</code> as decorative content (views/index.ejs L20 )</li> </ul>"},{"location":"Landing-Page/#keyboard-navigation","title":"Keyboard Navigation","text":"<p>Focus states are enhanced with consistent outline styling:</p> <pre><code>a:focus, button:focus, input:focus {\n  outline: 3px solid rgba(129,195,215,0.16);\n  outline-offset: 3px;\n  border-radius: 8px;\n}\n</code></pre> <p>(public/css/style.css L495</p> <p>)</p>"},{"location":"Landing-Page/#motion-preferences","title":"Motion Preferences","text":"<p>The stylesheet respects <code>prefers-reduced-motion</code> media query:</p> <pre><code>@media (prefers-reduced-motion: reduce) {\n  * {\n    transition: none !important;\n    animation: none !important;\n    transform: none !important;\n  }\n}\n</code></pre> <p>(public/css/style.css L511-L513</p> <p>)</p>"},{"location":"Landing-Page/#image-optimization","title":"Image Optimization","text":"<ul> <li>Lazy loading: <code>loading=\"lazy\"</code> on gallery images (views/index.ejs L75-L77 )</li> <li>Alt text: Descriptive alt attributes for all images</li> <li>Figcaptions: Semantic captions for gallery items</li> </ul> <p>Sources: views/index.ejs L6-L7</p> <p>views/index.ejs L14</p> <p>views/index.ejs L20</p> <p>views/index.ejs L75-L77</p> <p>public/css/style.css L495</p> <p>public/css/style.css L511-L513</p>"},{"location":"Landing-Page/#external-dependencies","title":"External Dependencies","text":"<p>The landing page relies on external libraries loaded via CDN:</p> Library Purpose Load Location Leaflet CSS Map styling views/index.ejs L93 Leaflet JS Interactive mapping engine views/index.ejs L94 Font Awesome Icon fonts public/css/style.css L1 Bootstrap UI framework (via partials/head) Referenced in head partial Boxicons Additional icon set (via partials/head) Referenced in head partial <p>Tile Provider:</p> <ul> <li>OpenStreetMap tiles with attribution requirement (views/index.ejs L99-L101 )</li> </ul> <p>Sources: views/index.ejs L93-L94</p> <p>views/index.ejs L99-L101</p> <p>public/css/style.css L1</p>"},{"location":"Login-System/","title":"Login System","text":"<p>Relevant source files * controllers/authcontroller.js * views/login.ejs * views/loginadmin.ejs</p>"},{"location":"Login-System/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document details the dual login mechanisms implemented in the HAPPY RUNNER 42K application. The system provides separate authentication pathways for participants (runners) and administrators (event organizers), each with distinct credential formats and access patterns. Participant authentication uses DNI (national identity number) as the username, while administrator authentication uses a standard username-based approach.</p> <p>For information about how authenticated sessions are managed after login, see Session Management. For details on how roles are enforced throughout the application, see Role-Based Access Control.</p> <p>Sources: controllers/authcontroller.js L1-L91</p> <p>views/login.ejs L1-L58</p> <p>views/loginadmin.ejs L1-L55</p>"},{"location":"Login-System/#login-system-architecture","title":"Login System Architecture","text":"<p>The application implements two independent login endpoints, each backed by separate database tables and credential formats:</p> Aspect Participant Login Admin Login Route <code>/auth</code> <code>/authadmin</code> View Template <code>login.ejs</code> <code>loginadmin.ejs</code> Controller Function <code>authcontroller.loginParticipante</code> <code>authcontroller.loginAdmin</code> Database Table <code>participantes</code> <code>organizadores</code> Username Field <code>dni</code> (numeric ID) <code>user</code> (string username) Password Storage bcrypt hash in <code>password</code> column bcrypt hash in <code>password</code> column Session Role <code>\"participante\"</code> <code>\"admin\"</code> Success Redirect <code>/perfil</code> <code>/admin</code> Failure Redirect <code>/login</code> (re-render) <code>/loginadmin</code> (re-render) <p>Sources: controllers/authcontroller.js L1-L91</p> <p>views/login.ejs L8</p> <p>views/loginadmin.ejs L8</p>"},{"location":"Login-System/#authentication-flow-diagram","title":"Authentication Flow Diagram","text":"<pre><code>flowchart TD\n\nAdminForm[\"loginadmin.ejs&lt;br&gt;Form: /authadmin\"]\nAdminPost[\"POST /authadmin\"]\nLoginAdminFunc[\"authcontroller.loginAdmin()\"]\nAdminDB[\"organizadores table&lt;br&gt;SELECT * WHERE user = ?\"]\nAdminBcrypt[\"bcrypt.compare()&lt;br&gt;password vs results[0].password\"]\nAdminSession[\"Session Variables:&lt;br&gt;loggedin=true&lt;br&gt;user=results[0].user&lt;br&gt;rol='admin'\"]\nAdminSuccess[\"Redirect to /admin\"]\nParticipantForm[\"login.ejs&lt;br&gt;Form: /auth\"]\nParticipantPost[\"POST /auth\"]\nLoginPartFunc[\"authcontroller.loginParticipante()\"]\nParticipantDB[\"participantes table&lt;br&gt;SELECT * WHERE dni = ?\"]\nParticipantBcrypt[\"bcrypt.compare()&lt;br&gt;password vs results[0].password\"]\nParticipantSession[\"Session Variables:&lt;br&gt;loggedin=true&lt;br&gt;dni=results[0].dni&lt;br&gt;rol='participante'\"]\nParticipantSuccess[\"Redirect to /perfil\"]\n\nsubgraph subGraph1 [\"Admin Login\"]\n    AdminForm\n    AdminPost\n    LoginAdminFunc\n    AdminDB\n    AdminBcrypt\n    AdminSession\n    AdminSuccess\n    AdminForm --&gt; AdminPost\n    AdminPost --&gt; LoginAdminFunc\n    LoginAdminFunc --&gt; AdminDB\n    AdminDB --&gt; AdminBcrypt\n    AdminBcrypt --&gt; AdminSession\n    AdminSession --&gt; AdminSuccess\n    AdminBcrypt --&gt; AdminForm\nend\n\nsubgraph subGraph0 [\"Participant Login\"]\n    ParticipantForm\n    ParticipantPost\n    LoginPartFunc\n    ParticipantDB\n    ParticipantBcrypt\n    ParticipantSession\n    ParticipantSuccess\n    ParticipantForm --&gt; ParticipantPost\n    ParticipantPost --&gt; LoginPartFunc\n    LoginPartFunc --&gt; ParticipantDB\n    ParticipantDB --&gt; ParticipantBcrypt\n    ParticipantBcrypt --&gt; ParticipantSession\n    ParticipantSession --&gt; ParticipantSuccess\n    ParticipantBcrypt --&gt; ParticipantForm\nend</code></pre> <p>Sources: controllers/authcontroller.js L1-L91</p> <p>views/login.ejs L8</p> <p>views/loginadmin.ejs L8</p>"},{"location":"Login-System/#participant-login-flow","title":"Participant Login Flow","text":""},{"location":"Login-System/#controller-implementation","title":"Controller Implementation","text":"<p>The <code>loginParticipante</code> function in controllers/authcontroller.js L1-L45</p> <p>handles participant authentication. The process follows these steps:</p> <ol> <li>Input Validation controllers/authcontroller.js L4-L12 * Extracts <code>dni</code> and <code>password</code> from <code>req.body</code> * Returns error if either field is missing * Renders <code>login.ejs</code> with SweetAlert2 error parameters</li> <li>Database Query controllers/authcontroller.js L14 * Queries <code>participantes</code> table: <code>SELECT * FROM participantes WHERE dni = ?</code> * Uses parameterized query to prevent SQL injection</li> <li>Credential Verification controllers/authcontroller.js L17-L28 * Checks if query returned results (<code>results.length === 0</code>) * Uses <code>bcrypt.compare(password, results[0].password)</code> for password validation * Both checks must pass for successful authentication</li> <li>Session Initialization controllers/authcontroller.js L31-L33 * Sets <code>req.session.loggedin = true</code> * Stores <code>req.session.dni = results[0].dni</code> * Assigns <code>req.session.rol = \"participante\"</code></li> <li>Success Response controllers/authcontroller.js L35-L43 * Renders <code>login.ejs</code> with success alert parameters * Sets <code>ruta: \"perfil\"</code> to redirect to profile page * Uses 1500ms timer for automatic redirect</li> </ol> <p>Sources: controllers/authcontroller.js L1-L45</p>"},{"location":"Login-System/#view-template","title":"View Template","text":"<p>The participant login interface is defined in views/login.ejs L1-L58</p> <p>Key elements include:</p> <ul> <li>Form Configuration views/login.ejs L8 * Form submits to <code>/auth</code> via POST method * Input field <code>dni</code> for participant identification * Password input field</li> <li>Field Labels views/login.ejs L10-L11 * Label text: \"Ingrese su usuario:\" (Enter your username) * Placeholder: \"Ingrese su DNI\" (Enter your DNI)</li> <li>SweetAlert2 Integration views/login.ejs L24-L54 * Conditional rendering based on <code>alert</code> variable existence * Displays <code>alertTitle</code>, <code>alertMessage</code>, and <code>alertIcon</code> * Auto-redirects on success using <code>window.location = '/&lt;%= ruta %&gt;'</code></li> </ul> <p>Sources: views/login.ejs L1-L58</p>"},{"location":"Login-System/#admin-login-flow","title":"Admin Login Flow","text":""},{"location":"Login-System/#controller-implementation_1","title":"Controller Implementation","text":"<p>The <code>loginAdmin</code> function in controllers/authcontroller.js L47-L91</p> <p>mirrors the participant login structure with different credentials:</p> <ol> <li>Input Validation controllers/authcontroller.js L50-L58 * Extracts <code>user</code> and <code>password</code> from <code>req.body</code> * Validates both fields are present</li> <li>Database Query controllers/authcontroller.js L60 * Queries <code>organizadores</code> table: <code>SELECT * FROM organizadores WHERE user = ?</code> * Uses string-based username lookup instead of numeric DNI</li> <li>Credential Verification controllers/authcontroller.js L63-L74 * Identical bcrypt comparison: <code>bcrypt.compare(password, results[0].password)</code> * Returns error with <code>loginadmin</code> route on failure</li> <li>Session Initialization controllers/authcontroller.js L77-L79 * Sets <code>req.session.loggedin = true</code> * Stores <code>req.session.user = results[0].user</code> * Assigns <code>req.session.rol = \"admin\"</code> (critical for role-based access)</li> <li>Success Response controllers/authcontroller.js L81-L89 * Renders <code>loginadmin.ejs</code> with success parameters * Sets <code>ruta: \"admin\"</code> to redirect to admin panel * Message: \"Login de administrador correcto\"</li> </ol> <p>Sources: controllers/authcontroller.js L47-L91</p>"},{"location":"Login-System/#view-template_1","title":"View Template","text":"<p>The admin login interface is defined in views/loginadmin.ejs L1-L55</p> <p>Notable differences from participant login:</p> <ul> <li>Form Configuration views/loginadmin.ejs L8 * Form submits to <code>/authadmin</code> via POST * Input field <code>user</code> instead of <code>dni</code></li> <li>Interface Labeling views/loginadmin.ejs L9-L10 * Header: \"ADMINISTRADORES\" * Label: \"Ingrese su usuario:\" (Enter your username) * Generic username placeholder, not DNI-specific</li> <li>SweetAlert2 Configuration views/loginadmin.ejs L22-L50 * Identical alert styling to participant login * Same branded color scheme and animation</li> </ul> <p>Sources: views/loginadmin.ejs L1-L55</p>"},{"location":"Login-System/#credential-validation-sequence","title":"Credential Validation Sequence","text":"<p>The following sequence diagram illustrates the detailed validation flow for both login types:</p> <pre><code>sequenceDiagram\n  participant User\n  participant login.ejs or\n  participant loginadmin.ejs\n  participant authcontroller\n  participant MySQL Database\n  participant bcrypt library\n  participant req.session\n\n  User-&gt;&gt;login.ejs or: \"Submit credentials\"\n  login.ejs or-&gt;&gt;authcontroller: \"POST /auth or /authadmin\n  authcontroller-&gt;&gt;authcontroller: {dni/user, password}\"\n  loop [\"Password mismatch\"]\n    authcontroller-&gt;&gt;login.ejs or: \"Validate fields present\"\n    login.ejs or-&gt;&gt;User: \"Render with alert\n    authcontroller-&gt;&gt;MySQL Database: Error: Debe ingresar...\"\n    MySQL Database--&gt;&gt;authcontroller: \"Show error modal\"\n    authcontroller-&gt;&gt;login.ejs or: \"SELECT * FROM table\n    login.ejs or-&gt;&gt;User: WHERE dni/user = ?\"\n    authcontroller-&gt;&gt;bcrypt library: \"results[]\"\n    bcrypt library--&gt;&gt;authcontroller: \"Render with alert\n    authcontroller-&gt;&gt;login.ejs or: Error: Credenciales inv\u00e1lidas\"\n    login.ejs or-&gt;&gt;User: \"Show error modal\"\n    authcontroller-&gt;&gt;req.session: \"bcrypt.compare(password,\n    req.session--&gt;&gt;authcontroller: results[0].password)\"\n    authcontroller-&gt;&gt;login.ejs or: \"boolean result\"\n    login.ejs or-&gt;&gt;User: \"Render with alert\n  end</code></pre> <p>Sources: controllers/authcontroller.js L1-L91</p>"},{"location":"Login-System/#password-security-implementation","title":"Password Security Implementation","text":"<p>Both login functions use bcrypt for secure password comparison:</p> <pre><code>// From authcontroller.js\n!(await bcrypt.compare(password, results[0].password))\n</code></pre> <p>This implementation:</p> <ul> <li>Never compares plaintext passwords directly</li> <li>Uses asynchronous bcrypt comparison with <code>await</code></li> <li>Compares user-submitted password against hashed value from database</li> <li>Returns boolean indicating match status</li> <li>Negation operator (<code>!</code>) treats mismatch as authentication failure</li> </ul> <p>The bcrypt comparison occurs at:</p> <ul> <li>Participant login: controllers/authcontroller.js L19</li> <li>Admin login: controllers/authcontroller.js L65</li> </ul> <p>Both implementations use identical logic, ensuring consistent security across user types.</p> <p>Sources: controllers/authcontroller.js L19</p> <p>controllers/authcontroller.js L65</p>"},{"location":"Login-System/#session-variable-assignment","title":"Session Variable Assignment","text":"<p>Upon successful authentication, the system initializes session variables that persist throughout the user's session. The variables differ based on login type:</p>"},{"location":"Login-System/#participant-session-variables","title":"Participant Session Variables","text":"<p>Set in controllers/authcontroller.js L31-L33</p> <p>:</p> Variable Value Purpose <code>req.session.loggedin</code> <code>true</code> Indicates authenticated state <code>req.session.dni</code> <code>results[0].dni</code> Participant identifier for queries <code>req.session.rol</code> <code>\"participante\"</code> Role flag for middleware authorization"},{"location":"Login-System/#admin-session-variables","title":"Admin Session Variables","text":"<p>Set in controllers/authcontroller.js L77-L79</p> <p>:</p> Variable Value Purpose <code>req.session.loggedin</code> <code>true</code> Indicates authenticated state <code>req.session.user</code> <code>results[0].user</code> Admin username for display <code>req.session.rol</code> <code>\"admin\"</code> Role flag for <code>verifyAdmin</code> middleware <p>The <code>rol</code> value is critical for the authorization system. Middleware functions check this value to enforce role-based access control (see Role-Based Access Control).</p> <p>Sources: controllers/authcontroller.js L31-L33</p> <p>controllers/authcontroller.js L77-L79</p>"},{"location":"Login-System/#user-feedback-system","title":"User Feedback System","text":"<p>Both login views use SweetAlert2 for displaying authentication results. The alert system is conditionally rendered when the <code>alert</code> variable exists in the view context.</p>"},{"location":"Login-System/#alert-configuration","title":"Alert Configuration","text":"<p>The SweetAlert2 configuration in both templates views/login.ejs L26-L50</p> <p>and views/loginadmin.ejs L23-L47</p> <p>includes:</p> Parameter Description Value Source <code>title</code> Alert heading <code>&lt;%= alertTitle %&gt;</code> from controller <code>text</code> Message body <code>&lt;%= alertMessage %&gt;</code> from controller <code>icon</code> Icon type <code>&lt;%= alertIcon %&gt;</code> (\"error\" or \"success\") <code>timer</code> Auto-close delay <code>&lt;%= timer %&gt;</code> (1500ms on success) <code>showConfirmButton</code> Show OK button <code>&lt;%= showConfirmButton %&gt;</code> (false on success)"},{"location":"Login-System/#controller-alert-parameters","title":"Controller Alert Parameters","text":"<p>Error responses controllers/authcontroller.js L5-L11</p> <p>controllers/authcontroller.js L21-L27</p> <p>:</p> <pre><code>{\n    alert: true,\n    alertTitle: \"Error\",\n    alertMessage: \"Credenciales inv\u00e1lidas\", // or \"Debe ingresar DNI y contrase\u00f1a\"\n    alertIcon: \"error\",\n    ruta: \"login\" // or \"loginadmin\"\n}\n</code></pre> <p>Success responses controllers/authcontroller.js L35-L43</p> <p>controllers/authcontroller.js L81-L89</p> <p>:</p> <pre><code>{\n    alert: true,\n    alertTitle: \"\u00c9xito\",\n    alertMessage: \"Login correcto\", // or \"Login de administrador correcto\"\n    alertIcon: \"success\",\n    showConfirmButton: false,\n    timer: 1500,\n    ruta: \"perfil\" // or \"admin\"\n}\n</code></pre> <p>The <code>ruta</code> parameter determines the redirect destination: views/login.ejs L51</p> <p>executes <code>window.location = '/&lt;%= ruta %&gt;'</code> after the alert.</p> <p>Sources: views/login.ejs L24-L54</p> <p>views/loginadmin.ejs L22-L50</p> <p>controllers/authcontroller.js L5-L43</p> <p>controllers/authcontroller.js L50-L89</p>"},{"location":"Login-System/#database-table-structure","title":"Database Table Structure","text":"<p>The login system queries two separate tables for authentication:</p>"},{"location":"Login-System/#participantes-table","title":"Participantes Table","text":"<p>Queried by <code>loginParticipante</code> controllers/authcontroller.js L14</p> <p>:</p> <ul> <li>Lookup Column: <code>dni</code> (participant's national ID number)</li> <li>Password Column: <code>password</code> (bcrypt hash)</li> <li>Additional Columns: <code>nombre</code>, <code>apellido</code>, <code>telefono</code>, <code>direccion</code>, <code>foto</code></li> </ul>"},{"location":"Login-System/#organizadores-table","title":"Organizadores Table","text":"<p>Queried by <code>loginAdmin</code> controllers/authcontroller.js L60</p> <p>:</p> <ul> <li>Lookup Column: <code>user</code> (admin username)</li> <li>Password Column: <code>password</code> (bcrypt hash)</li> <li>Additional Columns: Implementation-specific organizer data</li> </ul> <p>Both queries use parameterized SQL to prevent injection attacks:</p> <pre><code>SELECT * FROM participantes WHERE dni = ?\nSELECT * FROM organizadores WHERE user = ?\n</code></pre> <p>Sources: controllers/authcontroller.js L14</p> <p>controllers/authcontroller.js L60</p>"},{"location":"Login-System/#error-handling","title":"Error Handling","text":"<p>The authentication system implements consistent error handling across both login types:</p>"},{"location":"Login-System/#validation-errors","title":"Validation Errors","text":"<p>Missing field errors controllers/authcontroller.js L4-L12</p> <p>controllers/authcontroller.js L50-L58</p> <p>:</p> <ul> <li>Condition: <code>!dni || !password</code> or <code>!user || !password</code></li> <li>Message: \"Debe ingresar DNI y contrase\u00f1a\" / \"Debe ingresar Usuario y contrase\u00f1a\"</li> <li>Behavior: Re-renders login form with error alert, does not set session</li> </ul>"},{"location":"Login-System/#authentication-errors","title":"Authentication Errors","text":"<p>Invalid credential errors controllers/authcontroller.js L17-L28</p> <p>controllers/authcontroller.js L63-L74</p> <p>:</p> <ul> <li>Condition: <code>results.length === 0</code> OR bcrypt comparison fails</li> <li>Message: \"Credenciales inv\u00e1lidas\" (consistent message for both scenarios)</li> <li>Security: Does not distinguish between non-existent user and wrong password</li> <li>Behavior: Re-renders login form, preserves form state</li> </ul>"},{"location":"Login-System/#database-errors","title":"Database Errors","text":"<p>SQL errors controllers/authcontroller.js L15</p> <p>controllers/authcontroller.js L61</p> <p>:</p> <ul> <li>Handling: <code>if (err) throw err;</code></li> <li>Behavior: Throws unhandled exception, likely resulting in 500 error</li> <li>Note: Production systems should implement more robust error handling</li> </ul> <p>Sources: controllers/authcontroller.js L1-L91</p>"},{"location":"Login-System/#login-view-styling","title":"Login View Styling","text":"<p>Both login templates share the same CSS file views/login.ejs L5</p> <p>views/loginadmin.ejs L5</p> <p>:</p> <pre><code>&lt;link rel=\"stylesheet\" href=\"/resources/css/login.css\"&gt;\n</code></pre> <p>This provides consistent visual presentation across both authentication interfaces. The templates also include shared partials:</p> <ul> <li><code>partials/head</code> views/login.ejs L1  - Bootstrap, Font Awesome, global dependencies</li> <li><code>partials/header</code> views/login.ejs L3  - Navigation bar (role-aware)</li> <li><code>partials/footer</code> views/login.ejs L57  - Footer content</li> </ul> <p>The SweetAlert2 modal styling views/login.ejs L30-L49</p> <p>uses application brand colors:</p> <ul> <li>Background: Linear gradient from <code>#2f6690ff</code> to <code>#3a7ca5ff</code></li> <li>Text color: <code>#ffffff</code></li> <li>Icon color: <code>#81c3d7ff</code></li> <li>Confirm button: <code>#16425bff</code></li> <li>Backdrop: Semi-transparent with runner animation GIF</li> </ul> <p>Sources: views/login.ejs L1-L58</p> <p>views/loginadmin.ejs L1-L55</p>"},{"location":"Login-System/#integration-points","title":"Integration Points","text":"<p>The login system integrates with several other application components:</p> <ol> <li>Session Management Session Management * Sets session variables consumed by <code>cookie-session</code> middleware * Session data persists for 24 hours (configured in application server)</li> <li>Authorization Middleware Role-Based Access Control * <code>verifyToken</code> checks <code>req.session.loggedin</code> status * <code>verifyAdmin</code> validates <code>req.session.rol === \"admin\"</code></li> <li>Header Navigation Shared Components * <code>partials/header.ejs</code> displays different menu items based on <code>rol</code> value * Reads from <code>res.locals.rol</code> (populated from session)</li> <li>Protected Routes * Participant routes require <code>verifyToken</code> middleware * Admin routes require <code>verifyAdmin</code> middleware * Successful login enables access to role-appropriate interfaces</li> </ol> <p>Sources: controllers/authcontroller.js L31-L33</p> <p>controllers/authcontroller.js L77-L79</p>"},{"location":"Middleware-Layer/","title":"Middleware Layer","text":"<p>Relevant source files * middlewares/multer.js * middlewares/verifyAdmin.js * middlewares/verifyToken.js * public/css/edit.css</p>"},{"location":"Middleware-Layer/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document details the middleware layer that sits between the Express.js router and the business logic controllers. The middleware layer provides three critical cross-cutting concerns: general authentication (<code>verifyToken</code>), role-based authorization (<code>verifyAdmin</code>), and file upload processing (<code>multer</code>).</p> <p>For information about the overall application server configuration and route delegation, see Application Server. For session management configuration that works alongside these middlewares, see Session Management.</p>"},{"location":"Middleware-Layer/#middleware-stack-architecture","title":"Middleware Stack Architecture","text":"<p>The application implements three specialized middleware functions that intercept and process requests before they reach route handlers. These middlewares are located in the <code>middlewares/</code> directory and are selectively applied to routes based on protection requirements.</p>"},{"location":"Middleware-Layer/#middleware-stack-diagram","title":"Middleware Stack Diagram","text":"<pre><code>flowchart TD\n\nRequest[\"HTTP Request\"]\nCookieSession[\"cookie-session middleware&lt;br&gt;(app.js)\"]\nResLocals[\"res.locals population&lt;br&gt;(app.js)\"]\nVerifyToken[\"verifyToken&lt;br&gt;(middlewares/verifyToken.js)\"]\nVerifyAdmin[\"verifyAdmin&lt;br&gt;(middlewares/verifyAdmin.js)\"]\nMulter[\"multer.diskStorage&lt;br&gt;(middlewares/multer.js)\"]\nRouteHandler[\"Route Handler\"]\nController[\"Business Logic Controller\"]\n\nRequest --&gt; CookieSession\nCookieSession --&gt; ResLocals\nResLocals --&gt; VerifyToken\nResLocals --&gt; VerifyAdmin\nResLocals --&gt; Multer\nResLocals --&gt; RouteHandler\nVerifyToken --&gt; RouteHandler\nVerifyAdmin --&gt; RouteHandler\nMulter --&gt; RouteHandler\nRouteHandler --&gt; Controller\n\nsubgraph subGraph1 [\"File Processing\"]\n    Multer\nend\n\nsubgraph subGraph0 [\"Authentication Guards\"]\n    VerifyToken\n    VerifyAdmin\nend</code></pre> <p>Sources: middlewares/verifyToken.js L1-L18</p> <p>middlewares/verifyAdmin.js L1-L17</p> <p>middlewares/multer.js L1-L15</p>"},{"location":"Middleware-Layer/#authentication-middleware","title":"Authentication Middleware","text":""},{"location":"Middleware-Layer/#verifytoken-middleware","title":"verifyToken Middleware","text":"<p>The <code>verifyToken</code> middleware provides general authentication for any logged-in user (participants or administrators). It validates JWT tokens stored in cookies and populates <code>req.user</code> with decoded token data.</p> Aspect Implementation Location middlewares/verifyToken.js L1-L18 Token Source <code>req.cookies.token</code> extracted from HTTP cookies Verification <code>jwt.verify(token, process.env.JWT_SECRET)</code> Success Action Populates <code>req.user</code> with decoded token data, calls <code>next()</code> Failure Action Redirects to <code>/loginadmin</code>"},{"location":"Middleware-Layer/#verifytoken-flow","title":"verifyToken Flow","text":"<pre><code>flowchart TD\n\nStart[\"verifyToken invoked\"]\nCheckToken[\"Token exists in&lt;br&gt;req.cookies.token?\"]\nVerifyJWT[\"jwt.verify(token,&lt;br&gt;process.env.JWT_SECRET)\"]\nDecodeSuccess[\"Verification&lt;br&gt;successful?\"]\nPopulateUser[\"req.user = decoded\"]\nCallNext[\"next()\"]\nRedirectLogin[\"res.redirect('/loginadmin')\"]\n\nStart --&gt; CheckToken\nCheckToken --&gt; RedirectLogin\nCheckToken --&gt; VerifyJWT\nVerifyJWT --&gt; DecodeSuccess\nDecodeSuccess --&gt; RedirectLogin\nDecodeSuccess --&gt; PopulateUser\nPopulateUser --&gt; CallNext</code></pre> <p>Implementation Details:</p> <p>The token retrieval occurs at middlewares/verifyToken.js L4</p> <p>where <code>req.cookies.token</code> is accessed. If the token is missing, an immediate redirect occurs at middlewares/verifyToken.js L6</p> <p>The JWT verification uses <code>process.env.JWT_SECRET</code> as the signing key at middlewares/verifyToken.js L10</p> <p>with any verification errors caught at middlewares/verifyToken.js L13-L15</p> <p>triggering the same redirect behavior.</p> <p>Sources: middlewares/verifyToken.js L1-L18</p>"},{"location":"Middleware-Layer/#verifyadmin-middleware","title":"verifyAdmin Middleware","text":"<p>The <code>verifyAdmin</code> middleware implements role-based access control by adding an additional authorization layer beyond token verification. It ensures only users with <code>rol === \"admin\"</code> can access protected administrative routes.</p> Aspect Implementation Location middlewares/verifyAdmin.js L1-L17 Token Source <code>req.cookies.token</code> extracted from HTTP cookies Verification <code>jwt.verify(token, process.env.JWT_SECRET)</code> Role Check <code>decoded.rol !== \"admin\"</code> Success Action Populates <code>req.user</code> with decoded token data, calls <code>next()</code> Failure Action Redirects to <code>/authadmin</code>"},{"location":"Middleware-Layer/#verifyadmin-authorization-flow","title":"verifyAdmin Authorization Flow","text":"<pre><code>flowchart TD\n\nStart[\"verifyAdmin invoked\"]\nCheckToken[\"Token exists in&lt;br&gt;req.cookies.token?\"]\nVerifyJWT[\"jwt.verify(token,&lt;br&gt;process.env.JWT_SECRET)\"]\nDecodeSuccess[\"JWT verification&lt;br&gt;successful?\"]\nCheckRole[\"decoded.rol === 'admin'?\"]\nPopulateUser[\"req.user = decoded\"]\nCallNext[\"next()\"]\nRedirectAuth[\"res.redirect('/authadmin')\"]\n\nStart --&gt; CheckToken\nCheckToken --&gt; RedirectAuth\nCheckToken --&gt; VerifyJWT\nVerifyJWT --&gt; DecodeSuccess\nDecodeSuccess --&gt; RedirectAuth\nDecodeSuccess --&gt; CheckRole\nCheckRole --&gt; RedirectAuth\nCheckRole --&gt; PopulateUser\nPopulateUser --&gt; CallNext</code></pre> <p>Key Differences from verifyToken:</p> <ol> <li>Different Redirect Target: <code>verifyAdmin</code> redirects to <code>/authadmin</code> middlewares/verifyAdmin.js L5-L13  instead of <code>/loginadmin</code></li> <li>Additional Role Check: After successful JWT verification, <code>decoded.rol</code> is compared against <code>\"admin\"</code> at middlewares/verifyAdmin.js L9</li> <li>Stricter Access Control: Only tokens with <code>rol === \"admin\"</code> proceed to the route handler</li> </ol> <p>Sources: middlewares/verifyAdmin.js L1-L17</p>"},{"location":"Middleware-Layer/#file-upload-middleware","title":"File Upload Middleware","text":""},{"location":"Middleware-Layer/#multer-configuration","title":"multer Configuration","text":"<p>The <code>multer</code> middleware handles file uploads for participant photo registration. It configures disk storage with custom destination paths and filename generation strategies.</p>"},{"location":"Middleware-Layer/#storage-configuration","title":"Storage Configuration","text":"<pre><code>flowchart TD\n\nIncomingFile[\"Incoming File Upload\"]\nMulterDiskStorage[\"multer.diskStorage&lt;br&gt;configuration\"]\nDestinationFn[\"destination function&lt;br&gt;(line 6-8)\"]\nFilenameFn[\"filename function&lt;br&gt;(line 9-12)\"]\nFileSystem[\"public/uploads/participantes/&lt;br&gt;participante-{timestamp}.ext\"]\n\nIncomingFile --&gt; MulterDiskStorage\nMulterDiskStorage --&gt; DestinationFn\nMulterDiskStorage --&gt; FilenameFn\nDestinationFn --&gt; FileSystem\nFilenameFn --&gt; FileSystem</code></pre> <p>Sources: middlewares/multer.js L1-L15</p>"},{"location":"Middleware-Layer/#configuration-details","title":"Configuration Details","text":"Configuration Implementation Storage Type <code>multer.diskStorage</code> at middlewares/multer.js L5 Destination <code>'public/uploads/participantes'</code> at middlewares/multer.js L7 Filename Strategy <code>'participante-' + Date.now() + ext</code> at middlewares/multer.js L11 Extension Extraction <code>path.extname(file.originalname)</code> at middlewares/multer.js L10 Export <code>multer({ storage })</code> at middlewares/multer.js L15"},{"location":"Middleware-Layer/#filename-generation-process","title":"Filename Generation Process","text":"<p>The filename generation logic at middlewares/multer.js L9-L12</p> <p>follows this pattern:</p> <ol> <li>Extract the original file extension using <code>path.extname(file.originalname)</code></li> <li>Generate a unique timestamp using <code>Date.now()</code></li> <li>Concatenate prefix <code>'participante-'</code>, timestamp, and extension</li> <li>Example output: <code>participante-1703524892341.jpg</code></li> </ol> <p>This strategy ensures:</p> <ul> <li>Uniqueness: Timestamps prevent filename collisions</li> <li>Traceability: The <code>participante-</code> prefix identifies file origin</li> <li>Format Preservation: Original file extension is maintained</li> </ul> <p>Sources: middlewares/multer.js L1-L15</p>"},{"location":"Middleware-Layer/#middleware-integration-patterns","title":"Middleware Integration Patterns","text":""},{"location":"Middleware-Layer/#route-protection-patterns","title":"Route Protection Patterns","text":"<p>The middleware stack is applied to routes using three distinct patterns:</p>"},{"location":"Middleware-Layer/#pattern-1-public-routes-no-middleware","title":"Pattern 1: Public Routes (No Middleware)","text":"<pre><code>router.get('/info', (req, res) =&gt; { ... })\n</code></pre> <p>Public routes bypass all authentication and authorization middleware. Examples include landing page, event information, and registration forms.</p>"},{"location":"Middleware-Layer/#pattern-2-general-authentication-verifytoken","title":"Pattern 2: General Authentication (verifyToken)","text":"<pre><code>router.get('/perfil', verifyToken, (req, res) =&gt; { ... })\n</code></pre> <p>Participant-facing protected routes use <code>verifyToken</code> to ensure the user is authenticated. This pattern is applied to profile viewing and editing interfaces.</p>"},{"location":"Middleware-Layer/#pattern-3-admin-only-access-verifyadmin","title":"Pattern 3: Admin-Only Access (verifyAdmin)","text":"<pre><code>router.get('/admin', verifyAdmin, (req, res) =&gt; { ... })\n</code></pre> <p>Administrative routes use <code>verifyAdmin</code> to enforce both authentication and role-based authorization. This pattern protects participant management, winner selection, and organizer registration interfaces.</p>"},{"location":"Middleware-Layer/#pattern-4-file-upload-with-authentication","title":"Pattern 4: File Upload with Authentication","text":"<pre><code>router.post('/inscripcion', upload.single('foto'), (req, res) =&gt; { ... })\n</code></pre> <p>Registration routes combine <code>upload.single('foto')</code> with the route handler to process file uploads. The <code>upload</code> instance exported from middlewares/multer.js L15</p> <p>is applied using the <code>single()</code> method, which expects a form field named <code>'foto'</code>.</p>"},{"location":"Middleware-Layer/#middleware-composition-table","title":"Middleware Composition Table","text":"Route Pattern Middleware Stack Protected Resource <code>/</code> None Landing page <code>/info</code> None Event information <code>/inscripcion</code> <code>upload.single('foto')</code> Registration form + photo upload <code>/login</code> None Participant login form <code>/loginadmin</code> None Admin login form <code>/perfil</code> <code>verifyToken</code> Participant profile view <code>/editparti/:id</code> <code>verifyToken</code> Participant profile edit <code>/admin</code> <code>verifyAdmin</code> Admin participant management <code>/editadmin/:id</code> <code>verifyAdmin</code> Admin participant edit <code>/delete/:id</code> <code>verifyAdmin</code> Admin participant deletion <code>/register</code> <code>verifyAdmin</code> Organizer registration <p>Sources: Based on analysis of authentication patterns in middlewares/verifyToken.js L1-L18</p> <p>middlewares/verifyAdmin.js L1-L17</p> <p>middlewares/multer.js L1-L15</p>"},{"location":"Middleware-Layer/#security-considerations","title":"Security Considerations","text":""},{"location":"Middleware-Layer/#jwt-token-security","title":"JWT Token Security","text":"<p>Both authentication middlewares rely on JWT tokens stored in HTTP cookies:</p> <ul> <li>Secret Key: <code>process.env.JWT_SECRET</code> used for token signing and verification</li> <li>Token Location: <code>req.cookies.token</code> accessed by both middlewares</li> <li>Token Validation: <code>jwt.verify()</code> throws errors for expired, malformed, or invalid tokens</li> </ul>"},{"location":"Middleware-Layer/#error-handling-strategy","title":"Error Handling Strategy","text":"<p>All middleware failures result in redirects rather than error responses:</p> Middleware Error Condition Redirect Target <code>verifyToken</code> Missing token <code>/loginadmin</code> <code>verifyToken</code> Invalid JWT <code>/loginadmin</code> <code>verifyAdmin</code> Missing token <code>/authadmin</code> <code>verifyAdmin</code> Invalid JWT <code>/authadmin</code> <code>verifyAdmin</code> Non-admin role <code>/authadmin</code> <p>This redirect-on-failure strategy ensures:</p> <ul> <li>User Experience: Failed authentication redirects to login rather than showing error pages</li> <li>Security: Error details are not exposed to potential attackers</li> <li>Consistency: All authentication failures follow the same redirect pattern</li> </ul> <p>Sources: middlewares/verifyToken.js L5-L15</p> <p>middlewares/verifyAdmin.js L5-L14</p>"},{"location":"Middleware-Layer/#file-storage-security","title":"File Storage Security","text":"<p>The multer configuration implements basic file handling security:</p> <ol> <li>Controlled Destination: Files are restricted to <code>public/uploads/participantes/</code> directory middlewares/multer.js L7</li> <li>Filename Sanitization: Original filenames are discarded in favor of generated names middlewares/multer.js L11</li> <li>Extension Preservation: Original file extensions are preserved to maintain file type information middlewares/multer.js L10</li> </ol> <p>Limitations: The current implementation does not include:</p> <ul> <li>File type validation (MIME type checking)</li> <li>File size limits</li> <li>Malicious file content scanning</li> <li>Extension whitelist validation</li> </ul> <p>Sources: middlewares/multer.js L1-L15</p>"},{"location":"Organizer-Registration/","title":"Organizer Registration","text":"<p>Relevant source files * public/css/register.css * views/register.ejs</p>"},{"location":"Organizer-Registration/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document describes the organizer registration interface and process, which allows existing administrators to create new organizer accounts. Organizers are admin users who can manage participants, select race winners, and perform other administrative functions within the HAPPY RUNNER 42K marathon management system.</p> <p>For information about participant registration, see Participant Registration Flow. For details about how organizer accounts authenticate, see Login System. For an overview of all admin interfaces, see Admin Interfaces.</p> <p>Sources: views/register.ejs L1-L72</p> <p>public/css/register.css L1-L179</p>"},{"location":"Organizer-Registration/#access-control","title":"Access Control","text":"<p>The organizer registration interface is protected by the <code>verifyAdmin</code> middleware, ensuring that only authenticated administrators can create new organizer accounts. This prevents unauthorized account creation and maintains the integrity of the admin user base.</p> Aspect Implementation Route Protection <code>verifyAdmin</code> middleware guard User Role Required <code>rol === \"admin\"</code> in session Access Denial Behavior Redirect to <code>/authadmin</code> or <code>/loginadmin</code> Session Validation JWT token verification via <code>process.env.JWT_SECRET</code> <p>The registration form is rendered at the <code>/register</code> route (GET) and processes submissions at the same route (POST), both protected by admin authentication.</p> <p>Sources: High-level architecture diagrams, authentication flow context</p>"},{"location":"Organizer-Registration/#registration-interface","title":"Registration Interface","text":"<p>The organizer registration interface is implemented in <code>register.ejs</code> and styled by <code>register.css</code>. The page follows the same visual design language as other authentication pages (login.ejs, loginadmin.ejs), creating a cohesive user experience.</p>"},{"location":"Organizer-Registration/#page-structure","title":"Page Structure","text":"<pre><code>flowchart TD\n\nHead[\"partials/head.ejs&lt;br&gt;External libraries&lt;br&gt;(Bootstrap, Boxicons)\"]\nHeader[\"partials/header.ejs&lt;br&gt;Role-based navigation\"]\nMain[\"Main Content&lt;br&gt;(.auth-wrapper)\"]\nFormContainer[\"Form Container&lt;br&gt;(.login-container)\"]\nForm[\"Registration Form&lt;br&gt;(POST /register)\"]\nFooter[\"partials/footer.ejs\"]\n\nHead --&gt; Header\nHeader --&gt; Main\nMain --&gt; FormContainer\nFormContainer --&gt; Form\nForm --&gt; Footer</code></pre> <p>Sources: views/register.ejs L1-L72</p>"},{"location":"Organizer-Registration/#layout-components","title":"Layout Components","text":"<p>The page uses the standard partial inclusion pattern:</p> Component Purpose Location <code>partials/head</code> Loads Bootstrap, Boxicons, Montserrat font views/register.ejs L1 <code>partials/header</code> Displays role-based navigation views/register.ejs L8 <code>.auth-wrapper</code> Centers form vertically and horizontally views/register.ejs L10 <code>.login-container</code> Form container with styling views/register.ejs L11 <code>partials/footer</code> Footer with branding views/register.ejs L70 <p>The <code>.auth-wrapper</code> uses flexbox to center the form both horizontally and vertically, with <code>min-height: calc(100vh - 150px)</code> accounting for header and footer space public/css/register.css L28-L34</p> <p>Sources: views/register.ejs L1-L10</p> <p>public/css/register.css L28-L46</p>"},{"location":"Organizer-Registration/#form-fields-and-validation","title":"Form Fields and Validation","text":"<p>The registration form collects three fields to create a new organizer account. The form uses <code>novalidate</code> to bypass browser validation in favor of server-side validation with <code>express-validator</code> views/register.ejs L15</p>"},{"location":"Organizer-Registration/#field-schema","title":"Field Schema","text":"Field Name Input Type HTML <code>name</code> Placeholder Required Description Usuario <code>text</code> <code>user</code> \"Ingrese su usuario\" Yes Unique username for login Nombre <code>text</code> <code>nombre</code> \"Ingrese su nombre\" Yes Display name for the organizer Contrase\u00f1a <code>password</code> <code>password</code> \"Ingrese su contrase\u00f1a\" Yes Password (stored as bcrypt hash) <p>Sources: views/register.ejs L15-L28</p>"},{"location":"Organizer-Registration/#form-persistence","title":"Form Persistence","text":"<p>The form implements value persistence on validation failure. When server-side validation fails, the form re-renders with previously submitted values pre-populated using the <code>valores</code> object:</p> <pre><code>value=\"&lt;% if (typeof valores !== 'undefined') { %&gt;&lt;%= valores.user %&gt;&lt;% } %&gt;\"\n</code></pre> <p>This pattern is applied to all three input fields views/register.ejs L18</p> <p>views/register.ejs L22</p> <p>views/register.ejs L26</p> <p>preventing users from re-entering information after validation errors.</p> <p>Sources: views/register.ejs L16-L26</p>"},{"location":"Organizer-Registration/#validation-error-display","title":"Validation Error Display","text":"<p>Server-side validation errors from <code>express-validator</code> are displayed below the form using the <code>validaciones</code> array. Each validation error appears in a styled <code>.form-alert</code> container:</p> <pre><code>&lt;% if (typeof validaciones !== 'undefined') { %&gt;\n  &lt;div class=\"validation-list\" aria-live=\"polite\"&gt;\n    &lt;% validaciones.forEach(v =&gt; { %&gt;\n      &lt;div class=\"form-alert\"&gt;&lt;strong&gt;&lt;%= v.msg %&gt;&lt;/strong&gt;&lt;/div&gt;\n    &lt;% }) %&gt;\n  &lt;/div&gt;\n&lt;% } %&gt;\n</code></pre> <p>The validation display includes ARIA live region attributes for accessibility views/register.ejs L30-L37</p> <p>Sources: views/register.ejs L30-L38</p> <p>public/css/register.css L115-L125</p>"},{"location":"Organizer-Registration/#request-flow-and-data-processing","title":"Request Flow and Data Processing","text":"<p>The following diagram illustrates the complete flow from form submission to database persistence and user feedback.</p>"},{"location":"Organizer-Registration/#registration-process-flow","title":"Registration Process Flow","text":"<pre><code>sequenceDiagram\n  participant Browser\n  participant Express Server\n  participant verifyAdmin\n  participant Middleware\n  participant /register\n  participant Route Handler\n  participant express-validator\n  participant bcrypt\n  participant organizadores\n  participant Table\n\n  Browser-&gt;&gt;Express Server: \"GET /register\"\n  Express Server-&gt;&gt;verifyAdmin: \"Check admin session\"\n  loop [\"Not Admin\"]\n    verifyAdmin--&gt;&gt;Browser: \"Redirect /authadmin\"\n    verifyAdmin-&gt;&gt;/register: \"Proceed\"\n    /register--&gt;&gt;Browser: \"Render register.ejs\"\n    Browser-&gt;&gt;Express Server: \"POST /register\n    Express Server-&gt;&gt;verifyAdmin: (user, nombre, password)\"\n    verifyAdmin-&gt;&gt;express-validator: \"Verify admin token\"\n    express-validator-&gt;&gt;/register: \"Validate fields\"\n    /register--&gt;&gt;Browser: \"validaciones array\"\n    express-validator-&gt;&gt;/register: \"Re-render with errors\n    /register-&gt;&gt;organizadores: (valores, validaciones)\"\n    organizadores--&gt;&gt;/register: \"Fields valid\"\n    /register--&gt;&gt;Browser: \"SELECT user=?\"\n    organizadores--&gt;&gt;/register: \"Duplicate found\"\n    /register-&gt;&gt;bcrypt: \"SweetAlert error\n    bcrypt--&gt;&gt;/register: (alert object)\"\n    /register-&gt;&gt;organizadores: \"No duplicate\"\n    organizadores--&gt;&gt;/register: \"Hash password\"\n    /register--&gt;&gt;Browser: \"Hashed password\"\n  end</code></pre> <p>Sources: views/register.ejs L15-L67</p> <p>authentication flow context</p>"},{"location":"Organizer-Registration/#database-operations","title":"Database Operations","text":"<p>The registration process interacts with the <code>organizadores</code> table:</p> Operation SQL Pattern Purpose Duplicate Check <code>SELECT * FROM organizadores WHERE user = ?</code> Prevent duplicate usernames Insert Record <code>INSERT INTO organizadores (user, nombre, password) VALUES (?, ?, ?)</code> Create new organizer account Password Storage Bcrypt hash (not plaintext) Secure password storage <p>Sources: Database layer context from high-level diagrams</p>"},{"location":"Organizer-Registration/#visual-design-system","title":"Visual Design System","text":"<p>The registration page follows the application's established design system, utilizing CSS custom properties defined at the root level.</p>"},{"location":"Organizer-Registration/#color-palette","title":"Color Palette","text":"<pre><code>:root {\n  --lapis-lazuli: #2f6690ff;\n  --cerulean:     #3a7ca5ff;\n  --platinum:     #d9dcd6ff;\n  --indigo-dye:   #16425bff;\n  --sky-blue:     #81c3d7ff;\n  --white: #ffffff;\n  --muted-shadow: rgba(22,66,91,0.08);\n}\n</code></pre> <p>These tokens ensure visual consistency across all authentication interfaces public/css/register.css L1-L9</p>"},{"location":"Organizer-Registration/#form-container-styling","title":"Form Container Styling","text":"CSS Class Purpose Key Properties <code>.auth-wrapper</code> Vertical/horizontal centering <code>display: flex; align-items: center; justify-content: center</code> <code>.login-container</code> Form card container <code>max-width: 420px; border-radius: 14px; box-shadow: 0 10px 30px</code> <code>.cta-btn</code> Submit button <code>background: linear-gradient(90deg, var(--lapis-lazuli), var(--cerulean))</code> <p>The <code>.login-container</code> class is reused from the login interfaces, maintaining visual consistency public/css/register.css L37-L46</p> <p>Sources: public/css/register.css L1-L109</p>"},{"location":"Organizer-Registration/#input-interaction-states","title":"Input Interaction States","text":"<p>Input fields feature enhanced interaction feedback:</p> <pre><code>.login-container input:focus {\n  border-color: var(--cerulean);\n  box-shadow: 0 8px 22px rgba(58,124,165,0.10);\n  transform: translateY(-1px);\n}\n</code></pre> <p>The focus state includes border color change, shadow elevation, and subtle upward translation public/css/register.css L87-L91</p>"},{"location":"Organizer-Registration/#responsive-behavior","title":"Responsive Behavior","text":"<p>The interface adapts for mobile devices at the 480px breakpoint:</p> Element Desktop Mobile (&lt;480px) <code>.auth-wrapper</code> padding <code>48px 16px</code> <code>28px 12px</code> <code>.login-container</code> max-width <code>420px</code> <code>360px</code> <code>.login-container</code> padding <code>28px 22px</code> <code>20px 14px</code> Title font size <code>1.4rem</code> <code>1.2rem</code> <p>Sources: public/css/register.css L160-L166</p>"},{"location":"Organizer-Registration/#success-and-error-feedback","title":"Success and Error Feedback","text":"<p>The registration process uses SweetAlert2 for user feedback, providing visual confirmation of success or detailed error messages.</p>"},{"location":"Organizer-Registration/#alert-configuration","title":"Alert Configuration","text":"<pre><code>flowchart TD\n\nServerResponse[\"Server Response\"]\nAlertObject[\"alert object&lt;br&gt;(alertTitle, alertMessage,&lt;br&gt;alertIcon, timer, ruta)\"]\nSweetAlert[\"Swal.fire()\"]\nRedirect[\"window.location&lt;br&gt;redirect\"]\n\nServerResponse --&gt; AlertObject\nAlertObject --&gt; SweetAlert\nSweetAlert --&gt; Redirect</code></pre> <p>Sources: views/register.ejs L44-L67</p>"},{"location":"Organizer-Registration/#alert-object-structure","title":"Alert Object Structure","text":"<p>The server passes an <code>alert</code> object to the view when rendering feedback:</p> Property Purpose Example Values <code>alert</code> Boolean flag <code>true</code> (show alert), <code>undefined</code> (no alert) <code>alertTitle</code> Alert heading \"REGISTRO EXITOSO\", \"ERROR\" <code>alertMessage</code> Detailed message \"El usuario ya existe\" <code>alertIcon</code> SweetAlert icon type \"success\", \"error\", \"warning\" <code>timer</code> Auto-close timer (ms) <code>3000</code>, <code>false</code> <code>showConfirmButton</code> Display confirm button <code>true</code>, <code>false</code> <code>ruta</code> Redirect path after alert <code>\"admin\"</code>, <code>\"register\"</code> <p>Sources: views/register.ejs L44-L67</p>"},{"location":"Organizer-Registration/#alert-styling-customization","title":"Alert Styling Customization","text":"<p>SweetAlert2 popups are customized to match the application's color scheme:</p> <pre><code>Swal.fire({\n  background: 'linear-gradient(135deg, #2f6690ff, #3a7ca5ff)', // lapis-lazuli to cerulean\n  color: '#ffffff',\n  iconColor: '#81c3d7ff', // sky-blue\n  confirmButtonColor: '#16425bff', // indigo-dye\n  customClass: {\n    popup: 'swal2-border-rounded',\n    title: 'swal2-title-custom',\n    content: 'swal2-content-custom'\n  }\n})\n</code></pre> <p>Custom CSS classes provide additional styling public/css/register.css L128-L157</p> <p>including rounded borders, custom font families, and shadow effects.</p> <p>Sources: views/register.ejs L46-L62</p> <p>public/css/register.css L140-L156</p>"},{"location":"Organizer-Registration/#post-alert-navigation","title":"Post-Alert Navigation","text":"<p>After the alert closes (either automatically via timer or user confirmation), the page redirects to the specified <code>ruta</code>:</p> <pre><code>.then(() =&gt; {\n  window.location = '/&lt;%= ruta %&gt;';\n});\n</code></pre> <p>Successful registrations typically redirect to <code>/admin</code>, while errors may remain on <code>/register</code> views/register.ejs L63-L65</p> <p>Sources: views/register.ejs L63-L65</p>"},{"location":"Organizer-Registration/#typography-and-fonts","title":"Typography and Fonts","text":"<p>The registration page explicitly loads the Montserrat font family from Google Fonts:</p> <pre><code>&lt;link href=\"https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&amp;display=swap\" rel=\"stylesheet\"&gt;\n</code></pre> <p>Font weights used:</p> <ul> <li>400: Regular body text</li> <li>600: Labels and helper text</li> <li>800: Headings and button text</li> </ul> <p>The Montserrat font is applied globally to the <code>body</code> element with fallbacks: <code>\"Montserrat\", system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial</code> public/css/register.css L16</p> <p>Sources: views/register.ejs L4</p> <p>public/css/register.css L14-L22</p>"},{"location":"Organizer-Registration/#integration-with-shared-components","title":"Integration with Shared Components","text":"<p>The registration page integrates with the application's shared partial system, ensuring consistent navigation and layout.</p>"},{"location":"Organizer-Registration/#component-diagram","title":"Component Diagram","text":"<pre><code>flowchart TD\n\nRegisterPage[\"register.ejs\"]\nHead[\"partials/head.ejs&lt;br&gt;Bootstrap, Leaflet,&lt;br&gt;Font Awesome, Boxicons\"]\nHeader[\"partials/header.ejs&lt;br&gt;Role-based nav&lt;br&gt;(admin menu items)\"]\nFooter[\"partials/footer.ejs&lt;br&gt;Branding + links\"]\nRegisterCSS[\"register.css&lt;br&gt;Page-specific styling\"]\nMontserratFont[\"Montserrat font&lt;br&gt;(Google Fonts)\"]\nBoxiconsCSS[\"Boxicons CSS&lt;br&gt;(unpkg CDN)\"]\nSweetAlert2[\"SweetAlert2 library&lt;br&gt;(CDN)\"]\nSessionRole[\"req.session.rol\"]\n\nRegisterPage --&gt; Head\nRegisterPage --&gt; Header\nRegisterPage --&gt; Footer\nRegisterPage --&gt; RegisterCSS\nRegisterPage --&gt; MontserratFont\nRegisterPage --&gt; BoxiconsCSS\nRegisterPage --&gt; SweetAlert2\nHeader --&gt; SessionRole</code></pre> <p>Sources: views/register.ejs L1-L72</p>"},{"location":"Organizer-Registration/#header-navigation-context","title":"Header Navigation Context","text":"<p>The <code>header.ejs</code> partial adjusts navigation items based on <code>res.locals.rol</code>, which is populated from <code>req.session.rol</code>. For admin users accessing <code>/register</code>, the header displays admin-appropriate navigation options (participant management, winner management, logout).</p> <p>Sources: views/register.ejs L8</p> <p>header component context</p>"},{"location":"Organizer-Registration/#security-considerations","title":"Security Considerations","text":""},{"location":"Organizer-Registration/#authentication-layer","title":"Authentication Layer","text":"<ul> <li>Pre-condition: User must be authenticated as admin before accessing <code>/register</code> routes</li> <li>Middleware: <code>verifyAdmin</code> validates JWT token from cookies</li> <li>Session validation: Checks <code>req.session.rol === \"admin\"</code></li> <li>Token source: <code>JWT_SECRET</code> environment variable</li> </ul>"},{"location":"Organizer-Registration/#password-security","title":"Password Security","text":"<ul> <li>Hashing algorithm: bcrypt</li> <li>Storage: Password hashes stored in <code>organizadores.password</code> column</li> <li>Plain text: Never stored or transmitted after form submission</li> </ul>"},{"location":"Organizer-Registration/#duplicate-prevention","title":"Duplicate Prevention","text":"<p>The route handler queries the database before insertion to prevent duplicate usernames:</p> <pre><code>SELECT * FROM organizadores WHERE user = ?\n</code></pre> <p>If a match is found, the registration is rejected with an error alert.</p> <p>Sources: Authentication flow context, database operations from high-level diagrams</p>"},{"location":"Organizer-Registration/#file-structure-summary","title":"File Structure Summary","text":"File Purpose Lines of Code <code>views/register.ejs</code> Registration form template 72 <code>public/css/register.css</code> Page-specific styling 179 <p>Both files work together to provide the complete organizer registration experience, from visual presentation to form submission and feedback handling.</p> <p>Sources: views/register.ejs L1-L72</p> <p>public/css/register.css L1-L179</p>"},{"location":"Overview/","title":"Overview","text":"<p>Relevant source files * app.js * views/index.ejs * views/partials/header.ejs</p>"},{"location":"Overview/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document provides a high-level overview of the HAPPY RUNNER 42K marathon management application. It introduces the system's purpose, technology stack, architectural organization, and core user roles. For detailed information about specific subsystems, see the following related pages:</p> <ul> <li>Authentication mechanisms: Authentication &amp; Authorization</li> <li>User interface components: User Interfaces</li> <li>Data handling and storage: Data Management</li> <li>Application server configuration: Application Server</li> </ul>"},{"location":"Overview/#system-purpose","title":"System Purpose","text":"<p>HAPPY RUNNER 42K is a web-based marathon event management system designed to handle participant registration and administrative operations for a 42-kilometer running event in Barcelona. The system serves two distinct user populations:</p> <p>Participants can:</p> <ul> <li>Discover event information (date, location, race route)</li> <li>Register for the marathon with photo upload</li> <li>Manage their personal profile and registration data</li> <li>View event details and winner announcements</li> </ul> <p>Administrators can:</p> <ul> <li>View and manage all participant registrations</li> <li>Edit or delete participant records</li> <li>Select and announce race winners (1st, 2nd, 3rd place)</li> <li>Register additional organizer accounts</li> <li>Upload winner-specific photos</li> </ul> <p>The application implements role-based access control to enforce separation between public content, participant-only features, and administrator-only operations.</p> <p>Sources: app.js L1-L47</p> <p>views/partials/header.ejs L1-L33</p> <p>views/index.ejs L1-L119</p>"},{"location":"Overview/#technology-stack","title":"Technology Stack","text":"<p>The application is built using the following core technologies and dependencies:</p> Category Technology Purpose Runtime Node.js Server-side JavaScript execution Web Framework Express.js HTTP server and routing Template Engine EJS Server-side HTML rendering Database MySQL Relational data storage Session Management <code>cookie-session</code> Stateless encrypted cookies Authentication JWT (JSON Web Tokens) Token-based authentication Password Security <code>bcryptjs</code> Password hashing and comparison File Upload <code>multer</code> Multipart form data handling Frontend Framework Bootstrap 5 Responsive UI components Mapping Leaflet.js Interactive race route maps Icons Font Awesome, Boxicons UI iconography <p>Sources: app.js L1-L11</p>"},{"location":"Overview/#application-structure","title":"Application Structure","text":""},{"location":"Overview/#system-component-map","title":"System Component Map","text":"<p>The following diagram shows the primary components of the system and their relationships, using actual file paths and code entities from the codebase:</p> <pre><code>flowchart TD\n\nAppJS[\"app.js&lt;br&gt;(Express server)\"]\nIndexRouter[\"/src/routers/index.js\"]\nAuthRouter[\"/src/routers/auth.js\"]\nParticipanteRouter[\"/src/routers/participante.js\"]\nAdminRouter[\"/src/routers/admin.js\"]\nGanadoresRouter[\"/src/routers/ganadores.js\"]\nVerifyToken[\"verifyToken&lt;br&gt;(JWT validation)\"]\nVerifyAdmin[\"verifyAdmin&lt;br&gt;(role check)\"]\nMulterUpload[\"multer&lt;br&gt;(file upload)\"]\nCookieSession[\"cookie-session&lt;br&gt;(session mgmt)\"]\nAuthController[\"authcontroller.js\"]\nUpdateController[\"updateParticipante.js\"]\nIndexEJS[\"views/index.ejs\"]\nLoginEJS[\"views/login.ejs\"]\nInscripcionEJS[\"views/inscripcion.ejs\"]\nPerfilEJS[\"views/perfil.ejs\"]\nAdminEJS[\"views/admin.ejs\"]\nInfoEJS[\"views/info.ejs\"]\nPartials[\"views/partials/&lt;br&gt;head, header, footer\"]\nCSS[\"public/css/*.css\"]\nImages[\"public/img/\"]\nUploads[\"public/uploads/participantes/\"]\nDB[\"MySQL Database&lt;br&gt;participantes&lt;br&gt;organizadores&lt;br&gt;ganadores\"]\n\nAppJS --&gt; IndexRouter\nAppJS --&gt; AuthRouter\nAppJS --&gt; ParticipanteRouter\nAppJS --&gt; AdminRouter\nAppJS --&gt; GanadoresRouter\nAppJS --&gt; CookieSession\nIndexRouter --&gt; IndexEJS\nIndexRouter --&gt; InfoEJS\nAuthRouter --&gt; AuthController\nAuthController --&gt; DB\nParticipanteRouter --&gt; VerifyToken\nParticipanteRouter --&gt; MulterUpload\nParticipanteRouter --&gt; UpdateController\nParticipanteRouter --&gt; InscripcionEJS\nParticipanteRouter --&gt; PerfilEJS\nAdminRouter --&gt; VerifyAdmin\nAdminRouter --&gt; AdminEJS\nGanadoresRouter --&gt; VerifyAdmin\nUpdateController --&gt; DB\nIndexEJS --&gt; CSS\nInscripcionEJS --&gt; CSS\nPerfilEJS --&gt; CSS\nAdminEJS --&gt; CSS\nIndexEJS --&gt; Images\nMulterUpload --&gt; Uploads\n\nsubgraph subGraph6 [\"Data Layer\"]\n    DB\nend\n\nsubgraph subGraph5 [\"Static Assets\"]\n    CSS\n    Images\n    Uploads\nend\n\nsubgraph Views [\"Views\"]\n    IndexEJS\n    LoginEJS\n    InscripcionEJS\n    PerfilEJS\n    AdminEJS\n    InfoEJS\n    Partials\n    IndexEJS --&gt; Partials\n    LoginEJS --&gt; Partials\n    InscripcionEJS --&gt; Partials\n    PerfilEJS --&gt; Partials\n    AdminEJS --&gt; Partials\n    InfoEJS --&gt; Partials\nend\n\nsubgraph Controllers [\"Controllers\"]\n    AuthController\n    UpdateController\nend\n\nsubgraph Middleware [\"Middleware\"]\n    VerifyToken\n    VerifyAdmin\n    MulterUpload\n    CookieSession\nend\n\nsubgraph subGraph1 [\"Routing Layer\"]\n    IndexRouter\n    AuthRouter\n    ParticipanteRouter\n    AdminRouter\n    GanadoresRouter\nend\n\nsubgraph subGraph0 [\"Entry Point\"]\n    AppJS\nend</code></pre> <p>The system follows a layered architecture where app.js L1-L47</p> <p>serves as the central entry point, delegating to five specialized router modules. Each router handles a specific domain:</p> <ul> <li>index.js: Public pages (landing, event info)</li> <li>auth.js: Authentication endpoints (login, logout)</li> <li>participante.js: Participant operations (registration, profile editing)</li> <li>admin.js: Administrator operations (participant management)</li> <li>ganadores.js: Winner management operations</li> </ul> <p>Sources: app.js L40-L44</p>"},{"location":"Overview/#core-user-roles-and-access-patterns","title":"Core User Roles and Access Patterns","text":""},{"location":"Overview/#role-based-route-mapping","title":"Role-Based Route Mapping","text":"<p>The following diagram illustrates how user roles map to specific routes, middleware guards, and views:</p> <pre><code>flowchart TD\n\nPublic[\"Unauthenticated&lt;br&gt;Users\"]\nParticipant[\"Authenticated&lt;br&gt;rol='participante'\"]\nAdmin[\"Authenticated&lt;br&gt;rol='admin'\"]\nRouteIndex[\"GET /&lt;br&gt;(index.ejs)\"]\nRouteInfo[\"GET /info&lt;br&gt;(info.ejs)\"]\nRouteInscripcion[\"GET /inscripcion&lt;br&gt;(inscripcion.ejs)\"]\nRouteLogin[\"GET /login&lt;br&gt;(login.ejs)\"]\nRouteLoginAdmin[\"GET /loginadmin&lt;br&gt;(loginadmin.ejs)\"]\nRoutePerfil[\"GET /perfil&lt;br&gt;(perfil.ejs)&lt;br&gt;via verifyToken\"]\nRouteEdit[\"GET /edit&lt;br&gt;(edit.ejs)&lt;br&gt;via verifyToken\"]\nRouteUpdate[\"POST /update&lt;br&gt;via updateParticipante\"]\nRouteAdmin[\"GET /admin&lt;br&gt;(admin.ejs)&lt;br&gt;via verifyAdmin\"]\nRouteEditAdmin[\"GET /editadmin/:id&lt;br&gt;via verifyAdmin\"]\nRouteDelete[\"GET /delete/:id&lt;br&gt;via verifyAdmin\"]\nRouteRegister[\"GET /register&lt;br&gt;(register.ejs)&lt;br&gt;via verifyAdmin\"]\nRouteGanadores[\"ganadores routes&lt;br&gt;via verifyAdmin\"]\n\nPublic --&gt; RouteIndex\nPublic --&gt; RouteInfo\nPublic --&gt; RouteInscripcion\nPublic --&gt; RouteLogin\nPublic --&gt; RouteLoginAdmin\nParticipant --&gt; RoutePerfil\nParticipant --&gt; RouteEdit\nParticipant --&gt; RouteUpdate\nAdmin --&gt; RouteAdmin\nAdmin --&gt; RouteEditAdmin\nAdmin --&gt; RouteDelete\nAdmin --&gt; RouteRegister\nAdmin --&gt; RouteGanadores\n\nsubgraph subGraph5 [\"Admin Routes\"]\n    RouteAdmin\n    RouteEditAdmin\n    RouteDelete\n    RouteRegister\n    RouteGanadores\nend\n\nsubgraph subGraph4 [\"Participant Routes\"]\n    RoutePerfil\n    RouteEdit\n    RouteUpdate\nend\n\nsubgraph subGraph3 [\"Public Routes\"]\n    RouteIndex\n    RouteInfo\n    RouteInscripcion\n    RouteLogin\n    RouteLoginAdmin\nend\n\nsubgraph subGraph2 [\"Admin Role\"]\n    Admin\nend\n\nsubgraph subGraph1 [\"Participant Role\"]\n    Participant\nend\n\nsubgraph subGraph0 [\"Public Access\"]\n    Public\nend</code></pre>"},{"location":"Overview/#role-determination","title":"Role Determination","text":"<p>User roles are established during the authentication process and stored in the session:</p> <ol> <li>Unauthenticated users access public routes without restriction</li> <li>Participants authenticate via <code>POST /auth</code> with DNI credentials, receiving <code>rol='participante'</code> in session</li> <li>Administrators authenticate via <code>POST /authadmin</code> with username credentials, receiving <code>rol='admin'</code> in session</li> </ol> <p>The session data is made globally available to all views through middleware in app.js L22-L26</p> <p>which populates <code>res.locals.user</code> and <code>res.locals.rol</code>. This enables the header navigation in views/partials/header.ejs L18-L30</p> <p>to dynamically display role-appropriate menu items:</p> <ul> <li>Lines 18-21: Unauthenticated users see registration, participant login, and admin login</li> <li>Lines 22-24: Participants see profile link and logout</li> <li>Lines 25-29: Admins see organizer registration, admin panel, winner management, and logout</li> </ul> <p>Sources: app.js L22-L26</p> <p>views/partials/header.ejs L18-L30</p>"},{"location":"Overview/#request-lifecycle-overview","title":"Request Lifecycle Overview","text":""},{"location":"Overview/#typical-request-flow","title":"Typical Request Flow","text":"<pre><code>sequenceDiagram\n  participant Browser\n  participant app.js\n  participant cookie-session\n  participant verifyToken/\n  participant verifyAdmin\n  participant Route Handler\n  participant EJS Template\n\n  Browser-&gt;&gt;app.js: \"HTTP Request\"\n  app.js-&gt;&gt;cookie-session: \"Process cookies\"\n  cookie-session-&gt;&gt;cookie-session: \"Decrypt session\n  cookie-session-&gt;&gt;app.js: (keys: 'clave_secreta')\"\n  app.js-&gt;&gt;app.js: \"req.session populated\"\n  loop [\"Unauthorized\"]\n    app.js-&gt;&gt;verifyToken/: \"res.locals.user = req.session.user\n    verifyToken/--&gt;&gt;Browser: res.locals.rol = req.session.rol\"\n    verifyToken/-&gt;&gt;Route Handler: \"Check authorization\"\n    app.js-&gt;&gt;Route Handler: \"Redirect to login\"\n  end\n  Route Handler-&gt;&gt;EJS Template: \"Continue\"\n  EJS Template-&gt;&gt;EJS Template: \"Direct routing\"\n  EJS Template--&gt;&gt;Browser: \"Render template\"</code></pre> <p>The request lifecycle follows these stages:</p> <ol> <li>Session Decryption: app.js L12-L16  configures <code>cookie-session</code> with a 24-hour <code>maxAge</code> and secret key <code>'clave_secreta'</code></li> <li>Local Variables Population: app.js L22-L26  extracts session data into <code>res.locals</code> for view access</li> <li>Authorization Check: Protected routes pass through <code>verifyToken</code> or <code>verifyAdmin</code> middleware</li> <li>Route Handling: Request reaches the appropriate router module</li> <li>View Rendering: EJS templates render with access to session data via <code>user</code> and <code>rol</code> variables</li> </ol> <p>Sources: app.js L12-L26</p>"},{"location":"Overview/#key-subsystems","title":"Key Subsystems","text":"<p>The application is organized into several interconnected subsystems:</p> Subsystem Description Documentation Authentication Dual login system (DNI-based for participants, username-based for admins), JWT tokens, bcrypt password hashing Authentication &amp; Authorization Session Management Cookie-based sessions with 24-hour expiration, role storage Session Management Authorization Role-based access control via <code>verifyToken</code> and <code>verifyAdmin</code> middleware Role-Based Access Control Participant Registration Form handling, photo upload via multer, database insertion Registration Flow Profile Management View and edit participant data, update controller Profile Management Admin Panel Participant list with search, edit, and delete operations Admin Panel Winner Management Select winners from participant pool, upload winner photos Winner Management File Upload Multer-based photo upload with timestamp naming File Upload System View Rendering EJS templating with shared partials (head, header, footer) Shared Components Static Asset Serving CSS, images, and uploaded files via Express static middleware Application Server <p>Sources: app.js L1-L47</p> <p>views/partials/header.ejs L1-L33</p>"},{"location":"Overview/#directory-structure","title":"Directory Structure","text":"<pre><code>proyecto-node.js/\n\u251c\u2500\u2500 app.js                          # Express server entry point\n\u251c\u2500\u2500 env/\n\u2502   \u2514\u2500\u2500 .env                        # Environment variables (JWT_SECRET, DB config)\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 routers/\n\u2502   \u2502   \u251c\u2500\u2500 index.js                # Public routes (/, /info)\n\u2502   \u2502   \u251c\u2500\u2500 auth.js                 # Authentication routes\n\u2502   \u2502   \u251c\u2500\u2500 participante.js         # Participant routes (protected)\n\u2502   \u2502   \u251c\u2500\u2500 admin.js                # Admin routes (protected)\n\u2502   \u2502   \u2514\u2500\u2500 ganadores.js            # Winner management routes (protected)\n\u2502   \u251c\u2500\u2500 middlewares/\n\u2502   \u2502   \u251c\u2500\u2500 verifyToken.js          # JWT verification middleware\n\u2502   \u2502   \u2514\u2500\u2500 verifyAdmin.js          # Admin role verification middleware\n\u2502   \u2514\u2500\u2500 controllers/\n\u2502       \u251c\u2500\u2500 authcontroller.js       # Login/logout logic\n\u2502       \u2514\u2500\u2500 updateParticipante.js   # Update participant data\n\u251c\u2500\u2500 views/\n\u2502   \u251c\u2500\u2500 partials/\n\u2502   \u2502   \u251c\u2500\u2500 head.ejs                # HTML head with external libraries\n\u2502   \u2502   \u251c\u2500\u2500 header.ejs              # Navigation with role-based menu\n\u2502   \u2502   \u2514\u2500\u2500 footer.ejs              # Page footer\n\u2502   \u251c\u2500\u2500 index.ejs                   # Landing page\n\u2502   \u251c\u2500\u2500 info.ejs                    # Event info and winners\n\u2502   \u251c\u2500\u2500 inscripcion.ejs             # Registration form\n\u2502   \u251c\u2500\u2500 login.ejs                   # Participant login\n\u2502   \u251c\u2500\u2500 loginadmin.ejs              # Admin login\n\u2502   \u251c\u2500\u2500 perfil.ejs                  # Participant profile view\n\u2502   \u251c\u2500\u2500 edit.ejs                    # Participant profile edit\n\u2502   \u251c\u2500\u2500 admin.ejs                   # Admin participant management\n\u2502   \u2514\u2500\u2500 register.ejs                # Organizer registration\n\u251c\u2500\u2500 public/\n\u2502   \u251c\u2500\u2500 css/                        # Page-specific stylesheets\n\u2502   \u251c\u2500\u2500 img/                        # Static images\n\u2502   \u2514\u2500\u2500 uploads/\n\u2502       \u2514\u2500\u2500 participantes/          # Uploaded participant photos\n\u2514\u2500\u2500 package.json                    # Node.js dependencies\n</code></pre> <p>Sources: app.js L32-L44</p> <p>views/index.ejs L1</p> <p>views/partials/header.ejs L1</p>"},{"location":"Overview/#navigation-flow","title":"Navigation Flow","text":"<p>The following table summarizes the primary navigation paths through the application:</p> User Type Entry Point Available Actions Protected By Anonymous <code>GET /</code> (landing page) View event info, register, navigate to login None Registering Participant <code>GET /inscripcion</code> Fill form, upload photo, submit registration None Participant Login <code>GET /login</code> \u2192 <code>POST /auth</code> Enter DNI/password None Authenticated Participant <code>GET /perfil</code> View profile, edit data, logout <code>verifyToken</code> Admin Login <code>GET /loginadmin</code> \u2192 <code>POST /authadmin</code> Enter username/password None Authenticated Admin <code>GET /admin</code> View all participants, search, edit, delete, manage winners, register organizers <code>verifyAdmin</code> <p>Sources: views/partials/header.ejs L16-L30</p>"},{"location":"Overview/#external-dependencies","title":"External Dependencies","text":"<p>The application integrates several external services and libraries:</p>"},{"location":"Overview/#client-side-libraries","title":"Client-Side Libraries","text":"<p>Loaded via views/partials/head.ejs</p> <p>:</p> <ul> <li>Bootstrap 5.3.0: CSS framework for responsive design</li> <li>Leaflet.js: Interactive maps for displaying race routes</li> <li>Font Awesome 6.4.0: Icon library for UI elements</li> <li>Boxicons 2.1.4: Additional icon set for navigation</li> </ul>"},{"location":"Overview/#server-side-packages","title":"Server-Side Packages","text":"<p>Key dependencies from <code>package.json</code>:</p> <ul> <li>express: Web application framework</li> <li>ejs: Embedded JavaScript templating</li> <li>mysql: Database driver for MySQL connections</li> <li>bcryptjs: Password hashing and verification</li> <li>jsonwebtoken: JWT creation and verification</li> <li>cookie-session: Session management via encrypted cookies</li> <li>cookie-parser: Cookie parsing middleware</li> <li>multer: File upload handling</li> <li>dotenv: Environment variable management</li> </ul> <p>Sources: app.js L1-L11</p>"},{"location":"Overview/#database-schema-overview","title":"Database Schema Overview","text":"<p>The application uses three primary MySQL tables:</p> Table Purpose Key Fields participantes Store registered participants <code>id</code>, <code>nombre</code>, <code>apellido</code>, <code>dni</code>, <code>telefono</code>, <code>direccion</code>, <code>foto</code> organizadores Store admin/organizer accounts <code>id</code>, <code>username</code>, <code>password</code> (bcrypt-hashed) ganadores Store race winners <code>id</code>, <code>position</code> (1st/2nd/3rd), <code>participant_id</code> (FK), <code>foto</code> <p>The <code>ganadores</code> table references <code>participantes</code> via foreign key, allowing admins to select winners from the existing participant pool. See Participant Data for detailed schema information.</p> <p>Sources: Based on authentication and data management flows described in architecture diagrams.</p>"},{"location":"Overview/#summary","title":"Summary","text":"<p>HAPPY RUNNER 42K is a full-stack web application that demonstrates:</p> <ul> <li>Clear separation of concerns through modular routing and middleware</li> <li>Role-based access control with session-based authentication</li> <li>File upload capabilities for participant and winner photos</li> <li>Responsive design using Bootstrap and custom CSS</li> <li>Interactive features including Leaflet maps for race route visualization</li> <li>Administrative tools for participant management and winner selection</li> </ul> <p>The system architecture prioritizes security through middleware guards, maintainability through modular code organization, and usability through role-specific interfaces. For detailed information on specific subsystems, consult the child pages listed in the table of contents.</p> <p>Sources: app.js L1-L47</p> <p>views/index.ejs L1-L119</p> <p>views/partials/header.ejs L1-L33</p>"},{"location":"Participant-Data/","title":"Participant Data","text":"<p>Relevant source files * controllers/updateParticipante.js * views/admin.ejs</p>"},{"location":"Participant-Data/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document describes the structure, storage, and manipulation of participant data in the HAPPY RUNNER 42K application. It covers the database schema for the <code>participantes</code> table, CRUD operations for participant records, and the <code>updateParticipante.js</code> controller responsible for data modifications.</p> <p>For information about participant photo storage and file upload mechanics, see File Upload System. For details on how participant data is initially captured during registration, see Registration Flow. For information on participant self-service interfaces, see Profile Management. For information on administrative participant management, see Admin Panel.</p>"},{"location":"Participant-Data/#data-structure","title":"Data Structure","text":"<p>The <code>participantes</code> table stores all registered participant information. Each participant record contains identification data, contact information, and address details.</p>"},{"location":"Participant-Data/#database-schema","title":"Database Schema","text":"<p>The following table describes the fields stored in the <code>participantes</code> table:</p> Field Type Purpose Notes <code>id</code> Integer (PK) Unique participant identifier Auto-incrementing primary key; serves as dorsal number <code>nombre</code> String First name Required field <code>apellido</code> String Last name Required field <code>dni</code> String National ID number Unique identifier used for login authentication <code>telefono</code> String Phone number Contact information <code>calle</code> String Street name Address component <code>numero</code> String Street number Address component <code>poblacion</code> String City/Town Address component <code>codigo_postal</code> String Postal code Address component <code>foto</code> String Photo filename File path to participant photo in <code>public/uploads/participantes/</code> <p>Sources: views/admin.ejs L26-L49</p> <p>controllers/updateParticipante.js L5-L9</p>"},{"location":"Participant-Data/#participant-data-entity-model","title":"Participant Data Entity Model","text":"<pre><code>#mermaid-unausykavsk{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-unausykavsk .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-unausykavsk .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-unausykavsk .error-icon{fill:#dddddd;}#mermaid-unausykavsk .error-text{fill:#222222;stroke:#222222;}#mermaid-unausykavsk .edge-thickness-normal{stroke-width:1px;}#mermaid-unausykavsk .edge-thickness-thick{stroke-width:3.5px;}#mermaid-unausykavsk .edge-pattern-solid{stroke-dasharray:0;}#mermaid-unausykavsk .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-unausykavsk .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-unausykavsk .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-unausykavsk .marker{fill:#999;stroke:#999;}#mermaid-unausykavsk .marker.cross{stroke:#999;}#mermaid-unausykavsk svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-unausykavsk p{margin:0;}#mermaid-unausykavsk .entityBox{fill:#ffffff;stroke:#dddddd;}#mermaid-unausykavsk .relationshipLabelBox{fill:#dddddd;opacity:0.7;background-color:#dddddd;}#mermaid-unausykavsk .relationshipLabelBox rect{opacity:0.5;}#mermaid-unausykavsk .labelBkg{background-color:rgba(221, 221, 221, 0.5);}#mermaid-unausykavsk .edgeLabel .label{fill:#dddddd;font-size:14px;}#mermaid-unausykavsk .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#333;}#mermaid-unausykavsk .edge-pattern-dashed{stroke-dasharray:8,8;}#mermaid-unausykavsk .node rect,#mermaid-unausykavsk .node circle,#mermaid-unausykavsk .node ellipse,#mermaid-unausykavsk .node polygon{fill:#ffffff;stroke:#dddddd;stroke-width:1px;}#mermaid-unausykavsk .relationshipLine{stroke:#999;stroke-width:1;fill:none;}#mermaid-unausykavsk .marker{fill:none!important;stroke:#999!important;stroke-width:1;}#mermaid-unausykavsk :root{--mermaid-font-family:\"trebuchet ms\",verdana,arial,sans-serif;}can_becomeparticipantesintidPKAuto-increment dorsal numberstringnombreFirst namestringapellidoLast namestringdniUKUnique login credentialstringtelefonoContact phonestringcalleStreet namestringnumeroStreet numberstringpoblacionCity/Townstringcodigo_postalPostal codestringfotoPhoto filename pathganadoresintidPKstringposition1st/2nd/3rdintparticipant_idFKstringfotoWinner photo path\n</code></pre> <p>Diagram: Participant Entity Relationship</p> <p>The <code>participantes</code> table serves as the primary registry for all race participants. The <code>id</code> field doubles as the participant's dorsal/bib number for the race. The <code>dni</code> field is used as the unique login credential for participant authentication. The <code>foto</code> field stores the filename (not full path) of the uploaded participant photo. Participants can optionally be designated as winners, creating a relationship with the <code>ganadores</code> table.</p> <p>Sources: views/admin.ejs L26-L49</p>"},{"location":"Participant-Data/#crud-operations","title":"CRUD Operations","text":"<p>Participant data undergoes four primary operations throughout its lifecycle: creation during registration, retrieval for display, modification through profile editing or admin actions, and deletion by administrators.</p>"},{"location":"Participant-Data/#crud-operation-flow","title":"CRUD Operation Flow","text":"<pre><code>flowchart TD\n\nRegistrationForm[\"inscripcion.ejs&lt;br&gt;Registration Form\"]\nRegistrationRoute[\"/inscripcion&lt;br&gt;POST route\"]\nInsertQuery[\"INSERT INTO participantes&lt;br&gt;(nombre, apellido, dni, telefono,&lt;br&gt;calle, numero, poblacion,&lt;br&gt;codigo_postal, foto)\"]\nProfileRoute[\"/perfil&lt;br&gt;GET route\"]\nAdminRoute[\"/admin&lt;br&gt;GET route\"]\nSelectQuery[\"SELECT * FROM participantes&lt;br&gt;WHERE id = ?\"]\nSelectAllQuery[\"SELECT * FROM participantes\"]\nProfileView[\"perfil.ejs&lt;br&gt;Display participant data\"]\nAdminView[\"admin.ejs&lt;br&gt;Display all participants\"]\nEditForm[\"edit.ejs&lt;br&gt;Edit Form\"]\nAdminEditForm[\"editadmin.ejs&lt;br&gt;Admin Edit Form\"]\nUpdateRoute[\"/updatepar&lt;br&gt;POST route\"]\nUpdateController[\"updateParticipante.js&lt;br&gt;update() function\"]\nUpdateQuery[\"UPDATE participantes&lt;br&gt;SET nombre=?, apellido=?, dni=?,&lt;br&gt;telefono=?, calle=?, numero=?,&lt;br&gt;poblacion=?, codigo_postal=?&lt;br&gt;WHERE id=?\"]\nDeleteRoute[\"/delete/:id&lt;br&gt;GET route\"]\nDeleteQuery[\"DELETE FROM participantes&lt;br&gt;WHERE id=?\"]\nParticipantesDB[\"participantes&lt;br&gt;table\"]\n\nInsertQuery --&gt; ParticipantesDB\nSelectQuery --&gt; ParticipantesDB\nSelectAllQuery --&gt; ParticipantesDB\nParticipantesDB --&gt; ProfileView\nParticipantesDB --&gt; AdminView\nUpdateQuery --&gt; ParticipantesDB\nDeleteQuery --&gt; ParticipantesDB\n\nsubgraph subGraph3 [\"Delete Operations\"]\n    DeleteRoute\n    DeleteQuery\n    DeleteRoute --&gt; DeleteQuery\nend\n\nsubgraph subGraph2 [\"Update Operations\"]\n    EditForm\n    AdminEditForm\n    UpdateRoute\n    UpdateController\n    UpdateQuery\n    EditForm --&gt; UpdateRoute\n    AdminEditForm --&gt; UpdateRoute\n    UpdateRoute --&gt; UpdateController\n    UpdateController --&gt; UpdateQuery\nend\n\nsubgraph subGraph1 [\"Read Operations\"]\n    ProfileRoute\n    AdminRoute\n    SelectQuery\n    SelectAllQuery\n    ProfileView\n    AdminView\n    ProfileRoute --&gt; SelectQuery\n    AdminRoute --&gt; SelectAllQuery\nend\n\nsubgraph subGraph0 [\"Create Operations\"]\n    RegistrationForm\n    RegistrationRoute\n    InsertQuery\n    RegistrationForm --&gt; RegistrationRoute\n    RegistrationRoute --&gt; InsertQuery\nend</code></pre> <p>Diagram: Participant Data CRUD Flow</p> <p>This diagram maps each CRUD operation to its specific route, view, and SQL query. Create operations occur through the <code>/inscripcion</code> POST route. Read operations happen via two routes: <code>/perfil</code> for individual participant data and <code>/admin</code> for all participants. Update operations funnel through the <code>updateParticipante.js</code> controller regardless of whether initiated by the participant or an administrator. Delete operations are accessible only via the <code>/delete/:id</code> route, which is restricted to administrators.</p> <p>Sources: controllers/updateParticipante.js L1-L19</p> <p>views/admin.ejs L51-L56</p>"},{"location":"Participant-Data/#create-registration","title":"Create: Registration","text":"<p>New participant records are created during the registration process. The registration form captures all required fields and submits them to the <code>/inscripcion</code> POST route, which executes an <code>INSERT</code> query. The photo field is populated by the multer middleware during the registration process.</p> <p>For detailed information about the registration flow and form validation, see Registration Flow. For photo upload mechanics, see File Upload System.</p>"},{"location":"Participant-Data/#read-data-retrieval","title":"Read: Data Retrieval","text":"<p>Participant data is retrieved in two primary contexts:</p> <ol> <li>Individual Profile View: The <code>/perfil</code> route executes a <code>SELECT</code> query filtered by the authenticated participant's <code>id</code> (stored in session). The query retrieves all fields for display in <code>perfil.ejs</code>.</li> <li>Admin Panel View: The <code>/admin</code> route executes a <code>SELECT * FROM participantes</code> query to retrieve all registered participants. The data is rendered in <code>admin.ejs</code> with a searchable table interface.</li> </ol> <p>The admin table displays all participant fields including the dorsal number (<code>id</code>), personal information (<code>nombre</code>, <code>apellido</code>, <code>dni</code>), contact details (<code>telefono</code>), and complete address breakdown (<code>calle</code>, <code>numero</code>, <code>poblacion</code>, <code>codigo_postal</code>).</p> <p>Sources: views/admin.ejs L38-L60</p>"},{"location":"Participant-Data/#update-data-modification","title":"Update: Data Modification","text":"<p>Participant data can be modified through two interfaces:</p> <ol> <li>Self-Service Editing: Participants edit their own data via <code>edit.ejs</code></li> <li>Administrative Editing: Administrators edit any participant's data via <code>editadmin.ejs</code></li> </ol> <p>Both interfaces submit to the same <code>/updatepar</code> POST route, which delegates to the <code>updateParticipante.js</code> controller.</p>"},{"location":"Participant-Data/#delete-record-removal","title":"Delete: Record Removal","text":"<p>Participant deletion is an administrative-only operation. The admin panel provides a delete button for each participant row at views/admin.ejs L54-L56</p> <p>Clicking the delete button triggers a confirmation dialog and navigates to <code>/delete/:id</code>, which removes the record from the database.</p> <p>Sources: views/admin.ejs L54-L56</p>"},{"location":"Participant-Data/#updateparticipante-controller","title":"updateParticipante Controller","text":"<p>The <code>updateParticipante.js</code> controller is responsible for processing participant data modifications. It receives form data, constructs an UPDATE query, and redirects to the profile page upon completion.</p>"},{"location":"Participant-Data/#controller-function-signature","title":"Controller Function Signature","text":"<pre><code>exports.update = (req, res) =&gt; { ... }\n</code></pre> <p>The <code>update</code> function is the sole export from <code>updateParticipante.js</code>. It accepts Express request and response objects.</p> <p>Sources: controllers/updateParticipante.js L4</p>"},{"location":"Participant-Data/#update-operation-sequence","title":"Update Operation Sequence","text":"<pre><code>sequenceDiagram\n  participant edit.ejs or\n  participant editadmin.ejs\n  participant /updatepar\n  participant POST route\n  participant updateParticipante.js\n  participant update()\n  participant MySQL Database\n  participant participantes table\n  participant Browser\n  participant Redirect\n\n  edit.ejs or-&gt;&gt;/updatepar: POST form data\n  /updatepar-&gt;&gt;updateParticipante.js: (id, nombre, apellido, dni,\n  updateParticipante.js-&gt;&gt;updateParticipante.js: telefono, calle, numero,\n  updateParticipante.js-&gt;&gt;MySQL Database: poblacion, codigo_postal)\n  loop [Update Success]\n    MySQL Database--&gt;&gt;updateParticipante.js: req.body with all fields\n    updateParticipante.js-&gt;&gt;updateParticipante.js: Extract fields from req.body\n    updateParticipante.js-&gt;&gt;Browser: UPDATE participantes\n    MySQL Database--&gt;&gt;updateParticipante.js: SET fields WHERE id=?\n    updateParticipante.js-&gt;&gt;updateParticipante.js: Query result\n    updateParticipante.js-&gt;&gt;Browser: console.log(\"Datos actualizados correctamente\")\n  end</code></pre> <p>Diagram: Update Operation Flow</p> <p>The update sequence begins when a user submits either the self-service edit form (<code>edit.ejs</code>) or admin edit form (<code>editadmin.ejs</code>). Both forms POST to <code>/updatepar</code>, passing all modifiable fields plus the participant <code>id</code>. The controller extracts these fields from <code>req.body</code> and constructs a parameterized SQL query. Regardless of success or failure, the controller redirects to <code>/perfil</code>, logging the outcome to the console.</p> <p>Sources: controllers/updateParticipante.js L1-L19</p>"},{"location":"Participant-Data/#implementation-details","title":"Implementation Details","text":"<p>The controller implements the following logic:</p> <ol> <li>Field Extraction: Destructures <code>id</code>, <code>nombre</code>, <code>apellido</code>, <code>dni</code>, <code>telefono</code>, <code>calle</code>, <code>numero</code>, <code>poblacion</code>, and <code>codigo_postal</code> from <code>req.body</code> at controllers/updateParticipante.js L5</li> <li>Parameterized Query: Constructs an UPDATE statement with positional placeholders (<code>?</code>) to prevent SQL injection at controllers/updateParticipante.js L7-L9</li> <li>Field Order: The query parameters are ordered: <code>nombre</code>, <code>apellido</code>, <code>dni</code>, <code>telefono</code>, <code>calle</code>, <code>numero</code>, <code>poblacion</code>, <code>codigo_postal</code>, <code>id</code> (WHERE clause)</li> <li>Error Handling: Catches database errors and logs them with <code>console.error</code> at controllers/updateParticipante.js L12</li> <li>Response: Always redirects to <code>/perfil</code> regardless of operation outcome at controllers/updateParticipante.js L13-L16</li> </ol>"},{"location":"Participant-Data/#notable-behavior","title":"Notable Behavior","text":"<ul> <li>Photo Field Exclusion: The <code>foto</code> field is not included in the UPDATE query, meaning participant photos cannot be changed after initial registration. Photo updates would require separate file upload handling.</li> <li>No Response Differentiation: Both successful updates and errors result in a redirect to <code>/perfil</code>. Users do not receive explicit feedback about operation success or failure in the interface.</li> <li>Unified Update Path: There is no distinction between participant self-updates and admin updates at the controller level. Both use the same function and SQL query.</li> </ul> <p>Sources: controllers/updateParticipante.js L5-L18</p>"},{"location":"Participant-Data/#data-access-patterns","title":"Data Access Patterns","text":"<p>The following table summarizes how different user roles access participant data:</p> Operation Role Route View Access Control View Own Profile Participant <code>GET /perfil</code> <code>perfil.ejs</code> <code>verifyToken</code> middleware Edit Own Profile Participant <code>GET /edit``POST /updatepar</code> <code>edit.ejs</code> <code>verifyToken</code> middleware View All Participants Admin <code>GET /admin</code> <code>admin.ejs</code> <code>verifyAdmin</code> middleware Edit Any Participant Admin <code>GET /editadmin/:id``POST /updatepar</code> <code>editadmin.ejs</code> <code>verifyAdmin</code> middleware Delete Participant Admin <code>GET /delete/:id</code> Redirect <code>verifyAdmin</code> middleware <p>Participants can only view and modify their own data. The system identifies \"their own data\" by matching the session's participant <code>id</code> with the database record. Administrators have full access to view, edit, and delete any participant record.</p> <p>For details on authentication and authorization mechanisms, see Role-Based Access Control.</p> <p>Sources: views/admin.ejs L51-L56</p>"},{"location":"Participant-Data/#search-and-filtering","title":"Search and Filtering","text":"<p>The admin panel implements client-side search functionality for participant data. The search input filters the participant table based on user input.</p>"},{"location":"Participant-Data/#client-side-search-implementation","title":"Client-Side Search Implementation","text":"<p>The search functionality is implemented in JavaScript embedded within <code>admin.ejs</code> at views/admin.ejs L67-L78</p> <p>Key components:</p> <ul> <li>Search Input: HTML input with <code>id=\"searchInput\"</code> at views/admin.ejs L18</li> <li>Target Table: tbody with <code>id=\"participantesTable\"</code> at views/admin.ejs L38</li> <li>Search Logic: Filters table rows by checking if any cell text includes the search term</li> </ul> <p>The search is case-insensitive and searches across all visible columns (dorsal number, name, surname, DNI, phone, and all address fields). Rows that don't match the search term are hidden using <code>row.style.display = 'none'</code>.</p>"},{"location":"Participant-Data/#participant-count-badge","title":"Participant Count Badge","text":"<p>The admin panel displays a total participant count badge at views/admin.ejs L19</p> <p>The count is calculated server-side using <code>&lt;%= participantes.length %&gt;</code>, showing the number of records returned by the database query. This count does not dynamically update as the client-side search filters rows.</p> <p>Sources: views/admin.ejs L18-L19</p> <p>views/admin.ejs L67-L78</p>"},{"location":"Participant-Data/#database-connection","title":"Database Connection","text":"<p>All participant data operations use the MySQL database connection configured in the <code>db</code> module. The <code>updateParticipante.js</code> controller imports this connection at controllers/updateParticipante.js L1</p> <p>:</p> <pre><code>const db = require(\"../config/db\");\n</code></pre> <p>The <code>db</code> object provides the <code>query()</code> method used to execute SQL statements. For comprehensive information about database configuration and connection management, see Database Layer.</p> <p>Sources: controllers/updateParticipante.js L1</p>"},{"location":"Participant-Interfaces/","title":"Participant Interfaces","text":"<p>Relevant source files * views/index.ejs * views/inscripcion.ejs * views/perfil.ejs</p>"},{"location":"Participant-Interfaces/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document provides an overview of all user interfaces accessible to marathon participants in the HAPPY RUNNER 42K application. These interfaces enable participants to discover the event, register for the race, log in, and manage their profiles. For authentication mechanisms, see Authentication &amp; Authorization. For detailed information about individual interfaces, see Landing Page, Registration Flow, and Profile Management. For administrator-only interfaces, see Admin Interfaces.</p>"},{"location":"Participant-Interfaces/#interface-overview","title":"Interface Overview","text":"<p>The participant experience consists of three primary interfaces accessed through distinct routes:</p> Interface Route View Template Authentication Required Primary Purpose Landing Page <code>/</code> <code>views/index.ejs</code> No Event discovery and information Registration Form <code>/inscripcion</code> <code>views/inscripcion.ejs</code> No Participant registration and photo upload Profile View <code>/perfil/:id</code> <code>views/perfil.ejs</code> Yes (<code>verifyToken</code>) Display participant data Profile Edit <code>/edit/:id</code> <code>views/edit.ejs</code> Yes (<code>verifyToken</code>) Update participant information <p>All participant interfaces follow a consistent template structure utilizing shared EJS partials defined in <code>views/partials/</code> and page-specific CSS files located in <code>public/resources/css/</code>.</p>"},{"location":"Participant-Interfaces/#navigation-flow-and-route-architecture","title":"Navigation Flow and Route Architecture","text":"<p>The following diagram maps the complete participant journey through the application, showing actual route paths, view templates, and the authentication boundary:</p> <pre><code>flowchart TD\n\nIndex[\"/&lt;br&gt;(index.ejs)\"]\nInscripcion[\"/inscripcion&lt;br&gt;(inscripcion.ejs)\"]\nLogin[\"/login&lt;br&gt;(login.ejs)\"]\nPerfil[\"/perfil/:id&lt;br&gt;(perfil.ejs)\"]\nEdit[\"/edit/:id&lt;br&gt;(edit.ejs)\"]\nIndexRouter[\"routes/index.js\"]\nParticipanteRouter[\"routes/participante.js\"]\nAuthRouter[\"routes/auth.js\"]\nVerifyToken[\"middleware/verifyToken\"]\n\nInscripcion --&gt; IndexRouter\nLogin --&gt; AuthRouter\nLogin --&gt; Perfil\nEdit --&gt; ParticipanteRouter\nVerifyToken --&gt; Perfil\nVerifyToken --&gt; Edit\n\nsubgraph subGraph1 [\"Protected Access\"]\n    Perfil\n    Edit\n    Perfil --&gt; Edit\n    Edit --&gt; Perfil\nend\n\nsubgraph subGraph0 [\"Public Access\"]\n    Index\n    Inscripcion\n    Login\n    Index --&gt; Inscripcion\n    Index --&gt; Login\nend</code></pre> <p>Sources: views/index.ejs L1-L118</p> <p>views/inscripcion.ejs L1-L161</p> <p>views/perfil.ejs L1-L33</p>"},{"location":"Participant-Interfaces/#authentication-boundary","title":"Authentication Boundary","text":"<p>Participant interfaces are divided into public and protected sections. The authentication enforcement mechanism uses middleware guards and session validation:</p> <pre><code>flowchart TD\n\nPublicRoutes[\"Public Routes&lt;br&gt;/, /inscripcion\"]\nLoginRoute[\"/login&lt;br&gt;POST /login\"]\nAuthController[\"authcontroller.js&lt;br&gt;validateCredentials()\"]\nSessionCreate[\"Set session:&lt;br&gt;req.session.user&lt;br&gt;req.session.rol='participante'\"]\nProtectedRoutes[\"Protected Routes&lt;br&gt;/perfil/:id&lt;br&gt;/edit/:id\"]\nVerifyTokenMiddleware[\"verifyToken.js&lt;br&gt;Checks JWT cookie\"]\nProfileAccess[\"Render perfil.ejs&lt;br&gt;or edit.ejs\"]\nRedirect[\"Redirect to&lt;br&gt;/loginadmin\"]\n\nPublicRoutes --&gt; LoginRoute\nLoginRoute --&gt; AuthController\nAuthController --&gt; SessionCreate\nSessionCreate --&gt; ProtectedRoutes\nProtectedRoutes --&gt; VerifyTokenMiddleware\nVerifyTokenMiddleware --&gt; ProfileAccess\nVerifyTokenMiddleware --&gt; Redirect</code></pre> <p>The <code>verifyToken</code> middleware middleware/verifyToken.js</p> <p>checks for a valid JWT token in cookies and validates the user session. Upon successful authentication via <code>/login</code>, the system sets <code>req.session.rol = 'participante'</code> which distinguishes participant access from admin access.</p> <p>Sources: app.js</p> <p>middleware/verifyToken.js</p> <p>routes/auth.js</p>"},{"location":"Participant-Interfaces/#template-composition-architecture","title":"Template Composition Architecture","text":"<p>All participant interfaces utilize a modular EJS template system with shared partials for consistent layout and functionality:</p> <pre><code>flowchart TD\n\nHeadPartial[\"partials/head.ejs&lt;br&gt;Bootstrap, Leaflet,&lt;br&gt;Font Awesome, Boxicons\"]\nHeaderPartial[\"partials/header.ejs&lt;br&gt;Role-based navigation&lt;br&gt;res.locals.rol\"]\nFooterPartial[\"partials/footer.ejs\"]\nIndexEJS[\"index.ejs\"]\nInscripcionEJS[\"inscripcion.ejs\"]\nPerfilEJS[\"perfil.ejs\"]\nEditEJS[\"edit.ejs\"]\nStyleCSS[\"style.css\"]\nInscripcionCSS[\"inscripcion.css\"]\nPerfilCSS[\"perfil.css\"]\nEditCSS[\"edit.css\"]\n\nHeadPartial --&gt; IndexEJS\nHeadPartial --&gt; InscripcionEJS\nHeadPartial --&gt; PerfilEJS\nHeadPartial --&gt; EditEJS\nHeaderPartial --&gt; IndexEJS\nHeaderPartial --&gt; InscripcionEJS\nHeaderPartial --&gt; PerfilEJS\nFooterPartial --&gt; IndexEJS\nFooterPartial --&gt; PerfilEJS\nFooterPartial --&gt; EditEJS\nIndexEJS --&gt; StyleCSS\nInscripcionEJS --&gt; InscripcionCSS\nPerfilEJS --&gt; PerfilCSS\nEditEJS --&gt; EditCSS</code></pre> <p>Each template follows this inclusion pattern:</p> <ul> <li>Line 1: <code>&lt;%- include('partials/head') %&gt;</code> loads external library dependencies</li> <li>Line 3: <code>&lt;%- include('partials/header') %&gt;</code> provides navigation (role-aware)</li> <li>Final line: <code>&lt;%- include('partials/footer') %&gt;</code> closes the document</li> </ul> <p>Page-specific CSS is linked within each template using <code>&lt;link rel=\"stylesheet\" href=\"/resources/css/[page].css\"&gt;</code>.</p> <p>Sources: views/index.ejs L1-L3</p> <p>views/inscripcion.ejs L1-L3</p> <p>views/perfil.ejs L1-L3</p> <p>views/partials/</p>"},{"location":"Participant-Interfaces/#landing-page-interface","title":"Landing Page Interface","text":"<p>The landing page (<code>views/index.ejs</code>) serves as the primary entry point for participants. It provides event information, promotional content, and calls-to-action for registration.</p>"},{"location":"Participant-Interfaces/#key-components","title":"Key Components","text":"Component Implementation Lines Hero Banner <code>.banner</code> with overlay and event title views/index.ejs L5-L26 Call-to-Action Buttons for <code>/inscripcion</code> and scroll to <code>#recorrido</code> views/index.ejs L14-L17 Event Information Date, time, location, hydration details views/index.ejs L29-L53 Categories Male and female 42K divisions views/index.ejs L55-L69 Photo Gallery Three promotional images with captions views/index.ejs L71-L81 Race Map Leaflet interactive map showing race route views/index.ejs L83-L116"},{"location":"Participant-Interfaces/#external-integrations","title":"External Integrations","text":"<p>The landing page integrates Leaflet.js for interactive mapping:</p> <pre><code>flowchart TD\n\nLeafletCSS[\"Leaflet CSS&lt;br&gt;unpkg.com/leaflet\"]\nLeafletJS[\"Leaflet JS&lt;br&gt;unpkg.com/leaflet\"]\nMapDiv[\"\"]\nMapInit[\"L.map('map').setView()\"]\nRacePath[\"racePath array&lt;br&gt;coordinates\"]\nPolyline[\"L.polyline(racePath)\"]\nMarkers[\"L.marker()&lt;br&gt;Inicio and Meta\"]\n\nLeafletCSS --&gt; MapDiv\nLeafletJS --&gt; MapInit\nMapInit --&gt; MapDiv\nRacePath --&gt; Polyline\nPolyline --&gt; MapInit\nMarkers --&gt; MapInit</code></pre> <p>The map is initialized at Park G\u00fcell coordinates <code>[41.4145, 2.1527]</code> and displays a red polyline representing the race route with start and finish markers.</p> <p>Sources: views/index.ejs L93-L116</p>"},{"location":"Participant-Interfaces/#registration-interface","title":"Registration Interface","text":"<p>The registration form (<code>views/inscripcion.ejs</code>) handles new participant enrollment with file upload capabilities and real-time weather information.</p>"},{"location":"Participant-Interfaces/#form-structure","title":"Form Structure","text":"<p>The registration form includes the following fields submitted via <code>POST /inscripcion</code>:</p> Field Input Type Name Attribute Validation Profile Photo <code>file</code> <code>foto</code> <code>accept=\"image/*\" required</code> First Name <code>text</code> <code>nombre</code> Server-side validation Last Name <code>text</code> <code>apellido</code> Server-side validation DNI <code>text</code> <code>dni</code> Unique constraint Phone <code>text</code> <code>telefono</code> Server-side validation Street <code>text</code> <code>calle</code> Server-side validation Number <code>text</code> <code>numero</code> Server-side validation City <code>text</code> <code>poblacion</code> Server-side validation Postal Code <code>text</code> <code>codigo_postal</code> Server-side validation Password <code>password</code> <code>password</code> Hashed with bcrypt <p>Form submission uses <code>enctype=\"multipart/form-data\"</code> views/inscripcion.ejs L22</p> <p>to enable file upload processing by multer middleware.</p>"},{"location":"Participant-Interfaces/#weather-widget-integration","title":"Weather Widget Integration","text":"<p>A weather widget displays current conditions for Barcelona, populated server-side:</p> <pre><code>flowchart TD\n\nWeatherAPI[\"OpenWeatherMap API\"]\nServerCache[\"Server-side cache\"]\nClimaObject[\"clima object&lt;br&gt;{city, temp, humidity, etc}\"]\nWeatherWidget[\"Weather widget&lt;br&gt;inscripcion.ejs:100-125\"]\n\nWeatherAPI --&gt; ServerCache\nServerCache --&gt; ClimaObject\nClimaObject --&gt; WeatherWidget</code></pre> <p>The <code>clima</code> variable is injected by the server and includes: <code>city</code>, <code>temp</code>, <code>feels_like</code>, <code>humidity</code>, <code>description</code>, <code>wind_speed</code>, <code>clouds</code>, and <code>icon</code> (OpenWeatherMap icon code). If cached data is used, a <code>cached</code> flag indicates stale data views/inscripcion.ejs L118-L120</p>"},{"location":"Participant-Interfaces/#validation-and-feedback","title":"Validation and Feedback","text":"<p>Server-side validation errors are displayed using Bootstrap alert components views/inscripcion.ejs L87-L96</p> <p>:</p> <pre><code>&lt;% if (typeof validaciones !== 'undefined' &amp;&amp; Array.isArray(validaciones) &amp;&amp; validaciones.length) { %&gt;\n  &lt;% validaciones.forEach(function(validacion) { %&gt;\n    &lt;div class=\"alert alert-danger alert-dismissible fade show\" role=\"alert\"&gt;\n      &lt;strong&gt;&lt;%= validacion.msg %&gt;&lt;/strong&gt;\n      &lt;button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"&gt;&lt;/button&gt;\n    &lt;/div&gt;\n  &lt;% }); %&gt;\n&lt;% } %&gt;\n</code></pre> <p>Success messages use SweetAlert2 views/inscripcion.ejs L130-L155</p> <p>with custom styling matching the application's color scheme (<code>#2f6690ff</code>, <code>#3a7ca5ff</code>, <code>#81c3d7ff</code>).</p> <p>Sources: views/inscripcion.ejs L1-L161</p>"},{"location":"Participant-Interfaces/#profile-management-interfaces","title":"Profile Management Interfaces","text":"<p>Two interfaces enable participants to view and edit their profile data: <code>perfil.ejs</code> (read-only display) and <code>edit.ejs</code> (edit form).</p>"},{"location":"Participant-Interfaces/#profile-display-perfilejs","title":"Profile Display (perfil.ejs)","text":"<p>The profile page displays participant information in a read-only card layout:</p> <p>The profile displays:</p> <ul> <li>Participant Photo: Served from <code>/uploads/participantes/&lt;%= user.foto %&gt;</code> if available views/perfil.ejs L12-L13  otherwise shows a Boxicons user placeholder views/perfil.ejs L15</li> <li>Dorsal Number: Displays <code>user.id</code> as the race bib number views/perfil.ejs L21</li> <li>Personal Information: Name, DNI, phone, full address views/perfil.ejs L19-L26</li> <li>Edit Action: Link to <code>/edit/&lt;%= user.id %&gt;</code> views/perfil.ejs L28</li> </ul> <p>The <code>user</code> object is available via <code>res.locals.user</code> set by middleware in <code>app.js</code>, ensuring the session user data is accessible throughout the request lifecycle.</p>"},{"location":"Participant-Interfaces/#profile-editing","title":"Profile Editing","text":"<p>The edit interface (referenced but not shown in provided files) allows participants to update their information via the <code>updateParticipante.js</code> controller. Updated data is validated and persisted to the <code>participantes</code> table, with photo updates handled through multer middleware. Upon successful update, the system redirects back to <code>/perfil/:id</code>.</p> <p>Sources: views/perfil.ejs L1-L33</p>"},{"location":"Participant-Interfaces/#styling-system","title":"Styling System","text":"<p>Each participant interface has a dedicated CSS file following a naming convention:</p> Interface CSS File Key Styles Landing <code>public/resources/css/style.css</code> Hero banner, event info sections, gallery grid Registration <code>public/resources/css/inscripcion.css</code> Form layout, weather widget, motivational banner Profile <code>public/resources/css/perfil.css</code> Profile card, photo display, data rows Edit <code>public/resources/css/edit.css</code> Edit form styling, button styles <p>For comprehensive styling system documentation, see Design System and Component Styles.</p> <p>Sources: views/index.ejs L1</p> <p>views/inscripcion.ejs L7</p> <p>views/perfil.ejs L5</p>"},{"location":"Participant-Interfaces/#data-flow-summary","title":"Data Flow Summary","text":"<p>Participant interface data flows follow these patterns:</p>"},{"location":"Participant-Interfaces/#registration-data-flow","title":"Registration Data Flow","text":"<ol> <li>User submits form with photo \u2192 <code>POST /inscripcion</code></li> <li>Multer middleware processes file upload \u2192 saves to <code>public/uploads/participantes/</code></li> <li>Form data validated by express-validator</li> <li>Password hashed with bcrypt</li> <li>Record inserted into <code>participantes</code> table</li> <li>Success alert displayed with SweetAlert2</li> </ol>"},{"location":"Participant-Interfaces/#profile-view-data-flow","title":"Profile View Data Flow","text":"<ol> <li>User navigates to <code>/perfil/:id</code></li> <li><code>verifyToken</code> middleware validates authentication</li> <li>Route handler fetches participant data from <code>participantes</code> table</li> <li><code>perfil.ejs</code> rendered with <code>user</code> object from session</li> <li>Photo served from static file path <code>/uploads/participantes/</code></li> </ol>"},{"location":"Participant-Interfaces/#profile-update-data-flow","title":"Profile Update Data Flow","text":"<ol> <li>User submits edit form \u2192 <code>POST /edit/:id</code></li> <li><code>verifyToken</code> middleware validates authentication</li> <li><code>updateParticipante.js</code> controller processes update</li> <li>Optional photo upload handled by multer</li> <li>Database record updated in <code>participantes</code> table</li> <li>Redirect to <code>/perfil/:id</code></li> </ol> <p>Sources: routes/index.js</p> <p>routes/participante.js</p> <p>controllers/updateParticipante.js</p>"},{"location":"Profile-Management/","title":"Profile Management","text":"<p>Relevant source files * controllers/updateParticipante.js * public/css/perfil.css * views/edit.ejs * views/perfil.ejs</p>"},{"location":"Profile-Management/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document describes the participant profile management system, which allows authenticated participants to view their registration information and update their personal data. The system consists of two interfaces: a read-only profile display page and an edit form. This functionality is protected by the <code>verifyToken</code> middleware and only accessible to logged-in participants.</p> <p>For information about the initial registration process where this data is created, see Registration Flow. For administrator-level participant management, see Admin Panel.</p> <p>Sources: views/perfil.ejs L1-L32</p> <p>views/edit.ejs L1-L44</p> <p>controllers/updateParticipante.js L1-L19</p>"},{"location":"Profile-Management/#system-architecture","title":"System Architecture","text":"<p>The profile management system follows a standard view-edit-update pattern with distinct responsibilities across the presentation and business logic layers.</p> <pre><code>flowchart TD\n\nPerfilRoute[\"/perfil&lt;br&gt;GET route\"]\nEditRoute[\"/edit/:id&lt;br&gt;GET route\"]\nUpdateRoute[\"/edit/:id&lt;br&gt;POST route\"]\nVerifyToken[\"verifyToken&lt;br&gt;Authentication Guard\"]\nPerfilView[\"perfil.ejs&lt;br&gt;Profile Display\"]\nEditView[\"edit.ejs&lt;br&gt;Edit Form\"]\nUpdateController[\"updateParticipante.js&lt;br&gt;update() function\"]\nSessionData[\"req.session&lt;br&gt;user object\"]\nParticipantesDB[\"participantes table\"]\nPerfilCSS[\"perfil.css&lt;br&gt;Shared Styling\"]\n\nVerifyToken --&gt; PerfilRoute\nVerifyToken --&gt; EditRoute\nVerifyToken --&gt; UpdateRoute\nPerfilRoute --&gt; SessionData\nPerfilRoute --&gt; PerfilView\nEditRoute --&gt; SessionData\nEditRoute --&gt; EditView\nUpdateRoute --&gt; UpdateController\nUpdateController --&gt; ParticipantesDB\nUpdateController --&gt; PerfilRoute\nPerfilView --&gt; PerfilCSS\nEditView --&gt; PerfilCSS\nSessionData --&gt; PerfilView\nSessionData --&gt; EditView\n\nsubgraph Assets [\"Assets\"]\n    PerfilCSS\nend\n\nsubgraph subGraph4 [\"Data Layer\"]\n    SessionData\n    ParticipantesDB\nend\n\nsubgraph subGraph3 [\"Business Logic\"]\n    UpdateController\nend\n\nsubgraph subGraph2 [\"View Templates\"]\n    PerfilView\n    EditView\nend\n\nsubgraph Middleware [\"Middleware\"]\n    VerifyToken\nend\n\nsubgraph subGraph0 [\"Routes Layer\"]\n    PerfilRoute\n    EditRoute\n    UpdateRoute\nend</code></pre> <p>Sources: views/perfil.ejs L1-L32</p> <p>views/edit.ejs L1-L44</p> <p>controllers/updateParticipante.js L4-L18</p>"},{"location":"Profile-Management/#profile-display-interface","title":"Profile Display Interface","text":"<p>The profile viewing interface (<code>perfil.ejs</code>) presents participant data in a card-based layout with read-only information display.</p>"},{"location":"Profile-Management/#data-structure","title":"Data Structure","text":"<p>The profile page renders the following participant fields from the session <code>user</code> object:</p> Field Display Label Description <code>id</code> N\u00famero Dorsal Participant's unique race bib number <code>nombre</code> Bienvenido/a First name displayed in welcome message <code>apellido</code> Bienvenido/a Last name displayed in welcome message <code>dni</code> DNI National identification document number <code>telefono</code> Tel\u00e9fono Contact phone number <code>calle</code> Direcci\u00f3n Street name (combined with <code>numero</code>) <code>numero</code> Direcci\u00f3n Street number (combined with <code>calle</code>) <code>poblacion</code> Poblaci\u00f3n City or town name <code>codigo_postal</code> C\u00f3digo Postal Postal/ZIP code <code>foto</code> (Photo) Profile photo filename (optional) <p>Sources: views/perfil.ejs L19-L26</p>"},{"location":"Profile-Management/#photo-display-logic","title":"Photo Display Logic","text":"<p>The profile photo is rendered conditionally based on whether the participant uploaded a photo during registration:</p> <ul> <li>With Photo: Displays image from <code>/uploads/participantes/&lt;%= user.foto %&gt;</code> in a circular frame views/perfil.ejs L12-L13</li> <li>Without Photo: Shows a placeholder icon using Boxicons (<code>bx bxs-user</code>) views/perfil.ejs L15</li> </ul> <p>Both photo states use the <code>.perfil-foto</code> or <code>.perfil-foto-placeholder</code> CSS classes, which enforce 100x100px dimensions with circular borders public/css/perfil.css L50-L59</p> <p>Sources: views/perfil.ejs L11-L17</p> <p>public/css/perfil.css L50-L59</p>"},{"location":"Profile-Management/#navigation-to-edit-mode","title":"Navigation to Edit Mode","text":"<p>The profile page includes an \"Editar mi perfil\" button that links to <code>/edit/&lt;%= user.id %&gt;</code> views/perfil.ejs L28</p> <p>This button uses the <code>.btn-edit-profile</code> class with gradient styling and hover effects public/css/perfil.css L75-L93</p> <p>Sources: views/perfil.ejs L28</p> <p>public/css/perfil.css L75-L93</p>"},{"location":"Profile-Management/#profile-edit-interface","title":"Profile Edit Interface","text":"<p>The edit interface (<code>edit.ejs</code>) provides a form-based approach to updating participant information. The form structure mirrors the profile display but enables field modification.</p>"},{"location":"Profile-Management/#form-structure","title":"Form Structure","text":"<pre><code>flowchart TD\n\nFormAction[\"form action='/edit/[user.id]'&lt;br&gt;method='POST'\"]\nNombreField[\"input name='nombre'&lt;br&gt;value=user.nombre\"]\nApellidoField[\"input name='apellido'&lt;br&gt;value=user.apellido\"]\nDniField[\"input name='dni'&lt;br&gt;value=user.dni\"]\nTelefonoField[\"input name='telefono'&lt;br&gt;value=user.telefono\"]\nCalleField[\"input name='calle'&lt;br&gt;value=user.calle\"]\nNumeroField[\"input name='numero'&lt;br&gt;value=user.numero\"]\nPoblacionField[\"input name='poblacion'&lt;br&gt;value=user.poblacion\"]\nCodigoPostalField[\"input name='codigo_postal'&lt;br&gt;value=user.codigo_postal\"]\nSubmitBtn[\"button type='submit'&lt;br&gt;Guardar Cambios\"]\nCancelBtn[\"a href='/perfil'&lt;br&gt;Cancelar\"]\n\nsubgraph subGraph0 [\"edit.ejs Form\"]\n    FormAction\n    NombreField\n    ApellidoField\n    DniField\n    TelefonoField\n    CalleField\n    NumeroField\n    PoblacionField\n    CodigoPostalField\n    SubmitBtn\n    CancelBtn\n    FormAction --&gt; NombreField\n    FormAction --&gt; ApellidoField\n    FormAction --&gt; DniField\n    FormAction --&gt; TelefonoField\n    FormAction --&gt; CalleField\n    FormAction --&gt; NumeroField\n    FormAction --&gt; PoblacionField\n    FormAction --&gt; CodigoPostalField\n    FormAction --&gt; SubmitBtn\n    FormAction --&gt; CancelBtn\nend</code></pre> <p>Each input field is pre-populated with the current value from <code>user</code> object views/edit.ejs L14-L36</p> <p>All fields use Bootstrap's <code>.form-control</code> class for consistent styling.</p> <p>Sources: views/edit.ejs L11-L40</p>"},{"location":"Profile-Management/#form-fields-and-validation","title":"Form Fields and Validation","text":"<p>The edit form includes eight editable text fields:</p> <ol> <li>nombre - First name views/edit.ejs L14</li> <li>apellido - Last name views/edit.ejs L17</li> <li>dni - National ID views/edit.ejs L20</li> <li>telefono - Phone number views/edit.ejs L23</li> <li>calle - Street name views/edit.ejs L26</li> <li>numero - Street number views/edit.ejs L29</li> <li>poblacion - City/town views/edit.ejs L32</li> <li>codigo_postal - Postal code views/edit.ejs L35</li> </ol> <p>Note that the participant's <code>id</code> and <code>foto</code> are not editable through this interface. The participant ID is used in the form action URL but not modifiable. Photo updates are not currently supported through the profile edit interface.</p> <p>Sources: views/edit.ejs L11-L36</p>"},{"location":"Profile-Management/#action-buttons","title":"Action Buttons","text":"<p>The form provides two action buttons:</p> Button Type Action Class Guardar Cambios Submit POST to <code>/edit/:id</code> <code>.btn-edit-profile</code> Cancelar Link Navigate to <code>/perfil</code> <code>.btn .btn-danger</code> <p>Sources: views/edit.ejs L38-L39</p>"},{"location":"Profile-Management/#data-update-flow","title":"Data Update Flow","text":"<p>The update process follows a server-side controller pattern with database persistence and redirect-based feedback.</p>"},{"location":"Profile-Management/#update-sequence","title":"Update Sequence","text":"<pre><code>sequenceDiagram\n  participant Browser\n  participant edit.ejs\n  participant /edit/:id POST route\n  participant updateParticipante.update()\n  participant participantes table\n  participant /perfil GET route\n\n  Browser-&gt;&gt;edit.ejs: \"User modifies form fields\"\n  Browser-&gt;&gt;/edit/:id POST route: \"POST /edit/:id\n  /edit/:id POST route-&gt;&gt;updateParticipante.update(): {nombre, apellido, dni...}\"\n  updateParticipante.update()-&gt;&gt;updateParticipante.update(): \"req.body contains form data\"\n  note over updateParticipante.update(): \"nombre, apellido, dni, telefono,\n  updateParticipante.update()-&gt;&gt;participantes table: \"Extract fields from req.body\"\n  loop [\"Update Successful\"]\n    participantes table--&gt;&gt;updateParticipante.update(): \"UPDATE participantes SET\n    updateParticipante.update()-&gt;&gt;updateParticipante.update(): nombre=?, apellido=?, dni=?, ...\n    updateParticipante.update()--&gt;&gt;Browser: WHERE id=?\"\n    Browser-&gt;&gt;/perfil GET route: \"Result object\"\n    /perfil GET route--&gt;&gt;Browser: \"console.log('Datos actualizados')\"\n    participantes table--&gt;&gt;updateParticipante.update(): \"res.redirect('/perfil')\"\n    updateParticipante.update()-&gt;&gt;updateParticipante.update(): \"GET /perfil\"\n    updateParticipante.update()--&gt;&gt;Browser: \"Render updated profile\"\n    note over Browser: \"User sees unchanged profile\n  end</code></pre> <p>Sources: controllers/updateParticipante.js L4-L18</p>"},{"location":"Profile-Management/#update-controller-implementation","title":"Update Controller Implementation","text":"<p>The <code>update</code> function in controllers/updateParticipante.js L4-L18</p> <p>performs the following operations:</p> <ol> <li>Extract form data from <code>req.body</code> via destructuring controllers/updateParticipante.js L5</li> <li>Execute UPDATE query with parameterized values controllers/updateParticipante.js L7-L9</li> <li>Handle errors by logging and redirecting controllers/updateParticipante.js L11-L14</li> <li>Confirm success with console log and redirect controllers/updateParticipante.js L15-L16</li> </ol> <p>The SQL query uses parameterized placeholders (<code>?</code>) to prevent SQL injection:</p> <pre><code>UPDATE participantes \nSET nombre=?, apellido=?, dni=?, telefono=?, calle=?, numero=?, poblacion=?, codigo_postal=? \nWHERE id=?\n</code></pre> <p>Sources: controllers/updateParticipante.js L7-L9</p>"},{"location":"Profile-Management/#error-handling-limitations","title":"Error Handling Limitations","text":"<p>The current implementation has minimal error handling:</p> <ul> <li>Database errors are logged to console but not displayed to users controllers/updateParticipante.js L12-L13</li> <li>Both success and error cases redirect to <code>/perfil</code> controllers/updateParticipante.js L13-L16</li> <li>Users receive no explicit feedback about whether their update succeeded or failed</li> <li>No validation occurs on the server side before database insertion</li> </ul> <p>Sources: controllers/updateParticipante.js L10-L17</p>"},{"location":"Profile-Management/#styling-and-visual-design","title":"Styling and Visual Design","text":"<p>Both profile pages share the same stylesheet (<code>perfil.css</code>), creating visual consistency between view and edit modes.</p>"},{"location":"Profile-Management/#design-system","title":"Design System","text":"<p>The stylesheet defines a color palette using CSS custom properties public/css/perfil.css L1-L8</p> <p>:</p> Variable Hex Value Usage <code>--sky-blue</code> #81c3d7ff Background gradients <code>--platinum</code> #e5e5e5ff Background gradients, row backgrounds <code>--indigo-dye</code> #16425bff Primary text, borders <code>--lapis-lazuli</code> #2f6690ff Headings, buttons <code>--cerulean</code> #3a7ca5ff Subheadings, button gradients <code>--white</code> #ffffff Button text, card backgrounds <p>Sources: public/css/perfil.css L1-L8</p>"},{"location":"Profile-Management/#layout-components","title":"Layout Components","text":"<p>The profile interface uses a centered card layout:</p> <pre><code>flowchart TD\n\nHeader[\"h1 - Page Title\"]\nPhoto[\"perfil-foto-wrap - Photo Container\"]\nWelcome[\"h3 - Welcome Message\"]\nRows[\"perfil-row x8 - Data Rows\"]\nButton[\"btn-edit-profile - Action Button\"]\n\nsubgraph subGraph2 [\"body - Full Viewport\"]\n\nsubgraph subGraph1 [\"perfil-wrapper - Flexbox Container\"]\n\nsubgraph subGraph0 [\"perfil-card - Card Component\"]\n    Header\n    Photo\n    Welcome\n    Rows\n    Button\nend\nend\nend</code></pre> <p>Key CSS Classes:</p> <ul> <li><code>.perfil-wrapper</code> public/css/perfil.css L21-L27 : Flex container that centers content vertically and horizontally with 48px top/bottom padding</li> <li><code>.perfil-card</code> public/css/perfil.css L29-L44 : Max-width 380px card with gradient background, rounded corners (16px), box shadow, and hover effect that lifts the card 6px</li> <li><code>.perfil-row</code> public/css/perfil.css L61-L71 : Individual data display rows with flex layout (<code>justify-content: space-between</code>) and gradient background</li> <li><code>.btn-edit-profile</code> public/css/perfil.css L75-L92 : Full-width button with gradient background, pill shape (999px border-radius), and lift effect on hover</li> </ul> <p>Sources: public/css/perfil.css L21-L92</p>"},{"location":"Profile-Management/#photo-styling","title":"Photo Styling","text":"<p>Profile photos use circular framing with consistent dimensions:</p> <ul> <li>Dimensions: 100x100px enforced via <code>!important</code> public/css/perfil.css L51-L52</li> <li>Shape: Circular via <code>border-radius: 50%</code> public/css/perfil.css L53</li> <li>Cropping: <code>object-fit: cover</code> ensures photos fill frame public/css/perfil.css L54</li> <li>Border: 3px solid border in <code>--lapis-lazuli</code> color public/css/perfil.css L55</li> <li>Placeholder: Uses same dimensions with gray background and centered icon public/css/perfil.css L59</li> </ul> <p>Sources: public/css/perfil.css L50-L59</p>"},{"location":"Profile-Management/#responsive-behavior","title":"Responsive Behavior","text":"<p>The card-based layout adapts to different screen sizes:</p> <ul> <li>Full viewport height layout with <code>min-height: 100vh</code> on body public/css/perfil.css L18</li> <li>Card width constrained to 380px maximum public/css/perfil.css L31</li> <li>Horizontal padding of 16px on wrapper prevents edge overflow public/css/perfil.css L26</li> <li>Text within rows wraps naturally due to flex layout with space-between alignment public/css/perfil.css L70</li> </ul> <p>Sources: public/css/perfil.css L10-L31</p>"},{"location":"Profile-Management/#integration-with-application-flow","title":"Integration with Application Flow","text":"<p>Profile management integrates with the broader authentication and session management system:</p> <ol> <li>Authentication Requirement: Both <code>/perfil</code> and <code>/edit/:id</code> routes are protected by <code>verifyToken</code> middleware (see Role-Based Access Control)</li> <li>Session Data Access: The <code>user</code> object is populated in <code>res.locals</code> from session data, making it available to EJS templates</li> <li>Post-Login Redirect: After successful participant login, users are typically redirected to <code>/perfil</code> (see Login System)</li> <li>Shared Layout: Both pages include the standard <code>partials/head</code>, <code>partials/header</code>, and <code>partials/footer</code> (see Shared Components)</li> </ol> <p>Sources: views/perfil.ejs L1-L32</p> <p>views/edit.ejs L1-L44</p>"},{"location":"Profile-Management/#limitations-and-considerations","title":"Limitations and Considerations","text":"<p>The current profile management implementation has several constraints:</p>"},{"location":"Profile-Management/#data-modification-constraints","title":"Data Modification Constraints","text":"<ul> <li>Photo Updates Not Supported: Users cannot change their profile photo after initial registration. The photo field is stored in the database but not exposed in the edit form views/edit.ejs L11-L40</li> <li>No Validation: Server-side validation is absent; any form data is directly inserted into the database controllers/updateParticipante.js L7-L9</li> <li>ID Modification Risk: While the ID is not exposed as an editable field, the form action uses the ID from the URL parameter rather than validating against the authenticated user's session ID</li> </ul>"},{"location":"Profile-Management/#user-experience-gaps","title":"User Experience Gaps","text":"<ul> <li>No Success/Error Messages: Users receive no visual confirmation of whether updates succeeded controllers/updateParticipante.js L13-L16</li> <li>Silent Error Handling: Database errors are logged but not communicated to users controllers/updateParticipante.js L11-L14</li> <li>No Field Validation: Client-side and server-side validation are both missing (e.g., phone number format, postal code format)</li> <li>No Optimistic Updates: The page must be fully reloaded to see changes</li> </ul>"},{"location":"Profile-Management/#security-considerations","title":"Security Considerations","text":"<ul> <li>Authorization Check Missing: The update controller does not verify that the authenticated user's ID matches the ID being updated</li> <li>SQL Injection Protection: Uses parameterized queries, which provides protection controllers/updateParticipante.js L8</li> <li>No Input Sanitization: Form inputs are not sanitized before database insertion</li> </ul> <p>Sources: controllers/updateParticipante.js L4-L18</p> <p>views/edit.ejs L11-L40</p>"},{"location":"Registration-Flow/","title":"Registration Flow","text":"<p>Relevant source files * middlewares/multer.js * middlewares/verifyAdmin.js * middlewares/verifyToken.js * public/css/edit.css * public/css/inscripcion.css * views/inscripcion.ejs</p>"},{"location":"Registration-Flow/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document describes the participant registration flow in the HAPPY RUNNER 42K application, covering form submission, photo upload, validation feedback, and weather widget integration. The registration interface allows new participants to create accounts by providing personal information and uploading a profile photo.</p> <p>For information about post-registration authentication, see Login System. For details on profile editing after registration, see Profile Management. For technical details on the file upload infrastructure, see File Upload System.</p>"},{"location":"Registration-Flow/#registration-endpoint-and-route-handler","title":"Registration Endpoint and Route Handler","text":"<p>The registration flow begins when users access the registration form at <code>/inscripcion</code>. The route accepts both GET (to display the form) and POST (to process submissions) requests. The POST route includes the multer middleware for handling multipart form data with file uploads.</p> <p>Route Configuration:</p> <ul> <li>GET <code>/inscripcion</code> - Renders the registration form with weather data</li> <li>POST <code>/inscripcion</code> - Processes form submission with <code>upload.single('foto')</code> middleware</li> </ul> <p>The multer middleware is configured in middlewares/multer.js L1-L15</p> <p>with disk storage, saving uploaded photos to <code>public/uploads/participantes/</code> with the naming pattern <code>participante-{timestamp}{extension}</code>.</p> <p>Sources: views/inscripcion.ejs:22, middlewares/multer.js:1-15</p>"},{"location":"Registration-Flow/#form-structure-and-data-fields","title":"Form Structure and Data Fields","text":"<p>The registration form collects participant information across multiple categories: identification, contact details, address components, authentication credentials, and a profile photo.</p>"},{"location":"Registration-Flow/#required-form-fields","title":"Required Form Fields","text":"Field Name Input Type Purpose Database Column <code>foto</code> file Profile/dorsal photo <code>foto</code> <code>nombre</code> text First name <code>nombre</code> <code>apellido</code> text Last name <code>apellido</code> <code>dni</code> text National ID (unique identifier) <code>dni</code> <code>telefono</code> text Phone number <code>telefono</code> <code>calle</code> text Street name Part of <code>direccion</code> <code>numero</code> text Street number Part of <code>direccion</code> <code>poblacion</code> text City/town Part of <code>direccion</code> <code>codigo_postal</code> text Postal code Part of <code>direccion</code> <code>password</code> password Account password (hashed) <code>password</code> <p>The form at views/inscripcion.ejs L24-L81</p> <p>uses a two-column grid layout implemented in public/css/inscripcion.css L79-L92</p> <p>The left column contains the form fields, while the right column displays a weather widget.</p> <p>Sources: views/inscripcion.ejs:22-86, public/css/inscripcion.css:79-92</p>"},{"location":"Registration-Flow/#registration-request-flow","title":"Registration Request Flow","text":"<p>The following diagram illustrates the complete request lifecycle from form submission to database persistence and user feedback.</p> <pre><code>sequenceDiagram\n  participant Browser\n  participant /inscripcion Route\n  participant multer.single('foto')\n  participant express-validator\n  participant public/uploads/participantes/\n  participant bcrypt\n  participant MySQL participantes\n  participant OpenWeatherMap API\n\n  Browser-&gt;&gt;/inscripcion Route: \"POST /inscripcion\"\n  /inscripcion Route-&gt;&gt;multer.single('foto'): \"multipart/form-data\"\n  multer.single('foto')-&gt;&gt;multer.single('foto'): \"Process upload\"\n  multer.single('foto')-&gt;&gt;public/uploads/participantes/: \"Parse file field: foto\"\n  public/uploads/participantes/--&gt;&gt;multer.single('foto'): \"Save as participante-{timestamp}.ext\"\n  multer.single('foto')-&gt;&gt;express-validator: \"File path returned\"\n  express-validator-&gt;&gt;express-validator: \"req.file populated\"\n  loop [\"Validation Errors\"]\n    express-validator-&gt;&gt;OpenWeatherMap API: \"Validate all fields\"\n    OpenWeatherMap API--&gt;&gt;express-validator: \"(nombre, apellido, dni, etc.)\"\n    express-validator--&gt;&gt;Browser: \"Fetch weather for re-render\"\n    express-validator-&gt;&gt;bcrypt: \"Weather data\"\n    bcrypt--&gt;&gt;express-validator: \"Re-render inscripcion.ejs\"\n    express-validator-&gt;&gt;MySQL participantes: \"with validaciones array\"\n    MySQL participantes--&gt;&gt;express-validator: \"and preserved valores\"\n    express-validator--&gt;&gt;Browser: \"Hash password\"\n  end</code></pre> <p>Sources: views/inscripcion.ejs:22, middlewares/multer.js:5-12, views/inscripcion.ejs:87-96, views/inscripcion.ejs:131-154</p>"},{"location":"Registration-Flow/#photo-upload-process","title":"Photo Upload Process","text":"<p>The registration form requires participants to upload a profile photo, which is used for their race dorsal and profile display. The upload mechanism uses multer middleware with disk storage configuration.</p>"},{"location":"Registration-Flow/#multer-configuration-details","title":"Multer Configuration Details","text":"<p>The storage configuration at middlewares/multer.js L5-L13</p> <p>defines:</p> <ol> <li>Destination: <code>public/uploads/participantes</code> directory</li> <li>Filename Generation: <code>participante-</code> prefix + <code>Date.now()</code> timestamp + original file extension</li> <li>File Field: <code>foto</code> (accepts <code>image/*</code> MIME types)</li> </ol> <p>The filename generation strategy ensures unique filenames by using millisecond timestamps, preventing filename collisions when multiple users register simultaneously.</p> <p>Example Generated Filename:</p> <pre><code>participante-1703251234567.jpg\n</code></pre> <p>The uploaded file path is stored in the database's <code>foto</code> column as a relative path (e.g., <code>/uploads/participantes/participante-1703251234567.jpg</code>).</p> <p>Sources: middlewares/multer.js:1-15, views/inscripcion.ejs:25-26</p>"},{"location":"Registration-Flow/#form-layout-and-ui-components","title":"Form Layout and UI Components","text":"<p>The registration interface consists of three primary visual components: a motivational banner, the form grid, and a weather widget.</p> <pre><code>flowchart TD\n\nInscripcionContainer[\"inscripcion-container&lt;br&gt;(max-width: 980px)\"]\nMotivationalBanner[\"motivational-banner&lt;br&gt;Background: jovenes-amigos-corriendo.jpg&lt;br&gt;Height: 220px\"]\nBannerOverlay[\"banner-overlay&lt;br&gt;rgba overlay with text\"]\nFormElement[\"form element&lt;br&gt;grid-template-columns: 1fr 360px\"]\nFormLeft[\"form-left&lt;br&gt;2-column grid&lt;br&gt;Contains all input fields\"]\nWeatherWidget[\"weather-widget&lt;br&gt;360px width&lt;br&gt;OpenWeatherMap data\"]\nPhotoInput[\"foto input[type=file]\"]\nPersonalFields[\"nombre, apellido inputs\"]\nContactFields[\"dni, telefono inputs\"]\nAddressFields[\"calle, numero, poblacion,&lt;br&gt;codigo_postal inputs\"]\nPasswordField[\"password input[type=password]\"]\nSubmitButton[\"btn-registrarse button\"]\nValidationAlerts[\"alert-danger divs&lt;br&gt;(if validaciones array present)\"]\nWeatherIcon[\"Weather icon from OpenWeatherMap\"]\nWeatherStats[\"Temperature, humidity, wind data\"]\n\nInscripcionContainer --&gt; MotivationalBanner\nMotivationalBanner --&gt; BannerOverlay\nInscripcionContainer --&gt; FormElement\nFormElement --&gt; FormLeft\nFormElement --&gt; WeatherWidget\nFormLeft --&gt; PhotoInput\nFormLeft --&gt; PersonalFields\nFormLeft --&gt; ContactFields\nFormLeft --&gt; AddressFields\nFormLeft --&gt; PasswordField\nFormLeft --&gt; SubmitButton\nFormLeft --&gt; ValidationAlerts\nWeatherWidget --&gt; WeatherIcon\nWeatherWidget --&gt; WeatherStats</code></pre> <p>The form uses a responsive grid layout defined at public/css/inscripcion.css L79-L85</p> <p>On screens wider than 980px, the form displays in two columns: form fields on the left (spanning 2 sub-columns) and the weather widget on the right (fixed 360px width). On mobile devices (\u2264980px), the layout collapses to a single column with the weather widget repositioned above the form fields.</p> <p>Sources: views/inscripcion.ejs:10-127, public/css/inscripcion.css:52-64, public/css/inscripcion.css:79-92, public/css/inscripcion.css:161-179, public/css/inscripcion.css:251-263</p>"},{"location":"Registration-Flow/#validation-and-error-handling","title":"Validation and Error Handling","text":"<p>The registration form implements server-side validation using express-validator. When validation fails, the form is re-rendered with error messages and preserved field values.</p>"},{"location":"Registration-Flow/#validation-flow","title":"Validation Flow","text":"<pre><code>flowchart TD\n\nFormSubmit[\"Form submission&lt;br&gt;POST /inscripcion\"]\nValidatorMiddleware[\"express-validator&lt;br&gt;middleware chain\"]\nCheckErrors[\"validationResult(req)\"]\nHasErrors[\"Errors present?\"]\nPopulateValores[\"Preserve form data&lt;br&gt;in valores object\"]\nFetchWeather[\"Fetch weather data&lt;br&gt;for re-render\"]\nRenderWithErrors[\"Render inscripcion.ejs&lt;br&gt;with validaciones array\"]\nDisplayAlerts[\"Display alert-danger&lt;br&gt;Bootstrap alerts&lt;br&gt;(lines 87-96)\"]\nRepopulateFields[\"Repopulate input values&lt;br&gt;from valores object\"]\nProcessRegistration[\"Hash password&lt;br&gt;Insert to database\"]\nShowSuccess[\"Render with SweetAlert2&lt;br&gt;success alert&lt;br&gt;(lines 131-154)\"]\nRedirectLogin[\"Redirect to /login\"]\n\nFormSubmit --&gt; ValidatorMiddleware\nValidatorMiddleware --&gt; CheckErrors\nCheckErrors --&gt; HasErrors\nHasErrors --&gt; PopulateValores\nPopulateValores --&gt; FetchWeather\nFetchWeather --&gt; RenderWithErrors\nRenderWithErrors --&gt; DisplayAlerts\nRenderWithErrors --&gt; RepopulateFields\nHasErrors --&gt; ProcessRegistration\nProcessRegistration --&gt; ShowSuccess\nShowSuccess --&gt; RedirectLogin</code></pre>"},{"location":"Registration-Flow/#error-display-mechanism","title":"Error Display Mechanism","text":"<p>When validation errors occur, the server passes two objects to the EJS template:</p> <ol> <li><code>validaciones</code> array: Contains validation error objects with <code>msg</code> property</li> <li><code>valores</code> object: Contains submitted form values for field repopulation</li> </ol> <p>The template iterates over the <code>validaciones</code> array at views/inscripcion.ejs L87-L96</p> <p>to display Bootstrap alert components. Each input field checks for a corresponding value in the <code>valores</code> object to preserve user input, as seen in the pattern: <code>value=\"&lt;%= (typeof valores !== 'undefined' &amp;&amp; valores.nombre) ? valores.nombre : '' %&gt;\"</code> at views/inscripcion.ejs L32</p> <p>Sources: views/inscripcion.ejs:87-96, views/inscripcion.ejs:31-80</p>"},{"location":"Registration-Flow/#success-feedback-with-sweetalert2","title":"Success Feedback with SweetAlert2","text":"<p>Upon successful registration, the system displays a styled success modal using SweetAlert2 library and automatically redirects to the login page.</p> <p>The alert configuration at views/inscripcion.ejs L131-L154</p> <p>receives the following variables from the server:</p> Variable Purpose Example Value <code>alert</code> Boolean flag to trigger alert <code>true</code> <code>alertMessage</code> Message text \"Registro exitoso\" <code>alertIcon</code> Icon type \"success\" <code>showConfirmButton</code> Display confirm button <code>false</code> <code>timer</code> Auto-close timer (ms) <code>2000</code> <code>ruta</code> Redirect destination \"login\" <p>The alert uses a custom gradient background (<code>linear-gradient(135deg, #2f6690ff, #3a7ca5ff)</code>) matching the application's color scheme defined in public/css/inscripcion.css L4-L26</p> <p>After the timer expires or the user confirms, the <code>.then()</code> callback executes the redirect to <code>/&lt;%= ruta %&gt;</code>.</p> <p>Sources: views/inscripcion.ejs:131-154, public/css/inscripcion.css:4-26</p>"},{"location":"Registration-Flow/#weather-widget-integration","title":"Weather Widget Integration","text":"<p>The registration page includes a real-time weather widget that displays current conditions for the marathon location. This feature helps participants understand race-day weather conditions during registration.</p>"},{"location":"Registration-Flow/#weather-data-structure","title":"Weather Data Structure","text":"<p>The server injects a <code>clima</code> object into the template with the following properties:</p> Property Source Display Location <code>city</code> OpenWeatherMap city name Widget title (line 103) <code>icon</code> Weather icon code Icon image (lines 105-109) <code>temp</code> Current temperature (\u00b0C) Temperature stat (line 111) <code>feels_like</code> Feels-like temperature (\u00b0C) Sensation stat (line 112) <code>humidity</code> Humidity percentage Humidity stat (line 113) <code>description</code> Weather description Description text (line 114) <code>wind_speed</code> Wind speed (m/s) Wind stat (line 115) <code>clouds</code> Cloud coverage percentage Cloud stat (line 116) <p>The weather icon is fetched from OpenWeatherMap's CDN using the pattern <code>https://openweathermap.org/img/wn/{icon}@2x.png</code> at views/inscripcion.ejs L107</p>"},{"location":"Registration-Flow/#caching-indicator","title":"Caching Indicator","text":"<p>The widget displays a \"(Datos en cache)\" message when weather data is served from cache rather than fresh API calls, indicated by the <code>cached</code> variable at views/inscripcion.ejs L118-L120</p> <p>Widget Styling:</p> <ul> <li>Gradient background: public/css/inscripcion.css L175</li> <li>Hover transformation: public/css/inscripcion.css L181-L184</li> <li>Floating icon animation: public/css/inscripcion.css L202-L205</li> <li>Stat grid layout: public/css/inscripcion.css L207-L212</li> </ul> <p>Sources: views/inscripcion.ejs:101-125, public/css/inscripcion.css:161-239</p>"},{"location":"Registration-Flow/#visual-design-elements","title":"Visual Design Elements","text":""},{"location":"Registration-Flow/#motivational-banner","title":"Motivational Banner","text":"<p>The registration page features a full-width motivational banner with background imagery to encourage registration. The banner component at views/inscripcion.ejs L13-L18</p> <p>displays:</p> <ul> <li>Background Image: <code>jovenes-amigos-corriendo-durante-una-maraton.jpg</code> (marathon runners)</li> <li>Overlay: Semi-transparent dark overlay (<code>rgba(22,66,91,0.48)</code>)</li> <li>Headline: \"\u00a1Prep\u00e1rate para la gran carrera!\"</li> <li>Subtext: \"Visualiza la meta, siente la emoci\u00f3n y anima a inscribirte hoy.\"</li> </ul> <p>Styling is defined at public/css/inscripcion.css L251-L293</p> <p>with responsive height adjustments for mobile devices.</p>"},{"location":"Registration-Flow/#form-input-styling","title":"Form Input Styling","text":"<p>All form inputs follow a consistent visual design:</p> <ul> <li>Background: Subtle gradient <code>linear-gradient(180deg,#ffffff,#f7fbff)</code> (public/css/inscripcion.css L115 )</li> <li>Border: Light border <code>rgba(22,66,91,0.12)</code> with rounded corners (12px radius)</li> <li>Focus State: Elevated with <code>translateY(-3px)</code> and stronger shadow (public/css/inscripcion.css L122-L128 )</li> <li>Transition: Smooth transforms on interaction</li> </ul>"},{"location":"Registration-Flow/#submit-button","title":"Submit Button","text":"<p>The \"INSCRIBIRSE\" button at views/inscripcion.ejs L84</p> <p>features:</p> <ul> <li>Pill-shaped design (<code>border-radius: 999px</code>)</li> <li>Gradient background matching the application theme</li> <li>Hover elevation effect (<code>translateY(-5px)</code>)</li> <li>Styling defined at public/css/inscripcion.css L133-L148</li> </ul> <p>Sources: views/inscripcion.ejs:13-18, public/css/inscripcion.css:133-148, public/css/inscripcion.css:251-293</p>"},{"location":"Registration-Flow/#responsive-behavior","title":"Responsive Behavior","text":"<p>The registration interface adapts to different screen sizes through media queries defined in the stylesheet.</p>"},{"location":"Registration-Flow/#breakpoint-adjustments","title":"Breakpoint Adjustments","text":"<p>At 980px and below (public/css/inscripcion.css L302-L306</p> <p>):</p> <ul> <li>Form grid collapses from two columns to single column</li> <li>Weather widget reordered above form fields (<code>order: -1</code>)</li> <li>Form fields stack vertically</li> </ul> <p>At 768px and below (public/css/inscripcion.css L308-L312</p> <p>):</p> <ul> <li>Motivational banner height reduces from 220px to 160px</li> <li>Banner headline font size reduces to 1.5rem</li> <li>Banner text size reduces to 1rem</li> </ul> <p>The responsive strategy ensures usability across desktop, tablet, and mobile devices while maintaining visual hierarchy and component readability.</p> <p>Sources: public/css/inscripcion.css:302-312</p>"},{"location":"Registration-Flow/#component-composition-diagram","title":"Component Composition Diagram","text":"<pre><code>flowchart TD\n\nPartialHead[\"partials/head.ejs&lt;br&gt;Bootstrap 5.3.7&lt;br&gt;SweetAlert2\"]\nPartialHeader[\"partials/header.ejs&lt;br&gt;Navigation bar\"]\nInscripcionCSS[\"css/inscripcion.css&lt;br&gt;Page-specific styles\"]\nInscripcionTemplate[\"inscripcion.ejs&lt;br&gt;Main template\"]\nMotivBanner[\"Motivational banner&lt;br&gt;lines 13-18\"]\nFormBlock[\"Form element&lt;br&gt;lines 22-127\"]\nSweetAlertBlock[\"SweetAlert2 script&lt;br&gt;lines 131-154\"]\nPartialFooter[\"partials/footer.ejs\"]\nFormLeftColumn[\"Left column&lt;br&gt;Input fields&lt;br&gt;lines 23-98\"]\nWeatherColumn[\"Right column&lt;br&gt;Weather widget&lt;br&gt;lines 101-125\"]\nPhotoField[\"File input: foto\"]\nPersonalInfo[\"Text inputs:&lt;br&gt;nombre, apellido\"]\nContactInfo[\"Text inputs:&lt;br&gt;dni, telefono\"]\nAddress[\"Text inputs:&lt;br&gt;calle, numero,&lt;br&gt;poblacion, codigo_postal\"]\nAuth[\"Password input\"]\nSubmit[\"Submit button\"]\nErrors[\"Validation alerts&lt;br&gt;lines 87-96\"]\n\nPartialHead --&gt; InscripcionTemplate\nPartialHeader --&gt; InscripcionTemplate\nInscripcionCSS --&gt; InscripcionTemplate\nInscripcionTemplate --&gt; MotivBanner\nInscripcionTemplate --&gt; FormBlock\nInscripcionTemplate --&gt; SweetAlertBlock\nInscripcionTemplate --&gt; PartialFooter\nFormBlock --&gt; FormLeftColumn\nFormBlock --&gt; WeatherColumn\nFormLeftColumn --&gt; PhotoField\nFormLeftColumn --&gt; PersonalInfo\nFormLeftColumn --&gt; ContactInfo\nFormLeftColumn --&gt; Address\nFormLeftColumn --&gt; Auth\nFormLeftColumn --&gt; Submit\nFormLeftColumn --&gt; Errors</code></pre> <p>Sources: views/inscripcion.ejs:1-161, public/css/inscripcion.css:1-313</p>"},{"location":"Role-Based-Access-Control/","title":"Role-Based Access Control","text":"<p>Relevant source files * middlewares/multer.js * middlewares/verifyAdmin.js * middlewares/verifyToken.js * public/css/edit.css * views/partials/header.ejs</p>"},{"location":"Role-Based-Access-Control/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document details the role-based access control (RBAC) system that enforces authorization in the HAPPY RUNNER 42K application. The system distinguishes between two user roles (<code>participante</code> and <code>admin</code>) and uses middleware guards to protect routes and conditionally render UI elements based on authenticated user roles.</p> <p>For information about the login mechanisms that establish user sessions, see Login System. For details on session data storage and lifecycle, see Session Management.</p>"},{"location":"Role-Based-Access-Control/#role-definitions","title":"Role Definitions","text":"<p>The application defines two distinct user roles stored in session and JWT token payloads:</p> Role Value User Type Database Table Login Route Participant <code>\"participante\"</code> Event participants <code>participantes</code> <code>/login</code> Administrator <code>\"admin\"</code> Event organizers <code>organizadores</code> <code>/loginadmin</code> <p>The role value is set during authentication by the <code>authcontroller.js</code> and stored in both the session object (<code>req.session.rol</code>) and JWT token payload (<code>decoded.rol</code>).</p> <p>Sources: views/partials/header.ejs L22-L30</p> <p>middlewares/verifyAdmin.js L9</p>"},{"location":"Role-Based-Access-Control/#middleware-guards","title":"Middleware Guards","text":"<p>The system implements two JWT-based middleware guards that intercept requests to protected routes:</p>"},{"location":"Role-Based-Access-Control/#verifytoken-middleware","title":"verifyToken Middleware","text":"<p>The <code>verifyToken</code> middleware provides general authentication verification for any logged-in user (both participants and admins):</p> <pre><code>flowchart TD\n\nRequest[\"Incoming Request\"]\nCheckToken[\"Extract token from req.cookies.token\"]\nTokenExists[\"Token exists?\"]\nRedirectLogin[\"Redirect to /loginadmin\"]\nVerifyJWT[\"jwt.verify(token, JWT_SECRET)\"]\nValidToken[\"Valid token?\"]\nRedirectLogin2[\"Redirect to /loginadmin\"]\nStoreUser[\"Store decoded data in req.user\"]\nContinue[\"Call next()\"]\n\nRequest --&gt; CheckToken\nCheckToken --&gt; TokenExists\nTokenExists --&gt; RedirectLogin\nTokenExists --&gt; VerifyJWT\nVerifyJWT --&gt; ValidToken\nValidToken --&gt; RedirectLogin2\nValidToken --&gt; StoreUser\nStoreUser --&gt; Continue</code></pre> <p>Implementation details:</p> <ul> <li>Location: middlewares/verifyToken.js L3-L16</li> <li>Token source: <code>req.cookies.token</code> (set during login)</li> <li>Secret key: <code>process.env.JWT_SECRET</code> (environment variable)</li> <li>Success behavior: Populates <code>req.user</code> with decoded token payload and proceeds</li> <li>Failure behavior: Redirects to <code>/loginadmin</code> for both missing and invalid tokens</li> </ul> <p>Sources: middlewares/verifyToken.js L1-L19</p>"},{"location":"Role-Based-Access-Control/#verifyadmin-middleware","title":"verifyAdmin Middleware","text":"<p>The <code>verifyAdmin</code> middleware extends authentication with role-based authorization, ensuring only users with <code>rol === \"admin\"</code> can proceed:</p> <pre><code>flowchart TD\n\nRequest[\"Incoming Request\"]\nCheckToken[\"Extract token from req.cookies.token\"]\nTokenExists[\"Token exists?\"]\nRedirectAuth[\"Redirect to /authadmin\"]\nVerifyJWT[\"jwt.verify(token, JWT_SECRET)\"]\nValidToken[\"Valid token?\"]\nRedirectAuth2[\"Redirect to /authadmin\"]\nCheckRole[\"Check decoded.rol\"]\nIsAdmin[\"rol === 'admin'?\"]\nRedirectAuth3[\"Redirect to /authadmin\"]\nStoreUser[\"Store decoded in req.user\"]\nContinue[\"Call next()\"]\n\nRequest --&gt; CheckToken\nCheckToken --&gt; TokenExists\nTokenExists --&gt; RedirectAuth\nTokenExists --&gt; VerifyJWT\nVerifyJWT --&gt; ValidToken\nValidToken --&gt; RedirectAuth2\nValidToken --&gt; CheckRole\nCheckRole --&gt; IsAdmin\nIsAdmin --&gt; RedirectAuth3\nIsAdmin --&gt; StoreUser\nStoreUser --&gt; Continue</code></pre> <p>Implementation details:</p> <ul> <li>Location: middlewares/verifyAdmin.js L3-L15</li> <li>Additional check: <code>decoded.rol !== \"admin\"</code> triggers rejection</li> <li>Failure redirect: <code>/authadmin</code> (distinct from general auth failures)</li> <li>Cascading verification: Performs both token validation and role check</li> </ul> <p>Sources: middlewares/verifyAdmin.js L1-L17</p>"},{"location":"Role-Based-Access-Control/#route-protection-patterns","title":"Route Protection Patterns","text":""},{"location":"Role-Based-Access-Control/#protected-route-application","title":"Protected Route Application","text":"<p>Middleware guards are applied to route handlers in the Express routing layer. The system uses two protection patterns:</p> Pattern Middleware Applied To Purpose General Auth <code>verifyToken</code> Participant routes Requires any logged-in user Admin-Only <code>verifyAdmin</code> Administrative routes Requires admin role <p>Example route protection structure:</p> <pre><code>Router Configuration:\n\u251c\u2500\u2500 /perfil (GET)           \u2192 verifyToken \u2192 Participant profile view\n\u251c\u2500\u2500 /edit (GET/POST)        \u2192 verifyToken \u2192 Participant profile editing\n\u251c\u2500\u2500 /admin (GET)            \u2192 verifyAdmin \u2192 Participant management panel\n\u251c\u2500\u2500 /register (GET/POST)    \u2192 verifyAdmin \u2192 Organizer registration\n\u251c\u2500\u2500 /ganadores (GET/POST)   \u2192 verifyAdmin \u2192 Winner management\n\u2514\u2500\u2500 /editadmin/:id (POST)   \u2192 verifyAdmin \u2192 Admin participant editing\n</code></pre> <p>Sources: Referenced from Diagram 2 in high-level architecture</p>"},{"location":"Role-Based-Access-Control/#access-decision-flow","title":"Access Decision Flow","text":"<p>The following sequence diagram illustrates the complete authorization decision process for a protected route request:</p> <pre><code>sequenceDiagram\n  participant Browser\n  participant Express Router\n  participant verifyToken / verifyAdmin\n  participant jsonwebtoken.verify()\n  participant Route Handler\n\n  Browser-&gt;&gt;Express Router: \"GET /admin (with cookie)\"\n  Express Router-&gt;&gt;verifyToken / verifyAdmin: \"Intercept request\"\n  verifyToken / verifyAdmin-&gt;&gt;verifyToken / verifyAdmin: \"Extract req.cookies.token\"\n  loop [\"Role not admin\"]\n    verifyToken / verifyAdmin-&gt;&gt;Browser: \"302 Redirect to /loginadmin or /authadmin\"\n    verifyToken / verifyAdmin-&gt;&gt;jsonwebtoken.verify(): \"verify(token, JWT_SECRET)\"\n    jsonwebtoken.verify()--&gt;&gt;verifyToken / verifyAdmin: \"throw VerificationError\"\n    verifyToken / verifyAdmin-&gt;&gt;Browser: \"302 Redirect to /loginadmin or /authadmin\"\n    jsonwebtoken.verify()--&gt;&gt;verifyToken / verifyAdmin: \"Return decoded payload\"\n    verifyToken / verifyAdmin-&gt;&gt;verifyToken / verifyAdmin: \"decoded.rol === 'admin'?\"\n    verifyToken / verifyAdmin-&gt;&gt;Browser: \"302 Redirect to /authadmin\"\n    verifyToken / verifyAdmin-&gt;&gt;verifyToken / verifyAdmin: \"req.user = decoded\"\n    verifyToken / verifyAdmin-&gt;&gt;Route Handler: \"next()\"\n    Route Handler-&gt;&gt;Browser: \"200 OK with response\"\n    verifyToken / verifyAdmin-&gt;&gt;verifyToken / verifyAdmin: \"req.user = decoded\"\n    verifyToken / verifyAdmin-&gt;&gt;Route Handler: \"next()\"\n    Route Handler-&gt;&gt;Browser: \"200 OK with response\"\n  end</code></pre> <p>Sources: middlewares/verifyToken.js L3-L16</p> <p>middlewares/verifyAdmin.js L3-L15</p>"},{"location":"Role-Based-Access-Control/#role-based-navigation-rendering","title":"Role-Based Navigation Rendering","text":"<p>The <code>header.ejs</code> partial implements conditional navigation rendering based on the authenticated user's role:</p>"},{"location":"Role-Based-Access-Control/#navigation-menu-structure","title":"Navigation Menu Structure","text":"<pre><code>flowchart TD\n\nHeaderPartial[\"header.ejs partial\"]\nCheckUser[\"User authenticated?\"]\nPublicNav[\"Public Navigation\"]\nPubLinks[\"INICIO, INFO, INSCRIPCI\u00d3N&lt;br&gt;User Icon \u2192 /login&lt;br&gt;Shield Icon \u2192 /loginadmin\"]\nParticipantNav[\"Participant Navigation\"]\nPartLinks[\"INICIO, INFO&lt;br&gt;MI PERFIL \u2192 /perfil&lt;br&gt;Logout Icon \u2192 /logout\"]\nAdminNav[\"Admin Navigation\"]\nAdminLinks[\"INICIO, INFO&lt;br&gt;REG\u00cdSTRATE \u2192 /register&lt;br&gt;PANEL \u2192 /admin&lt;br&gt;GANADORES \u2192 /ganadores&lt;br&gt;Logout Icon \u2192 /logout\"]\n\nHeaderPartial --&gt; CheckUser\nCheckUser --&gt; PublicNav\nPublicNav --&gt; PubLinks\nCheckUser --&gt; ParticipantNav\nParticipantNav --&gt; PartLinks\nCheckUser --&gt; AdminNav\nAdminNav --&gt; AdminLinks</code></pre>"},{"location":"Role-Based-Access-Control/#implementation-details","title":"Implementation Details","text":"<p>The header uses EJS conditional blocks to render different navigation items:</p> <ol> <li>Unauthenticated state (<code>!user</code>): views/partials/header.ejs L18-L21 * Shows registration link * Shows participant login icon (<code>/login</code>) * Shows admin login icon (<code>/loginadmin</code>)</li> <li>Participant role (<code>rol === 'participante'</code>): views/partials/header.ejs L22-L24 * Shows profile link (<code>/perfil</code>) * Shows logout icon * Hides admin-only links</li> <li>Admin role (<code>rol === 'admin'</code>): views/partials/header.ejs L25-L30 * Shows organizer registration (<code>/register</code>) * Shows admin panel (<code>/admin</code>) * Shows winner management (<code>/ganadores</code>) * Shows logout icon</li> </ol> <p>Data source: The <code>user</code> and <code>rol</code> variables are populated from <code>res.locals</code> by middleware in <code>app.js</code>, which reads from <code>req.session</code>.</p> <p>Sources: views/partials/header.ejs L18-L30</p>"},{"location":"Role-Based-Access-Control/#jwt-token-payload-structure","title":"JWT Token Payload Structure","text":"<p>When authentication succeeds, the <code>authcontroller.js</code> generates a JWT token containing role information:</p> Field Type Description Example Value <code>id</code> Number User ID from database <code>42</code> <code>nombre</code> String User's first name (participante) or username (admin) <code>\"Juan\"</code> or <code>\"admin_user\"</code> <code>rol</code> String User role identifier <code>\"participante\"</code> or <code>\"admin\"</code> <code>iat</code> Number Issued at timestamp <code>1699564800</code> <code>exp</code> Number Expiration timestamp <code>1699651200</code> <p>The middleware guards decode this payload to access the <code>rol</code> field for authorization decisions.</p> <p>Sources: Referenced from Diagram 5 (Request Lifecycle) and middleware implementations</p>"},{"location":"Role-Based-Access-Control/#redirect-strategy","title":"Redirect Strategy","text":"<p>The system uses different redirect targets based on the type of authorization failure:</p> <pre><code>flowchart TD\n\nAuthFailure[\"Authorization Failure\"]\nType[\"Failure Type\"]\nLoginAdmin[\"/loginadmin\"]\nAuthAdmin[\"/authadmin\"]\nAuthAdmin2[\"/authadmin\"]\nLoginPage[\"General login page\"]\nUnauthorizedPage[\"Unauthorized access page\"]\nUnauthorizedPage2[\"Unauthorized access page\"]\n\nAuthFailure --&gt; Type\nType --&gt; LoginAdmin\nType --&gt; AuthAdmin\nType --&gt; AuthAdmin2\nLoginAdmin --&gt; LoginPage\nAuthAdmin --&gt; UnauthorizedPage\nAuthAdmin2 --&gt; UnauthorizedPage2</code></pre> <p>Redirect behavior:</p> <ul> <li><code>verifyToken</code> failures \u2192 <code>/loginadmin</code>: middlewares/verifyToken.js L6 middlewares/verifyToken.js L14</li> <li><code>verifyAdmin</code> token failures \u2192 <code>/authadmin</code>: middlewares/verifyAdmin.js L5 middlewares/verifyAdmin.js L13</li> <li><code>verifyAdmin</code> role check failures \u2192 <code>/authadmin</code>: middlewares/verifyAdmin.js L9</li> </ul> <p>This distinction allows the UI to differentiate between \"not logged in\" and \"insufficient privileges\" scenarios.</p> <p>Sources: middlewares/verifyToken.js L1-L19</p> <p>middlewares/verifyAdmin.js L1-L17</p>"},{"location":"Role-Based-Access-Control/#session-view-data-binding","title":"Session-View Data Binding","text":"<p>The Express application populates <code>res.locals</code> with session data for all views:</p> <pre><code>// Executed on every request in app.js middleware chain:\nres.locals.user = req.session.user || null;\nres.locals.rol = req.session.rol || null;\n</code></pre> <p>This makes <code>user</code> and <code>rol</code> variables globally available to all EJS templates without explicit passing from route handlers. The header partial leverages these variables for conditional rendering as documented in the Navigation Rendering section.</p> <p>Sources: Referenced from Diagram 5 (Request Lifecycle and Session Management)</p>"},{"location":"Role-Based-Access-Control/#authorization-summary-table","title":"Authorization Summary Table","text":"Resource Type Route Pattern Middleware Required Role Redirect on Failure Public pages <code>/</code>, <code>/info</code>, <code>/inscripcion</code> None None N/A Participant profile <code>/perfil</code> <code>verifyToken</code> Any authenticated <code>/loginadmin</code> Profile editing <code>/edit</code> <code>verifyToken</code> Any authenticated <code>/loginadmin</code> Admin panel <code>/admin</code> <code>verifyAdmin</code> <code>admin</code> <code>/authadmin</code> Winner management <code>/ganadores</code> <code>verifyAdmin</code> <code>admin</code> <code>/authadmin</code> Organizer registration <code>/register</code> <code>verifyAdmin</code> <code>admin</code> <code>/authadmin</code> Admin edit participant <code>/editadmin/:id</code> <code>verifyAdmin</code> <code>admin</code> <code>/authadmin</code> Delete participant <code>/delete/:id</code> <code>verifyAdmin</code> <code>admin</code> <code>/authadmin</code> <p>Sources: Referenced from Diagram 2 (Authentication and Authorization Flow)</p>"},{"location":"Session-Management/","title":"Session Management","text":"<p>Relevant source files * app.js * controllers/authcontroller.js</p>"},{"location":"Session-Management/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document describes the session management implementation in the HAPPY RUNNER 42K application. Session management maintains authenticated user state across HTTP requests using cookie-based sessions with the <code>cookie-session</code> middleware. The system stores user identity, role information, and authentication status to enable role-based access control and personalized user experiences.</p> <p>For information about how sessions are created during authentication, see Login System. For details on how session data enforces access control, see Role-Based Access Control.</p>"},{"location":"Session-Management/#session-configuration","title":"Session Configuration","text":"<p>The application configures session management using the <code>cookie-session</code> middleware package. Configuration occurs in app.js L9-L16</p> <p>with the following parameters:</p> <pre><code>cookieSession({\n    name: 'session',\n    keys: ['clave_secreta'],  \n    maxAge: 24 * 60 * 60 * 1000 \n})\n</code></pre>"},{"location":"Session-Management/#configuration-parameters","title":"Configuration Parameters","text":"Parameter Value Purpose <code>name</code> <code>'session'</code> Cookie name sent to client browser <code>keys</code> <code>['clave_secreta']</code> Signing key array for cookie signature verification <code>maxAge</code> <code>24 * 60 * 60 * 1000</code> Session expiration in milliseconds (24 hours) <p>The <code>cookie-session</code> middleware stores session data directly in the cookie rather than using server-side session storage. Each request includes the session cookie, which is cryptographically signed using the <code>keys</code> array to prevent tampering. The middleware automatically validates the signature and populates <code>req.session</code> with the decoded session data.</p> <p>Sources: app.js L9-L16</p>"},{"location":"Session-Management/#session-data-structure","title":"Session Data Structure","text":"<p>Session data varies based on user role. The system stores different identifiers for participants (DNI-based) versus administrators (username-based), along with a common role indicator.</p>"},{"location":"Session-Management/#participant-session-schema","title":"Participant Session Schema","text":"<pre><code>flowchart TD\n\nLoginSuccess[\"loginParticipante success\"]\nSetLoggedin[\"req.session.loggedin = true\"]\nSetDNI[\"req.session.dni = results[0].dni\"]\nSetRole[\"req.session.rol = 'participante'\"]\n\nLoginSuccess --&gt; SetLoggedin\nLoginSuccess --&gt; SetDNI\nLoginSuccess --&gt; SetRole</code></pre> <p>Participant Session Properties:</p> Property Type Description Set Location <code>loggedin</code> Boolean Authentication status flag controllers/authcontroller.js L31 <code>dni</code> String Participant's DNI identifier controllers/authcontroller.js L32 <code>rol</code> String Role value: <code>\"participante\"</code> controllers/authcontroller.js L33"},{"location":"Session-Management/#administrator-session-schema","title":"Administrator Session Schema","text":"<pre><code>flowchart TD\n\nLoginSuccess[\"loginAdmin success\"]\nSetLoggedin[\"req.session.loggedin = true\"]\nSetUser[\"req.session.user = results[0].user\"]\nSetRole[\"req.session.rol = 'admin'\"]\n\nLoginSuccess --&gt; SetLoggedin\nLoginSuccess --&gt; SetUser\nLoginSuccess --&gt; SetRole</code></pre> <p>Administrator Session Properties:</p> Property Type Description Set Location <code>loggedin</code> Boolean Authentication status flag controllers/authcontroller.js L77 <code>user</code> String Administrator username controllers/authcontroller.js L78 <code>rol</code> String Role value: <code>\"admin\"</code> controllers/authcontroller.js L79 <p>The <code>rol</code> property serves as the primary discriminator for role-based access control. Middleware guards check this value to enforce authorization rules (see Role-Based Access Control).</p> <p>Sources: controllers/authcontroller.js L31-L33</p> <p>controllers/authcontroller.js L77-L79</p>"},{"location":"Session-Management/#session-lifecycle","title":"Session Lifecycle","text":"<p>The session lifecycle encompasses initialization during authentication, persistence across requests, and automatic expiration.</p>"},{"location":"Session-Management/#lifecycle-stages","title":"Lifecycle Stages","text":"<p>1. Session Initialization</p> <p>Sessions are created during successful authentication in <code>authcontroller.js</code>. The <code>loginParticipante</code> function controllers/authcontroller.js L1-L45</p> <p>handles participant logins, while <code>loginAdmin</code> controllers/authcontroller.js L47-L91</p> <p>handles administrator logins. Both functions follow the same pattern:</p> <ul> <li>Validate credentials against database</li> <li>Set <code>req.session.loggedin = true</code></li> <li>Store user identifier (<code>dni</code> or <code>user</code>)</li> <li>Set <code>req.session.rol</code> to appropriate role</li> </ul> <p>2. Session Persistence</p> <p>On each request, <code>cookie-session</code> middleware app.js L12-L16</p> <p>:</p> <ul> <li>Extracts the session cookie from request headers</li> <li>Verifies the cryptographic signature using <code>keys: ['clave_secreta']</code></li> <li>Deserializes session data into <code>req.session</code> object</li> <li>Makes session data available to route handlers and subsequent middleware</li> </ul> <p>3. Session Expiration</p> <p>Sessions automatically expire after 24 hours (<code>maxAge: 24 * 60 * 60 * 1000</code> milliseconds). The browser discards expired cookies, and subsequent requests arrive without valid session data. Middleware guards redirect unauthenticated requests to appropriate login pages.</p> <p>Sources: app.js L12-L16</p> <p>controllers/authcontroller.js L31-L33</p> <p>controllers/authcontroller.js L77-L79</p>"},{"location":"Session-Management/#view-integration-via-reslocals","title":"View Integration via res.locals","text":"<p>Session data integrates with the EJS view layer through <code>res.locals</code> population. Middleware in app.js L22-L26</p> <p>extracts session properties and makes them available to all rendered templates.</p> <pre><code>flowchart TD\n\nIncomingRequest[\"Incoming Request\"]\nCookieSessionMW[\"cookie-session middleware&lt;br&gt;populates req.session\"]\nCustomMW[\"Custom middleware&lt;br&gt;app.js:22-26\"]\nExtractUser[\"res.locals.user = req.session.user || null\"]\nExtractRol[\"res.locals.rol = req.session.rol || null\"]\nRouteHandler[\"Route Handler\"]\nEJSRender[\"EJS Template Rendering\"]\nAccessLocals[\"Templates access:&lt;br&gt;user, rol variables\"]\n\nIncomingRequest --&gt; CookieSessionMW\nCookieSessionMW --&gt; CustomMW\nCustomMW --&gt; ExtractUser\nCustomMW --&gt; ExtractRol\nExtractUser --&gt; RouteHandler\nExtractRol --&gt; RouteHandler\nRouteHandler --&gt; EJSRender\nEJSRender --&gt; AccessLocals</code></pre>"},{"location":"Session-Management/#reslocals-population","title":"res.locals Population","text":"<p>The middleware at app.js L22-L26</p> <p>runs on every request:</p> <pre><code>app.use((req, res, next) =&gt; {\n  res.locals.user = req.session.user || null;\n  res.locals.rol = req.session.rol || null;\n  next();\n});\n</code></pre> <p>This pattern provides fallback values when no session exists (unauthenticated requests). EJS templates can safely reference <code>user</code> and <code>rol</code> variables without explicit null checks.</p>"},{"location":"Session-Management/#template-usage-patterns","title":"Template Usage Patterns","text":"<p>Role-Based Navigation</p> <p>The <code>header.ejs</code> partial uses <code>res.locals.rol</code> to render different navigation menus:</p> <pre><code>&lt;% if (rol === 'admin') { %&gt;\n    &lt;!-- Admin-specific navigation items --&gt;\n&lt;% } else if (rol === 'participante') { %&gt;\n    &lt;!-- Participant-specific navigation items --&gt;\n&lt;% } else { %&gt;\n    &lt;!-- Public navigation items --&gt;\n&lt;% } %&gt;\n</code></pre> <p>Conditional Rendering</p> <p>Templates use <code>res.locals.user</code> to determine authentication status:</p> <pre><code>&lt;% if (user) { %&gt;\n    &lt;!-- Content for authenticated users --&gt;\n&lt;% } else { %&gt;\n    &lt;!-- Content for guests --&gt;\n&lt;% } %&gt;\n</code></pre> <p>The <code>res.locals</code> pattern ensures session data propagates to all views without explicit parameter passing in route handlers. This reduces code duplication and maintains consistency across the application.</p> <p>Sources: app.js L22-L26</p>"},{"location":"Session-Management/#session-data-flow","title":"Session Data Flow","text":"<p>This diagram shows the complete flow of session data from creation through view rendering, mapping natural language concepts to specific code entities:</p> <pre><code>flowchart TD\n\nLoginPost[\"POST /auth route\"]\nParticipantAuth[\"loginParticipante()&lt;br&gt;authcontroller.js:1-45\"]\nAdminAuth[\"loginAdmin()&lt;br&gt;authcontroller.js:47-91\"]\nReqSession[\"req.session object\"]\nSessionProps[\"loggedin: Boolean&lt;br&gt;dni/user: String&lt;br&gt;rol: 'participante'|'admin'\"]\nCookieSerialization[\"cookie-session&lt;br&gt;Signed cookie&lt;br&gt;keys=['clave_secreta']\"]\nNextRequest[\"Next HTTP Request\"]\nCookieDeserialize[\"cookie-session middleware&lt;br&gt;app.js:12-16\"]\nCustomMiddleware[\"Custom middleware&lt;br&gt;app.js:22-26\"]\nResLocals[\"res.locals.user&lt;br&gt;res.locals.rol\"]\nRouteRender[\"Route handler calls&lt;br&gt;res.render()\"]\nEJSTemplate[\"EJS templates access&lt;br&gt;user and rol variables\"]\n\nParticipantAuth --&gt; ReqSession\nAdminAuth --&gt; ReqSession\nCookieSerialization --&gt; NextRequest\nCookieDeserialize --&gt; ReqSession\nReqSession --&gt; CustomMiddleware\nResLocals --&gt; RouteRender\n\nsubgraph subGraph3 [\"View Layer\"]\n    RouteRender\n    EJSTemplate\n    RouteRender --&gt; EJSTemplate\nend\n\nsubgraph subGraph2 [\"Request Processing\"]\n    NextRequest\n    CookieDeserialize\n    CustomMiddleware\n    ResLocals\n    NextRequest --&gt; CookieDeserialize\n    CustomMiddleware --&gt; ResLocals\nend\n\nsubgraph subGraph1 [\"Session Storage\"]\n    ReqSession\n    SessionProps\n    CookieSerialization\n    ReqSession --&gt; SessionProps\n    SessionProps --&gt; CookieSerialization\nend\n\nsubgraph subGraph0 [\"Authentication Layer\"]\n    LoginPost\n    ParticipantAuth\n    AdminAuth\n    LoginPost --&gt; ParticipantAuth\n    LoginPost --&gt; AdminAuth\nend</code></pre> <p>Sources: app.js L12-L16</p> <p>app.js L22-L26</p> <p>controllers/authcontroller.js L1-L45</p> <p>controllers/authcontroller.js L47-L91</p>"},{"location":"Session-Management/#security-considerations","title":"Security Considerations","text":""},{"location":"Session-Management/#cookie-signing","title":"Cookie Signing","text":"<p>The <code>cookie-session</code> middleware signs cookies using the <code>keys</code> array app.js L14</p> <p>The current implementation uses a single key <code>'clave_secreta'</code>. The signature prevents:</p> <ul> <li>Cookie Tampering: Clients cannot modify session data (e.g., changing <code>rol</code> from <code>\"participante\"</code> to <code>\"admin\"</code>) without invalidating the signature</li> <li>Session Forgery: Attackers cannot create valid session cookies without knowing the signing key</li> </ul>"},{"location":"Session-Management/#security-limitations","title":"Security Limitations","text":"<p>Current Implementation Issues:</p> Issue Impact Recommendation Hardcoded signing key Key exposed in source code Move to environment variable (<code>process.env.SESSION_SECRET</code>) No HTTPS enforcement Cookies transmitted in plaintext over HTTP Add <code>secure: true</code> flag in production Missing <code>httpOnly</code> flag Cookies accessible via JavaScript Enable <code>httpOnly: true</code> to prevent XSS attacks No <code>sameSite</code> policy Vulnerable to CSRF attacks Set <code>sameSite: 'strict'</code> or <code>'lax'</code>"},{"location":"Session-Management/#session-expiration","title":"Session Expiration","text":"<p>The 24-hour <code>maxAge</code> app.js L15</p> <p>balances security and user convenience. Users remain authenticated for one day without re-login. After expiration:</p> <ul> <li>Browser discards the cookie</li> <li><code>req.session</code> becomes empty object</li> <li>Middleware guards detect missing <code>loggedin</code> flag</li> <li>Unauthenticated requests redirect to login pages</li> </ul> <p>No server-side session invalidation exists. Users cannot explicitly \"logout\" to destroy sessions before expiration. Implementing logout requires clearing session data:</p> <pre><code>req.session = null;  // Clears all session data\n</code></pre> <p>Sources: app.js L12-L16</p>"},{"location":"Session-Management/#session-management-summary","title":"Session Management Summary","text":"<p>The HAPPY RUNNER 42K application implements cookie-based session management with the following characteristics:</p> Aspect Implementation Middleware <code>cookie-session</code> package Storage Client-side cookies (signed, not encrypted) Duration 24 hours Signing Key <code>'clave_secreta'</code> (hardcoded) Session Properties <code>loggedin</code>, <code>dni</code>/<code>user</code>, <code>rol</code> View Integration <code>res.locals</code> population via custom middleware Role Discrimination <code>rol</code> property: <code>\"participante\"</code> or <code>\"admin\"</code> <p>The session system enables stateful authentication without server-side session storage, integrating tightly with role-based access control and view rendering systems.</p> <p>Sources: app.js L9-L26</p> <p>controllers/authcontroller.js L31-L33</p> <p>controllers/authcontroller.js L77-L79</p>"},{"location":"Shared-Components/","title":"Shared Components","text":"<p>Relevant source files * views/partials/head.ejs * views/partials/header.ejs</p>"},{"location":"Shared-Components/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document describes the reusable EJS partial templates that provide consistent layout and functionality across all pages in the HAPPY RUNNER 42K application. These shared components establish a modular frontend architecture where common elements are defined once and included across multiple views.</p> <p>The shared components consist of:</p> <ul> <li>Head partial: Centralizes external library loading, meta tags, and global dependencies</li> <li>Header partial: Implements role-based navigation and application branding</li> <li>Footer partial: Provides consistent page closure (referenced in architecture but not detailed here)</li> </ul> <p>For information about the full page templates that consume these partials, see Participant Interfaces and Admin Interfaces. For styling of these components, see Design System.</p>"},{"location":"Shared-Components/#partial-inclusion-architecture","title":"Partial Inclusion Architecture","text":"<p>The application uses EJS's partial inclusion mechanism to compose pages from reusable components. Each full page template includes shared partials, reducing code duplication and ensuring consistency.</p> <p>Partial Inclusion Pattern Diagram</p> <pre><code>flowchart TD\n\nHeadEJS[\"views/partials/head.ejs&lt;br&gt;External Dependencies\"]\nHeaderEJS[\"views/partials/header.ejs&lt;br&gt;Navigation &amp; Branding\"]\nFooterEJS[\"views/partials/footer.ejs&lt;br&gt;Page Closure\"]\nIndexEJS[\"views/index.ejs\"]\nLoginEJS[\"views/login.ejs\"]\nInscripcionEJS[\"views/inscripcion.ejs\"]\nPerfilEJS[\"views/perfil.ejs\"]\nEditEJS[\"views/edit.ejs\"]\nAdminEJS[\"views/admin.ejs\"]\nInfoEJS[\"views/info.ejs\"]\nRegisterEJS[\"views/register.ejs\"]\n\nHeadEJS --&gt; IndexEJS\nHeadEJS --&gt; LoginEJS\nHeadEJS --&gt; InscripcionEJS\nHeadEJS --&gt; PerfilEJS\nHeadEJS --&gt; AdminEJS\nHeaderEJS --&gt; IndexEJS\nHeaderEJS --&gt; InscripcionEJS\nHeaderEJS --&gt; PerfilEJS\nHeaderEJS --&gt; InfoEJS\nFooterEJS --&gt; IndexEJS\nFooterEJS --&gt; PerfilEJS\nFooterEJS --&gt; InfoEJS\n\nsubgraph PageTemplates [\"Page Templates\"]\n    IndexEJS\n    LoginEJS\n    InscripcionEJS\n    PerfilEJS\n    EditEJS\n    AdminEJS\n    InfoEJS\n    RegisterEJS\nend\n\nsubgraph PartialTemplates [\"Partial Templates\"]\n    HeadEJS\n    HeaderEJS\n    FooterEJS\nend</code></pre> <p>Sources: System architecture diagrams, <code>views/partials/head.ejs</code>, <code>views/partials/header.ejs</code></p>"},{"location":"Shared-Components/#head-partial","title":"Head Partial","text":"<p>The <code>head.ejs</code> partial defines the HTML document head section, loading all external dependencies and establishing global page configuration. This partial is included in every page template, providing a single source of truth for library versions and meta tags.</p>"},{"location":"Shared-Components/#document-configuration","title":"Document Configuration","text":"<p>The head partial establishes basic HTML5 document structure with UTF-8 encoding and responsive viewport configuration:</p> Configuration Value Purpose Character Set <code>utf-8</code> UTF-8 encoding for international character support Viewport <code>width=device-width, initial-scale=1</code> Responsive mobile-first rendering IE Compatibility <code>IE=edge</code> Forces latest IE rendering engine Page Title \"Happy Runner\" Browser tab title Meta Description Marathon event details SEO optimization <p>views/partials/head.ejs L4-L8</p>"},{"location":"Shared-Components/#external-library-dependencies","title":"External Library Dependencies","text":"<p>The head partial loads six external library dependencies in a specific order to ensure proper initialization:</p> <p>External Library Loading Sequence</p> <pre><code>flowchart TD\n\nHeadEJS[\"head.ejs\"]\nStyleCSS[\"/resources/css/style.css&lt;br&gt;Base application styles\"]\nBoxicons[\"Boxicons 2.1.4&lt;br&gt;Icon library\"]\nFontAwesome[\"Font Awesome 6.5.0&lt;br&gt;Icon library\"]\nBootstrap[\"Bootstrap 5.3.3&lt;br&gt;CSS + JS bundle\"]\nAnimateCSS[\"Animate.css 4.1.1&lt;br&gt;Animation utilities\"]\nLeaflet[\"Leaflet CSS&lt;br&gt;Interactive maps\"]\nMontserratReg[\"Montserrat-Regular.woff2&lt;br&gt;Preloaded font\"]\nMontserratBold[\"Montserrat-Bold.woff2&lt;br&gt;Preloaded font\"]\n\nHeadEJS --&gt; StyleCSS\nHeadEJS --&gt; Boxicons\nHeadEJS --&gt; FontAwesome\nHeadEJS --&gt; Bootstrap\nHeadEJS --&gt; AnimateCSS\nHeadEJS --&gt; Leaflet\nHeadEJS --&gt; MontserratReg\nHeadEJS --&gt; MontserratBold\n\nsubgraph FontOptimization [\"Font Optimization\"]\n    MontserratReg\n    MontserratBold\nend\n\nsubgraph MapLibrary [\"Mapping\"]\n    Leaflet\nend\n\nsubgraph UIFrameworks [\"UI Frameworks\"]\n    Bootstrap\n    AnimateCSS\nend\n\nsubgraph CoreStyling [\"Core Styling &amp; Icons\"]\n    StyleCSS\n    Boxicons\n    FontAwesome\nend</code></pre> <p>Detailed Library Configuration:</p> Library Version CDN/Local Purpose in Application <code>style.css</code> Local <code>/resources/css/style.css</code> Base application styles, design tokens Boxicons 2.1.4 unpkg.com User interface icons (login, logout, profile) Leaflet Latest unpkg.com Interactive race route maps on landing and info pages Montserrat Fonts Custom Local <code>/fonts/</code> Primary typography, preloaded for performance Animate.css 4.1.1 cdnjs CSS animation utilities for transitions Font Awesome 6.5.0 cdnjs Additional icon set for UI elements Bootstrap 5.3.3 jsdelivr CSS framework and JavaScript components <p>views/partials/head.ejs L9-L17</p>"},{"location":"Shared-Components/#font-preloading-strategy","title":"Font Preloading Strategy","text":"<p>The head partial implements font preloading for performance optimization. The <code>rel=\"preload\"</code> directive instructs the browser to download Montserrat font files early in the page load process, preventing flash of unstyled text (FOUT):</p> <ul> <li>Montserrat-Regular.woff2: views/partials/head.ejs L12</li> <li>Montserrat-Bold.woff2: views/partials/head.ejs L13</li> </ul> <p>Both fonts use <code>crossorigin</code> attribute to ensure proper CORS handling for font files.</p>"},{"location":"Shared-Components/#seo-and-metadata","title":"SEO and Metadata","text":"<p>The meta description provides search engine optimization with event-specific details:</p> <pre><code>\"Marat\u00f3n 42K Ciudad de Barcelona \u2014 29 Nov 2025. Categor\u00edas masculina y femenina. \nInscripciones abiertas. Kit oficial y puntos de hidrataci\u00f3n.\"\n</code></pre> <p>This includes the event date (November 29, 2025), location (Barcelona), race categories, and key participant benefits.</p> <p>Sources: <code>views/partials/head.ejs</code></p>"},{"location":"Shared-Components/#header-partial","title":"Header Partial","text":"<p>The <code>header.ejs</code> partial implements the application's primary navigation bar with dynamic role-based menu items. This component closes the HTML <code>&lt;head&gt;</code> section and opens the <code>&lt;body&gt;</code>, establishing the page's visual hierarchy.</p>"},{"location":"Shared-Components/#component-structure","title":"Component Structure","text":"<p>Header Component Architecture</p> <pre><code>flowchart TD\n\nUserVar[\"user&lt;br&gt;Current user object\"]\nRolVar[\"rol&lt;br&gt;User role string\"]\nHeaderEJS[\"header.ejs\"]\nLogo[\"div.logo&lt;br&gt;Logo Image + Text\"]\nMenuBtn[\"div.menu-btn&lt;br&gt;Mobile Toggle Button\"]\nNavLinks[\"div.nav-links#navLinks&lt;br&gt;Navigation Menu\"]\nUserCheck[\"if !user&lt;br&gt;Unauthenticated State\"]\nParticipantCheck[\"if rol === 'participante'&lt;br&gt;Participant State\"]\nAdminCheck[\"if rol === 'admin'&lt;br&gt;Admin State\"]\nUnauthLinks[\"INICIO, INFO, INSCRIPCI\u00d3N&lt;br&gt;Login Icons\"]\nParticipantLinks[\"INICIO, INFO, MI PERFIL&lt;br&gt;Logout\"]\nAdminLinks[\"INICIO, INFO, REG\u00cdSTRATE&lt;br&gt;PANEL, GANADORES, Logout\"]\n\nUserCheck --&gt; UnauthLinks\nParticipantCheck --&gt; ParticipantLinks\nAdminCheck --&gt; AdminLinks\n\nsubgraph DynamicContent [\"Dynamic Content via EJS\"]\n    UserCheck\n    ParticipantCheck\n    AdminCheck\nend\n\nsubgraph NavBar [\"Navigation Bar\"]\n    Logo\n    MenuBtn\n    NavLinks\nend\n\nsubgraph SessionData [\"Session Data (res.locals)\"]\n    UserVar\n    RolVar\nend</code></pre>"},{"location":"Shared-Components/#logo-and-branding","title":"Logo and Branding","text":"<p>The logo component combines the application icon with text branding:</p> <ul> <li>Image: <code>/resources/img/happy.png</code> displays the Happy Runner logo</li> <li>Text: \"Happy Runner\" span provides text-based branding</li> <li>Container: <code>.logo</code> div wrapper for styling and layout</li> </ul> <p>views/partials/header.ejs L6-L9</p>"},{"location":"Shared-Components/#mobile-menu-toggle","title":"Mobile Menu Toggle","text":"<p>The header includes a hamburger menu button for mobile responsiveness:</p> <ul> <li>Element: <code>.menu-btn</code> div with <code>onclick=\"toggleMenu()\"</code> handler</li> <li>Structure: Three nested <code>&lt;div&gt;</code> elements create the hamburger icon lines</li> <li>Target: Toggles visibility of <code>#navLinks</code> navigation container</li> </ul> <p>views/partials/header.ejs L10-L14</p>"},{"location":"Shared-Components/#role-based-navigation-system","title":"Role-Based Navigation System","text":"<p>The navigation menu dynamically renders different link sets based on the user's authentication state and role. The system reads <code>user</code> and <code>rol</code> variables from <code>res.locals</code>, which are populated by middleware on each request.</p> <p>Navigation Menu Variations Table</p> User State Condition Links Displayed Unauthenticated <code>!user</code> INICIO, INFO, INSCRIPCI\u00d3N, User login icon, Admin login icon Participant <code>rol === 'participante'</code> INICIO, INFO, MI PERFIL, Logout icon Administrator <code>rol === 'admin'</code> INICIO, INFO, REG\u00cdSTRATE, PANEL, GANADORES, Logout <p>Navigation Routes by Role</p> <pre><code>flowchart TD\n\nRegisterOrg[\"/register REG\u00cdSTRATE\"]\nAdminPanel[\"/admin PANEL\"]\nWinners[\"/ganadores GANADORES\"]\nLogoutA[\"/logout Logout Icon&lt;br&gt;bxs-log-out\"]\nProfile[\"/perfil MI PERFIL\"]\nLogoutP[\"/logout Logout Icon&lt;br&gt;bxs-log-out\"]\nRegistration[\"/inscripcion INSCRIPCI\u00d3N&lt;br&gt;btn-primary\"]\nLoginParticipant[\"/login User Icon&lt;br&gt;bx-user-circle\"]\nLoginAdmin[\"/loginadmin Shield Icon&lt;br&gt;bxs-shield\"]\nHome[\"/ INICIO\"]\nInfo[\"/info INFO\"]\nNavLinks[\"Navigation Links Container\"]\n\nsubgraph AdminLinks [\"Admin Only\"]\n    RegisterOrg\n    AdminPanel\n    Winners\n    LogoutA\nend\n\nsubgraph ParticipantLinks [\"Participant Only\"]\n    Profile\n    LogoutP\nend\n\nsubgraph UnauthLinks [\"Unauthenticated Only\"]\n    Registration\n    LoginParticipant\n    LoginAdmin\nend\n\nsubgraph CommonLinks [\"Common Links (All Users)\"]\n    Home\n    Info\nend</code></pre>"},{"location":"Shared-Components/#ejs-conditional-logic","title":"EJS Conditional Logic","text":"<p>The header partial uses EJS conditionals to determine which navigation items to render:</p> <ol> <li>Check for unauthenticated user: views/partials/header.ejs L18-L21 * Renders registration link with <code>.btn-primary</code> class * Shows participant login icon (<code>bx-user-circle</code>) * Shows admin login icon (<code>bxs-shield</code>)</li> <li>Check for participant role: views/partials/header.ejs L22-L24 * Displays \"MI PERFIL\" link to <code>/perfil</code> * Shows logout icon (<code>bxs-log-out</code>)</li> <li>Check for admin role: views/partials/header.ejs L25-L29 * \"REG\u00cdSTRATE\" link for registering new organizers * \"PANEL\" link to admin dashboard at <code>/admin</code> * \"GANADORES\" link to winner management * Logout icon</li> </ol>"},{"location":"Shared-Components/#icon-integration","title":"Icon Integration","text":"<p>The header uses Boxicons for user interface icons:</p> Icon Class Visual Purpose Roles <code>bx-user-circle</code> User avatar Participant login Unauthenticated <code>bxs-shield</code> Shield Admin login Unauthenticated <code>bxs-log-out</code> Exit arrow Logout action Participant, Admin <p>These icons are rendered as <code>&lt;i&gt;</code> elements within anchor tags.</p>"},{"location":"Shared-Components/#session-variable-dependencies","title":"Session Variable Dependencies","text":"<p>The header partial depends on two <code>res.locals</code> variables populated by middleware in the application server:</p> <ul> <li><code>user</code>: Object containing current user data (or <code>null</code>/<code>undefined</code> if not authenticated)</li> <li><code>rol</code>: String indicating user role (<code>'participante'</code> or <code>'admin'</code>)</li> </ul> <p>These variables are set by middleware that reads session data from <code>req.session</code> and makes it available to all EJS views. See Session Management for details on how these variables are populated.</p> <p>Sources: <code>views/partials/header.ejs</code></p>"},{"location":"Shared-Components/#integration-with-page-templates","title":"Integration with Page Templates","text":"<p>Shared components are integrated into page templates using EJS include syntax. The typical pattern is:</p> <pre><code>&lt;%- include('partials/head') %&gt;\n&lt;%- include('partials/header') %&gt;\n\n&lt;!-- Page-specific content --&gt;\n\n&lt;%- include('partials/footer') %&gt;\n</code></pre> <p>The <code>&lt;%-</code> syntax executes the include directive and renders unescaped HTML, while <code>&lt;%=</code> would escape HTML entities.</p>"},{"location":"Shared-Components/#inclusion-patterns-by-page-type","title":"Inclusion Patterns by Page Type","text":"<p>Different page types include different combinations of partials:</p> Page Type Head Header Footer Reason Landing (<code>index.ejs</code>) \u2713 \u2713 \u2713 Full layout with navigation Login pages \u2713 \u2717 \u2717 Focused authentication flow Registration \u2713 \u2713 \u2717 Public page with navigation Profile pages \u2713 \u2713 \u2713 Authenticated user pages Admin pages \u2713 \u2713 \u2717 Admin-specific layout Info page \u2713 \u2713 \u2713 Public information page <p>This selective inclusion allows pages to maintain consistency while adapting layout to their specific context.</p> <p>Sources: System architecture diagrams</p>"},{"location":"Shared-Components/#styling-and-customization","title":"Styling and Customization","text":"<p>While the head partial loads the base <code>style.css</code> stylesheet, individual pages can supplement this with additional page-specific stylesheets loaded after the shared components. This creates a cascade where:</p> <ol> <li>Global styles from <code>style.css</code> apply to all elements, including shared components</li> <li>Page-specific styles override or extend global styles as needed</li> </ol> <p>The navigation bar in <code>header.ejs</code> uses classes like <code>.logo</code>, <code>.menu-btn</code>, and <code>.nav-links</code> that are styled in <code>style.css</code>. The <code>.btn-primary</code> class on the registration link provides consistent button styling across the application.</p> <p>For detailed information about the styling system, see Design System and Component Styles.</p> <p>Sources: <code>views/partials/head.ejs</code>, <code>views/partials/header.ejs</code></p>"},{"location":"Styling-System/","title":"Styling System","text":"<p>Relevant source files * middlewares/multer.js * middlewares/verifyAdmin.js * middlewares/verifyToken.js * public/css/admin.css * public/css/edit.css * public/css/style.css</p>"},{"location":"Styling-System/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document describes the CSS architecture and styling system used throughout the HAPPY RUNNER 42K application. The styling system is built on a foundation of CSS custom properties (design tokens), modular page-specific stylesheets, and responsive design patterns. All styles follow a consistent design language centered around a blue/teal color palette and modern gradient effects.</p> <p>For information about the EJS view templates that these styles are applied to, see User Interfaces. For details about external library integration (Bootstrap, Leaflet, Font Awesome), see Shared Components.</p>"},{"location":"Styling-System/#css-architecture-overview","title":"CSS Architecture Overview","text":"<p>The styling system follows a modular architecture where a base stylesheet defines global design tokens and reusable patterns, while page-specific stylesheets handle component-level customization.</p>"},{"location":"Styling-System/#stylesheet-organization","title":"Stylesheet Organization","text":"<p>Sources: public/css/style.css L1-L721</p> <p>public/css/admin.css L1-L157</p> <p>public/css/edit.css L1-L150</p>"},{"location":"Styling-System/#design-token-system","title":"Design Token System","text":"<p>The application uses CSS custom properties defined in <code>:root</code> blocks to maintain a consistent design language across all pages. These tokens are accessible globally and ensure visual coherence.</p>"},{"location":"Styling-System/#core-color-palette","title":"Core Color Palette","text":"Token Name Value Usage <code>--lapis-lazuli</code> <code>#2f6690ff</code> Primary brand color, navigation gradients, headings <code>--cerulean</code> <code>#3a7ca5ff</code> Secondary brand color, gradient endpoints <code>--platinum</code> <code>#d9dcd6ff</code> Background tints, subtle overlays <code>--indigo-dye</code> <code>#16425bff</code> Dark text, strong contrast elements <code>--sky-blue</code> <code>#81c3d7ff</code> Accent color, badges, highlights <code>--white</code> <code>#ffffff</code> Text on dark backgrounds, card backgrounds <code>--accent</code> <code>#d2643c</code> Call-to-action elements (only in style.css) <p>The color system is defined identically across all stylesheets:</p> <p>public/css/style.css L3-L11</p> <pre><code>:root {\n  --lapis-lazuli: #2f6690ff;\n  --cerulean:     #3a7ca5ff;\n  --platinum:     #d9dcd6ff;\n  --indigo-dye:   #16425bff;\n  --sky-blue:     #81c3d7ff;\n  --white:        #ffffff;\n  --accent:       #d2643c;\n  --glass:        rgba(255,255,255,0.96);\n}\n</code></pre>"},{"location":"Styling-System/#spacing-and-layout-tokens","title":"Spacing and Layout Tokens","text":"Token Value Purpose <code>--radius</code> <code>14px</code> Default border radius for cards and components <code>--gap</code> <code>1rem</code> Standard spacing between elements <code>--max-width</code> <code>1200px</code> Maximum content width for containers <code>--card-max-width</code> <code>980px</code> Maximum width for admin cards (admin.css only)"},{"location":"Styling-System/#shadow-system","title":"Shadow System","text":"Token Value Application <code>--shadow-soft</code> <code>0 12px 32px rgba(10,30,45,0.08)</code> Default card elevation <code>--shadow-strong</code> <code>0 20px 60px rgba(10,30,45,0.14)</code> Hover states, emphasized elements <code>--muted-shadow</code> <code>rgba(22,66,91,0.08)</code> Subtle shadows (admin.css)"},{"location":"Styling-System/#typography-tokens","title":"Typography Tokens","text":"<p>public/css/style.css L22-L27</p> <pre><code>/* typography (AUMENTADO) */\n--fz-base: 18px;         /* aumentado para mejor lectura */\n--fz-lg: 1.25rem;\n--fz-sm: .95rem;\n--leading: 1.55;\n</code></pre> <p>Sources: public/css/style.css L3-L27</p> <p>public/css/admin.css L1-L11</p> <p>public/css/edit.css L2-L9</p>"},{"location":"Styling-System/#global-base-styles","title":"Global Base Styles","text":"<p>The base stylesheet public/css/style.css</p> <p>establishes foundational styles that apply across all pages.</p>"},{"location":"Styling-System/#box-model-and-reset","title":"Box Model and Reset","text":"<p>public/css/style.css L29-L40</p> <pre><code>/* ----------------- Base / Reset ----------------- */\n* { box-sizing: border-box; }\nhtml, body { height: 100%; }\nbody{\n  margin: 0;\n  font-family: \"Montserrat\", system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial; \n  font-size: var(--fz-base);\n  line-height: var(--leading);\n  color: var(--indigo-dye);\n  background: linear-gradient(180deg, var(--platinum) 0%, #f4fbff 100%);\n  -webkit-font-smoothing:antialiased;\n}\n</code></pre> <p>All pages use the Montserrat font family with system font fallbacks. The body has a subtle gradient background from <code>--platinum</code> to a light blue tint.</p>"},{"location":"Styling-System/#container-utility","title":"Container Utility","text":"<p>public/css/style.css L42-L43</p> <pre><code>.container { width: calc(100% - 2rem); max-width: var(--max-width); margin: 0 auto; padding: 0 1rem; }\n</code></pre> <p>The <code>.container</code> class provides centered content with responsive width and maximum constraints.</p> <p>Sources: public/css/style.css L29-L43</p>"},{"location":"Styling-System/#navigation-system","title":"Navigation System","text":"<p>The navigation bar uses a sticky positioning pattern with gradient backgrounds and responsive behavior.</p>"},{"location":"Styling-System/#desktop-navigation-structure","title":"Desktop Navigation Structure","text":"<pre><code>flowchart TD\n\nNav[\"nav element&lt;br&gt;sticky position\"]\nLogo[\"logo div&lt;br&gt;img + span\"]\nNavLinks[\"nav-links div&lt;br&gt;desktop menu\"]\nMenuBtn[\"menu-btn div&lt;br&gt;mobile hamburger\"]\nLinkStandard[\"Standard links&lt;br&gt;hover: rgba white\"]\nLinkCTA[\"btn-primary CTA&lt;br&gt;gradient background\"]\n\nNav --&gt; Logo\nNav --&gt; NavLinks\nNav --&gt; MenuBtn\nNavLinks --&gt; LinkStandard\nNavLinks --&gt; LinkCTA</code></pre> <p>public/css/style.css L45-L58</p> <pre><code>nav {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 2rem;\n  background: linear-gradient(90deg, var(--lapis-lazuli), var(--cerulean));\n  color: var(--white);\n  position: sticky;\n  top: 0;\n  z-index: 120;\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);\n  font-family: 'Montserrat', system-ui, sans-serif;\n}\n</code></pre>"},{"location":"Styling-System/#navigation-link-styles","title":"Navigation Link Styles","text":"Class Styling Purpose <code>.nav-links a</code> White text, <code>0.5rem 1rem</code> padding, <code>border-radius: 12px</code> Standard navigation links <code>.nav-links a:hover</code> <code>background: rgba(255, 255, 255, 0.15)</code>, <code>transform: translateY(-2px)</code> Hover state with subtle lift <code>.nav-links a.btn-primary</code> Gradient <code>#ff5f6d</code> to <code>#ffc371</code>, rounded pill shape Special CTA button (Inscripci\u00f3n)"},{"location":"Styling-System/#mobile-navigation-behavior","title":"Mobile Navigation Behavior","text":"<p>public/css/style.css L150-L167</p> <pre><code>@media (max-width: 780px) {\n  .menu-btn { display: flex; }\n  .nav-links {\n    display: none;\n    flex-direction: column;\n    position: absolute;\n    top: 70px;\n    right: 12px;\n    background: rgba(0,0,0,0.7);\n    border-radius: 12px;\n    padding: 1rem;\n    min-width: 220px;\n  }\n  .nav-links.active { display: flex; }\n}\n</code></pre> <p>On mobile (\u2264780px), the navigation collapses into a hamburger menu. The <code>.menu-btn</code> displays three horizontal bars that toggle the <code>.nav-links.active</code> state via JavaScript.</p> <p>Sources: public/css/style.css L45-L167</p>"},{"location":"Styling-System/#hero-banner-system","title":"Hero Banner System","text":"<p>The landing page hero banner combines a background image, overlay effects, and parallax-inspired transforms.</p>"},{"location":"Styling-System/#banner-structure-and-styling","title":"Banner Structure and Styling","text":"<pre><code>flowchart TD\n\nBanner[\".banner&lt;br&gt;min-height: 72vh&lt;br&gt;position: relative\"]\nBgImage[\"background-image&lt;br&gt;/resources/img/bunner.jpg\"]\nOverlay[\".banner-overlay&lt;br&gt;gradient overlay&lt;br&gt;backdrop-filter: blur\"]\nBannerText[\".banner-text&lt;br&gt;z-index: 2&lt;br&gt;transform: translateZ\"]\nHeroTitle[\".hero-title&lt;br&gt;clamp 2rem-3.6rem\"]\nLead[\".lead&lt;br&gt;font-weight: 700\"]\nBannerDesc[\".banner-desc&lt;br&gt;max-width: 68ch\"]\nHeroCTA[\".hero-cta&lt;br&gt;flex gap\"]\nCountdown[\".countdown&lt;br&gt;inline-block badge\"]\nBtnBanner[\".btn-banner&lt;br&gt;gradient accent\"]\nBtnOutline[\".btn-outline&lt;br&gt;border white\"]\n\nBanner --&gt; BgImage\nBanner --&gt; Overlay\nBanner --&gt; BannerText\nBannerText --&gt; HeroTitle\nBannerText --&gt; Lead\nBannerText --&gt; BannerDesc\nBannerText --&gt; HeroCTA\nBannerText --&gt; Countdown\nHeroCTA --&gt; BtnBanner\nHeroCTA --&gt; BtnOutline</code></pre> <p>public/css/style.css L209-L229</p> <pre><code>.banner {\n  position: relative;\n  min-height: 72vh;\n  display: flex;\n  align-items: center;\n  overflow: hidden;\n  background-image: url('/resources/img/bunner.jpg');\n  background-size: cover;\n  background-position: center;\n  perspective: 1400px;\n  transition: transform .18s ease;\n}\n\n/* overlay intenso para mejor contraste del texto */\n.banner-overlay {\n  position: absolute;\n  inset: 0;\n  background: linear-gradient(180deg, rgba(6,24,36,0.72), rgba(17,46,66,0.45));\n  z-index: 1;\n  backdrop-filter: blur(2px);\n}\n</code></pre> <p>The banner uses a dark gradient overlay (<code>rgba(6,24,36,0.72)</code> to <code>rgba(17,46,66,0.45)</code>) with a 2px blur to ensure text contrast over the background image.</p>"},{"location":"Styling-System/#responsive-typography","title":"Responsive Typography","text":"<p>The <code>.hero-title</code> uses <code>clamp()</code> for fluid typography:</p> <p>public/css/style.css L243-L249</p> <pre><code>.hero-title {\n  font-size: clamp(2rem, 5.2vw, 3.6rem);\n  margin: 0.1rem 0;\n  font-weight: 800;\n  letter-spacing: -0.02em;\n  line-height: 1.02;\n}\n</code></pre> <p>This scales from 2rem (mobile) to 3.6rem (desktop) based on viewport width.</p> <p>Sources: public/css/style.css L208-L297</p>"},{"location":"Styling-System/#card-system","title":"Card System","text":"<p>Cards are the primary content container pattern, with two variants: light (default) and dark (emphasized).</p>"},{"location":"Styling-System/#card-component-hierarchy","title":"Card Component Hierarchy","text":"<pre><code>flowchart TD\n\nCardBase[\".card base styles&lt;br&gt;border-radius: var--radius&lt;br&gt;padding: 1.25rem\"]\nCardLight[\".card default&lt;br&gt;background: linear-gradient&lt;br&gt;white to fbfdff\"]\nCardDark[\".card--dark&lt;br&gt;background: dark gradients&lt;br&gt;color: white\"]\nCardDetail[\".detail&lt;br&gt;flex: 1 1 220px\"]\nCardCat[\".cat&lt;br&gt;category cards&lt;br&gt;hover: translateY-10px\"]\nCardWinners[\"winners-section&lt;br&gt;dark emphasis\"]\nCardMap[\"map-card&lt;br&gt;dark tones\"]\n\nCardBase --&gt; CardLight\nCardBase --&gt; CardDark\nCardLight --&gt; CardDetail\nCardLight --&gt; CardCat\nCardDark --&gt; CardWinners\nCardDark --&gt; CardMap</code></pre> <p>public/css/style.css L318-L348</p> <pre><code>.card {\n  border-radius: var(--radius);\n  padding: 1.25rem;\n  box-shadow: var(--shadow-soft);\n  border: 1px solid rgba(22,66,91,0.06);\n  background: linear-gradient(180deg, rgba(255,255,255,0.98), #fbfdff);\n  transition: transform .18s ease, box-shadow .18s ease;\n}\n\n/* Dark / Emphasized card (m\u00e1s color oscuro y contraste) */\n.card--dark {\n  background: linear-gradient(180deg, rgba(6,24,36,0.92), rgba(14,34,48,0.94));\n  color: var(--white);\n  border: 1px solid rgba(255,255,255,0.04);\n  box-shadow: var(--shadow-strong);\n}\n</code></pre>"},{"location":"Styling-System/#category-cards-with-hover-effects","title":"Category Cards with Hover Effects","text":"<p>public/css/style.css L354-L365</p> <pre><code>.cat {\n  flex: 1 1 300px;\n  border-radius: var(--radius);\n  padding: 1.25rem;\n  border: 1px solid rgba(22,66,91,0.06);\n  box-shadow: var(--shadow-soft);\n  background: linear-gradient(180deg, var(--white), #fbfdff);\n  transition: transform .28s cubic-bezier(.2,.9,.3,1), box-shadow .28s;\n}\n.cat:hover { transform: translateY(-10px); box-shadow: var(--shadow-strong); }\n</code></pre> <p>Category cards (<code>.cat</code>) lift 10px on hover with a cubic-bezier easing for smooth animation.</p> <p>Sources: public/css/style.css L316-L365</p>"},{"location":"Styling-System/#specialized-component-styles","title":"Specialized Component Styles","text":""},{"location":"Styling-System/#photo-gallery-grid","title":"Photo Gallery Grid","text":"<p>public/css/style.css L368-L385</p> <pre><code>.gallery-container {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));\n  gap: 1rem;\n  margin-top: 0.5rem;\n}\n.gallery-container figure {\n  border-radius: 12px;\n  overflow: hidden;\n  background: linear-gradient(180deg, rgba(6,24,36,0.03), rgba(6,24,36,0.01));\n  box-shadow: var(--shadow-soft);\n  transition: transform .36s ease, box-shadow .22s;\n}\n.gallery-container img { width:100%; height: 260px; object-fit: cover; transition: transform .5s ease, filter .3s; display:block; }\n.gallery-container figure:hover { transform: translateY(-10px); box-shadow: var(--shadow-strong); }\n.gallery-container figure:hover img { transform: scale(1.05); filter: brightness(1.03); }\n</code></pre> <p>The gallery uses CSS Grid with <code>auto-fit</code> and <code>minmax()</code> for responsive columns. Hover effects include:</p> <ul> <li>Container lift: <code>translateY(-10px)</code></li> <li>Image zoom: <code>scale(1.05)</code></li> <li>Brightness increase: <code>brightness(1.03)</code></li> </ul>"},{"location":"Styling-System/#leaflet-map-container","title":"Leaflet Map Container","text":"<p>public/css/style.css L408-L428</p> <pre><code>.map-wrapper {\n  max-width: 1000px;\n  margin: 0 auto;\n  padding: 1rem;\n  border-radius: 16px;\n  background: #fff;\n  box-shadow: 0 8px 35px rgba(0, 40, 70, 0.10);\n  border: 1px solid rgba(0, 60, 120, 0.08);\n  animation: fadeIn .6s ease-out forwards;\n}\n\n#map {\n  width: 100%;\n  height: 450px;\n  border-radius: 14px;\n  overflow: hidden;\n  border: 2px solid rgba(22,66,91,0.08);\n  box-shadow: 0 12px 40px rgba(10,40,60,0.12);\n}\n</code></pre> <p>The <code>#map</code> element is styled as a rounded, shadowed container. Custom Leaflet popup styles override defaults:</p> <p>public/css/style.css L431-L442</p> <pre><code>.leaflet-popup-content-wrapper {\n  border-radius: 10px;\n  background: #ffffff;\n  color: #1b3a57;\n  font-weight: 600;\n  border: 1px solid rgba(0,45,95,0.08);\n  box-shadow: 0 10px 30px rgba(0,0,0,0.15);\n}\n</code></pre>"},{"location":"Styling-System/#winner-cards-display","title":"Winner Cards Display","text":"<pre><code>flowchart TD\n\nWinnersGrid[\".winners-grid&lt;br&gt;CSS Grid auto-fit\"]\nWinnerCard[\".winner-card&lt;br&gt;flex column center\"]\nPhotoWrap[\".winner-photo-wrap&lt;br&gt;110px circle&lt;br&gt;border gradient\"]\nPhoto[\".winner-photo&lt;br&gt;object-fit: cover\"]\nDorsalBadge[\".dorsal-badge&lt;br&gt;gradient pill&lt;br&gt;font-weight: 800\"]\n\nWinnersGrid --&gt; WinnerCard\nWinnerCard --&gt; PhotoWrap\nPhotoWrap --&gt; Photo\nWinnerCard --&gt; DorsalBadge</code></pre> <p>public/css/style.css L466-L485</p> <pre><code>.winners-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n  gap: 14px;\n}\n.winner-card {\n  display:flex; flex-direction:column; align-items:center; text-align:center; padding:14px; border-radius:12px;\n  background: linear-gradient(180deg,#fff,#f7fbff);\n  box-shadow: var(--shadow-soft); transition: transform .18s, box-shadow .18s;\n}\n.winner-card:hover { transform: translateY(-8px); box-shadow: var(--shadow-strong); }\n.winner-photo-wrap { width:110px; height:110px; border-radius:999px; overflow:hidden; display:flex; align-items:center; justify-content:center; margin-bottom:10px; border: 3px solid rgba(47,102,144,0.06); background: linear-gradient(180deg, rgba(47,102,144,0.04), rgba(58,124,165,0.02)); }\n</code></pre> <p>Winner photos are displayed in 110px circular containers with subtle gradient borders. The <code>.dorsal-badge</code> uses the primary gradient:</p> <p>public/css/style.css L481-L485</p> <pre><code>.dorsal-badge {\n  display:inline-block; padding:6px 10px; border-radius:999px;\n  background: linear-gradient(90deg, var(--lapis-lazuli), var(--cerulean));\n  color: #fff; font-weight: 800; margin-left: .5rem;\n}\n</code></pre> <p>Sources: public/css/style.css L368-L491</p>"},{"location":"Styling-System/#footer-system","title":"Footer System","text":"<p>The footer implements a three-column grid layout with brand identity, navigation links, and social elements.</p>"},{"location":"Styling-System/#footer-structure","title":"Footer Structure","text":"<p>public/css/style.css L525-L542</p> <pre><code>.site-footer {\n  background: var(--lapis-lazuli);\n  color: var(--white);\n  padding: 3rem 1.5rem 2rem;\n  font-family: system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial;\n  line-height: 1.5;\n}\n\n.footer-grid {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 2rem;\n  align-items: start;\n  max-width: 1200px;\n  margin: 0 auto;\n}\n</code></pre>"},{"location":"Styling-System/#social-icon-styling","title":"Social Icon Styling","text":"<p>public/css/style.css L624-L651</p> <pre><code>.social-icon {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  width: 56px;\n  height: 56px;\n  border-radius: 999px;\n  border: 1px solid rgba(255,255,255,0.2);\n  text-decoration: none;\n  color: var(--white);\n  background: rgba(255,255,255,0.08);\n  transition: transform 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;\n  flex: 0 0 56px;\n}\n.social-icon:hover,\n.social-icon:focus {\n  transform: translateY(-6px) scale(1.05);\n  box-shadow: 0 16px 40px rgba(0,0,0,0.25);\n  background: rgba(255,255,255,0.16);\n  color: var(--platinum);\n  outline: none;\n}\n</code></pre> <p>Social icons are 56px circles with hover effects including vertical lift and scale transform.</p> <p>Sources: public/css/style.css L525-L720</p>"},{"location":"Styling-System/#page-specific-stylesheets","title":"Page-Specific Stylesheets","text":""},{"location":"Styling-System/#admin-panel-styles","title":"Admin Panel Styles","text":"<p>The admin panel stylesheet extends the base design system for table-heavy interfaces.</p>"},{"location":"Styling-System/#admin-card-container","title":"Admin Card Container","text":"<p>public/css/admin.css L36-L44</p> <pre><code>.login-container.admin-card {\n  width: 100%;\n  max-width: 900px; /* ancho total de la tarjeta con tabla */\n  background: linear-gradient(180deg, #ffffff, var(--platinum));\n  border-radius: 14px;\n  padding: 18px;\n  box-shadow: 0 10px 30px var(--muted-shadow);\n  border: 1px solid rgba(22,66,91,0.06);\n}\n</code></pre> <p>The <code>.admin-card</code> uses a wider max-width (900px) to accommodate data tables.</p>"},{"location":"Styling-System/#table-styling","title":"Table Styling","text":"<pre><code>flowchart TD\n\nSmallTable[\".small-table&lt;br&gt;max-height: 420px&lt;br&gt;overflow: auto\"]\nTableHead[\".table-head-custom th&lt;br&gt;gradient background&lt;br&gt;lapis-lazuli to cerulean\"]\nTableRows[\"tbody tr:nth-child-even&lt;br&gt;alternating row color\"]\nTableCells[\"th, td&lt;br&gt;compact padding&lt;br&gt;0.45rem 0.5rem\"]\nActionButtons[\"Action buttons&lt;br&gt;34x34px inline-flex\"]\nBtnEdit[\".btn-edit&lt;br&gt;yellow gradient\"]\nBtnDelete[\".btn-delete&lt;br&gt;red gradient\"]\n\nSmallTable --&gt; TableHead\nSmallTable --&gt; TableRows\nSmallTable --&gt; TableCells\nTableCells --&gt; ActionButtons\nActionButtons --&gt; BtnEdit\nActionButtons --&gt; BtnDelete</code></pre> <p>public/css/admin.css L75-L105</p> <pre><code>.small-table {\n  max-height: 420px;\n  overflow: auto;\n  border-radius: 8px;\n  background: #fff;\n  padding: 6px;\n  margin-top: 6px;\n}\n\n.table-head-custom th {\n  background: linear-gradient(90deg, var(--lapis-lazuli), var(--cerulean));\n  color: var(--white);\n  font-weight: 700;\n  font-size: 0.85rem;\n  border: none;\n}\n\n.table th, .table td {\n  padding: 0.45rem 0.5rem;\n  vertical-align: middle;\n  font-size: 0.86rem;\n  border-color: rgba(22,66,91,0.06);\n}\n\n.table tbody tr:nth-child(even) {\n  background: rgba(24,86,121,0.03);\n}\n</code></pre> <p>Action buttons (<code>.btn-edit</code> and <code>.btn-delete</code>) are compact 34x34px squares:</p> <p>public/css/admin.css L107-L131</p> <pre><code>.btn-edit, .btn-delete {\n  width: 34px;\n  height: 34px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0;\n  border-radius: 10px;\n  border: none;\n  cursor: pointer;\n}\n\n/* estilo edit (amarillo/contrast) */\n.btn-edit {\n  background: linear-gradient(180deg, rgba(255,239,186,0.95), rgba(255,249,230,0.95));\n  color: #7a5a00;\n  border: 1px solid rgba(122,90,0,0.08);\n}\n\n/* estilo delete (suave) */\n.btn-delete {\n  background: linear-gradient(180deg, rgba(255,232,232,0.95), rgba(255,245,245,0.95));\n  color: #8b1e1e;\n  border: 1px solid rgba(139,30,30,0.06);\n}\n</code></pre> <p>Sources: public/css/admin.css L1-L157</p>"},{"location":"Styling-System/#edit-profile-form-styles","title":"Edit Profile Form Styles","text":"<p>The edit profile stylesheet provides form-focused styling with input states.</p>"},{"location":"Styling-System/#form-container","title":"Form Container","text":"<p>public/css/edit.css L26-L41</p> <pre><code>.container.mt-4.w-50 {\n  max-width: 460px;       /* compact width */\n  width: 100%;\n  margin: 36px auto !important;  /* center horizontally and add vertical spacing */\n  padding-left: 12px;\n  padding-right: 12px;\n}\n\n.container .card {\n  border: none;\n  border-radius: 14px;\n  overflow: hidden;\n  box-shadow: 0 12px 40px rgba(22,66,91,0.12);\n  background: linear-gradient(180deg, rgba(255,255,255,0.98), #ffffff);\n}\n</code></pre> <p>The form card is constrained to 460px for a focused editing experience.</p>"},{"location":"Styling-System/#input-field-styling","title":"Input Field Styling","text":"<p>public/css/edit.css L66-L81</p> <pre><code>.container .form-control {\n  border-radius: 10px;\n  border: 1px solid rgba(22,66,91,0.12);\n  background: linear-gradient(180deg, #fff, var(--platinum));\n  padding: 10px 12px;\n  box-shadow: none;\n  transition: box-shadow .15s ease, border-color .12s ease, transform .09s ease;\n}\n\n.container .form-control:focus {\n  border-color: var(--cerulean);\n  box-shadow: 0 10px 30px rgba(58,124,165,0.08);\n  transform: translateY(-1px);\n  outline: none;\n}\n</code></pre> <p>Form inputs have a subtle gradient background and lift slightly on focus with shadow and border color changes.</p>"},{"location":"Styling-System/#button-variants","title":"Button Variants","text":"Button Class Styling Usage <code>.btn.btn-primary</code> Gradient <code>lapis-lazuli</code> to <code>cerulean</code>, pill shape, <code>font-weight: 800</code> Primary action (Guardar) <code>.btn.btn-danger</code> Transparent background, <code>lapis-lazuli</code> border, <code>font-weight: 700</code> Secondary action (Cancelar) <p>public/css/edit.css L84-L128</p> <pre><code>.container .card .btn.btn-primary,\n.container .card .btn.btn-primary:visited {\n  display: inline-block;\n  margin-top: 12px;\n  width: 100%;\n  padding: 10px 14px;\n  border-radius: 999px;\n  font-weight: 800;\n  letter-spacing: 0.5px;\n  text-align: center;\n  text-decoration: none;\n  background: linear-gradient(90deg, var(--lapis-lazuli), var(--cerulean)) !important;\n  color: var(--white) !important;\n  box-shadow: 0 12px 30px rgba(58,124,165,0.14);\n  border: 0;\n  transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;\n}\n\n.container .card .btn.btn-danger {\n  display: inline-block;\n  margin-top: 10px;\n  width: 100%;\n  padding: 9px 14px;\n  border-radius: 999px;\n  font-weight: 700;\n  color: var(--lapis-lazuli) !important;\n  background: transparent !important;\n  border: 2px solid rgba(47,102,144,0.12);\n  transition: all .12s ease;\n}\n</code></pre> <p>Sources: public/css/edit.css L1-L150</p>"},{"location":"Styling-System/#responsive-design-strategy","title":"Responsive Design Strategy","text":"<p>The styling system uses multiple breakpoint strategies for responsive behavior.</p>"},{"location":"Styling-System/#breakpoint-table","title":"Breakpoint Table","text":"Breakpoint Applies To Key Changes <code>max-width: 980px</code> Global layout Column layouts become single-column, reduced hero title size <code>max-width: 780px</code> Navigation Hamburger menu activation, mobile nav dropdown <code>max-width: 768px</code> Map section Map height reduced to 350px <code>max-width: 680px</code> Gallery, banner Gallery images reduced to 200px, banner height to 55vh <code>max-width: 576px</code> Forms, admin Compact card sizing, reduced padding <code>max-width: 560px</code> Footer Single-column footer grid"},{"location":"Styling-System/#navigation-mobile-transformation","title":"Navigation Mobile Transformation","text":"<p>public/css/style.css L150-L167</p> <pre><code>@media (max-width: 780px) {\n  .menu-btn { display: flex; }\n  .nav-links {\n    display: none;\n    flex-direction: column;\n    position: absolute;\n    top: 70px;\n    right: 12px;\n    background: rgba(0,0,0,0.7);\n    border-radius: 12px;\n    padding: 1rem;\n    min-width: 220px;\n  }\n\n  .nav-links.active { display: flex; }\n\n  .nav-links a { padding: 0.65rem 1rem; font-size: 0.95rem; }\n}\n</code></pre>"},{"location":"Styling-System/#admin-panel-responsive-adjustments","title":"Admin Panel Responsive Adjustments","text":"<p>public/css/admin.css L146-L156</p> <pre><code>@media (max-width: 992px) {\n  .login-container.admin-card { max-width: 720px; padding: 14px; }\n  .small-table { max-height: 360px; }\n}\n@media (max-width: 576px) {\n  .auth-wrapper { padding: 20px 10px; min-height: calc(100vh - 120px); }\n  .login-container.admin-card { max-width: 360px; padding: 12px; }\n  .table th, .table td { font-size: 0.78rem; padding: 0.32rem 0.36rem; }\n  .small-table { max-height: 300px; }\n  .cta-btn { padding: 6px 8px; font-size: 0.85rem; }\n}\n</code></pre> <p>The admin table progressively reduces: 720px wide at medium screens, 360px at mobile, with smaller font sizes and padding.</p>"},{"location":"Styling-System/#footer-responsive-grid","title":"Footer Responsive Grid","text":"<p>public/css/style.css L709-L720</p> <pre><code>@media (max-width: 980px) {\n  .footer-grid { grid-template-columns: repeat(2, 1fr); }\n  .footer-legal { flex-direction: column; align-items: flex-start; gap: 0.5rem; }\n}\n@media (max-width: 560px) {\n  .footer-grid { grid-template-columns: 1fr; }\n  .newsletter { width: 100%; }\n  .footer-legal { align-items: center; text-align: center; }\n  .social-icon { width: 48px; height: 48px; }\n  .social-icon svg { width: 22px; height: 22px; }\n  .footer-sponsors img { height: 44px; }\n}\n</code></pre> <p>The footer transforms from three columns \u2192 two columns (980px) \u2192 single column (560px).</p> <p>Sources: public/css/style.css L150-L167</p> <p>public/css/style.css L451-L508</p> <p>public/css/style.css L709-L720</p> <p>public/css/admin.css L146-L156</p> <p>public/css/edit.css L136-L144</p>"},{"location":"Styling-System/#accessibility-features","title":"Accessibility Features","text":"<p>The styling system incorporates multiple accessibility considerations.</p>"},{"location":"Styling-System/#focus-visibility","title":"Focus Visibility","text":"<p>public/css/style.css L170-L177</p> <pre><code>.menu-btn:focus,\n.nav-links a:focus,\n.nav-links a:focus-visible {\n  outline: 3px solid rgba(129, 195, 215, 0.18);\n  outline-offset: 3px;\n  border-radius: 8px;\n}\n</code></pre> <p>All interactive elements receive a 3px outline with offset on focus, using the <code>--sky-blue</code> color at 18% opacity.</p> <p>public/css/style.css L495</p> <pre><code>a:focus, button:focus, input:focus { outline: 3px solid rgba(129,195,215,0.16); outline-offset: 3px; border-radius: 8px; }\n</code></pre>"},{"location":"Styling-System/#reduced-motion-support","title":"Reduced Motion Support","text":"<p>public/css/style.css L511-L513</p> <pre><code>@media (prefers-reduced-motion: reduce){\n  * { transition: none !important; animation: none !important; transform: none !important; }\n}\n</code></pre> <p>Users with <code>prefers-reduced-motion</code> settings have all transitions, animations, and transforms disabled.</p> <p>public/css/edit.css L147-L149</p> <pre><code>@media (prefers-reduced-motion: reduce) {\n  * { transition: none !important; animation: none !important; }\n}\n</code></pre> <p>This pattern is consistently applied across page-specific stylesheets.</p>"},{"location":"Styling-System/#screen-reader-utilities","title":"Screen Reader Utilities","text":"<p>public/css/style.css L702-L706</p> <pre><code>.sr-only {\n  position: absolute !important;\n  width: 1px; height: 1px; padding: 0; margin: -1px;\n  overflow: hidden; clip: rect(0 0 0 0); white-space: nowrap; border: 0;\n}\n</code></pre> <p>The <code>.sr-only</code> class provides content that is accessible to screen readers but visually hidden.</p> <p>Sources: public/css/style.css L170-L177</p> <p>public/css/style.css L495</p> <p>public/css/style.css L511-L513</p> <p>public/css/style.css L702-L706</p> <p>public/css/edit.css L147-L149</p>"},{"location":"Styling-System/#gradient-system","title":"Gradient System","text":"<p>Gradients are a defining visual characteristic of the design system, used consistently across buttons, backgrounds, and overlays.</p>"},{"location":"Styling-System/#gradient-pattern-table","title":"Gradient Pattern Table","text":"Gradient Type CSS Value Usage Primary Navigation <code>linear-gradient(90deg, var(--lapis-lazuli), var(--cerulean))</code> Navigation bar, table headers, badges CTA Accent <code>linear-gradient(180deg, #ff5f6d, #ffc371)</code> Registration button, hero CTAs Button Primary <code>linear-gradient(90deg, var(--lapis-lazuli), var(--cerulean))</code> Primary action buttons Dark Card <code>linear-gradient(180deg, rgba(6,24,36,0.92), rgba(14,34,48,0.94))</code> Emphasized content cards Light Card <code>linear-gradient(180deg, rgba(255,255,255,0.98), #fbfdff)</code> Default card backgrounds Body Background <code>linear-gradient(180deg, var(--platinum) 0%, #f4fbff 100%)</code> Page background Banner Overlay <code>linear-gradient(180deg, rgba(6,24,36,0.72), rgba(17,46,66,0.45))</code> Hero banner text contrast"},{"location":"Styling-System/#gradient-direction-conventions","title":"Gradient Direction Conventions","text":"<pre><code>flowchart TD\n\nHorizontal[\"Horizontal 90deg&lt;br&gt;Used for: nav, badges,&lt;br&gt;prominent UI elements\"]\nVertical[\"Vertical 180deg&lt;br&gt;Used for: cards, backgrounds,&lt;br&gt;subtle depth\"]\nPrimaryGrad[\"lapis-lazuli \u2192 cerulean\"]\nAccentGrad[\"#ff5f6d \u2192 #ffc371\"]\nLightCard[\"white \u2192 fbfdff\"]\nDarkCard[\"rgba6,24,36 \u2192 rgba14,34,48\"]\nOverlay[\"Dark overlays for text contrast\"]\n\nHorizontal --&gt; PrimaryGrad\nHorizontal --&gt; AccentGrad\nVertical --&gt; LightCard\nVertical --&gt; DarkCard\nVertical --&gt; Overlay</code></pre> <p>Horizontal gradients (90deg) are used for prominent UI elements like navigation, badges, and primary buttons to create left-to-right color flow.</p> <p>Vertical gradients (180deg) are used for backgrounds and cards to create subtle top-to-bottom depth.</p> <p>Sources: public/css/style.css L51</p> <p>public/css/style.css L114</p> <p>public/css/style.css L259</p> <p>public/css/style.css L329</p> <p>public/css/admin.css L66</p> <p>public/css/admin.css L86</p>"},{"location":"Styling-System/#animation-and-transition-patterns","title":"Animation and Transition Patterns","text":"<p>The design system uses consistent timing functions and durations for smooth interactions.</p>"},{"location":"Styling-System/#transition-duration-standards","title":"Transition Duration Standards","text":"Duration Timing Function Usage <code>.12s</code> <code>ease</code> Fast interactions (button hover, input focus) <code>.15s</code> <code>ease</code> Input state changes <code>.18s</code> <code>ease</code> / <code>cubic-bezier(.2,.9,.3,1)</code> Card hover, transforms <code>.22s</code> <code>ease</code> Gallery shadow changes <code>.25s</code> <code>ease</code> Navigation link hover <code>.28s</code> <code>cubic-bezier(.2,.9,.3,1)</code> Category card emphasis <code>.36s</code> <code>ease</code> Gallery figure transforms <code>.5s</code> <code>ease</code> Gallery image zoom"},{"location":"Styling-System/#transform-patterns","title":"Transform Patterns","text":"<pre><code>flowchart TD\n\nHover[\"Hover/Focus State\"]\nLiftSmall[\"translateY-2px&lt;br&gt;Nav links\"]\nLiftMedium[\"translateY-3px&lt;br&gt;Primary buttons\"]\nLiftLarge[\"translateY-6px&lt;br&gt;Share buttons, social icons\"]\nLiftXL[\"translateY-10px&lt;br&gt;Cards, gallery figures\"]\nScale[\"scale1.01-1.05&lt;br&gt;Buttons, cards\"]\nZoom[\"img scale1.05&lt;br&gt;Gallery images\"]\n\nHover --&gt; LiftSmall\nHover --&gt; LiftMedium\nHover --&gt; LiftLarge\nHover --&gt; LiftXL\nHover --&gt; Scale\nHover --&gt; Zoom</code></pre> <p>Common transform combinations:</p> <ul> <li>Small lift: <code>translateY(-2px)</code> for subtle feedback (nav links)</li> <li>Medium lift + scale: <code>translateY(-3px) scale(1.01)</code> for buttons</li> <li>Large lift: <code>translateY(-6px)</code> for prominent elements (social icons)</li> <li>Extra large lift: <code>translateY(-10px)</code> for cards and gallery items</li> </ul> <p>public/css/style.css L364</p> <pre><code>.cat:hover { transform: translateY(-10px); box-shadow: var(--shadow-strong); }\n</code></pre> <p>public/css/style.css L104-L106</p> <pre><code>.container .card .btn.btn-primary:hover {\n  transform: translateY(-3px) scale(1.01);\n  box-shadow: 0 18px 40px rgba(58,124,165,0.18);\n  opacity: 0.98;\n}\n</code></pre> <p>Sources: public/css/style.css L93-L125</p> <p>public/css/style.css L362-L365</p> <p>public/css/style.css L381-L383</p> <p>public/css/edit.css L72-L80</p>"},{"location":"Styling-System/#css-custom-property-inheritance","title":"CSS Custom Property Inheritance","text":"<p>All page-specific stylesheets inherit from the same base design tokens, ensuring visual consistency.</p>"},{"location":"Styling-System/#token-reuse-diagram","title":"Token Reuse Diagram","text":"<pre><code>flowchart TD\n\nRootTokens[\":root CSS Custom Properties&lt;br&gt;Defined in multiple files\"]\nStyleCSS[\"style.css defines:&lt;br&gt;--lapis-lazuli, --cerulean,&lt;br&gt;--platinum, --indigo-dye,&lt;br&gt;--sky-blue, --white, --accent\"]\nAdminCSS[\"admin.css redefines:&lt;br&gt;Same tokens + --muted-shadow,&lt;br&gt;--card-max-width\"]\nEditCSS[\"edit.css redefines:&lt;br&gt;Core tokens only&lt;br&gt;no page-specific additions\"]\nGlobalUsage[\"Global components:&lt;br&gt;nav, banner, footer,&lt;br&gt;cards, buttons\"]\nAdminUsage[\"Admin-specific:&lt;br&gt;tables, action buttons,&lt;br&gt;compact layouts\"]\nFormUsage[\"Form-specific:&lt;br&gt;inputs, labels,&lt;br&gt;button variants\"]\n\nRootTokens --&gt; StyleCSS\nRootTokens --&gt; AdminCSS\nRootTokens --&gt; EditCSS\nStyleCSS --&gt; GlobalUsage\nAdminCSS --&gt; AdminUsage\nEditCSS --&gt; FormUsage</code></pre> <p>Each stylesheet defines its own <code>:root</code> block with the core color tokens, allowing page-specific stylesheets to work independently without requiring <code>style.css</code> to be loaded (though in practice, <code>style.css</code> is loaded globally via views/partials/head.ejs</p> <p>).</p> <p>Token Consistency:</p> <ul> <li>\u2705 <code>--lapis-lazuli</code>, <code>--cerulean</code>, <code>--platinum</code>, <code>--indigo-dye</code>, <code>--sky-blue</code>, <code>--white</code> defined identically across all files</li> <li>\u26a0\ufe0f <code>--accent</code> only defined in <code>style.css</code></li> <li>\u26a0\ufe0f <code>--muted-shadow</code> and <code>--card-max-width</code> only in <code>admin.css</code></li> </ul> <p>Sources: public/css/style.css L3-L27</p> <p>public/css/admin.css L1-L11</p> <p>public/css/edit.css L2-L9</p>"},{"location":"Styling-System/#summary","title":"Summary","text":"<p>The styling system is built on these core principles:</p> <ol> <li>Design Token Foundation: CSS custom properties provide a single source of truth for colors, spacing, and typography</li> <li>Modular Architecture: Base stylesheet (<code>style.css</code>) defines global patterns; page-specific stylesheets add component-level customization</li> <li>Consistent Gradient System: Horizontal gradients for UI elements, vertical gradients for backgrounds</li> <li>Progressive Enhancement: Responsive breakpoints adapt layouts from desktop \u2192 tablet \u2192 mobile</li> <li>Accessibility First: Focus visibility, reduced motion support, and screen reader utilities built-in</li> <li>Smooth Interactions: Consistent transition timings and transform patterns create cohesive user experience</li> </ol> <p>The system achieves visual coherence through reusable patterns while allowing page-specific customization through dedicated stylesheets.</p>"},{"location":"User-Interfaces/","title":"User Interfaces","text":"<p>Relevant source files * views/admin.ejs * views/index.ejs * views/partials/head.ejs * views/partials/header.ejs</p>"},{"location":"User-Interfaces/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document provides a comprehensive overview of the user interface layer in the HAPPY RUNNER 42K application, describing the EJS-based view architecture, template composition patterns, and role-based interface presentation. The system implements distinct interface hierarchies for participants, administrators, and public visitors.</p> <p>For detailed authentication mechanisms that control interface access, see Authentication &amp; Authorization. For styling and CSS architecture, see Styling System. For subsystem details on specific interface types, see Participant Interfaces, Admin Interfaces, and Shared Components.</p>"},{"location":"User-Interfaces/#ui-architecture-overview","title":"UI Architecture Overview","text":"<p>The application uses EJS (Embedded JavaScript) templating with a partial-based composition pattern. All views reside in <code>views/</code> directory and share common components through <code>views/partials/</code>. The system implements role-based conditional rendering where navigation and available pages adapt based on the user's session role (<code>participante</code>, <code>admin</code>, or unauthenticated).</p> Aspect Implementation Template Engine EJS Layout Pattern Partial inclusion (head, header, footer) Routing Express router modules with role-based middleware Access Control Session-based with <code>res.locals</code> injection Static Assets CSS per-page pattern (<code>/resources/css/</code>) External Libraries Bootstrap 5.3.3, Leaflet, Font Awesome, Boxicons <p>Sources: views/partials/head.ejs L1-L20</p> <p>views/partials/header.ejs L1-L33</p>"},{"location":"User-Interfaces/#interface-access-model","title":"Interface Access Model","text":"<pre><code>flowchart TD\n\nBrowser[\"Browser Request\"]\nIndex[\"index.ejs&lt;br&gt;Landing Page&lt;br&gt;Route: /\"]\nInfo[\"info.ejs&lt;br&gt;Event Info &amp; Winners&lt;br&gt;Route: /info\"]\nLogin[\"login.ejs&lt;br&gt;Participant Login&lt;br&gt;Route: /login\"]\nLoginAdmin[\"loginadmin.ejs&lt;br&gt;Admin Login&lt;br&gt;Route: /loginadmin\"]\nInscripcion[\"inscripcion.ejs&lt;br&gt;Registration Form&lt;br&gt;Route: /inscripcion\"]\nTokenCheck[\"JWT Validation&lt;br&gt;req.session.rol === 'participante'\"]\nPerfil[\"perfil.ejs&lt;br&gt;Profile Display&lt;br&gt;Route: /perfil\"]\nEdit[\"edit.ejs&lt;br&gt;Profile Edit&lt;br&gt;Route: /edit\"]\nAdminCheck[\"JWT Validation&lt;br&gt;req.session.rol === 'admin'\"]\nAdmin[\"admin.ejs&lt;br&gt;Participant Management&lt;br&gt;Route: /admin\"]\nEditAdmin[\"edit.ejs&lt;br&gt;Edit Participant&lt;br&gt;Route: /editadmin/:id\"]\nGanadores[\"ganadores routes&lt;br&gt;Winner Management&lt;br&gt;Route: /ganadores\"]\nRegister[\"register.ejs&lt;br&gt;Organizer Registration&lt;br&gt;Route: /register\"]\n\nBrowser --&gt; Index\nBrowser --&gt; Info\nBrowser --&gt; Login\nBrowser --&gt; LoginAdmin\nBrowser --&gt; Inscripcion\nBrowser --&gt; TokenCheck\nTokenCheck --&gt; Perfil\nTokenCheck --&gt; Edit\nBrowser --&gt; AdminCheck\nAdminCheck --&gt; Admin\nAdminCheck --&gt; EditAdmin\nAdminCheck --&gt; Ganadores\nAdminCheck --&gt; Register\n\nsubgraph subGraph4 [\"Admin Interfaces\"]\n    Admin\n    EditAdmin\n    Ganadores\n    Register\nend\n\nsubgraph subGraph3 [\"verifyAdmin Middleware\"]\n    AdminCheck\nend\n\nsubgraph subGraph2 [\"Participant Interfaces\"]\n    Perfil\n    Edit\nend\n\nsubgraph subGraph1 [\"verifyToken Middleware\"]\n    TokenCheck\nend\n\nsubgraph subGraph0 [\"Public Interfaces\"]\n    Index\n    Info\n    Login\n    LoginAdmin\n    Inscripcion\nend</code></pre> <p>This diagram maps HTTP routes to view files and their middleware requirements. Public interfaces have no authentication guard, participant interfaces require <code>verifyToken</code> middleware, and admin interfaces require <code>verifyAdmin</code> middleware.</p> <p>Sources: views/partials/header.ejs L18-L30</p>"},{"location":"User-Interfaces/#view-composition-pattern","title":"View Composition Pattern","text":"<pre><code>flowchart TD\n\nHead[\"partials/head.ejs&lt;br&gt;Lines 1-20&lt;br&gt;- Meta tags&lt;br&gt;- Bootstrap CSS&lt;br&gt;- Leaflet CSS&lt;br&gt;- Font libraries&lt;br&gt;- Custom fonts\"]\nHeader[\"partials/header.ejs&lt;br&gt;Lines 1-33&lt;br&gt;- Logo&lt;br&gt;- Navigation menu&lt;br&gt;- Role-based links&lt;br&gt;- Mobile toggle\"]\nFooter[\"partials/footer.ejs&lt;br&gt;- Footer content&lt;br&gt;- Closing tags\"]\nIndexView[\"index.ejs\"]\nAdminView[\"admin.ejs\"]\nPerfilView[\"perfil.ejs\"]\nInscripcionView[\"inscripcion.ejs\"]\nStyleCSS[\"/resources/css/style.css\"]\nAdminCSS[\"/resources/css/admin.css\"]\nPerfilCSS[\"/resources/css/perfil.css\"]\nInscripcionCSS[\"/resources/css/inscripcion.css\"]\n\nHead --&gt; IndexView\nHead --&gt; AdminView\nHead --&gt; PerfilView\nHead --&gt; InscripcionView\nHeader --&gt; IndexView\nHeader --&gt; PerfilView\nHeader --&gt; InscripcionView\nFooter --&gt; IndexView\nFooter --&gt; PerfilView\nStyleCSS --&gt; IndexView\nAdminCSS --&gt; AdminView\nPerfilCSS --&gt; PerfilView\nInscripcionCSS --&gt; InscripcionView\n\nsubgraph subGraph2 [\"Page-Specific Assets\"]\n    StyleCSS\n    AdminCSS\n    PerfilCSS\n    InscripcionCSS\nend\n\nsubgraph subGraph1 [\"Page Templates\"]\n    IndexView\n    AdminView\n    PerfilView\n    InscripcionView\nend\n\nsubgraph subGraph0 [\"Shared Partials\"]\n    Head\n    Header\n    Footer\nend</code></pre> <p>Every page template includes <code>partials/head.ejs</code> for common <code>&lt;head&gt;</code> setup, selectively includes <code>partials/header.ejs</code> for navigation (admin views like <code>admin.ejs</code> may skip this), and includes <code>partials/footer.ejs</code> for page closure. Each template then loads its own dedicated CSS file.</p> <p>Sources: views/index.ejs L1-L118</p> <p>views/admin.ejs L1-L65</p> <p>views/partials/head.ejs L1-L20</p>"},{"location":"User-Interfaces/#role-based-navigation","title":"Role-Based Navigation","text":"<p>The <code>partials/header.ejs</code> implements dynamic navigation that adapts based on <code>res.locals.user</code> and <code>res.locals.rol</code> values injected by Express middleware:</p> Session State Navigation Items Displayed No session (<code>!user</code>) INICIO, INFO, INSCRIPCI\u00d3N, User icon (\u2192 /login), Shield icon (\u2192 /loginadmin) <code>rol === 'participante'</code> INICIO, INFO, MI PERFIL, Logout icon <code>rol === 'admin'</code> INICIO, INFO, REG\u00cdSTRATE, PANEL, GANADORES, Logout icon <p>The navigation is implemented in views/partials/header.ejs L18-L30</p> <p>using EJS conditionals:</p> <pre><code>&lt;% if (!user) { %&gt;\n  &lt;!-- Public navigation --&gt;\n&lt;% } else if (rol === 'participante') { %&gt;\n  &lt;!-- Participant navigation --&gt;\n&lt;% } else if (rol === 'admin') { %&gt;\n  &lt;!-- Admin navigation --&gt;\n&lt;% } %&gt;\n</code></pre> <p>The <code>res.locals</code> injection occurs in the Express middleware pipeline before view rendering, making these values globally available to all EJS templates without explicit passing.</p> <p>Sources: views/partials/header.ejs L18-L30</p>"},{"location":"User-Interfaces/#public-interface-characteristics","title":"Public Interface Characteristics","text":"<p>Public interfaces are accessible without authentication and serve as entry points for user journeys:</p> View File Route Primary Purpose Key Features <code>index.ejs</code> <code>/</code> Event landing page Hero banner, event details, photo gallery, Leaflet race map <code>info.ejs</code> <code>/info</code> Event information &amp; winners Detailed event info, winner display cards, race route map <code>inscripcion.ejs</code> <code>/inscripcion</code> Participant registration Multi-field form, photo upload, weather widget <code>login.ejs</code> <code>/login</code> Participant authentication DNI-based login form <code>loginadmin.ejs</code> <code>/loginadmin</code> Admin authentication Username/password login form"},{"location":"User-Interfaces/#landing-page-structure","title":"Landing Page Structure","text":"<p>The <code>index.ejs</code> template views/index.ejs L1-L119</p> <p>implements a multi-section layout:</p> <ol> <li>Hero Banner views/index.ejs L5-L26 : Full-width banner with event title, date, call-to-action buttons</li> <li>Event Info Section views/index.ejs L29-L53 : Grid of event details (date, time, location, hydration)</li> <li>Categories Section views/index.ejs L55-L69 : Masculine/Feminine 42K categories</li> <li>Gallery Section views/index.ejs L71-L81 : Three-image gallery with lazy loading</li> <li>Race Route Map views/index.ejs L83-L116 : Leaflet map with polyline route visualization</li> </ol> <p>The Leaflet map initialization occurs in an inline <code>&lt;script&gt;</code> block views/index.ejs L95-L116</p> <p>creating an interactive map centered on Park G\u00fcell coordinates <code>[41.4145, 2.1527]</code> with race path markers.</p> <p>Sources: views/index.ejs L1-L119</p>"},{"location":"User-Interfaces/#participant-interface-characteristics","title":"Participant Interface Characteristics","text":"<p>Participant interfaces require <code>verifyToken</code> middleware and display personalized data from <code>req.session.user</code>:</p> View File Route Purpose Data Dependencies <code>perfil.ejs</code> <code>/perfil</code> Display participant profile Session user object <code>edit.ejs</code> <code>/edit</code> Edit participant profile Participant record from database <p>These views render participant-specific data including name, DNI, address details, phone number, and uploaded photo path. The edit flow submits to <code>updateParticipante.js</code> controller for data persistence.</p> <p>Sources: Referenced in views/partials/header.ejs L23</p>"},{"location":"User-Interfaces/#admin-interface-characteristics","title":"Admin Interface Characteristics","text":""},{"location":"User-Interfaces/#admin-panel-structure","title":"Admin Panel Structure","text":"<p>The <code>admin.ejs</code> view views/admin.ejs L1-L79</p> <p>implements a full-featured participant management interface:</p> <p>Key Components:</p> <ol> <li>Search Bar views/admin.ejs L17-L20 : Client-side filtering input with participant count badge</li> <li>Data Table views/admin.ejs L22-L62 : Bootstrap table displaying all participant records</li> <li>Action Buttons views/admin.ejs L50-L57 : Edit (Boxicons <code>bxs-edit</code>) and Delete (Boxicons <code>bxs-trash</code>) icons per row</li> </ol> <p>Table Columns:</p> Column Field Source N\u00b0 Dorsal <code>participante.id</code> Auto-incremented participant ID Nombre <code>participante.nombre</code> First name Apellido <code>participante.apellido</code> Last name DNI <code>participante.dni</code> National ID Tel. <code>participante.telefono</code> Phone number Calle <code>participante.calle</code> Street name N\u00b0 <code>participante.numero</code> Street number Poblaci\u00f3n <code>participante.poblacion</code> City/town CP\u00b0 <code>participante.codigo_postal</code> Postal code Acciones Links to <code>/editadmin/:id</code> and <code>/delete/:id</code> Action buttons <p>Client-Side Search Implementation:</p> <p>The search functionality views/admin.ejs L67-L77</p> <p>uses vanilla JavaScript to filter table rows based on user input:</p> <pre><code>const searchInput = document.getElementById('searchInput');\nconst participantesTable = document.getElementById('participantesTable');\nsearchInput?.addEventListener('input', (e) =&gt; {\n  const q = e.target.value.toLowerCase().trim();\n  Array.from(participantesTable.rows).forEach(row =&gt; {\n    const txt = row.innerText.toLowerCase();\n    row.style.display = txt.includes(q) ? '' : 'none';\n  });\n});\n</code></pre> <p>This provides instant filtering across all table columns without server round-trips.</p> <p>Sources: views/admin.ejs L1-L79</p>"},{"location":"User-Interfaces/#shared-component-architecture","title":"Shared Component Architecture","text":"<pre><code>flowchart TD\n\nFooterContent[\"Footer HTML&lt;br&gt;Closing tags\"]\nNavStructure[\"element\"]\nNavLinks[\"Role-based Navigation\"]\nPublicLinks[\"INICIO, INFO,&lt;br&gt;INSCRIPCI\u00d3N, Icons\"]\nParticipantLinks[\"MI PERFIL, Logout\"]\nAdminLinks[\"REG\u00cdSTRATE, PANEL,&lt;br&gt;GANADORES, Logout\"]\nLogo[\"Logo + Text&lt;br&gt;/resources/img/happy.png\"]\nMobileToggle[\"Mobile Menu Button&lt;br&gt;toggleMenu()\"]\nMetaTags[\"Meta Tags&lt;br&gt;charset, viewport, IE edge\"]\nLibraries[\"External Libraries\"]\nBootstrap[\"Bootstrap 5.3.3&lt;br&gt;CSS + JS Bundle\"]\nLeaflet[\"Leaflet CSS&lt;br&gt;Map rendering\"]\nBoxicons[\"Boxicons 2.1.4&lt;br&gt;Icon library\"]\nFontAwesome[\"Font Awesome 6.5.0&lt;br&gt;Additional icons\"]\nAnimate[\"Animate.css 4.1.1&lt;br&gt;Animation utilities\"]\nTitle[\"Title: Happy Runner\"]\nDescription[\"SEO Description\"]\nFonts[\"Custom Fonts&lt;br&gt;Montserrat preloaded&lt;br&gt;Regular &amp; Bold\"]\nCustomCSS[\"style.css&lt;br&gt;Global styles\"]\n\nsubgraph partials/footer.ejs [\"partials/footer.ejs\"]\n    FooterContent\nend\n\nsubgraph partials/header.ejs [\"partials/header.ejs\"]\n    NavStructure\n    NavLinks\n    PublicLinks\n    ParticipantLinks\n    AdminLinks\n    Logo\n    MobileToggle\n    NavLinks --&gt; PublicLinks\n    NavLinks --&gt; ParticipantLinks\n    NavLinks --&gt; AdminLinks\nend\n\nsubgraph partials/head.ejs [\"partials/head.ejs\"]\n    MetaTags\n    Libraries\n    Bootstrap\n    Leaflet\n    Boxicons\n    FontAwesome\n    Animate\n    Title\n    Description\n    Fonts\n    CustomCSS\n    Libraries --&gt; Bootstrap\n    Libraries --&gt; Leaflet\n    Libraries --&gt; Boxicons\n    Libraries --&gt; FontAwesome\n    Libraries --&gt; Animate\nend</code></pre>"},{"location":"User-Interfaces/#head-partial-dependencies","title":"Head Partial Dependencies","text":"<p>The <code>partials/head.ejs</code> views/partials/head.ejs L1-L20</p> <p>establishes the complete dependency chain for all pages:</p> Dependency CDN/Path Purpose Bootstrap 5.3.3 CSS <code>cdn.jsdelivr.net</code> UI framework, grid system, utilities Bootstrap 5.3.3 JS <code>cdn.jsdelivr.net</code> Interactive components Leaflet CSS <code>unpkg.com/leaflet</code> Map rendering library Boxicons 2.1.4 <code>unpkg.com/boxicons</code> Icon library (user, shield, trash, edit icons) Font Awesome 6.5.0 <code>cdnjs.cloudflare.com</code> Additional icon library Animate.css 4.1.1 <code>cdnjs.cloudflare.com</code> CSS animation utilities Montserrat Font <code>/fonts/</code> (preloaded) Custom typography <code>style.css</code> <code>/resources/css/</code> Global application styles"},{"location":"User-Interfaces/#header-partial-navigation-logic","title":"Header Partial Navigation Logic","text":"<p>The header navigation views/partials/header.ejs L5-L32</p> <p>implements:</p> <ol> <li>Logo Section views/partials/header.ejs L6-L9 : Image + text branding</li> <li>Mobile Menu Toggle views/partials/header.ejs L10-L14 : Hamburger button calling <code>toggleMenu()</code> function</li> <li>Conditional Navigation views/partials/header.ejs L15-L31 : Three-way branching based on <code>user</code> and <code>rol</code> variables</li> </ol> <p>Navigation links use Boxicons for iconography:</p> <ul> <li><code>bx-user-circle</code>: Participant login</li> <li><code>bxs-shield</code>: Admin login</li> <li><code>bxs-log-out</code>: Logout action</li> </ul> <p>Sources: views/partials/head.ejs L1-L20</p> <p>views/partials/header.ejs L1-L33</p>"},{"location":"User-Interfaces/#view-to-route-mapping","title":"View-to-Route Mapping","text":"<p>The following table maps all view files to their corresponding Express routes and required middleware:</p> View File Route Pattern HTTP Method Middleware Route Module <code>index.ejs</code> <code>/</code> GET None <code>routes/index.js</code> <code>info.ejs</code> <code>/info</code> GET None <code>routes/index.js</code> <code>inscripcion.ejs</code> <code>/inscripcion</code> GET None <code>routes/index.js</code> <code>login.ejs</code> <code>/login</code> GET None <code>routes/auth.js</code> <code>loginadmin.ejs</code> <code>/loginadmin</code> GET None <code>routes/auth.js</code> <code>perfil.ejs</code> <code>/perfil</code> GET <code>verifyToken</code> <code>routes/participante.js</code> <code>edit.ejs</code> <code>/edit</code> GET <code>verifyToken</code> <code>routes/participante.js</code> <code>admin.ejs</code> <code>/admin</code> GET <code>verifyAdmin</code> <code>routes/admin.js</code> <code>edit.ejs</code> <code>/editadmin/:id</code> GET <code>verifyAdmin</code> <code>routes/admin.js</code> <code>register.ejs</code> <code>/register</code> GET <code>verifyAdmin</code> <code>routes/auth.js</code> <p>Note that <code>edit.ejs</code> is reused for both participant self-editing (<code>/edit</code>) and admin-initiated editing (<code>/editadmin/:id</code>) with different middleware requirements.</p> <p>Sources: Inferred from route structure and views/partials/header.ejs L18-L30</p> <p>views/admin.ejs L51-L54</p>"},{"location":"User-Interfaces/#interactive-features","title":"Interactive Features","text":""},{"location":"User-Interfaces/#leaflet-map-integration","title":"Leaflet Map Integration","text":"<p>The landing page and info page implement Leaflet maps for race route visualization. In <code>index.ejs</code> views/index.ejs L93-L116</p> <p>:</p> <ol> <li>Map Initialization: Creates <code>L.map('map')</code> centered on Park G\u00fcell</li> <li>Tile Layer: Uses OpenStreetMap tiles via <code>L.tileLayer()</code></li> <li>Race Path: Defines array of coordinates and renders with <code>L.polyline()</code></li> <li>Markers: Places markers at start (<code>racePath[0]</code>) and finish points</li> <li>Auto-fit: Calls <code>map.fitBounds()</code> to frame the entire route</li> </ol> <p>The map container requires inline styles: <code>height: 400px; width: 100%; border: 2px solid #ccc;</code> views/index.ejs L87</p>"},{"location":"User-Interfaces/#client-side-search-in-admin-panel","title":"Client-Side Search in Admin Panel","text":"<p>The admin panel implements instant search filtering views/admin.ejs L67-L77</p> <p>without pagination or server queries. On each keystroke in <code>#searchInput</code>, the script:</p> <ol> <li>Retrieves input value and converts to lowercase</li> <li>Iterates through all <code>&lt;tbody&gt;</code> rows</li> <li>Checks if row text includes search query</li> <li>Sets <code>display: none</code> for non-matching rows</li> </ol> <p>This approach provides responsive filtering for reasonable dataset sizes (hundreds of participants) but may require server-side implementation for larger datasets.</p> <p>Sources: views/index.ejs L93-L116</p> <p>views/admin.ejs L67-L77</p>"},{"location":"User-Interfaces/#css-loading-strategy","title":"CSS Loading Strategy","text":"<p>Each page follows a consistent CSS loading pattern:</p> <ol> <li>Global Styles: <code>style.css</code> loaded via <code>partials/head.ejs</code> views/partials/head.ejs L9</li> <li>Page-Specific Styles: Loaded directly in the view file after head include</li> </ol> <p>Example from <code>admin.ejs</code> views/admin.ejs L7</p> <p>:</p> <pre><code>&lt;link rel=\"stylesheet\" href=\"/resources/css/admin.css\"&gt;\n</code></pre> <p>This two-tier approach enables:</p> <ul> <li>Global consistency through shared base styles (typography, colors, layout utilities)</li> <li>Page-specific customization without style conflicts</li> <li>Efficient caching of common styles across pages</li> </ul> <p>Available CSS Files:</p> <ul> <li><code>style.css</code>: Global base styles</li> <li><code>admin.css</code>: Admin panel table and action buttons</li> <li><code>inscripcion.css</code>: Registration form styling</li> <li><code>perfil.css</code>: Profile display layout</li> <li><code>edit.css</code>: Profile edit form</li> <li><code>info.css</code>: Info page and winner cards</li> <li><code>login.css</code>: Login form styling</li> </ul> <p>Sources: views/partials/head.ejs L9</p> <p>views/admin.ejs L7</p>"},{"location":"User-Interfaces/#accessibility-considerations","title":"Accessibility Considerations","text":"<p>The UI layer implements several accessibility features:</p> Feature Implementation Location Semantic HTML <code>&lt;header&gt;</code>, <code>&lt;main&gt;</code>, <code>&lt;nav&gt;</code>, <code>&lt;article&gt;</code> elements All view files ARIA Labels <code>aria-label</code>, <code>aria-hidden</code> attributes views/index.ejs L6-L20 Image Alt Text Alt attributes on all images views/index.ejs L75-L77 Form Labels Explicit label-input associations Registration and edit forms Lazy Loading <code>loading=\"lazy\"</code> on gallery images views/index.ejs L75-L77 Keyboard Navigation Focusable elements, logical tab order Navigation and forms Responsive Meta Tag <code>viewport</code> meta for mobile scaling views/partials/head.ejs L6 <p>Sources: views/index.ejs L6-L77</p> <p>views/partials/head.ejs L6</p>"},{"location":"User-Interfaces/#summary","title":"Summary","text":"<p>The HAPPY RUNNER 42K UI layer implements a role-aware, component-based architecture using EJS templating. The system distinguishes three user contexts\u2014public visitors, authenticated participants, and administrators\u2014through session-based conditional rendering. All pages compose from shared partials (<code>head</code>, <code>header</code>, <code>footer</code>) while maintaining page-specific styling through dedicated CSS files. Interactive features include Leaflet map integration for race visualization and client-side search for admin participant management. The Bootstrap 5.3.3 framework provides responsive layout and utility classes, while Boxicons and Font Awesome supply iconography throughout the interface.</p>"},{"location":"Winner-Management/","title":"Winner Management","text":"<p>Relevant source files * middlewares/multer.js * middlewares/verifyAdmin.js * middlewares/verifyToken.js * public/css/edit.css * public/css/info.css * views/info.ejs</p>"},{"location":"Winner-Management/#purpose-and-scope","title":"Purpose and Scope","text":"<p>This document describes the winner management system within the HAPPY RUNNER 42K marathon application. The system enables administrators to designate the top three finishers (1st, 2nd, and 3rd place) from registered participants and optionally upload winner-specific photos. Winners are selected through a form interface embedded in the event information page and displayed publicly to all users.</p> <p>For general event information display, see Landing Page. For broader administrative functions including participant management, see Admin Panel. For organizer account creation, see Organizer Registration.</p>"},{"location":"Winner-Management/#system-architecture","title":"System Architecture","text":"<p>The winner management system is architecturally unique in that it combines both administrative control and public display within a single page template (<code>info.ejs</code>). Access control is enforced through conditional rendering based on the user's role, rather than through separate route handlers.</p> <pre><code>flowchart TD\n\nInfoRoute[\"/info GET route\"]\nGanadoresRoute[\"/ganadores POST route\"]\nVerifyAdmin[\"verifyAdmin middleware\"]\nSession[\"req.session.rol\"]\nInfoEJS[\"info.ejs template\"]\nAdminPanel[\"Admin winner form&lt;br&gt;(lines 30-84)\"]\nPublicDisplay[\"Winners grid&lt;br&gt;(lines 93-120)\"]\nParticipantesTable[\"participantes table\"]\nGanadoresTable[\"ganadores table\"]\nFileSystem[\"public/uploads/participantes/\"]\n\nInfoRoute --&gt; Session\nSession --&gt; InfoEJS\nAdminPanel --&gt; GanadoresRoute\nGanadoresRoute --&gt; VerifyAdmin\nVerifyAdmin --&gt; GanadoresTable\nGanadoresRoute --&gt;|\"POST /ganadores\"| FileSystem\nInfoRoute --&gt; ParticipantesTable\nInfoRoute --&gt; GanadoresTable\nPublicDisplay --&gt; GanadoresTable\n\nsubgraph subGraph3 [\"Data Layer\"]\n    ParticipantesTable\n    GanadoresTable\n    FileSystem\nend\n\nsubgraph subGraph2 [\"View Layer\"]\n    InfoEJS\n    AdminPanel\n    PublicDisplay\n    InfoEJS --&gt; AdminPanel\n    InfoEJS --&gt; PublicDisplay\nend\n\nsubgraph Authentication [\"Authentication\"]\n    VerifyAdmin\n    Session\nend\n\nsubgraph subGraph0 [\"Route Layer\"]\n    InfoRoute\n    GanadoresRoute\nend</code></pre> <p>Sources: views/info.ejs L1-L147</p> <p>middlewares/verifyAdmin.js L1-L17</p>"},{"location":"Winner-Management/#administrative-interface","title":"Administrative Interface","text":""},{"location":"Winner-Management/#winner-selection-form","title":"Winner Selection Form","text":"<p>The winner registration form is conditionally rendered within <code>info.ejs</code> when the <code>isAdmin</code> flag is set to <code>true</code> in the template context views/info.ejs L30-L84</p> <p>The form provides three identical field groups, one for each podium position.</p> <p>Form Structure:</p> Position Field Name Field Type Purpose 1st Place <code>primero</code> <code>&lt;select&gt;</code> dropdown Participant ID selection 1st Place <code>foto1</code> <code>&lt;input type=\"file\"&gt;</code> Optional winner photo 2nd Place <code>segundo</code> <code>&lt;select&gt;</code> dropdown Participant ID selection 2nd Place <code>foto2</code> <code>&lt;input type=\"file\"&gt;</code> Optional winner photo 3rd Place <code>tercero</code> <code>&lt;select&gt;</code> dropdown Participant ID selection 3rd Place <code>foto3</code> <code>&lt;input type=\"file\"&gt;</code> Optional winner photo <p>Each dropdown is populated dynamically with all registered participants, displaying both the participant ID and full name in the format: <code>{id} \u2014 {nombre} {apellido}</code> views/info.ejs L40-L42</p> <pre><code>flowchart TD\n\nSelect1[\"select[name='primero']\"]\nFile1[\"input[name='foto1']\"]\nSelect2[\"select[name='segundo']\"]\nFile2[\"input[name='foto2']\"]\nSelect3[\"select[name='tercero']\"]\nFile3[\"input[name='foto3']\"]\nParticipantLoop[\"participantes.forEach loop&lt;br&gt;(lines 40-42, 53-55, 66-68)\"]\nFormAction[\"POST /ganadores\"]\nEnctype[\"enctype='multipart/form-data'\"]\n\nParticipantLoop --&gt; Select1\nParticipantLoop --&gt; Select2\nParticipantLoop --&gt; Select3\nSelect1 --&gt; FormAction\nFile1 --&gt; FormAction\nSelect2 --&gt; FormAction\nFile2 --&gt; FormAction\nSelect3 --&gt; FormAction\nFile3 --&gt; FormAction\n\nsubgraph subGraph2 [\"Form Submission\"]\n    FormAction\n    Enctype\n    Enctype --&gt; FormAction\nend\n\nsubgraph subGraph1 [\"Data Population\"]\n    ParticipantLoop\nend\n\nsubgraph subGraph0 [\"Form Controls\"]\n    Select1\n    File1\n    Select2\n    File2\n    Select3\n    File3\nend</code></pre> <p>Sources: views/info.ejs L34-L78</p>"},{"location":"Winner-Management/#form-validation-and-submission","title":"Form Validation and Submission","text":"<p>The form requires <code>enctype=\"multipart/form-data\"</code> to support file uploads views/info.ejs L34</p> <p>Each participant selection dropdown is marked with the <code>required</code> attribute views/info.ejs L38-L64</p> <p>ensuring that all three positions must be filled before submission. The file inputs are optional, allowing administrators to designate winners without immediately providing photos.</p> <p>The form submits to the <code>/ganadores</code> POST endpoint views/info.ejs L34</p> <p>which is protected by the <code>verifyAdmin</code> middleware as documented in Role-Based Access Control.</p>"},{"location":"Winner-Management/#feedback-messaging","title":"Feedback Messaging","text":"<p>The form displays server-side feedback messages when present. The template checks for <code>mensaje</code> and <code>mensajeTipo</code> variables views/info.ejs L79-L81</p> <p>and conditionally applies success styling when <code>mensajeTipo === 'success'</code>.</p> <p>Sources: views/info.ejs L79-L81</p>"},{"location":"Winner-Management/#winner-display-system","title":"Winner Display System","text":""},{"location":"Winner-Management/#public-winners-grid","title":"Public Winners Grid","text":"<p>The winners section renders below the race map regardless of user authentication status views/info.ejs L93-L120</p> <p>This ensures that race results are publicly visible to all visitors.</p> <pre><code>flowchart TD\n\nGanadoresCheck[\"ganadores &amp;&amp; ganadores.length &gt; 0\"]\nShowGrid[\"Render winners-grid\"]\nShowEmpty[\"Show 'A\u00fan no se han registrado'\"]\nPhotoWrap[\"winner-photo-wrap&lt;br&gt;100px circular\"]\nWinnerPhoto[\"winner-photo img\"]\nPlaceholder[\"winner-placeholder icon\"]\nPosition[\"winner-place (posicion)\"]\nName[\"winner-name (nombre + apellido)\"]\nDorsal[\"dorsal-badge\"]\nGanadoresArray[\"ganadores array\"]\nFotoField[\"g.foto\"]\nPosicionField[\"g.posicion\"]\nNombreField[\"g.nombre\"]\nApellidoField[\"g.apellido\"]\nDorsalField[\"g.dorsal\"]\n\nShowGrid --&gt; PhotoWrap\nPhotoWrap --&gt; FotoField\nFotoField --&gt; WinnerPhoto\nFotoField --&gt; Placeholder\nShowGrid --&gt; Position\nShowGrid --&gt; Name\nShowGrid --&gt; Dorsal\n\nsubgraph subGraph2 [\"Data Sources\"]\n    GanadoresArray\n    FotoField\n    PosicionField\n    NombreField\n    ApellidoField\n    DorsalField\n    GanadoresArray --&gt; PosicionField\n    GanadoresArray --&gt; NombreField\n    GanadoresArray --&gt; ApellidoField\n    GanadoresArray --&gt; DorsalField\nend\n\nsubgraph subGraph1 [\"Winner Card Components\"]\n    PhotoWrap\n    WinnerPhoto\n    Placeholder\n    Position\n    Name\n    Dorsal\nend\n\nsubgraph subGraph0 [\"Display Logic\"]\n    GanadoresCheck\n    ShowGrid\n    ShowEmpty\n    GanadoresCheck --&gt; ShowGrid\n    GanadoresCheck --&gt; ShowEmpty\nend</code></pre> <p>Sources: views/info.ejs L93-L120</p>"},{"location":"Winner-Management/#winner-card-structure","title":"Winner Card Structure","text":"<p>Each winner is rendered as an <code>article.winner-card</code> with the following structure:</p> <ol> <li>Photo Display views/info.ejs L100-L108 * If <code>g.foto</code> exists: renders <code>&lt;img&gt;</code> from <code>/uploads/participantes/{filename}</code> * If <code>g.foto</code> is null: displays a Boxicons user placeholder icon (<code>bx bxs-user</code>)</li> <li>Winner Information views/info.ejs L109-L113 * Position: <code>#{g.posicion}</code> displayed with class <code>winner-place</code> * Name: <code>{g.nombre} {g.apellido}</code> with class <code>winner-name</code> * Dorsal: \"Dorsal\" label followed by <code>{g.dorsal}</code> in a <code>dorsal-badge</code> span</li> </ol> <p>Sources: views/info.ejs L99-L114</p>"},{"location":"Winner-Management/#data-flow-and-state-management","title":"Data Flow and State Management","text":""},{"location":"Winner-Management/#winner-registration-flow","title":"Winner Registration Flow","text":"<pre><code>sequenceDiagram\n  participant Admin User\n  participant Browser\n  participant /info GET\n  participant /ganadores POST\n  participant multer.upload\n  participant Database\n  participant File System\n\n  Admin User-&gt;&gt;Browser: Navigate to /info\n  Browser-&gt;&gt;/info GET: GET /info\n  /info GET-&gt;&gt;Database: SELECT participantes\n  /info GET-&gt;&gt;Database: SELECT ganadores\n  Database--&gt;&gt;/info GET: participant list + winners\n  /info GET--&gt;&gt;Browser: Render info.ejs (isAdmin=true)\n  Admin User-&gt;&gt;Browser: Fill form + upload photos\n  Browser-&gt;&gt;/ganadores POST: POST /ganadores (multipart)\n  /ganadores POST-&gt;&gt;multer.upload: Process file uploads\n  multer.upload-&gt;&gt;File System: Save foto1, foto2, foto3\n  File System--&gt;&gt;multer.upload: File paths\n  multer.upload-&gt;&gt;/ganadores POST: req.files populated\n  /ganadores POST-&gt;&gt;Database: INSERT/UPDATE ganadores (position=1)\n  /ganadores POST-&gt;&gt;Database: INSERT/UPDATE ganadores (position=2)\n  /ganadores POST-&gt;&gt;Database: INSERT/UPDATE ganadores (position=3)\n  Database--&gt;&gt;/ganadores POST: Success\n  /ganadores POST--&gt;&gt;Browser: Redirect to /info (with mensaje)\n  Browser-&gt;&gt;/info GET: GET /info\n  /info GET--&gt;&gt;Browser: Display success message</code></pre> <p>Sources: views/info.ejs L34</p> <p>middlewares/multer.js L1-L15</p>"},{"location":"Winner-Management/#data-model-relationships","title":"Data Model Relationships","text":"<p>The <code>ganadores</code> table maintains a relationship with the <code>participantes</code> table through the <code>participant_id</code> foreign key. The table structure stores:</p> <ul> <li><code>position</code>: Integer (1, 2, or 3) identifying the podium placement</li> <li><code>participant_id</code>: Foreign key reference to <code>participantes.id</code></li> <li><code>foto</code>: Optional filename for winner-specific photo</li> </ul> <p>When rendering winners, the system performs a JOIN query to retrieve participant details (nombre, apellido, dorsal) alongside winner-specific data views/info.ejs L98</p> <p>Sources: Based on template data structure in views/info.ejs L96-L120</p>"},{"location":"Winner-Management/#file-upload-integration","title":"File Upload Integration","text":""},{"location":"Winner-Management/#multer-configuration","title":"Multer Configuration","text":"<p>The winner management system leverages the same multer configuration used for participant registration middlewares/multer.js L1-L15</p> <p>File uploads are stored in <code>public/uploads/participantes/</code> with auto-generated filenames following the pattern <code>participante-{timestamp}.{ext}</code>.</p> <p>Key Configuration Points:</p> Setting Value Purpose Destination <code>public/uploads/participantes</code> Storage directory middlewares/multer.js L7 Filename Strategy <code>participante-{Date.now()}.{ext}</code> Unique timestamped naming middlewares/multer.js L11 Storage Type <code>multer.diskStorage</code> File system storage middlewares/multer.js L5 <pre><code>flowchart TD\n\nFoto1[\"foto1 file input\"]\nFoto2[\"foto2 file input\"]\nFoto3[\"foto3 file input\"]\nStorage[\"multer.diskStorage\"]\nDestination[\"destination: public/uploads/participantes\"]\nFilename[\"filename: participante-TIMESTAMP.ext\"]\nFileSystem[\"File System\"]\nGeneratedPath[\"participante-1234567890.jpg\"]\n\nFoto1 --&gt; Storage\nFoto2 --&gt; Storage\nFoto3 --&gt; Storage\nDestination --&gt; FileSystem\nFilename --&gt; GeneratedPath\n\nsubgraph subGraph2 [\"Storage Result\"]\n    FileSystem\n    GeneratedPath\nend\n\nsubgraph subGraph1 [\"Multer Processing\"]\n    Storage\n    Destination\n    Filename\n    Storage --&gt; Destination\n    Storage --&gt; Filename\nend\n\nsubgraph subGraph0 [\"Form Upload Fields\"]\n    Foto1\n    Foto2\n    Foto3\nend</code></pre> <p>Sources: middlewares/multer.js L4-L13</p>"},{"location":"Winner-Management/#photo-display-logic","title":"Photo Display Logic","text":"<p>When displaying winners, the system checks for the existence of <code>g.foto</code> views/info.ejs L101</p> <p>If present, it constructs the image path as <code>/uploads/participantes/{g.foto}</code>. This path resolution works because the <code>public</code> directory is served as static files by the Express application.</p> <p>If no photo exists, the system displays a Boxicons user icon placeholder views/info.ejs L104-L106</p> <p>maintaining visual consistency in the winners grid even when photos are missing.</p> <p>Sources: views/info.ejs L100-L108</p>"},{"location":"Winner-Management/#styling-and-layout","title":"Styling and Layout","text":""},{"location":"Winner-Management/#css-architecture","title":"CSS Architecture","text":"<p>The winner management interface styling is defined in <code>public/css/info.css</code> using the application's design token system public/css/info.css L1-L10</p> <p>Winner Card Styling:</p> <pre><code>flowchart TD\n\nWinnersGrid[\".winners-grid&lt;br&gt;grid, auto-fit, minmax 140px\"]\nWinnerCard[\".winner-card&lt;br&gt;flex column, centered\"]\nPhotoWrap[\".winner-photo-wrap&lt;br&gt;100px circle, gradient bg\"]\nPhoto[\".winner-photo&lt;br&gt;object-fit: cover\"]\nPlaceholder[\".winner-placeholder&lt;br&gt;icon 2.2rem\"]\nPlace[\".winner-place&lt;br&gt;font-weight: 900\"]\nName[\".winner-name&lt;br&gt;font-weight: 700\"]\nBadge[\".dorsal-badge&lt;br&gt;gradient, rounded-full\"]\nDesktop[\"Desktop: auto-fit columns\"]\nTablet[\"&lt; 980px: 2 columns\"]\nMobile[\"&lt; 560px: smaller photos\"]\n\nWinnersGrid --&gt; Desktop\n\nsubgraph subGraph1 [\"Responsive Behavior\"]\n    Desktop\n    Tablet\n    Mobile\n    Desktop --&gt; Tablet\n    Tablet --&gt; Mobile\nend\n\nsubgraph subGraph0 [\"CSS Classes\"]\n    WinnersGrid\n    WinnerCard\n    PhotoWrap\n    Photo\n    Placeholder\n    Place\n    Name\n    Badge\n    WinnersGrid --&gt; WinnerCard\n    WinnerCard --&gt; PhotoWrap\n    PhotoWrap --&gt; Photo\n    PhotoWrap --&gt; Placeholder\n    WinnerCard --&gt; Place\n    WinnerCard --&gt; Name\n    WinnerCard --&gt; Badge\nend</code></pre> <p>Sources: public/css/info.css L106-L149</p> <p>public/css/info.css L193-L194</p>"},{"location":"Winner-Management/#design-tokens","title":"Design Tokens","text":"<p>The styling utilizes CSS custom properties for consistent theming:</p> <ul> <li>Primary Colors: <code>--lapis-lazuli</code> (#2f6690) and <code>--cerulean</code> (#3a7ca5)</li> <li>Background: <code>--glass</code> (rgba(255,255,255,0.96))</li> <li>Shadows: <code>--muted-shadow</code> (rgba(22,66,91,0.08))</li> </ul> <p>The winner cards feature hover effects with vertical translation and shadow enhancement public/css/info.css L121-L124</p> <p>providing interactive feedback.</p> <p>Sources: public/css/info.css L1-L10</p> <p>public/css/info.css L111-L124</p>"},{"location":"Winner-Management/#authorization-and-access-control","title":"Authorization and Access Control","text":""},{"location":"Winner-Management/#admin-only-form-access","title":"Admin-Only Form Access","text":"<p>The winner registration form is protected through template-level conditional rendering:</p> <pre><code>&lt;% if (typeof isAdmin !== 'undefined' &amp;&amp; isAdmin) { %&gt;\n  &lt;section class=\"card admin-panel\"&gt;\n    &lt;!-- Form content --&gt;\n  &lt;/section&gt;\n&lt;% } %&gt;\n</code></pre> <p>This check occurs in views/info.ejs L30</p> <p>The <code>isAdmin</code> variable must be explicitly set in the route handler's template context, typically derived from <code>req.session.rol === 'admin'</code>.</p> <p>Sources: views/info.ejs L30-L84</p>"},{"location":"Winner-Management/#backend-route-protection","title":"Backend Route Protection","text":"<p>While the form rendering is conditionally protected, the actual POST endpoint <code>/ganadores</code> must also implement server-side protection using the <code>verifyAdmin</code> middleware middlewares/verifyAdmin.js L1-L17</p> <p>This middleware:</p> <ol> <li>Extracts the JWT token from <code>req.cookies.token</code> middlewares/verifyAdmin.js L4</li> <li>Verifies the token using <code>process.env.JWT_SECRET</code> middlewares/verifyAdmin.js L8</li> <li>Checks that <code>decoded.rol === \"admin\"</code> middlewares/verifyAdmin.js L9</li> <li>Redirects to <code>/authadmin</code> if any check fails middlewares/verifyAdmin.js L5-L13</li> </ol> <pre><code>flowchart TD\n\nRequest[\"POST /ganadores request\"]\nVerifyAdmin[\"verifyAdmin middleware\"]\nCheckToken[\"Extract req.cookies.token\"]\nValidateJWT[\"jwt.verify with JWT_SECRET\"]\nCheckRole[\"decoded.rol === 'admin'\"]\nRouteHandler[\"Route handler executes\"]\nRedirectAuth[\"Redirect to /authadmin\"]\n\nRequest --&gt; VerifyAdmin\nVerifyAdmin --&gt; CheckToken\nCheckToken --&gt; ValidateJWT\nCheckToken --&gt; RedirectAuth\nValidateJWT --&gt; CheckRole\nValidateJWT --&gt; RedirectAuth\nCheckRole --&gt; RouteHandler\nCheckRole --&gt; RedirectAuth</code></pre> <p>Sources: middlewares/verifyAdmin.js L1-L17</p>"},{"location":"Winner-Management/#integration-points","title":"Integration Points","text":""},{"location":"Winner-Management/#participant-data-dependency","title":"Participant Data Dependency","text":"<p>The winner selection system depends on the participant dataset. The route handler must query the <code>participantes</code> table and pass the results to the template as the <code>participantes</code> array variable. This data populates the dropdown options in all three winner selection fields views/info.ejs L40-L68</p>"},{"location":"Winner-Management/#event-information-page-context","title":"Event Information Page Context","text":"<p>Winner management is embedded within the broader event information page, which also includes:</p> <ul> <li>Event details section views/info.ejs L16-L28</li> <li>Participant statistics views/info.ejs L21-L27</li> <li>Interactive Leaflet race map views/info.ejs L88-L145</li> <li>Social sharing buttons</li> </ul> <p>This co-location allows administrators to manage winners within the same interface where they view event statistics and participant counts.</p> <p>Sources: views/info.ejs L1-L147</p>"}]}